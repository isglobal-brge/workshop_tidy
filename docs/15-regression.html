<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="David Sarrat González, Juan R González">
<meta name="dcterms.date" content="2025-09-29">

<title>Chapter 15: Regression Models - Theory, Implementation, and Best Practices – Tidyverse &amp; Machine Learning Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-4a990d8dcb58f517c7c86712b8f2ac7c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-90ee96a17764a76d4fcf3f331faa145e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Tidyverse &amp; Machine Learning Workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-1-tidyverse" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part 1: Tidyverse</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-1-tidyverse">    
        <li>
    <a class="dropdown-item" href="./01-introduction.html">
 <span class="dropdown-text">Ch 1: Introduction to Tidyverse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02-data-import.html">
 <span class="dropdown-text">Ch 2: Data Import with readr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-data-wrangling.html">
 <span class="dropdown-text">Ch 3: Data Wrangling with dplyr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-data-tidying.html">
 <span class="dropdown-text">Ch 4: Data Tidying with tidyr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./05-visualization.html">
 <span class="dropdown-text">Ch 5: Visualization with ggplot2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./06-functional-programming.html">
 <span class="dropdown-text">Ch 6: Functional Programming with purrr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./07-strings-dates.html">
 <span class="dropdown-text">Ch 7: Strings and Dates</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-2-tidymodels" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part 2: Tidymodels</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-2-tidymodels">    
        <li>
    <a class="dropdown-item" href="./08-tidymodels-intro.html">
 <span class="dropdown-text">Ch 8: Introduction to Tidymodels</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./09-data-splitting.html">
 <span class="dropdown-text">Ch 9: Data Splitting &amp; Resampling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./10-feature-engineering.html">
 <span class="dropdown-text">Ch 10: Feature Engineering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./11-model-specification.html">
 <span class="dropdown-text">Ch 11: Model Specification</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./12-workflows-evaluation.html">
 <span class="dropdown-text">Ch 12: Workflows &amp; Evaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./13-hyperparameter-tuning.html">
 <span class="dropdown-text">Ch 13: Hyperparameter Tuning</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-3-machine-learning" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part 3: Machine Learning</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-3-machine-learning">    
        <li>
    <a class="dropdown-item" href="./14-classification.html">
 <span class="dropdown-text">Ch 14: Classification Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./15-regression.html">
 <span class="dropdown-text">Ch 15: Regression Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./16-ensemble-methods.html">
 <span class="dropdown-text">Ch 16: Ensemble Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./17-unsupervised-learning.html">
 <span class="dropdown-text">Ch 17: Unsupervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./18-model-deployment.html">
 <span class="dropdown-text">Ch 18: Model Deployment</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives">Learning Objectives</a></li>
  <li><a href="#what-is-regression" id="toc-what-is-regression" class="nav-link" data-scroll-target="#what-is-regression">What is Regression?</a>
  <ul class="collapse">
  <li><a href="#the-fundamental-question" id="toc-the-fundamental-question" class="nav-link" data-scroll-target="#the-fundamental-question">The Fundamental Question</a></li>
  </ul></li>
  <li><a href="#setup-and-data-preparation" id="toc-setup-and-data-preparation" class="nav-link" data-scroll-target="#setup-and-data-preparation">Setup and Data Preparation</a></li>
  <li><a href="#linear-regression-the-foundation" id="toc-linear-regression-the-foundation" class="nav-link" data-scroll-target="#linear-regression-the-foundation">Linear Regression: The Foundation</a>
  <ul class="collapse">
  <li><a href="#mathematical-framework" id="toc-mathematical-framework" class="nav-link" data-scroll-target="#mathematical-framework">Mathematical Framework</a></li>
  <li><a href="#the-ordinary-least-squares-ols-method" id="toc-the-ordinary-least-squares-ols-method" class="nav-link" data-scroll-target="#the-ordinary-least-squares-ols-method">The Ordinary Least Squares (OLS) Method</a></li>
  <li><a href="#key-assumptions-of-linear-regression" id="toc-key-assumptions-of-linear-regression" class="nav-link" data-scroll-target="#key-assumptions-of-linear-regression">Key Assumptions of Linear Regression</a></li>
  </ul></li>
  <li><a href="#implementing-linear-regression-with-tidymodels" id="toc-implementing-linear-regression-with-tidymodels" class="nav-link" data-scroll-target="#implementing-linear-regression-with-tidymodels">Implementing Linear Regression with Tidymodels</a>
  <ul class="collapse">
  <li><a href="#data-splitting-and-preprocessing" id="toc-data-splitting-and-preprocessing" class="nav-link" data-scroll-target="#data-splitting-and-preprocessing">Data Splitting and Preprocessing</a></li>
  <li><a href="#model-specification-and-training" id="toc-model-specification-and-training" class="nav-link" data-scroll-target="#model-specification-and-training">Model Specification and Training</a></li>
  </ul></li>
  <li><a href="#polynomial-and-non-linear-regression" id="toc-polynomial-and-non-linear-regression" class="nav-link" data-scroll-target="#polynomial-and-non-linear-regression">Polynomial and Non-linear Regression</a>
  <ul class="collapse">
  <li><a href="#understanding-polynomial-regression" id="toc-understanding-polynomial-regression" class="nav-link" data-scroll-target="#understanding-polynomial-regression">Understanding Polynomial Regression</a></li>
  <li><a href="#implementing-polynomial-features" id="toc-implementing-polynomial-features" class="nav-link" data-scroll-target="#implementing-polynomial-features">Implementing Polynomial Features</a></li>
  </ul></li>
  <li><a href="#regularization-ridge-lasso-and-elastic-net" id="toc-regularization-ridge-lasso-and-elastic-net" class="nav-link" data-scroll-target="#regularization-ridge-lasso-and-elastic-net">Regularization: Ridge, Lasso, and Elastic Net</a>
  <ul class="collapse">
  <li><a href="#understanding-regularization-mathematics" id="toc-understanding-regularization-mathematics" class="nav-link" data-scroll-target="#understanding-regularization-mathematics">Understanding Regularization Mathematics</a></li>
  <li><a href="#implementing-regularized-regression" id="toc-implementing-regularized-regression" class="nav-link" data-scroll-target="#implementing-regularized-regression">Implementing Regularized Regression</a></li>
  </ul></li>
  <li><a href="#regression-trees-and-random-forests" id="toc-regression-trees-and-random-forests" class="nav-link" data-scroll-target="#regression-trees-and-random-forests">Regression Trees and Random Forests</a>
  <ul class="collapse">
  <li><a href="#how-regression-trees-work" id="toc-how-regression-trees-work" class="nav-link" data-scroll-target="#how-regression-trees-work">How Regression Trees Work</a></li>
  <li><a href="#random-forests-for-regression" id="toc-random-forests-for-regression" class="nav-link" data-scroll-target="#random-forests-for-regression">Random Forests for Regression</a></li>
  </ul></li>
  <li><a href="#model-diagnostics-and-validation" id="toc-model-diagnostics-and-validation" class="nav-link" data-scroll-target="#model-diagnostics-and-validation">Model Diagnostics and Validation</a>
  <ul class="collapse">
  <li><a href="#residual-analysis" id="toc-residual-analysis" class="nav-link" data-scroll-target="#residual-analysis">Residual Analysis</a></li>
  <li><a href="#cross-validation-for-model-selection" id="toc-cross-validation-for-model-selection" class="nav-link" data-scroll-target="#cross-validation-for-model-selection">Cross-Validation for Model Selection</a></li>
  </ul></li>
  <li><a href="#advanced-topics" id="toc-advanced-topics" class="nav-link" data-scroll-target="#advanced-topics">Advanced Topics</a>
  <ul class="collapse">
  <li><a href="#dealing-with-multicollinearity" id="toc-dealing-with-multicollinearity" class="nav-link" data-scroll-target="#dealing-with-multicollinearity">Dealing with Multicollinearity</a></li>
  <li><a href="#handling-non-constant-variance-heteroscedasticity" id="toc-handling-non-constant-variance-heteroscedasticity" class="nav-link" data-scroll-target="#handling-non-constant-variance-heteroscedasticity">Handling Non-constant Variance (Heteroscedasticity)</a></li>
  </ul></li>
  <li><a href="#practical-example-complete-regression-pipeline" id="toc-practical-example-complete-regression-pipeline" class="nav-link" data-scroll-target="#practical-example-complete-regression-pipeline">Practical Example: Complete Regression Pipeline</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-1-implement-regularization-with-tuning" id="toc-exercise-1-implement-regularization-with-tuning" class="nav-link" data-scroll-target="#exercise-1-implement-regularization-with-tuning">Exercise 1: Implement Regularization with Tuning</a></li>
  <li><a href="#exercise-2-diagnose-and-fix-model-problems" id="toc-exercise-2-diagnose-and-fix-model-problems" class="nav-link" data-scroll-target="#exercise-2-diagnose-and-fix-model-problems">Exercise 2: Diagnose and Fix Model Problems</a></li>
  <li><a href="#exercise-3-non-linear-relationships" id="toc-exercise-3-non-linear-relationships" class="nav-link" data-scroll-target="#exercise-3-non-linear-relationships">Exercise 3: Non-linear Relationships</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#whats-next" id="toc-whats-next" class="nav-link" data-scroll-target="#whats-next">What’s Next?</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Chapter 15: Regression Models - Theory, Implementation, and Best Practices</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>David Sarrat González, Juan R González </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">September 29, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h2>
<p>By the end of this chapter, you will understand:</p>
<ul>
<li>Linear regression theory and assumptions</li>
<li>Polynomial and non-linear regression</li>
<li>Regularization techniques (Ridge, Lasso, Elastic Net)</li>
<li>Regression trees and ensemble methods</li>
<li>Model diagnostics and validation</li>
<li>Advanced regression techniques</li>
<li>Practical implementation with tidymodels</li>
</ul>
</section>
<section id="what-is-regression" class="level2">
<h2 class="anchored" data-anchor-id="what-is-regression">What is Regression?</h2>
<p>Regression analysis is a fundamental statistical technique for modeling the relationship between a dependent variable (target) and one or more independent variables (features). Unlike classification, which predicts discrete categories, regression predicts continuous numerical values.</p>
<section id="the-fundamental-question" class="level3">
<h3 class="anchored" data-anchor-id="the-fundamental-question">The Fundamental Question</h3>
<p>In regression, we’re essentially asking: “Given these input features, what numerical value should we predict?” This could be: - Predicting house prices based on size, location, and amenities - Estimating customer lifetime value from behavior patterns - Forecasting sales based on historical data and market conditions - Determining optimal drug dosage based on patient characteristics</p>
</section>
</section>
<section id="setup-and-data-preparation" class="level2">
<h2 class="anchored" data-anchor-id="setup-and-data-preparation">Setup and Data Preparation</h2>
<p>Let’s begin by loading the necessary libraries and preparing our datasets. We’ll use multiple datasets throughout this chapter to illustrate different concepts and techniques.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>-- Attaching packages -------------------------------------- tidymodels 1.4.1 --</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>v broom        1.0.10     v recipes      1.3.1 
v dials        1.4.2      v rsample      1.3.1 
v dplyr        1.1.4      v tailor       0.1.0 
v ggplot2      4.0.0      v tidyr        1.3.1 
v infer        1.0.9      v tune         2.0.0 
v modeldata    1.5.1      v workflows    1.3.0 
v parsnip      1.3.3      v workflowsets 1.1.1 
v purrr        1.1.0      v yardstick    1.3.2 </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- Conflicts ----------------------------------------- tidymodels_conflicts() --
x purrr::discard() masks scales::discard()
x dplyr::filter()  masks stats::filter()
x dplyr::lag()     masks stats::lag()
x recipes::step()  masks stats::step()</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>-- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --
v forcats   1.0.0     v stringr   1.5.2
v lubridate 1.9.4     v tibble    3.3.0
v readr     2.1.5     </code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>-- Conflicts ------------------------------------------ tidyverse_conflicts() --
x readr::col_factor() masks scales::col_factor()
x purrr::discard()    masks scales::discard()
x dplyr::filter()     masks stats::filter()
x stringr::fixed()    masks recipes::fixed()
x dplyr::lag()        masks stats::lag()
x readr::spec()       masks yardstick::spec()
i Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modeldata)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Adjuntando el paquete: 'vip'

The following object is masked from 'package:utils':

    vi</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Cargando paquete requerido: Matrix

Adjuntando el paquete: 'Matrix'

The following objects are masked from 'package:tidyr':

    expand, pack, unpack

Loaded glmnet 4.1-10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>corrplot 0.95 loaded</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Adjuntando el paquete: 'performance'

The following objects are masked from 'package:yardstick':

    mae, rmse</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set theme and seed for reproducibility</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Load datasets</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(ames)        <span class="co"># House prices dataset</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(concrete)    <span class="co"># Concrete strength dataset</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Chicago)     <span class="co"># Chicago ridership data</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick overview of our main dataset</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(ames)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,930
Columns: 74
$ MS_SubClass        &lt;fct&gt; One_Story_1946_and_Newer_All_Styles, One_Story_1946~
$ MS_Zoning          &lt;fct&gt; Residential_Low_Density, Residential_High_Density, ~
$ Lot_Frontage       &lt;dbl&gt; 141, 80, 81, 93, 74, 78, 41, 43, 39, 60, 75, 0, 63,~
$ Lot_Area           &lt;int&gt; 31770, 11622, 14267, 11160, 13830, 9978, 4920, 5005~
$ Street             &lt;fct&gt; Pave, Pave, Pave, Pave, Pave, Pave, Pave, Pave, Pav~
$ Alley              &lt;fct&gt; No_Alley_Access, No_Alley_Access, No_Alley_Access, ~
$ Lot_Shape          &lt;fct&gt; Slightly_Irregular, Regular, Slightly_Irregular, Re~
$ Land_Contour       &lt;fct&gt; Lvl, Lvl, Lvl, Lvl, Lvl, Lvl, Lvl, HLS, Lvl, Lvl, L~
$ Utilities          &lt;fct&gt; AllPub, AllPub, AllPub, AllPub, AllPub, AllPub, All~
$ Lot_Config         &lt;fct&gt; Corner, Inside, Corner, Corner, Inside, Inside, Ins~
$ Land_Slope         &lt;fct&gt; Gtl, Gtl, Gtl, Gtl, Gtl, Gtl, Gtl, Gtl, Gtl, Gtl, G~
$ Neighborhood       &lt;fct&gt; North_Ames, North_Ames, North_Ames, North_Ames, Gil~
$ Condition_1        &lt;fct&gt; Norm, Feedr, Norm, Norm, Norm, Norm, Norm, Norm, No~
$ Condition_2        &lt;fct&gt; Norm, Norm, Norm, Norm, Norm, Norm, Norm, Norm, Nor~
$ Bldg_Type          &lt;fct&gt; OneFam, OneFam, OneFam, OneFam, OneFam, OneFam, Twn~
$ House_Style        &lt;fct&gt; One_Story, One_Story, One_Story, One_Story, Two_Sto~
$ Overall_Cond       &lt;fct&gt; Average, Above_Average, Above_Average, Average, Ave~
$ Year_Built         &lt;int&gt; 1960, 1961, 1958, 1968, 1997, 1998, 2001, 1992, 199~
$ Year_Remod_Add     &lt;int&gt; 1960, 1961, 1958, 1968, 1998, 1998, 2001, 1992, 199~
$ Roof_Style         &lt;fct&gt; Hip, Gable, Hip, Hip, Gable, Gable, Gable, Gable, G~
$ Roof_Matl          &lt;fct&gt; CompShg, CompShg, CompShg, CompShg, CompShg, CompSh~
$ Exterior_1st       &lt;fct&gt; BrkFace, VinylSd, Wd Sdng, BrkFace, VinylSd, VinylS~
$ Exterior_2nd       &lt;fct&gt; Plywood, VinylSd, Wd Sdng, BrkFace, VinylSd, VinylS~
$ Mas_Vnr_Type       &lt;fct&gt; Stone, None, BrkFace, None, None, BrkFace, None, No~
$ Mas_Vnr_Area       &lt;dbl&gt; 112, 0, 108, 0, 0, 20, 0, 0, 0, 0, 0, 0, 0, 0, 0, 6~
$ Exter_Cond         &lt;fct&gt; Typical, Typical, Typical, Typical, Typical, Typica~
$ Foundation         &lt;fct&gt; CBlock, CBlock, CBlock, CBlock, PConc, PConc, PConc~
$ Bsmt_Cond          &lt;fct&gt; Good, Typical, Typical, Typical, Typical, Typical, ~
$ Bsmt_Exposure      &lt;fct&gt; Gd, No, No, No, No, No, Mn, No, No, No, No, No, No,~
$ BsmtFin_Type_1     &lt;fct&gt; BLQ, Rec, ALQ, ALQ, GLQ, GLQ, GLQ, ALQ, GLQ, Unf, U~
$ BsmtFin_SF_1       &lt;dbl&gt; 2, 6, 1, 1, 3, 3, 3, 1, 3, 7, 7, 1, 7, 3, 3, 1, 3, ~
$ BsmtFin_Type_2     &lt;fct&gt; Unf, LwQ, Unf, Unf, Unf, Unf, Unf, Unf, Unf, Unf, U~
$ BsmtFin_SF_2       &lt;dbl&gt; 0, 144, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1120, 0~
$ Bsmt_Unf_SF        &lt;dbl&gt; 441, 270, 406, 1045, 137, 324, 722, 1017, 415, 994,~
$ Total_Bsmt_SF      &lt;dbl&gt; 1080, 882, 1329, 2110, 928, 926, 1338, 1280, 1595, ~
$ Heating            &lt;fct&gt; GasA, GasA, GasA, GasA, GasA, GasA, GasA, GasA, Gas~
$ Heating_QC         &lt;fct&gt; Fair, Typical, Typical, Excellent, Good, Excellent,~
$ Central_Air        &lt;fct&gt; Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, Y, ~
$ Electrical         &lt;fct&gt; SBrkr, SBrkr, SBrkr, SBrkr, SBrkr, SBrkr, SBrkr, SB~
$ First_Flr_SF       &lt;int&gt; 1656, 896, 1329, 2110, 928, 926, 1338, 1280, 1616, ~
$ Second_Flr_SF      &lt;int&gt; 0, 0, 0, 0, 701, 678, 0, 0, 0, 776, 892, 0, 676, 0,~
$ Gr_Liv_Area        &lt;int&gt; 1656, 896, 1329, 2110, 1629, 1604, 1338, 1280, 1616~
$ Bsmt_Full_Bath     &lt;dbl&gt; 1, 0, 0, 1, 0, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, ~
$ Bsmt_Half_Bath     &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ~
$ Full_Bath          &lt;int&gt; 1, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 1, 1, 3, 2, ~
$ Half_Bath          &lt;int&gt; 0, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, ~
$ Bedroom_AbvGr      &lt;int&gt; 3, 2, 3, 3, 3, 3, 2, 2, 2, 3, 3, 3, 3, 2, 1, 4, 4, ~
$ Kitchen_AbvGr      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, ~
$ TotRms_AbvGrd      &lt;int&gt; 7, 5, 6, 8, 6, 7, 6, 5, 5, 7, 7, 6, 7, 5, 4, 12, 8,~
$ Functional         &lt;fct&gt; Typ, Typ, Typ, Typ, Typ, Typ, Typ, Typ, Typ, Typ, T~
$ Fireplaces         &lt;int&gt; 2, 0, 0, 2, 1, 1, 0, 0, 1, 1, 1, 0, 1, 1, 0, 1, 0, ~
$ Garage_Type        &lt;fct&gt; Attchd, Attchd, Attchd, Attchd, Attchd, Attchd, Att~
$ Garage_Finish      &lt;fct&gt; Fin, Unf, Unf, Fin, Fin, Fin, Fin, RFn, RFn, Fin, F~
$ Garage_Cars        &lt;dbl&gt; 2, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 3, 2, ~
$ Garage_Area        &lt;dbl&gt; 528, 730, 312, 522, 482, 470, 582, 506, 608, 442, 4~
$ Garage_Cond        &lt;fct&gt; Typical, Typical, Typical, Typical, Typical, Typica~
$ Paved_Drive        &lt;fct&gt; Partial_Pavement, Paved, Paved, Paved, Paved, Paved~
$ Wood_Deck_SF       &lt;int&gt; 210, 140, 393, 0, 212, 360, 0, 0, 237, 140, 157, 48~
$ Open_Porch_SF      &lt;int&gt; 62, 0, 36, 0, 34, 36, 0, 82, 152, 60, 84, 21, 75, 0~
$ Enclosed_Porch     &lt;int&gt; 0, 0, 0, 0, 0, 0, 170, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0~
$ Three_season_porch &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ~
$ Screen_Porch       &lt;int&gt; 0, 120, 0, 0, 0, 0, 0, 144, 0, 0, 0, 0, 0, 0, 140, ~
$ Pool_Area          &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, ~
$ Pool_QC            &lt;fct&gt; No_Pool, No_Pool, No_Pool, No_Pool, No_Pool, No_Poo~
$ Fence              &lt;fct&gt; No_Fence, Minimum_Privacy, No_Fence, No_Fence, Mini~
$ Misc_Feature       &lt;fct&gt; None, None, Gar2, None, None, None, None, None, Non~
$ Misc_Val           &lt;int&gt; 0, 0, 12500, 0, 0, 0, 0, 0, 0, 0, 0, 500, 0, 0, 0, ~
$ Mo_Sold            &lt;int&gt; 5, 6, 6, 4, 3, 6, 4, 1, 3, 6, 4, 3, 5, 2, 6, 6, 6, ~
$ Year_Sold          &lt;int&gt; 2010, 2010, 2010, 2010, 2010, 2010, 2010, 2010, 201~
$ Sale_Type          &lt;fct&gt; WD , WD , WD , WD , WD , WD , WD , WD , WD , WD , W~
$ Sale_Condition     &lt;fct&gt; Normal, Normal, Normal, Normal, Normal, Normal, Nor~
$ Sale_Price         &lt;int&gt; 215000, 105000, 172000, 244000, 189900, 195500, 213~
$ Longitude          &lt;dbl&gt; -93.61975, -93.61976, -93.61939, -93.61732, -93.638~
$ Latitude           &lt;dbl&gt; 42.05403, 42.05301, 42.05266, 42.05125, 42.06090, 4~</code></pre>
</div>
</div>
<p>The Ames housing dataset contains information about residential homes sold in Ames, Iowa. It’s perfect for demonstrating regression techniques because: - It has a clear continuous target (Sale_Price) - It contains both numeric and categorical predictors - It has enough complexity to showcase advanced techniques - It’s real-world data with typical challenges (missing values, outliers, etc.)</p>
</section>
<section id="linear-regression-the-foundation" class="level2">
<h2 class="anchored" data-anchor-id="linear-regression-the-foundation">Linear Regression: The Foundation</h2>
<section id="mathematical-framework" class="level3">
<h3 class="anchored" data-anchor-id="mathematical-framework">Mathematical Framework</h3>
<p>Linear regression assumes a linear relationship between predictors and the response. The model can be expressed as:</p>
<p><span class="math display">\[Y = \beta_0 + \beta_1X_1 + \beta_2X_2 + ... + \beta_pX_p + \epsilon\]</span></p>
<p>Where: - <span class="math inline">\(Y\)</span> is the response variable - <span class="math inline">\(X_1, ..., X_p\)</span> are the predictor variables - <span class="math inline">\(\beta_0\)</span> is the intercept (the expected value of Y when all X = 0) - <span class="math inline">\(\beta_1, ..., \beta_p\)</span> are the coefficients (slopes) - <span class="math inline">\(\epsilon\)</span> is the error term (assumed to be normally distributed with mean 0)</p>
</section>
<section id="the-ordinary-least-squares-ols-method" class="level3">
<h3 class="anchored" data-anchor-id="the-ordinary-least-squares-ols-method">The Ordinary Least Squares (OLS) Method</h3>
<p>The most common method for estimating the coefficients is Ordinary Least Squares, which minimizes the sum of squared residuals:</p>
<p><span class="math display">\[\text{RSS} = \sum_{i=1}^{n} (y_i - \hat{y}_i)^2 = \sum_{i=1}^{n} (y_i - \beta_0 - \sum_{j=1}^{p} \beta_j x_{ij})^2\]</span></p>
<p>Let’s visualize this concept:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create simple example data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>simple_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">50</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_true =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> x,  <span class="co"># True relationship</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y_true <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">3</span>)  <span class="co"># Add noise</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit simple linear regression</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>simple_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> simple_data)</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Add predictions and residuals</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>simple_data <span class="ot">&lt;-</span> simple_data <span class="sc">%&gt;%</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_pred =</span> <span class="fu">predict</span>(simple_lm),</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">residual =</span> y <span class="sc">-</span> y_pred</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize OLS concept</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(simple_data, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> x, <span class="at">y =</span> y, <span class="at">yend =</span> y_pred), </span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_pred), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_true), <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Ordinary Least Squares Visualization"</span>,</span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Red lines show residuals (errors) being minimized"</span>,</span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Predictor (X)"</span>,</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Response (Y)"</span></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="dv">15</span>, <span class="at">label =</span> <span class="st">"True relationship"</span>, </span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb18-34"><a href="#cb18-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="dv">25</span>, <span class="at">label =</span> <span class="st">"Fitted line"</span>, </span>
<span id="cb18-35"><a href="#cb18-35" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb18-36"><a href="#cb18-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-37"><a href="#cb18-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual distribution</span></span>
<span id="cb18-38"><a href="#cb18-38" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(simple_data, <span class="fu">aes</span>(<span class="at">x =</span> residual)) <span class="sc">+</span></span>
<span id="cb18-39"><a href="#cb18-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb18-40"><a href="#cb18-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb18-41"><a href="#cb18-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-42"><a href="#cb18-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Residuals"</span>,</span>
<span id="cb18-43"><a href="#cb18-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Should be centered at zero and approximately normal"</span>,</span>
<span id="cb18-44"><a href="#cb18-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Residual"</span>,</span>
<span id="cb18-45"><a href="#cb18-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Count"</span></span>
<span id="cb18-46"><a href="#cb18-46" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb18-47"><a href="#cb18-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-48"><a href="#cb18-48" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="key-assumptions-of-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="key-assumptions-of-linear-regression">Key Assumptions of Linear Regression</h3>
<p>Understanding the assumptions is crucial for proper model interpretation and validation:</p>
<ol type="1">
<li><strong>Linearity</strong>: The relationship between X and Y is linear</li>
<li><strong>Independence</strong>: Observations are independent of each other</li>
<li><strong>Homoscedasticity</strong>: Constant variance of residuals</li>
<li><strong>Normality</strong>: Residuals are normally distributed</li>
<li><strong>No multicollinearity</strong>: Predictors are not highly correlated</li>
</ol>
<p>Let’s check these assumptions with real data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare Ames data for simple example</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>ames_simple <span class="ot">&lt;-</span> ames <span class="sc">%&gt;%</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sale_Price, Gr_Liv_Area, Year_Built, Overall_Cond) <span class="sc">%&gt;%</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>ames_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sale_Price <span class="sc">~</span> Gr_Liv_Area <span class="sc">+</span> Year_Built <span class="sc">+</span> Overall_Cond, </span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> ames_simple)</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create diagnostic plots</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ames_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>Each diagnostic plot tells us something important: - <strong>Residuals vs Fitted</strong>: Checks linearity and homoscedasticity. We want no clear pattern. - <strong>Q-Q Plot</strong>: Checks normality of residuals. Points should follow the diagonal line. - <strong>Scale-Location</strong>: Another check for homoscedasticity. We want a horizontal line. - <strong>Residuals vs Leverage</strong>: Identifies influential points that might unduly affect the model.</p>
</section>
</section>
<section id="implementing-linear-regression-with-tidymodels" class="level2">
<h2 class="anchored" data-anchor-id="implementing-linear-regression-with-tidymodels">Implementing Linear Regression with Tidymodels</h2>
<p>Now let’s implement a proper regression workflow using tidymodels. We’ll predict house prices using multiple features.</p>
<section id="data-splitting-and-preprocessing" class="level3">
<h3 class="anchored" data-anchor-id="data-splitting-and-preprocessing">Data Splitting and Preprocessing</h3>
<p>First, we need to properly split our data and create a preprocessing recipe. This is crucial to avoid data leakage and ensure fair model evaluation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean and prepare the Ames data</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>ames_clean <span class="ot">&lt;-</span> ames <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Sale_Price =</span> <span class="fu">log10</span>(Sale_Price)) <span class="sc">%&gt;%</span>  <span class="co"># Log transform for better distribution</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"_Condition"</span>))  <span class="co"># Remove some problematic variables</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>ames_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(ames_clean, <span class="at">prop =</span> <span class="fl">0.75</span>, <span class="at">strata =</span> Sale_Price)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>ames_train <span class="ot">&lt;-</span> <span class="fu">training</span>(ames_split)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>ames_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(ames_split)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create preprocessing recipe</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>ames_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> ames_train) <span class="sc">%&gt;%</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove variables with near-zero variance</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_nzv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Impute missing values</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create dummy variables for categorical predictors</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize numeric predictors</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the recipe</span></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="fu">prep</span>(ames_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 2,197
Columns: 210
$ Lot_Frontage                                          &lt;dbl&gt; 0.38099161, -1.0~
$ Lot_Area                                              &lt;dbl&gt; -0.23232512, -1.~
$ Year_Built                                            &lt;dbl&gt; -0.036951183, -0~
$ Year_Remod_Add                                        &lt;dbl&gt; -0.671110551, -0~
$ Mas_Vnr_Area                                          &lt;dbl&gt; -0.56439715, 2.2~
$ BsmtFin_SF_1                                          &lt;dbl&gt; -1.4325147, 0.80~
$ BsmtFin_SF_2                                          &lt;dbl&gt; 0.1623553, -0.29~
$ Bsmt_Unf_SF                                           &lt;dbl&gt; -1.26807359, -0.~
$ Total_Bsmt_SF                                         &lt;dbl&gt; -0.369147073, -1~
$ First_Flr_SF                                          &lt;dbl&gt; -0.705259283, -1~
$ Second_Flr_SF                                         &lt;dbl&gt; -0.78932267, 0.3~
$ Gr_Liv_Area                                           &lt;dbl&gt; -1.2416271, -1.0~
$ Bsmt_Full_Bath                                        &lt;dbl&gt; 1.0937422, -0.81~
$ Bsmt_Half_Bath                                        &lt;dbl&gt; -0.2447953, -0.2~
$ Full_Bath                                             &lt;dbl&gt; -1.0378355, -1.0~
$ Half_Bath                                             &lt;dbl&gt; -0.7549524, 1.22~
$ Bedroom_AbvGr                                         &lt;dbl&gt; -1.0622200, -1.0~
$ TotRms_AbvGrd                                         &lt;dbl&gt; -1.5633313, -0.9~
$ Fireplaces                                            &lt;dbl&gt; -0.9316181, -0.9~
$ Garage_Cars                                           &lt;dbl&gt; 0.3179223, -1.00~
$ Garage_Area                                           &lt;dbl&gt; 0.2574653, -0.96~
$ Wood_Deck_SF                                          &lt;dbl&gt; 1.22164555, 1.50~
$ Open_Porch_SF                                         &lt;dbl&gt; -0.69696285, -0.~
$ Mo_Sold                                               &lt;dbl&gt; -0.81175416, -1.~
$ Year_Sold                                             &lt;dbl&gt; 1.67607, 1.67607~
$ Longitude                                             &lt;dbl&gt; 0.6146441, 0.608~
$ Latitude                                              &lt;dbl&gt; 1.03189989, 0.94~
$ Sale_Price                                            &lt;dbl&gt; 5.100371, 4.9822~
$ MS_SubClass_One_Story_1945_and_Older                  &lt;dbl&gt; -0.2194655, -0.2~
$ MS_SubClass_One_Story_with_Finished_Attic_All_Ages    &lt;dbl&gt; -0.04269842, -0.~
$ MS_SubClass_One_and_Half_Story_Unfinished_All_Ages    &lt;dbl&gt; -0.08006419, -0.~
$ MS_SubClass_One_and_Half_Story_Finished_All_Ages      &lt;dbl&gt; -0.3368694, -0.3~
$ MS_SubClass_Two_Story_1946_and_Newer                  &lt;dbl&gt; -0.4924801, -0.4~
$ MS_SubClass_Two_Story_1945_and_Older                  &lt;dbl&gt; -0.2148708, -0.2~
$ MS_SubClass_Two_and_Half_Story_All_Ages               &lt;dbl&gt; -0.09086754, -0.~
$ MS_SubClass_Split_or_Multilevel                       &lt;dbl&gt; -0.2066285, -0.2~
$ MS_SubClass_Split_Foyer                               &lt;dbl&gt; -0.1290402, -0.1~
$ MS_SubClass_Duplex_All_Styles_and_Ages                &lt;dbl&gt; -0.1968579, -0.1~
$ MS_SubClass_One_Story_PUD_1946_and_Newer              &lt;dbl&gt; -0.2628085, -0.2~
$ MS_SubClass_One_and_Half_Story_PUD_All_Ages           &lt;dbl&gt; -0.02133462, -0.~
$ MS_SubClass_Two_Story_PUD_1946_and_Newer              &lt;dbl&gt; -0.2171781, 4.60~
$ MS_SubClass_PUD_Multilevel_Split_Level_Foyer          &lt;dbl&gt; -0.08289329, -0.~
$ MS_SubClass_Two_Family_conversion_All_Styles_and_Ages &lt;dbl&gt; -0.1412578, -0.1~
$ MS_Zoning_Residential_High_Density                    &lt;dbl&gt; -0.08828712, -0.~
$ MS_Zoning_Residential_Low_Density                     &lt;dbl&gt; 0.5433843, -1.83~
$ MS_Zoning_Residential_Medium_Density                  &lt;dbl&gt; -0.4352129, 2.29~
$ MS_Zoning_A_agr                                       &lt;dbl&gt; -0.03017859, -0.~
$ MS_Zoning_C_all                                       &lt;dbl&gt; -0.1005502, -0.1~
$ MS_Zoning_I_all                                       &lt;dbl&gt; -0.02133462, -0.~
$ Lot_Shape_Slightly_Irregular                          &lt;dbl&gt; -0.7154097, -0.7~
$ Lot_Shape_Moderately_Irregular                        &lt;dbl&gt; -0.1660823, -0.1~
$ Lot_Shape_Irregular                                   &lt;dbl&gt; -0.06760468, -0.~
$ Lot_Config_CulDSac                                    &lt;dbl&gt; -0.2548026, -0.2~
$ Lot_Config_FR2                                        &lt;dbl&gt; -0.1786766, -0.1~
$ Lot_Config_FR3                                        &lt;dbl&gt; -0.07713411, -0.~
$ Lot_Config_Inside                                     &lt;dbl&gt; -1.649997, 0.605~
$ Neighborhood_College_Creek                            &lt;dbl&gt; -0.318997, -0.31~
$ Neighborhood_Old_Town                                 &lt;dbl&gt; -0.2950355, -0.2~
$ Neighborhood_Edwards                                  &lt;dbl&gt; -0.266744, -0.26~
$ Neighborhood_Somerset                                 &lt;dbl&gt; -0.2618178, -0.2~
$ Neighborhood_Northridge_Heights                       &lt;dbl&gt; -0.2392499, -0.2~
$ Neighborhood_Gilbert                                  &lt;dbl&gt; -0.2434722, -0.2~
$ Neighborhood_Sawyer                                   &lt;dbl&gt; -0.2217336, -0.2~
$ Neighborhood_Northwest_Ames                           &lt;dbl&gt; -0.2183242, -0.2~
$ Neighborhood_Sawyer_West                              &lt;dbl&gt; -0.2171781, -0.2~
$ Neighborhood_Mitchell                                 &lt;dbl&gt; -0.1981015, -0.1~
$ Neighborhood_Brookside                                &lt;dbl&gt; -0.1981015, -0.1~
$ Neighborhood_Crawford                                 &lt;dbl&gt; -0.1968579, -0.1~
$ Neighborhood_Iowa_DOT_and_Rail_Road                   &lt;dbl&gt; -0.1918152, -0.1~
$ Neighborhood_Timberland                               &lt;dbl&gt; -0.1587037, -0.1~
$ Neighborhood_Northridge                               &lt;dbl&gt; -0.1571906, -0.1~
$ Neighborhood_Stone_Brook                              &lt;dbl&gt; -0.1378697, -0.1~
$ Neighborhood_South_and_West_of_Iowa_State_University  &lt;dbl&gt; -0.1196059, -0.1~
$ Neighborhood_Clear_Creek                              &lt;dbl&gt; -0.1215478, -0.1~
$ Neighborhood_Meadow_Village                           &lt;dbl&gt; -0.1135927, -0.1~
$ Neighborhood_Briardale                                &lt;dbl&gt; -0.09582679, 10.~
$ Neighborhood_Bloomington_Heights                      &lt;dbl&gt; -0.09582679, -0.~
$ Neighborhood_Veenker                                  &lt;dbl&gt; -0.09582679, -0.~
$ Neighborhood_Northpark_Villa                          &lt;dbl&gt; -0.09086754, -0.~
$ Neighborhood_Blueste                                  &lt;dbl&gt; -0.06043983, -0.~
$ Neighborhood_Greens                                   &lt;dbl&gt; -0.04269842, -0.~
$ Neighborhood_Green_Hills                              &lt;dbl&gt; 0, 0, 0, 0, 0, 0~
$ Neighborhood_Landmark                                 &lt;dbl&gt; -0.02133462, -0.~
$ Neighborhood_Hayden_Lake                              &lt;dbl&gt; 0, 0, 0, 0, 0, 0~
$ Condition_1_Feedr                                     &lt;dbl&gt; -0.2497013, -0.2~
$ Condition_1_Norm                                      &lt;dbl&gt; 0.4059855, 0.405~
$ Condition_1_PosA                                      &lt;dbl&gt; -0.08828712, -0.~
$ Condition_1_PosN                                      &lt;dbl&gt; -0.1094102, -0.1~
$ Condition_1_RRAe                                      &lt;dbl&gt; -0.09582679, -0.~
$ Condition_1_RRAn                                      &lt;dbl&gt; -0.1308504, -0.1~
$ Condition_1_RRNe                                      &lt;dbl&gt; -0.04269842, -0.~
$ Condition_1_RRNn                                      &lt;dbl&gt; -0.05231854, -0.~
$ Bldg_Type_TwoFmCon                                    &lt;dbl&gt; -0.1429241, -0.1~
$ Bldg_Type_Duplex                                      &lt;dbl&gt; -0.1968579, -0.1~
$ Bldg_Type_Twnhs                                       &lt;dbl&gt; -0.1892507, 5.28~
$ Bldg_Type_TwnhsE                                      &lt;dbl&gt; -0.2950355, -0.2~
$ House_Style_One_and_Half_Unf                          &lt;dbl&gt; -0.08289329, -0.~
$ House_Style_One_Story                                 &lt;dbl&gt; 0.996592, -1.002~
$ House_Style_SFoyer                                    &lt;dbl&gt; -0.1631668, -0.1~
$ House_Style_SLvl                                      &lt;dbl&gt; -0.2171781, -0.2~
$ House_Style_Two_and_Half_Fin                          &lt;dbl&gt; -0.05231854, -0.~
$ House_Style_Two_and_Half_Unf                          &lt;dbl&gt; -0.0982158, -0.0~
$ House_Style_Two_Story                                 &lt;dbl&gt; -0.6508892, 1.53~
$ Overall_Cond_Poor                                     &lt;dbl&gt; -0.05652338, -0.~
$ Overall_Cond_Fair                                     &lt;dbl&gt; -0.1326376, -0.1~
$ Overall_Cond_Below_Average                            &lt;dbl&gt; -0.1813704, -0.1~
$ Overall_Cond_Average                                  &lt;dbl&gt; 0.8734386, 0.873~
$ Overall_Cond_Above_Average                            &lt;dbl&gt; -0.4688046, -0.4~
$ Overall_Cond_Good                                     &lt;dbl&gt; -0.3859932, -0.3~
$ Overall_Cond_Very_Good                                &lt;dbl&gt; -0.2317166, -0.2~
$ Overall_Cond_Excellent                                &lt;dbl&gt; -0.1308504, -0.1~
$ Overall_Cond_Very_Excellent                           &lt;dbl&gt; 0, 0, 0, 0, 0, 0~
$ Roof_Style_Gable                                      &lt;dbl&gt; 0.5109551, 0.510~
$ Roof_Style_Gambrel                                    &lt;dbl&gt; -0.09337895, -0.~
$ Roof_Style_Hip                                        &lt;dbl&gt; -0.4788845, -0.4~
$ Roof_Style_Mansard                                    &lt;dbl&gt; -0.06043983, -0.~
$ Roof_Style_Shed                                       &lt;dbl&gt; -0.03696949, -0.~
$ Exterior_1st_AsphShn                                  &lt;dbl&gt; -0.03017859, -0.~
$ Exterior_1st_BrkComm                                  &lt;dbl&gt; -0.03696949, -0.~
$ Exterior_1st_BrkFace                                  &lt;dbl&gt; -0.1800279, -0.1~
$ Exterior_1st_CBlock                                   &lt;dbl&gt; -0.02133462, -0.~
$ Exterior_1st_CemntBd                                  &lt;dbl&gt; -0.2171781, -0.2~
$ Exterior_1st_HdBoard                                  &lt;dbl&gt; -0.4165718, 2.39~
$ Exterior_1st_ImStucc                                  &lt;dbl&gt; -0.02133462, -0.~
$ Exterior_1st_MetalSd                                  &lt;dbl&gt; -0.4337328, -0.4~
$ Exterior_1st_Plywood                                  &lt;dbl&gt; 3.497052, -0.285~
$ Exterior_1st_PreCast                                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0~
$ Exterior_1st_Stone                                    &lt;dbl&gt; -0.03017859, -0.~
$ Exterior_1st_Stucco                                   &lt;dbl&gt; -0.1272059, -0.1~
$ Exterior_1st_VinylSd                                  &lt;dbl&gt; -0.7307357, -0.7~
$ Exterior_1st_Wd.Sdng                                  &lt;dbl&gt; -0.4014121, -0.4~
$ Exterior_1st_WdShing                                  &lt;dbl&gt; -0.1429241, -0.1~
$ Exterior_2nd_AsphShn                                  &lt;dbl&gt; -0.04269842, -0.~
$ Exterior_2nd_Brk.Cmn                                  &lt;dbl&gt; -0.08563145, -0.~
$ Exterior_2nd_BrkFace                                  &lt;dbl&gt; -0.1290402, -0.1~
$ Exterior_2nd_CBlock                                   &lt;dbl&gt; -0.02133462, -0.~
$ Exterior_2nd_CmentBd                                  &lt;dbl&gt; -0.2171781, -0.2~
$ Exterior_2nd_HdBoard                                  &lt;dbl&gt; -0.3937376, 2.53~
$ Exterior_2nd_ImStucc                                  &lt;dbl&gt; -0.07713411, -0.~
$ Exterior_2nd_MetalSd                                  &lt;dbl&gt; -0.4300246, -0.4~
$ Exterior_2nd_Other                                    &lt;dbl&gt; 0, 0, 0, 0, 0, 0~
$ Exterior_2nd_Plywood                                  &lt;dbl&gt; 3.1249258, -0.31~
$ Exterior_2nd_PreCast                                  &lt;dbl&gt; 0, 0, 0, 0, 0, 0~
$ Exterior_2nd_Stone                                    &lt;dbl&gt; -0.04774917, -0.~
$ Exterior_2nd_Stucco                                   &lt;dbl&gt; -0.1308504, -0.1~
$ Exterior_2nd_VinylSd                                  &lt;dbl&gt; -0.7263444, -0.7~
$ Exterior_2nd_Wd.Sdng                                  &lt;dbl&gt; -0.3898745, -0.3~
$ Exterior_2nd_Wd.Shng                                  &lt;dbl&gt; -0.1786766, -0.1~
$ Mas_Vnr_Type_BrkFace                                  &lt;dbl&gt; -0.6558526, 1.52~
$ Mas_Vnr_Type_CBlock                                   &lt;dbl&gt; -0.02133462, -0.~
$ Mas_Vnr_Type_None                                     &lt;dbl&gt; 0.8095158, -1.23~
$ Mas_Vnr_Type_Stone                                    &lt;dbl&gt; -0.3049467, -0.3~
$ Exter_Cond_Fair                                       &lt;dbl&gt; -0.1541244, -0.1~
$ Exter_Cond_Good                                       &lt;dbl&gt; -0.3460075, -0.3~
$ Exter_Cond_Poor                                       &lt;dbl&gt; -0.03017859, -0.~
$ Exter_Cond_Typical                                    &lt;dbl&gt; 0.3975833, 0.397~
$ Foundation_CBlock                                     &lt;dbl&gt; 1.1615155, 1.161~
$ Foundation_PConc                                      &lt;dbl&gt; -0.8872845, -0.8~
$ Foundation_Slab                                       &lt;dbl&gt; -0.1395732, -0.1~
$ Foundation_Stone                                      &lt;dbl&gt; -0.06043983, -0.~
$ Foundation_Wood                                       &lt;dbl&gt; -0.04774917, -0.~
$ Bsmt_Exposure_Gd                                      &lt;dbl&gt; -0.3137757, -0.3~
$ Bsmt_Exposure_Mn                                      &lt;dbl&gt; -0.3013679, -0.3~
$ Bsmt_Exposure_No                                      &lt;dbl&gt; 0.7358721, 0.735~
$ Bsmt_Exposure_No_Basement                             &lt;dbl&gt; -0.1773163, -0.1~
$ BsmtFin_Type_1_BLQ                                    &lt;dbl&gt; -0.312900, -0.31~
$ BsmtFin_Type_1_GLQ                                    &lt;dbl&gt; -0.6423969, -0.6~
$ BsmtFin_Type_1_LwQ                                    &lt;dbl&gt; -0.2317166, -0.2~
$ BsmtFin_Type_1_No_Basement                            &lt;dbl&gt; -0.1745678, -0.1~
$ BsmtFin_Type_1_Rec                                    &lt;dbl&gt; -0.3351923, 2.98~
$ BsmtFin_Type_1_Unf                                    &lt;dbl&gt; -0.6416901, -0.6~
$ Heating_QC_Fair                                       &lt;dbl&gt; -0.1918152, -0.1~
$ Heating_QC_Good                                       &lt;dbl&gt; -0.4374295, -0.4~
$ Heating_QC_Poor                                       &lt;dbl&gt; -0.03696949, -0.~
$ Heating_QC_Typical                                    &lt;dbl&gt; 1.5645654, 1.564~
$ Central_Air_Y                                         &lt;dbl&gt; 0.2725689, 0.272~
$ Electrical_FuseF                                      &lt;dbl&gt; -0.1412578, -0.1~
$ Electrical_FuseP                                      &lt;dbl&gt; -0.05652338, -0.~
$ Electrical_Mix                                        &lt;dbl&gt; 0, 0, 0, 0, 0, 0~
$ Electrical_SBrkr                                      &lt;dbl&gt; 0.312900, 0.3129~
$ Electrical_Unknown                                    &lt;dbl&gt; -0.02133462, -0.~
$ Garage_Type_Basment                                   &lt;dbl&gt; -0.1196059, -0.1~
$ Garage_Type_BuiltIn                                   &lt;dbl&gt; -0.2548026, -0.2~
$ Garage_Type_CarPort                                   &lt;dbl&gt; -0.0709206, -0.0~
$ Garage_Type_Detchd                                    &lt;dbl&gt; -0.6085939, 1.64~
$ Garage_Type_More_Than_Two_Types                       &lt;dbl&gt; -0.0709206, -0.0~
$ Garage_Type_No_Garage                                 &lt;dbl&gt; -0.2434722, -0.2~
$ Garage_Finish_No_Garage                               &lt;dbl&gt; -0.2445188, -0.2~
$ Garage_Finish_RFn                                     &lt;dbl&gt; -0.623355, -0.62~
$ Garage_Finish_Unf                                     &lt;dbl&gt; -0.8478001, 1.17~
$ Garage_Cond_Fair                                      &lt;dbl&gt; -0.1602038, -0.1~
$ Garage_Cond_Good                                      &lt;dbl&gt; -0.06760468, -0.~
$ Garage_Cond_No_Garage                                 &lt;dbl&gt; -0.2445188, -0.2~
$ Garage_Cond_Poor                                      &lt;dbl&gt; -0.0740911, -0.0~
$ Garage_Cond_Typical                                   &lt;dbl&gt; 0.3198619, 0.319~
$ Paved_Drive_Partial_Pavement                          &lt;dbl&gt; -0.1541244, -0.1~
$ Paved_Drive_Paved                                     &lt;dbl&gt; 0.3275821, 0.327~
$ Fence_Good_Wood                                       &lt;dbl&gt; -0.2042228, -0.2~
$ Fence_Minimum_Privacy                                 &lt;dbl&gt; 2.7713349, -0.36~
$ Fence_Minimum_Wood_Wire                               &lt;dbl&gt; -0.06412077, -0.~
$ Fence_No_Fence                                        &lt;dbl&gt; -1.9865551, 0.50~
$ Sale_Type_Con                                         &lt;dbl&gt; -0.04269842, -0.~
$ Sale_Type_ConLD                                       &lt;dbl&gt; -0.08289329, -0.~
$ Sale_Type_ConLI                                       &lt;dbl&gt; -0.06043983, -0.~
$ Sale_Type_ConLw                                       &lt;dbl&gt; -0.05231854, -0.~
$ Sale_Type_CWD                                         &lt;dbl&gt; -0.0709206, -0.0~
$ Sale_Type_New                                         &lt;dbl&gt; -0.2886094, -0.2~
$ Sale_Type_Oth                                         &lt;dbl&gt; -0.04269842, -0.~
$ Sale_Type_VWD                                         &lt;dbl&gt; -0.02133462, -0.~
$ Sale_Type_WD.                                         &lt;dbl&gt; 0.3906485, -2.55~</code></pre>
</div>
</div>
<p>Notice how we’re taking several important steps: 1. <strong>Log transformation</strong>: Sale prices often have a right-skewed distribution. Log transformation makes the distribution more normal. 2. <strong>Stratified splitting</strong>: Ensures both training and test sets have similar distributions of the target variable. 3. <strong>Systematic preprocessing</strong>: Handles missing values, creates dummy variables, and normalizes features in a reproducible way.</p>
</section>
<section id="model-specification-and-training" class="level3">
<h3 class="anchored" data-anchor-id="model-specification-and-training">Model Specification and Training</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify linear regression model</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>lm_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create workflow</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>lm_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(ames_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>lm_fit <span class="ot">&lt;-</span> lm_workflow <span class="sc">%&gt;%</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(ames_train)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and examine coefficients</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>lm_coefs <span class="ot">&lt;-</span> lm_fit <span class="sc">%&gt;%</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(estimate))) <span class="sc">%&gt;%</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>)</span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize top coefficients</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lm_coefs, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(term, estimate), <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 20 Most Influential Features in Linear Regression"</span>,</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Coefficients represent change in log10(Sale_Price) per unit change in feature"</span>,</span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Feature"</span>,</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Coefficient"</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The coefficients tell us the relationship between each feature and the sale price. Since we normalized the predictors, we can compare coefficient magnitudes directly. Positive coefficients increase price, negative ones decrease it.</p>
</section>
</section>
<section id="polynomial-and-non-linear-regression" class="level2">
<h2 class="anchored" data-anchor-id="polynomial-and-non-linear-regression">Polynomial and Non-linear Regression</h2>
<p>Sometimes relationships aren’t linear. Polynomial regression can capture curved relationships by including polynomial terms.</p>
<section id="understanding-polynomial-regression" class="level3">
<h3 class="anchored" data-anchor-id="understanding-polynomial-regression">Understanding Polynomial Regression</h3>
<p>Polynomial regression extends linear regression by adding polynomial terms:</p>
<p><span class="math display">\[Y = \beta_0 + \beta_1X + \beta_2X^2 + ... + \beta_dX^d + \epsilon\]</span></p>
<p>Let’s visualize different polynomial degrees:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate non-linear data</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>nonlinear_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">100</span>),</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_true =</span> <span class="dv">10</span> <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>x <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.02</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">3</span>,</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y_true <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">sd =</span> <span class="dv">5</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models with different polynomial degrees</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>degrees <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>poly_models <span class="ot">&lt;-</span> <span class="fu">map</span>(degrees, <span class="cf">function</span>(d) {</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="at">degree =</span> d, <span class="at">raw =</span> <span class="cn">TRUE</span>), <span class="at">data =</span> nonlinear_data)</span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate predictions</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>poly_predictions <span class="ot">&lt;-</span> <span class="fu">map2_df</span>(poly_models, degrees, <span class="cf">function</span>(model, d) {</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  nonlinear_data <span class="sc">%&gt;%</span></span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">y_pred =</span> <span class="fu">predict</span>(model),</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">degree =</span> <span class="fu">paste</span>(<span class="st">"Degree"</span>, d)</span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(poly_predictions, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">data =</span> nonlinear_data) <span class="sc">+</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_pred, <span class="at">color =</span> degree), <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_true), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> nonlinear_data, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>degree, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Polynomial Regression with Different Degrees"</span>,</span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Black dashed line shows true relationship. Higher degrees can lead to overfitting."</span>,</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"X"</span>,</span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Y"</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>Notice how: - <strong>Degree 1</strong> (linear) underfits - it can’t capture the curve - <strong>Degree 2-3</strong> capture the main pattern well - <strong>Degree 10</strong> overfits - it follows noise in the data</p>
</section>
<section id="implementing-polynomial-features" class="level3">
<h3 class="anchored" data-anchor-id="implementing-polynomial-features">Implementing Polynomial Features</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create recipe with polynomial features</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>poly_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> Gr_Liv_Area <span class="sc">+</span> Lot_Area, </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> ames_train) <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(Gr_Liv_Area, <span class="at">degree =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(Lot_Area, <span class="at">degree =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="at">terms =</span> <span class="sc">~</span> Gr_Liv_Area_poly_1<span class="sc">:</span>Lot_Area_poly_1)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model with polynomial features</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>poly_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(poly_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>poly_fit <span class="ot">&lt;-</span> poly_workflow <span class="sc">%&gt;%</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(ames_train)</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare with simple linear model</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>simple_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> Gr_Liv_Area <span class="sc">+</span> Lot_Area, </span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> ames_train)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>simple_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(simple_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec)</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>simple_fit <span class="ot">&lt;-</span> simple_workflow <span class="sc">%&gt;%</span></span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(ames_train)</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate both models</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>models_comparison <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">c</span>(<span class="st">"Linear"</span>, <span class="st">"Polynomial"</span>),</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">workflow =</span> <span class="fu">list</span>(simple_workflow, poly_workflow)</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">fit =</span> <span class="fu">map</span>(workflow, <span class="sc">~</span> <span class="fu">fit</span>(., ames_train)),</span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">train_pred =</span> <span class="fu">map</span>(fit, <span class="sc">~</span> <span class="fu">predict</span>(., ames_train)),</span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_pred =</span> <span class="fu">map</span>(fit, <span class="sc">~</span> <span class="fu">predict</span>(., ames_test))</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics</span></span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>comparison_metrics <span class="ot">&lt;-</span> models_comparison <span class="sc">%&gt;%</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">train_metrics =</span> <span class="fu">map2</span>(train_pred, <span class="fu">list</span>(ames_train), <span class="sc">~</span> {</span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(.x, .y) <span class="sc">%&gt;%</span></span>
<span id="cb24-43"><a href="#cb24-43" aria-hidden="true" tabindex="-1"></a>        <span class="fu">metrics</span>(<span class="at">truth =</span> Sale_Price, <span class="at">estimate =</span> .pred)</span>
<span id="cb24-44"><a href="#cb24-44" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb24-45"><a href="#cb24-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_metrics =</span> <span class="fu">map2</span>(test_pred, <span class="fu">list</span>(ames_test), <span class="sc">~</span> {</span>
<span id="cb24-46"><a href="#cb24-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(.x, .y) <span class="sc">%&gt;%</span></span>
<span id="cb24-47"><a href="#cb24-47" aria-hidden="true" tabindex="-1"></a>        <span class="fu">metrics</span>(<span class="at">truth =</span> Sale_Price, <span class="at">estimate =</span> .pred)</span>
<span id="cb24-48"><a href="#cb24-48" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb24-49"><a href="#cb24-49" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb24-50"><a href="#cb24-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, train_metrics, test_metrics) <span class="sc">%&gt;%</span></span>
<span id="cb24-51"><a href="#cb24-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(train_metrics, test_metrics), </span>
<span id="cb24-52"><a href="#cb24-52" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"dataset"</span>, <span class="at">values_to =</span> <span class="st">"metrics"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-53"><a href="#cb24-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(metrics)</span>
<span id="cb24-54"><a href="#cb24-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-55"><a href="#cb24-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize comparison</span></span>
<span id="cb24-56"><a href="#cb24-56" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison_metrics, </span>
<span id="cb24-57"><a href="#cb24-57" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> .estimate, <span class="at">fill =</span> dataset)) <span class="sc">+</span></span>
<span id="cb24-58"><a href="#cb24-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb24-59"><a href="#cb24-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>.metric, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb24-60"><a href="#cb24-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"train_metrics"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, </span>
<span id="cb24-61"><a href="#cb24-61" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"test_metrics"</span> <span class="ot">=</span> <span class="st">"darkblue"</span>)) <span class="sc">+</span></span>
<span id="cb24-62"><a href="#cb24-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-63"><a href="#cb24-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Linear vs Polynomial Model Comparison"</span>,</span>
<span id="cb24-64"><a href="#cb24-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Watch for overfitting: train performance much better than test"</span>,</span>
<span id="cb24-65"><a href="#cb24-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Metric Value"</span></span>
<span id="cb24-66"><a href="#cb24-66" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="regularization-ridge-lasso-and-elastic-net" class="level2">
<h2 class="anchored" data-anchor-id="regularization-ridge-lasso-and-elastic-net">Regularization: Ridge, Lasso, and Elastic Net</h2>
<p>Regularization adds a penalty term to the loss function to prevent overfitting and handle multicollinearity.</p>
<section id="understanding-regularization-mathematics" class="level3">
<h3 class="anchored" data-anchor-id="understanding-regularization-mathematics">Understanding Regularization Mathematics</h3>
<p>The three main types of regularization are:</p>
<p><strong>Ridge Regression (L2 penalty):</strong> <span class="math display">\[\text{Loss} = \text{RSS} + \lambda \sum_{j=1}^{p} \beta_j^2\]</span></p>
<p>Ridge regression shrinks coefficients toward zero but never exactly to zero. It’s good when you have many predictors with small effects.</p>
<p><strong>Lasso Regression (L1 penalty):</strong> <span class="math display">\[\text{Loss} = \text{RSS} + \lambda \sum_{j=1}^{p} |\beta_j|\]</span></p>
<p>Lasso can shrink coefficients exactly to zero, performing automatic feature selection. It’s good when you believe only a subset of predictors are important.</p>
<p><strong>Elastic Net (Combination):</strong> <span class="math display">\[\text{Loss} = \text{RSS} + \lambda \left[ \alpha \sum_{j=1}^{p} |\beta_j| + (1-\alpha) \sum_{j=1}^{p} \beta_j^2 \right]\]</span></p>
<p>Elastic Net combines Ridge and Lasso, controlled by the mixing parameter α.</p>
<p>Let’s visualize how regularization affects coefficients:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for regularization</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>ames_reg <span class="ot">&lt;-</span> ames_train <span class="sc">%&gt;%</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sale_Price, Gr_Liv_Area, Garage_Area, Year_Built, </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>         Lot_Area, Total_Bsmt_SF, First_Flr_SF) <span class="sc">%&gt;%</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create model matrix</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(Sale_Price <span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> ames_reg)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> ames_reg<span class="sc">$</span>Sale_Price</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Ridge regression</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>ridge_fit <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X, y, <span class="at">alpha =</span> <span class="dv">0</span>)  <span class="co"># alpha = 0 for Ridge</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Lasso regression</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>lasso_fit <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X, y, <span class="at">alpha =</span> <span class="dv">1</span>)  <span class="co"># alpha = 1 for Lasso</span></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Elastic Net</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>elastic_fit <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X, y, <span class="at">alpha =</span> <span class="fl">0.5</span>)  <span class="co"># alpha = 0.5 for 50/50 mix</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create coefficient path plots</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridge_fit, <span class="at">xvar =</span> <span class="st">"lambda"</span>, <span class="at">main =</span> <span class="st">"Ridge Regression Path"</span>)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lasso_fit, <span class="at">xvar =</span> <span class="st">"lambda"</span>, <span class="at">main =</span> <span class="st">"Lasso Regression Path"</span>)</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(elastic_fit, <span class="at">xvar =</span> <span class="st">"lambda"</span>, <span class="at">main =</span> <span class="st">"Elastic Net Path"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>These plots show how coefficients change as the penalty parameter λ increases: - <strong>Ridge</strong>: All coefficients shrink smoothly toward zero but never reach it - <strong>Lasso</strong>: Coefficients can hit zero abruptly (feature selection) - <strong>Elastic Net</strong>: Combination of both behaviors</p>
</section>
<section id="implementing-regularized-regression" class="level3">
<h3 class="anchored" data-anchor-id="implementing-regularized-regression">Implementing Regularized Regression</h3>
<p>Now let’s implement these methods properly with tidymodels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a more complete recipe</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>reg_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> ames_train) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_nzv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge regression</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>ridge_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fl">0.01</span>, <span class="at">mixture =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Lasso regression</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>lasso_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fl">0.01</span>, <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Elastic Net</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>elastic_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fl">0.01</span>, <span class="at">mixture =</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create workflows</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>ridge_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(reg_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(ridge_spec)</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>lasso_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(reg_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lasso_spec)</span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a>elastic_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-34"><a href="#cb26-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(reg_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb26-35"><a href="#cb26-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(elastic_spec)</span>
<span id="cb26-36"><a href="#cb26-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-37"><a href="#cb26-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit all models</span></span>
<span id="cb26-38"><a href="#cb26-38" aria-hidden="true" tabindex="-1"></a>ridge_fit <span class="ot">&lt;-</span> ridge_wf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(ames_train)</span>
<span id="cb26-39"><a href="#cb26-39" aria-hidden="true" tabindex="-1"></a>lasso_fit <span class="ot">&lt;-</span> lasso_wf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(ames_train)</span>
<span id="cb26-40"><a href="#cb26-40" aria-hidden="true" tabindex="-1"></a>elastic_fit <span class="ot">&lt;-</span> elastic_wf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(ames_train)</span>
<span id="cb26-41"><a href="#cb26-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-42"><a href="#cb26-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare number of non-zero coefficients</span></span>
<span id="cb26-43"><a href="#cb26-43" aria-hidden="true" tabindex="-1"></a>n_features <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb26-44"><a href="#cb26-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Ridge"</span>, <span class="st">"Lasso"</span>, <span class="st">"Elastic Net"</span>),</span>
<span id="cb26-45"><a href="#cb26-45" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Non-zero Coefficients</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb26-46"><a href="#cb26-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">tidy</span>(ridge_fit)<span class="sc">$</span>estimate <span class="sc">!=</span> <span class="dv">0</span>),</span>
<span id="cb26-47"><a href="#cb26-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">tidy</span>(lasso_fit)<span class="sc">$</span>estimate <span class="sc">!=</span> <span class="dv">0</span>),</span>
<span id="cb26-48"><a href="#cb26-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">tidy</span>(elastic_fit)<span class="sc">$</span>estimate <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb26-49"><a href="#cb26-49" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb26-50"><a href="#cb26-50" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Total Features</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb26-51"><a href="#cb26-51" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(<span class="fu">tidy</span>(ridge_fit)),</span>
<span id="cb26-52"><a href="#cb26-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(<span class="fu">tidy</span>(lasso_fit)),</span>
<span id="cb26-53"><a href="#cb26-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(<span class="fu">tidy</span>(elastic_fit))</span>
<span id="cb26-54"><a href="#cb26-54" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-55"><a href="#cb26-55" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-56"><a href="#cb26-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-57"><a href="#cb26-57" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(n_features)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">Non-zero Coefficients</th>
<th style="text-align: right;">Total Features</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Ridge</td>
<td style="text-align: right;">203</td>
<td style="text-align: right;">210</td>
</tr>
<tr class="even">
<td style="text-align: left;">Lasso</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">210</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Elastic Net</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">210</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Notice how Lasso has fewer non-zero coefficients - it’s performing feature selection automatically!</p>
</section>
</section>
<section id="regression-trees-and-random-forests" class="level2">
<h2 class="anchored" data-anchor-id="regression-trees-and-random-forests">Regression Trees and Random Forests</h2>
<p>Tree-based methods can capture non-linear relationships and interactions without explicitly specifying them.</p>
<section id="how-regression-trees-work" class="level3">
<h3 class="anchored" data-anchor-id="how-regression-trees-work">How Regression Trees Work</h3>
<p>Regression trees recursively partition the feature space into rectangles, predicting the mean value in each region. The splitting criterion for regression is typically the reduction in RSS:</p>
<p><span class="math display">\[\text{RSS} = \sum_{i \in R_1} (y_i - \hat{y}_{R_1})^2 + \sum_{i \in R_2} (y_i - \hat{y}_{R_2})^2\]</span></p>
<p>Where <span class="math inline">\(R_1\)</span> and <span class="math inline">\(R_2\)</span> are the two regions created by the split.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a simple regression tree</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cost_complexity =</span> <span class="fl">0.01</span>,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">tree_depth =</span> <span class="dv">4</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_n =</span> <span class="dv">20</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>tree_fit <span class="ot">&lt;-</span> tree_spec <span class="sc">%&gt;%</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Sale_Price <span class="sc">~</span> Gr_Liv_Area <span class="sc">+</span> Year_Built, <span class="at">data =</span> ames_train)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the tree</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">require</span>(rpart.plot, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart.plot</span>(tree_fit<span class="sc">$</span>fit, <span class="at">type =</span> <span class="dv">4</span>, <span class="at">extra =</span> <span class="dv">1</span>, <span class="at">roundint =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediction surface</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Gr_Liv_Area =</span> <span class="fu">seq</span>(<span class="fu">min</span>(ames_train<span class="sc">$</span>Gr_Liv_Area, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">max</span>(ames_train<span class="sc">$</span>Gr_Liv_Area, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">length.out =</span> <span class="dv">100</span>),</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year_Built =</span> <span class="fu">seq</span>(<span class="fu">min</span>(ames_train<span class="sc">$</span>Year_Built, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">max</span>(ames_train<span class="sc">$</span>Year_Built, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>                   <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>grid_pred <span class="ot">&lt;-</span> tree_fit <span class="sc">%&gt;%</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(grid) <span class="sc">%&gt;%</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(grid)</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize prediction surface</span></span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grid_pred, <span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Year_Built, <span class="at">fill =</span> .pred)) <span class="sc">+</span></span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">sample_n</span>(ames_train, <span class="dv">200</span>), </span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> <span class="cn">NULL</span>, <span class="at">color =</span> Sale_Price), </span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Regression Tree Prediction Surface"</span>,</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Notice the rectangular regions - characteristic of tree-based methods"</span>,</span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Living Area (sq ft)"</span>,</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Year Built"</span>,</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Predicted</span><span class="sc">\n</span><span class="st">log(Price)"</span>,</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Actual</span><span class="sc">\n</span><span class="st">log(Price)"</span></span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>The rectangular regions are a key characteristic of tree-based methods. Each rectangle represents a leaf node in the tree, with all observations in that region receiving the same prediction.</p>
</section>
<section id="random-forests-for-regression" class="level3">
<h3 class="anchored" data-anchor-id="random-forests-for-regression">Random Forests for Regression</h3>
<p>Random Forests improve upon single trees by: 1. Building many trees on bootstrap samples (bagging) 2. Randomly selecting features at each split 3. Averaging predictions across all trees</p>
<p>This reduces overfitting and improves generalization:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest specification</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>rf_spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">trees =</span> <span class="dv">500</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="dv">10</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_n =</span> <span class="dv">5</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">importance =</span> <span class="st">"impurity"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create workflow</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>rf_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(reg_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rf_spec)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit with cross-validation for better evaluation</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>ames_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(ames_train, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>rf_cv <span class="ot">&lt;-</span> rf_workflow <span class="sc">%&gt;%</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> ames_folds,</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(yardstick<span class="sc">::</span>rmse, yardstick<span class="sc">::</span>rsq, yardstick<span class="sc">::</span>mae),</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Show performance</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(rf_cv) <span class="sc">%&gt;%</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">.metric</th>
<th style="text-align: left;">.estimator</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">std_err</th>
<th style="text-align: left;">.config</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">mae</td>
<td style="text-align: left;">standard</td>
<td style="text-align: right;">0.0433</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0011</td>
<td style="text-align: left;">pre0_mod0_post0</td>
</tr>
<tr class="even">
<td style="text-align: left;">rmse</td>
<td style="text-align: left;">standard</td>
<td style="text-align: right;">0.0686</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0032</td>
<td style="text-align: left;">pre0_mod0_post0</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rsq</td>
<td style="text-align: left;">standard</td>
<td style="text-align: right;">0.8656</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0.0074</td>
<td style="text-align: left;">pre0_mod0_post0</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit final model for feature importance</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>rf_final <span class="ot">&lt;-</span> rf_workflow <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(ames_train)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and plot feature importance</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>rf_importance <span class="ot">&lt;-</span> rf_final <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">20</span>)</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>rf_importance <span class="sc">+</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 20 Most Important Features in Random Forest"</span>,</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on impurity reduction"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Random Forests often provide excellent predictive performance with minimal tuning, making them a go-to method for many regression problems.</p>
</section>
</section>
<section id="model-diagnostics-and-validation" class="level2">
<h2 class="anchored" data-anchor-id="model-diagnostics-and-validation">Model Diagnostics and Validation</h2>
<p>Proper model validation is crucial for ensuring your model will generalize well to new data.</p>
<section id="residual-analysis" class="level3">
<h3 class="anchored" data-anchor-id="residual-analysis">Residual Analysis</h3>
<p>Residual analysis helps identify problems with model assumptions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predictions from our linear model</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>lm_pred <span class="ot">&lt;-</span> lm_fit <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(ames_test) <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(ames_test) <span class="sc">%&gt;%</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">residual =</span> Sale_Price <span class="sc">-</span> .pred,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">std_residual =</span> residual <span class="sc">/</span> <span class="fu">sd</span>(residual)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create diagnostic plots</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(lm_pred, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> residual)) <span class="sc">+</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Residuals vs Fitted Values"</span>,</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Look for patterns - should be random scatter around zero"</span>,</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Fitted Values"</span>,</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Residuals"</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(lm_pred, <span class="fu">aes</span>(<span class="at">sample =</span> std_residual)) <span class="sc">+</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Q-Q Plot"</span>,</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Check normality - points should follow the line"</span>,</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Theoretical Quantiles"</span>,</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Residuals"</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(lm_pred, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(std_residual)))) <span class="sc">+</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Scale-Location Plot"</span>,</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Check homoscedasticity - spread should be constant"</span>,</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Fitted Values"</span>,</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"√|Standardized Residuals|"</span></span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(lm_pred, <span class="fu">aes</span>(<span class="at">x =</span> residual)) <span class="sc">+</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(count)), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb30-45"><a href="#cb30-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb30-46"><a href="#cb30-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Residuals"</span>,</span>
<span id="cb30-47"><a href="#cb30-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Should be approximately normal"</span>,</span>
<span id="cb30-48"><a href="#cb30-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Residual"</span>,</span>
<span id="cb30-49"><a href="#cb30-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Count"</span></span>
<span id="cb30-50"><a href="#cb30-50" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-51"><a href="#cb30-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-52"><a href="#cb30-52" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
<p>Each plot reveals different aspects: - <strong>Pattern in residuals vs fitted</strong>: Indicates non-linearity - <strong>Deviation from Q-Q line</strong>: Indicates non-normality - <strong>Funnel shape in scale-location</strong>: Indicates heteroscedasticity - <strong>Skewed residual distribution</strong>: May need transformation</p>
</section>
<section id="cross-validation-for-model-selection" class="level3">
<h3 class="anchored" data-anchor-id="cross-validation-for-model-selection">Cross-Validation for Model Selection</h3>
<p>Cross-validation provides unbiased estimates of model performance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare multiple models using cross-validation</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>models_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Linear"</span> <span class="ot">=</span> lm_spec,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ridge"</span> <span class="ot">=</span> ridge_spec,</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Lasso"</span> <span class="ot">=</span> lasso_spec,</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Random Forest"</span> <span class="ot">=</span> rf_spec,</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decision Tree"</span> <span class="ot">=</span> tree_spec</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate all models</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="fu">names</span>(models_list), <span class="cf">function</span>(model_name) {</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(reg_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(models_list[[model_name]])</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    wf,</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> ames_folds,</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(yardstick<span class="sc">::</span>rmse, yardstick<span class="sc">::</span>rsq, yardstick<span class="sc">::</span>mae)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> model_name)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize comparison</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cv_results, <span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> mean, <span class="at">fill =</span> model)) <span class="sc">+</span></span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> std_err, <span class="at">ymax =</span> mean <span class="sc">+</span> std_err), </span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>.metric, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Model Comparison via 5-Fold Cross-Validation"</span>,</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Error bars show standard error across folds"</span>,</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Metric Value"</span></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="advanced-topics" class="level2">
<h2 class="anchored" data-anchor-id="advanced-topics">Advanced Topics</h2>
<section id="dealing-with-multicollinearity" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-multicollinearity">Dealing with Multicollinearity</h3>
<p>Multicollinearity occurs when predictors are highly correlated, making coefficient interpretation difficult:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check correlation among numeric predictors</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>numeric_features <span class="ot">&lt;-</span> ames_train <span class="sc">%&gt;%</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Sale_Price) <span class="sc">%&gt;%</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(numeric_features)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Find highly correlated pairs</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>high_cor <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(cor_matrix) <span class="sc">&gt;</span> <span class="fl">0.8</span> <span class="sc">&amp;</span> cor_matrix <span class="sc">!=</span> <span class="dv">1</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>high_cor_pairs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">var1 =</span> <span class="fu">rownames</span>(cor_matrix)[high_cor[,<span class="dv">1</span>]],</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">var2 =</span> <span class="fu">colnames</span>(cor_matrix)[high_cor[,<span class="dv">2</span>]],</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">correlation =</span> cor_matrix[high_cor]</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(var1 <span class="sc">&lt;</span> var2) <span class="sc">%&gt;%</span>  <span class="co"># Remove duplicates</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(correlation)))</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Highly correlated variable pairs:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Highly correlated variable pairs:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(high_cor_pairs, <span class="dv">10</span>) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">var1</th>
<th style="text-align: left;">var2</th>
<th style="text-align: right;">correlation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Garage_Area</td>
<td style="text-align: left;">Garage_Cars</td>
<td style="text-align: right;">0.892</td>
</tr>
<tr class="even">
<td style="text-align: left;">Gr_Liv_Area</td>
<td style="text-align: left;">TotRms_AbvGrd</td>
<td style="text-align: right;">0.809</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize correlation matrix</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">type =</span> <span class="st">"upper"</span>, </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">order =</span> <span class="st">"hclust"</span>, <span class="at">tl.cex =</span> <span class="fl">0.6</span>, <span class="at">tl.col =</span> <span class="st">"black"</span>,</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag =</span> <span class="cn">FALSE</span>, <span class="at">addCoef.col =</span> <span class="st">"black"</span>, <span class="at">number.cex =</span> <span class="fl">0.4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>High correlations between predictors can cause: - Unstable coefficient estimates - Large standard errors - Difficulty interpreting individual effects</p>
<p>Solutions include: - Remove one of the correlated variables - Use PCA to create uncorrelated components - Apply regularization (Ridge regression handles multicollinearity well)</p>
</section>
<section id="handling-non-constant-variance-heteroscedasticity" class="level3">
<h3 class="anchored" data-anchor-id="handling-non-constant-variance-heteroscedasticity">Handling Non-constant Variance (Heteroscedasticity)</h3>
<p>When variance changes with the fitted values, we can apply transformations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example with original scale prices (not log-transformed)</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>ames_original <span class="ot">&lt;-</span> ames <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sale_Price, Gr_Liv_Area, Year_Built, Overall_Cond) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model on original scale</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>original_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> ames_original)</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model on log scale</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>log_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(Sale_Price) <span class="sc">~</span> ., <span class="at">data =</span> ames_original)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare residual plots</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>orig_pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">fitted =</span> <span class="fu">fitted</span>(original_fit),</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">residual =</span> <span class="fu">residuals</span>(original_fit),</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"Original Scale"</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>log_pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">fitted =</span> <span class="fu">fitted</span>(log_fit),</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">residual =</span> <span class="fu">residuals</span>(log_fit),</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"Log Scale"</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>combined_pred <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(orig_pred, log_pred)</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_pred, <span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> residual)) <span class="sc">+</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>model, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Effect of Log Transformation on Heteroscedasticity"</span>,</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Log transformation often stabilizes variance"</span>,</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Fitted Values"</span>,</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Residuals"</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<p>The log transformation has stabilized the variance - notice how the spread of residuals is more constant in the log scale model.</p>
</section>
</section>
<section id="practical-example-complete-regression-pipeline" class="level2">
<h2 class="anchored" data-anchor-id="practical-example-complete-regression-pipeline">Practical Example: Complete Regression Pipeline</h2>
<p>Let’s put everything together in a comprehensive example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a complete modeling pipeline</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Data preparation</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>concrete_clean <span class="ot">&lt;-</span> concrete <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>concrete_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(concrete_clean, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>concrete_train <span class="ot">&lt;-</span> <span class="fu">training</span>(concrete_split)</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>concrete_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(concrete_split)</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Exploratory data analysis</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>concrete_summary <span class="ot">&lt;-</span> concrete_train <span class="sc">%&gt;%</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">sd</span>(value),</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">min =</span> <span class="fu">min</span>(value),</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">max</span>(value)</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Dataset summary:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Dataset summary:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>concrete_summary <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">age</td>
<td style="text-align: right;">45.85</td>
<td style="text-align: right;">64.08</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">365.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">blast_furnace_slag</td>
<td style="text-align: right;">71.36</td>
<td style="text-align: right;">84.29</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">359.40</td>
</tr>
<tr class="odd">
<td style="text-align: left;">cement</td>
<td style="text-align: right;">283.40</td>
<td style="text-align: right;">104.81</td>
<td style="text-align: right;">102.00</td>
<td style="text-align: right;">540.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">coarse_aggregate</td>
<td style="text-align: right;">970.40</td>
<td style="text-align: right;">76.68</td>
<td style="text-align: right;">801.00</td>
<td style="text-align: right;">1134.30</td>
</tr>
<tr class="odd">
<td style="text-align: left;">compressive_strength</td>
<td style="text-align: right;">35.56</td>
<td style="text-align: right;">16.71</td>
<td style="text-align: right;">2.33</td>
<td style="text-align: right;">81.75</td>
</tr>
<tr class="even">
<td style="text-align: left;">fine_aggregate</td>
<td style="text-align: right;">773.44</td>
<td style="text-align: right;">81.49</td>
<td style="text-align: right;">594.00</td>
<td style="text-align: right;">992.60</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fly_ash</td>
<td style="text-align: right;">54.42</td>
<td style="text-align: right;">63.98</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">200.10</td>
</tr>
<tr class="even">
<td style="text-align: left;">superplasticizer</td>
<td style="text-align: right;">6.13</td>
<td style="text-align: right;">5.86</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">32.20</td>
</tr>
<tr class="odd">
<td style="text-align: left;">water</td>
<td style="text-align: right;">182.12</td>
<td style="text-align: right;">21.78</td>
<td style="text-align: right;">121.80</td>
<td style="text-align: right;">247.00</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create recipe with feature engineering</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>concrete_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(compressive_strength <span class="sc">~</span> ., <span class="at">data =</span> concrete_train) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(age, <span class="at">degree =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="at">terms =</span> <span class="sc">~</span> cement<span class="sc">:</span>water)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Specify multiple models</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">linear =</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span> <span class="fu">set_engine</span>(<span class="st">"lm"</span>),</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">ridge =</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>),</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">rf =</span> <span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(), <span class="at">trees =</span> <span class="dv">500</span>, <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"ranger"</span>) <span class="sc">%&gt;%</span> <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Create workflows</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>workflows <span class="ot">&lt;-</span> <span class="fu">map</span>(models, <span class="cf">function</span>(model) {</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(concrete_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(model)</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Tune hyperparameters for models that need it</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>concrete_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(concrete_train, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune Ridge</span></span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>ridge_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">penalty</span>(), <span class="at">levels =</span> <span class="dv">10</span>)</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>ridge_tune <span class="ot">&lt;-</span> workflows<span class="sc">$</span>ridge <span class="sc">%&gt;%</span></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> concrete_folds,</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> ridge_grid,</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(yardstick<span class="sc">::</span>rmse, yardstick<span class="sc">::</span>rsq)</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune Random Forest</span></span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a>rf_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(</span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtry</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">7</span>)),</span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min_n</span>(),</span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="dv">5</span></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>rf_tune <span class="ot">&lt;-</span> workflows<span class="sc">$</span>rf <span class="sc">%&gt;%</span></span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> concrete_folds,</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> rf_grid,</span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(yardstick<span class="sc">::</span>rmse, yardstick<span class="sc">::</span>rsq)</span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Select best models</span></span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>best_ridge <span class="ot">&lt;-</span> <span class="fu">select_best</span>(ridge_tune, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a>best_rf <span class="ot">&lt;-</span> <span class="fu">select_best</span>(rf_tune, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. Finalize workflows</span></span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>final_linear <span class="ot">&lt;-</span> workflows<span class="sc">$</span>linear</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>final_ridge <span class="ot">&lt;-</span> workflows<span class="sc">$</span>ridge <span class="sc">%&gt;%</span> <span class="fu">finalize_workflow</span>(best_ridge)</span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a>final_rf <span class="ot">&lt;-</span> workflows<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">finalize_workflow</span>(best_rf)</span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a><span class="co"># 9. Fit final models and evaluate</span></span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>final_fits <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">linear =</span> final_linear <span class="sc">%&gt;%</span> <span class="fu">fit</span>(concrete_train),</span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">ridge =</span> final_ridge <span class="sc">%&gt;%</span> <span class="fu">fit</span>(concrete_train),</span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">rf =</span> final_rf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(concrete_train)</span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a><span class="co"># 10. Make predictions and evaluate</span></span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="fu">names</span>(final_fits), <span class="cf">function</span>(model_name) {</span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>  final_fits[[model_name]] <span class="sc">%&gt;%</span></span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(concrete_test) <span class="sc">%&gt;%</span></span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(concrete_test) <span class="sc">%&gt;%</span></span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a>    <span class="fu">metrics</span>(<span class="at">truth =</span> compressive_strength, <span class="at">estimate =</span> .pred) <span class="sc">%&gt;%</span></span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> model_name)</span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize final comparison</span></span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test_results, <span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> .estimate, <span class="at">fill =</span> model)) <span class="sc">+</span></span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>.metric, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb40-78"><a href="#cb40-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Final Model Comparison on Test Set"</span>,</span>
<span id="cb40-79"><a href="#cb40-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Concrete compressive strength prediction"</span>,</span>
<span id="cb40-80"><a href="#cb40-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Metric Value"</span></span>
<span id="cb40-81"><a href="#cb40-81" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb40-82"><a href="#cb40-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<section id="exercise-1-implement-regularization-with-tuning" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1-implement-regularization-with-tuning">Exercise 1: Implement Regularization with Tuning</h3>
<p>Build a regularized regression model with proper hyperparameter tuning:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the Ames dataset to predict Sale_Price</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an elastic net model with tuned penalty and mixture</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Simpler recipe for exercise</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>elastic_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> Gr_Liv_Area <span class="sc">+</span> Year_Built <span class="sc">+</span> Overall_Cond <span class="sc">+</span> </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                        Neighborhood <span class="sc">+</span> Total_Bsmt_SF, <span class="at">data =</span> ames_train) <span class="sc">%&gt;%</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Elastic net specification with tuning</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>elastic_tune_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">penalty =</span> <span class="fu">tune</span>(),</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">mixture =</span> <span class="fu">tune</span>()</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Workflow</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a>elastic_tune_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(elastic_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(elastic_tune_spec)</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Tuning grid</span></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>elastic_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">penalty</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">0</span>)),</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mixture</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Create resamples</span></span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>ames_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(ames_train, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune the model</span></span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a>elastic_tuned <span class="ot">&lt;-</span> elastic_tune_wf <span class="sc">%&gt;%</span></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> ames_folds,</span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> elastic_grid,</span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(yardstick<span class="sc">::</span>rmse, yardstick<span class="sc">::</span>rsq, yardstick<span class="sc">::</span>mae)</span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize tuning results</span></span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(elastic_tuned) <span class="sc">+</span></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Elastic Net Tuning Results"</span>,</span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Performance across different penalty and mixture values"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Select and fit best model</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>best_elastic <span class="ot">&lt;-</span> <span class="fu">select_best</span>(elastic_tuned, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>final_elastic <span class="ot">&lt;-</span> elastic_tune_wf <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_elastic) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(ames_train)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on test set</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>elastic_test_pred <span class="ot">&lt;-</span> final_elastic <span class="sc">%&gt;%</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(ames_test) <span class="sc">%&gt;%</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(ames_test)</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>elastic_metrics <span class="ot">&lt;-</span> elastic_test_pred <span class="sc">%&gt;%</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metrics</span>(<span class="at">truth =</span> Sale_Price, <span class="at">estimate =</span> .pred)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Best hyperparameters:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Best hyperparameters:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(best_elastic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 3
  penalty mixture .config         
    &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;           
1   0.001    0.25 pre0_mod02_post0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Test set performance:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Test set performance:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(elastic_metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 x 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 rmse    standard      0.0752
2 rsq     standard      0.816 
3 mae     standard      0.0479</code></pre>
</div>
</div>
</section>
<section id="exercise-2-diagnose-and-fix-model-problems" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2-diagnose-and-fix-model-problems">Exercise 2: Diagnose and Fix Model Problems</h3>
<p>Identify and address issues in a regression model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a problematic model and fix it</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Intentionally problematic model (using highly correlated predictors)</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>problem_data <span class="ot">&lt;-</span> ames_train <span class="sc">%&gt;%</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sale_Price, Gr_Liv_Area, Total_Bsmt_SF, First_Flr_SF, </span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>         Second_Flr_SF, Garage_Area, Garage_Cars) <span class="sc">%&gt;%</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Check correlations</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(problem_data[,<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corrplot</span>(<span class="at">method =</span> <span class="st">"number"</span>, <span class="at">type =</span> <span class="st">"upper"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit problematic model</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>problem_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> problem_data)</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(problem_fit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sale_Price ~ ., data = problem_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.05511 -0.03523  0.01104  0.05335  0.31904 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    4.740e+00  7.247e-03 654.021  &lt; 2e-16 ***
Gr_Liv_Area   -5.079e-05  4.297e-05  -1.182   0.2373    
Total_Bsmt_SF  1.368e-04  7.725e-06  17.707  &lt; 2e-16 ***
First_Flr_SF   1.723e-04  4.409e-05   3.908 9.60e-05 ***
Second_Flr_SF  1.969e-04  4.341e-05   4.537 6.02e-06 ***
Garage_Area    3.874e-05  2.156e-05   1.797   0.0725 .  
Garage_Cars    7.311e-02  6.039e-03  12.106  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.09484 on 2190 degrees of freedom
Multiple R-squared:  0.7168,    Adjusted R-squared:  0.716 
F-statistic: 923.8 on 6 and 2190 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the high VIF (Variance Inflation Factor)</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">require</span>(car, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  vif_values <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">vif</span>(problem_fit)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Variance Inflation Factors:"</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(vif_values)</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Variance Inflation Factors:"
  Gr_Liv_Area Total_Bsmt_SF  First_Flr_SF Second_Flr_SF   Garage_Area 
   112.172194      2.772377     73.222425     84.197910      5.207468 
  Garage_Cars 
     5.107801 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix 1: Remove highly correlated variables</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>fixed_data1 <span class="ot">&lt;-</span> problem_data <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Garage_Cars, <span class="sc">-</span>Second_Flr_SF)  <span class="co"># Remove redundant variables</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>fixed_fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> fixed_data1)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix 2: Use PCA</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>pca_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> problem_data) <span class="sc">%&gt;%</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">all_predictors</span>(), <span class="at">num_comp =</span> <span class="dv">4</span>)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>pca_fit <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(pca_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec) <span class="sc">%&gt;%</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(problem_data)</span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix 3: Use Ridge regression</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>ridge_fix <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fl">0.1</span>, <span class="at">mixture =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> problem_data)</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare solutions</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Original model R-squared:"</span>, <span class="fu">summary</span>(problem_fit)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Original model R-squared: 0.7167839 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Fixed model R-squared:"</span>, <span class="fu">summary</span>(fixed_fit1)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Fixed model R-squared: 0.6943782 </code></pre>
</div>
</div>
</section>
<section id="exercise-3-non-linear-relationships" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3-non-linear-relationships">Exercise 3: Non-linear Relationships</h3>
<p>Explore and model non-linear relationships:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Create synthetic data with non-linear relationship</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>nonlinear_ex <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">200</span>),</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span><span class="fu">sin</span>(x) <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="fl">0.05</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">3</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the relationship</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nonlinear_ex, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Non-linear Relationship to Model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare different approaches</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Linear model (will underfit)</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>linear_ex <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> nonlinear_ex)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Polynomial regression</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>poly_ex <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">5</span>), <span class="at">data =</span> nonlinear_ex)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Spline regression</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>spline_ex <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> splines<span class="sc">::</span><span class="fu">ns</span>(x, <span class="at">df =</span> <span class="dv">5</span>), <span class="at">data =</span> nonlinear_ex)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Random Forest</span></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>rf_ex <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">trees =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x, <span class="at">data =</span> nonlinear_ex)</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate predictions</span></span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>predictions_ex <span class="ot">&lt;-</span> nonlinear_ex <span class="sc">%&gt;%</span></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">linear =</span> <span class="fu">predict</span>(linear_ex, nonlinear_ex),</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">polynomial =</span> <span class="fu">predict</span>(poly_ex, nonlinear_ex),</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">spline =</span> <span class="fu">predict</span>(spline_ex, nonlinear_ex),</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">rf =</span> <span class="fu">predict</span>(rf_ex, nonlinear_ex)<span class="sc">$</span>.pred</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(linear, polynomial, spline, rf), </span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"model"</span>, <span class="at">values_to =</span> <span class="st">"prediction"</span>)</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize all models</span></span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predictions_ex, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> prediction, <span class="at">color =</span> model), <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>model) <span class="sc">+</span></span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comparison of Methods for Non-linear Relationships"</span>,</span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Different approaches to capturing non-linearity"</span></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="15-regression_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate performance</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>performance_ex <span class="ot">&lt;-</span> predictions_ex <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y <span class="sc">-</span> prediction)<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mae =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(y <span class="sc">-</span> prediction)),</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">r_squared =</span> <span class="fu">cor</span>(y, prediction)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>performance_ex <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">model</th>
<th style="text-align: right;">rmse</th>
<th style="text-align: right;">mae</th>
<th style="text-align: right;">r_squared</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">linear</td>
<td style="text-align: right;">2.597</td>
<td style="text-align: right;">2.011</td>
<td style="text-align: right;">0.173</td>
</tr>
<tr class="even">
<td style="text-align: left;">polynomial</td>
<td style="text-align: right;">1.074</td>
<td style="text-align: right;">0.865</td>
<td style="text-align: right;">0.858</td>
</tr>
<tr class="odd">
<td style="text-align: left;">rf</td>
<td style="text-align: right;">0.582</td>
<td style="text-align: right;">0.472</td>
<td style="text-align: right;">0.959</td>
</tr>
<tr class="even">
<td style="text-align: left;">spline</td>
<td style="text-align: right;">0.980</td>
<td style="text-align: right;">0.808</td>
<td style="text-align: right;">0.882</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>In this comprehensive chapter, you’ve learned:</p>
<p>✅ <strong>Linear regression theory</strong>: OLS, assumptions, diagnostics<br>
✅ <strong>Polynomial and non-linear regression</strong>: Capturing curved relationships<br>
✅ <strong>Regularization techniques</strong>: Ridge, Lasso, and Elastic Net<br>
✅ <strong>Tree-based methods</strong>: Decision trees and Random Forests<br>
✅ <strong>Model validation</strong>: Cross-validation, residual analysis<br>
✅ <strong>Advanced topics</strong>: Multicollinearity, heteroscedasticity<br>
✅ <strong>Complete workflows</strong>: From data preparation to final evaluation</p>
<p>Key takeaways: - Always check model assumptions before interpreting results - Use regularization when you have many predictors or multicollinearity - Tree-based methods are powerful for capturing non-linear patterns - Cross-validation is essential for honest model evaluation - Different problems require different approaches - no single best method</p>
</section>
<section id="whats-next" class="level2">
<h2 class="anchored" data-anchor-id="whats-next">What’s Next?</h2>
<p>In <a href="./16-ensemble-methods.html">Chapter 16</a>, we’ll explore ensemble methods in depth, learning how to combine multiple models for superior performance.</p>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<ul>
<li><a href="https://www.statlearning.com/">An Introduction to Statistical Learning</a> - Chapters 3, 6, 8</li>
<li><a href="https://hastie.su.domains/ElemStatLearn/">The Elements of Statistical Learning</a> - Chapters 3, 4, 15</li>
<li><a href="http://appliedpredictivemodeling.com/">Applied Predictive Modeling</a> - Chapters 6-8</li>
<li><a href="https://avehtari.github.io/ROS-Examples/">Regression and Other Stories</a> - Comprehensive regression guide</li>
<li><a href="https://www.tmwr.org/">Tidy Modeling with R</a> - Chapters 7-11</li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Find all elements with class 'quarto-title-meta-heading' that contain "Author"
    const authorHeadings = document.querySelectorAll('.quarto-title-meta-heading');
    
    authorHeadings.forEach(function(heading) {
        if (heading.textContent.trim() === 'Author') {
            heading.textContent = 'Authors';
        }
    });
});
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb62" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Chapter 15: Regression Models - Theory, Implementation, and Best Practices"</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "David Sarrat González, Juan R González"</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>By the end of this chapter, you will understand:</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Linear regression theory and assumptions</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Polynomial and non-linear regression</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Regularization techniques (Ridge, Lasso, Elastic Net)</span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Regression trees and ensemble methods</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Model diagnostics and validation</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Advanced regression techniques</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Practical implementation with tidymodels</span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="fu">## What is Regression?</span></span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>Regression analysis is a fundamental statistical technique for modeling the relationship between a dependent variable (target) and one or more independent variables (features). Unlike classification, which predicts discrete categories, regression predicts continuous numerical values.</span>
<span id="cb62-26"><a href="#cb62-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-27"><a href="#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Fundamental Question</span></span>
<span id="cb62-28"><a href="#cb62-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-29"><a href="#cb62-29" aria-hidden="true" tabindex="-1"></a>In regression, we're essentially asking: "Given these input features, what numerical value should we predict?" This could be:</span>
<span id="cb62-30"><a href="#cb62-30" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Predicting house prices based on size, location, and amenities</span>
<span id="cb62-31"><a href="#cb62-31" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Estimating customer lifetime value from behavior patterns</span>
<span id="cb62-32"><a href="#cb62-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Forecasting sales based on historical data and market conditions</span>
<span id="cb62-33"><a href="#cb62-33" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Determining optimal drug dosage based on patient characteristics</span>
<span id="cb62-34"><a href="#cb62-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-35"><a href="#cb62-35" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setup and Data Preparation</span></span>
<span id="cb62-36"><a href="#cb62-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-37"><a href="#cb62-37" aria-hidden="true" tabindex="-1"></a>Let's begin by loading the necessary libraries and preparing our datasets. We'll use multiple datasets throughout this chapter to illustrate different concepts and techniques.</span>
<span id="cb62-38"><a href="#cb62-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-41"><a href="#cb62-41" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-42"><a href="#cb62-42" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb62-43"><a href="#cb62-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb62-44"><a href="#cb62-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb62-45"><a href="#cb62-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modeldata)</span>
<span id="cb62-46"><a href="#cb62-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vip)</span>
<span id="cb62-47"><a href="#cb62-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb62-48"><a href="#cb62-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb62-49"><a href="#cb62-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb62-50"><a href="#cb62-50" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb62-51"><a href="#cb62-51" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(performance)</span>
<span id="cb62-52"><a href="#cb62-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-53"><a href="#cb62-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Set theme and seed for reproducibility</span></span>
<span id="cb62-54"><a href="#cb62-54" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb62-55"><a href="#cb62-55" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb62-56"><a href="#cb62-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-57"><a href="#cb62-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Load datasets</span></span>
<span id="cb62-58"><a href="#cb62-58" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(ames)        <span class="co"># House prices dataset</span></span>
<span id="cb62-59"><a href="#cb62-59" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(concrete)    <span class="co"># Concrete strength dataset</span></span>
<span id="cb62-60"><a href="#cb62-60" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Chicago)     <span class="co"># Chicago ridership data</span></span>
<span id="cb62-61"><a href="#cb62-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-62"><a href="#cb62-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick overview of our main dataset</span></span>
<span id="cb62-63"><a href="#cb62-63" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(ames)</span>
<span id="cb62-64"><a href="#cb62-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-65"><a href="#cb62-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-66"><a href="#cb62-66" aria-hidden="true" tabindex="-1"></a>The Ames housing dataset contains information about residential homes sold in Ames, Iowa. It's perfect for demonstrating regression techniques because:</span>
<span id="cb62-67"><a href="#cb62-67" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It has a clear continuous target (Sale_Price)</span>
<span id="cb62-68"><a href="#cb62-68" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It contains both numeric and categorical predictors</span>
<span id="cb62-69"><a href="#cb62-69" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It has enough complexity to showcase advanced techniques</span>
<span id="cb62-70"><a href="#cb62-70" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>It's real-world data with typical challenges (missing values, outliers, etc.)</span>
<span id="cb62-71"><a href="#cb62-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-72"><a href="#cb62-72" aria-hidden="true" tabindex="-1"></a><span class="fu">## Linear Regression: The Foundation</span></span>
<span id="cb62-73"><a href="#cb62-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-74"><a href="#cb62-74" aria-hidden="true" tabindex="-1"></a><span class="fu">### Mathematical Framework</span></span>
<span id="cb62-75"><a href="#cb62-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-76"><a href="#cb62-76" aria-hidden="true" tabindex="-1"></a>Linear regression assumes a linear relationship between predictors and the response. The model can be expressed as:</span>
<span id="cb62-77"><a href="#cb62-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-78"><a href="#cb62-78" aria-hidden="true" tabindex="-1"></a>$$Y = \beta_0 + \beta_1X_1 + \beta_2X_2 + ... + \beta_pX_p + \epsilon$$</span>
<span id="cb62-79"><a href="#cb62-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-80"><a href="#cb62-80" aria-hidden="true" tabindex="-1"></a>Where:</span>
<span id="cb62-81"><a href="#cb62-81" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$Y$ is the response variable</span>
<span id="cb62-82"><a href="#cb62-82" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$X_1, ..., X_p$ are the predictor variables</span>
<span id="cb62-83"><a href="#cb62-83" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta_0$ is the intercept (the expected value of Y when all X = 0)</span>
<span id="cb62-84"><a href="#cb62-84" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\beta_1, ..., \beta_p$ are the coefficients (slopes)</span>
<span id="cb62-85"><a href="#cb62-85" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$\epsilon$ is the error term (assumed to be normally distributed with mean 0)</span>
<span id="cb62-86"><a href="#cb62-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-87"><a href="#cb62-87" aria-hidden="true" tabindex="-1"></a><span class="fu">### The Ordinary Least Squares (OLS) Method</span></span>
<span id="cb62-88"><a href="#cb62-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-89"><a href="#cb62-89" aria-hidden="true" tabindex="-1"></a>The most common method for estimating the coefficients is Ordinary Least Squares, which minimizes the sum of squared residuals:</span>
<span id="cb62-90"><a href="#cb62-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-91"><a href="#cb62-91" aria-hidden="true" tabindex="-1"></a>$$\text{RSS} = \sum_{i=1}^{n} (y_i - \hat{y}_i)^2 = \sum_{i=1}^{n} (y_i - \beta_0 - \sum_{j=1}^{p} \beta_j x_{ij})^2$$</span>
<span id="cb62-92"><a href="#cb62-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-93"><a href="#cb62-93" aria-hidden="true" tabindex="-1"></a>Let's visualize this concept:</span>
<span id="cb62-94"><a href="#cb62-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-97"><a href="#cb62-97" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-98"><a href="#cb62-98" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 12</span></span>
<span id="cb62-99"><a href="#cb62-99" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb62-100"><a href="#cb62-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-101"><a href="#cb62-101" aria-hidden="true" tabindex="-1"></a><span class="co"># Create simple example data</span></span>
<span id="cb62-102"><a href="#cb62-102" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb62-103"><a href="#cb62-103" aria-hidden="true" tabindex="-1"></a>simple_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb62-104"><a href="#cb62-104" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">50</span>),</span>
<span id="cb62-105"><a href="#cb62-105" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_true =</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> x,  <span class="co"># True relationship</span></span>
<span id="cb62-106"><a href="#cb62-106" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y_true <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">3</span>)  <span class="co"># Add noise</span></span>
<span id="cb62-107"><a href="#cb62-107" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-108"><a href="#cb62-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-109"><a href="#cb62-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit simple linear regression</span></span>
<span id="cb62-110"><a href="#cb62-110" aria-hidden="true" tabindex="-1"></a>simple_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> simple_data)</span>
<span id="cb62-111"><a href="#cb62-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-112"><a href="#cb62-112" aria-hidden="true" tabindex="-1"></a><span class="co"># Add predictions and residuals</span></span>
<span id="cb62-113"><a href="#cb62-113" aria-hidden="true" tabindex="-1"></a>simple_data <span class="ot">&lt;-</span> simple_data <span class="sc">%&gt;%</span></span>
<span id="cb62-114"><a href="#cb62-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-115"><a href="#cb62-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_pred =</span> <span class="fu">predict</span>(simple_lm),</span>
<span id="cb62-116"><a href="#cb62-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">residual =</span> y <span class="sc">-</span> y_pred</span>
<span id="cb62-117"><a href="#cb62-117" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-118"><a href="#cb62-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-119"><a href="#cb62-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize OLS concept</span></span>
<span id="cb62-120"><a href="#cb62-120" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(simple_data, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb62-121"><a href="#cb62-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> x, <span class="at">y =</span> y, <span class="at">yend =</span> y_pred), </span>
<span id="cb62-122"><a href="#cb62-122" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb62-123"><a href="#cb62-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb62-124"><a href="#cb62-124" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_pred), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb62-125"><a href="#cb62-125" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_true), <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb62-126"><a href="#cb62-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-127"><a href="#cb62-127" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Ordinary Least Squares Visualization"</span>,</span>
<span id="cb62-128"><a href="#cb62-128" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Red lines show residuals (errors) being minimized"</span>,</span>
<span id="cb62-129"><a href="#cb62-129" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Predictor (X)"</span>,</span>
<span id="cb62-130"><a href="#cb62-130" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Response (Y)"</span></span>
<span id="cb62-131"><a href="#cb62-131" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-132"><a href="#cb62-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="dv">15</span>, <span class="at">label =</span> <span class="st">"True relationship"</span>, </span>
<span id="cb62-133"><a href="#cb62-133" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb62-134"><a href="#cb62-134" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">8</span>, <span class="at">y =</span> <span class="dv">25</span>, <span class="at">label =</span> <span class="st">"Fitted line"</span>, </span>
<span id="cb62-135"><a href="#cb62-135" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb62-136"><a href="#cb62-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-137"><a href="#cb62-137" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual distribution</span></span>
<span id="cb62-138"><a href="#cb62-138" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(simple_data, <span class="fu">aes</span>(<span class="at">x =</span> residual)) <span class="sc">+</span></span>
<span id="cb62-139"><a href="#cb62-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">20</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb62-140"><a href="#cb62-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb62-141"><a href="#cb62-141" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-142"><a href="#cb62-142" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Residuals"</span>,</span>
<span id="cb62-143"><a href="#cb62-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Should be centered at zero and approximately normal"</span>,</span>
<span id="cb62-144"><a href="#cb62-144" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Residual"</span>,</span>
<span id="cb62-145"><a href="#cb62-145" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Count"</span></span>
<span id="cb62-146"><a href="#cb62-146" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-147"><a href="#cb62-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-148"><a href="#cb62-148" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span>
<span id="cb62-149"><a href="#cb62-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-150"><a href="#cb62-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-151"><a href="#cb62-151" aria-hidden="true" tabindex="-1"></a><span class="fu">### Key Assumptions of Linear Regression</span></span>
<span id="cb62-152"><a href="#cb62-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-153"><a href="#cb62-153" aria-hidden="true" tabindex="-1"></a>Understanding the assumptions is crucial for proper model interpretation and validation:</span>
<span id="cb62-154"><a href="#cb62-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-155"><a href="#cb62-155" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Linearity**: The relationship between X and Y is linear</span>
<span id="cb62-156"><a href="#cb62-156" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Independence**: Observations are independent of each other</span>
<span id="cb62-157"><a href="#cb62-157" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Homoscedasticity**: Constant variance of residuals</span>
<span id="cb62-158"><a href="#cb62-158" aria-hidden="true" tabindex="-1"></a><span class="ss">4. </span>**Normality**: Residuals are normally distributed</span>
<span id="cb62-159"><a href="#cb62-159" aria-hidden="true" tabindex="-1"></a><span class="ss">5. </span>**No multicollinearity**: Predictors are not highly correlated</span>
<span id="cb62-160"><a href="#cb62-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-161"><a href="#cb62-161" aria-hidden="true" tabindex="-1"></a>Let's check these assumptions with real data:</span>
<span id="cb62-162"><a href="#cb62-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-165"><a href="#cb62-165" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-166"><a href="#cb62-166" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 12</span></span>
<span id="cb62-167"><a href="#cb62-167" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb62-168"><a href="#cb62-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-169"><a href="#cb62-169" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare Ames data for simple example</span></span>
<span id="cb62-170"><a href="#cb62-170" aria-hidden="true" tabindex="-1"></a>ames_simple <span class="ot">&lt;-</span> ames <span class="sc">%&gt;%</span></span>
<span id="cb62-171"><a href="#cb62-171" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sale_Price, Gr_Liv_Area, Year_Built, Overall_Cond) <span class="sc">%&gt;%</span></span>
<span id="cb62-172"><a href="#cb62-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb62-173"><a href="#cb62-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-174"><a href="#cb62-174" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb62-175"><a href="#cb62-175" aria-hidden="true" tabindex="-1"></a>ames_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sale_Price <span class="sc">~</span> Gr_Liv_Area <span class="sc">+</span> Year_Built <span class="sc">+</span> Overall_Cond, </span>
<span id="cb62-176"><a href="#cb62-176" aria-hidden="true" tabindex="-1"></a>              <span class="at">data =</span> ames_simple)</span>
<span id="cb62-177"><a href="#cb62-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-178"><a href="#cb62-178" aria-hidden="true" tabindex="-1"></a><span class="co"># Create diagnostic plots</span></span>
<span id="cb62-179"><a href="#cb62-179" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb62-180"><a href="#cb62-180" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ames_lm)</span>
<span id="cb62-181"><a href="#cb62-181" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-182"><a href="#cb62-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-183"><a href="#cb62-183" aria-hidden="true" tabindex="-1"></a>Each diagnostic plot tells us something important:</span>
<span id="cb62-184"><a href="#cb62-184" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Residuals vs Fitted**: Checks linearity and homoscedasticity. We want no clear pattern.</span>
<span id="cb62-185"><a href="#cb62-185" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Q-Q Plot**: Checks normality of residuals. Points should follow the diagonal line.</span>
<span id="cb62-186"><a href="#cb62-186" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Scale-Location**: Another check for homoscedasticity. We want a horizontal line.</span>
<span id="cb62-187"><a href="#cb62-187" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Residuals vs Leverage**: Identifies influential points that might unduly affect the model.</span>
<span id="cb62-188"><a href="#cb62-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-189"><a href="#cb62-189" aria-hidden="true" tabindex="-1"></a><span class="fu">## Implementing Linear Regression with Tidymodels</span></span>
<span id="cb62-190"><a href="#cb62-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-191"><a href="#cb62-191" aria-hidden="true" tabindex="-1"></a>Now let's implement a proper regression workflow using tidymodels. We'll predict house prices using multiple features.</span>
<span id="cb62-192"><a href="#cb62-192" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-193"><a href="#cb62-193" aria-hidden="true" tabindex="-1"></a><span class="fu">### Data Splitting and Preprocessing</span></span>
<span id="cb62-194"><a href="#cb62-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-195"><a href="#cb62-195" aria-hidden="true" tabindex="-1"></a>First, we need to properly split our data and create a preprocessing recipe. This is crucial to avoid data leakage and ensure fair model evaluation.</span>
<span id="cb62-196"><a href="#cb62-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-199"><a href="#cb62-199" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-200"><a href="#cb62-200" aria-hidden="true" tabindex="-1"></a><span class="co"># Clean and prepare the Ames data</span></span>
<span id="cb62-201"><a href="#cb62-201" aria-hidden="true" tabindex="-1"></a>ames_clean <span class="ot">&lt;-</span> ames <span class="sc">%&gt;%</span></span>
<span id="cb62-202"><a href="#cb62-202" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Sale_Price =</span> <span class="fu">log10</span>(Sale_Price)) <span class="sc">%&gt;%</span>  <span class="co"># Log transform for better distribution</span></span>
<span id="cb62-203"><a href="#cb62-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">contains</span>(<span class="st">"_Condition"</span>))  <span class="co"># Remove some problematic variables</span></span>
<span id="cb62-204"><a href="#cb62-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-205"><a href="#cb62-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Split the data</span></span>
<span id="cb62-206"><a href="#cb62-206" aria-hidden="true" tabindex="-1"></a>ames_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(ames_clean, <span class="at">prop =</span> <span class="fl">0.75</span>, <span class="at">strata =</span> Sale_Price)</span>
<span id="cb62-207"><a href="#cb62-207" aria-hidden="true" tabindex="-1"></a>ames_train <span class="ot">&lt;-</span> <span class="fu">training</span>(ames_split)</span>
<span id="cb62-208"><a href="#cb62-208" aria-hidden="true" tabindex="-1"></a>ames_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(ames_split)</span>
<span id="cb62-209"><a href="#cb62-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-210"><a href="#cb62-210" aria-hidden="true" tabindex="-1"></a><span class="co"># Create preprocessing recipe</span></span>
<span id="cb62-211"><a href="#cb62-211" aria-hidden="true" tabindex="-1"></a>ames_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> ames_train) <span class="sc">%&gt;%</span></span>
<span id="cb62-212"><a href="#cb62-212" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove variables with near-zero variance</span></span>
<span id="cb62-213"><a href="#cb62-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_nzv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-214"><a href="#cb62-214" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Impute missing values</span></span>
<span id="cb62-215"><a href="#cb62-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-216"><a href="#cb62-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-217"><a href="#cb62-217" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create dummy variables for categorical predictors</span></span>
<span id="cb62-218"><a href="#cb62-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-219"><a href="#cb62-219" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Normalize numeric predictors</span></span>
<span id="cb62-220"><a href="#cb62-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb62-221"><a href="#cb62-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-222"><a href="#cb62-222" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the recipe</span></span>
<span id="cb62-223"><a href="#cb62-223" aria-hidden="true" tabindex="-1"></a><span class="fu">prep</span>(ames_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb62-224"><a href="#cb62-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bake</span>(<span class="at">new_data =</span> <span class="cn">NULL</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-225"><a href="#cb62-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">glimpse</span>()</span>
<span id="cb62-226"><a href="#cb62-226" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-227"><a href="#cb62-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-228"><a href="#cb62-228" aria-hidden="true" tabindex="-1"></a>Notice how we're taking several important steps:</span>
<span id="cb62-229"><a href="#cb62-229" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Log transformation**: Sale prices often have a right-skewed distribution. Log transformation makes the distribution more normal.</span>
<span id="cb62-230"><a href="#cb62-230" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Stratified splitting**: Ensures both training and test sets have similar distributions of the target variable.</span>
<span id="cb62-231"><a href="#cb62-231" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Systematic preprocessing**: Handles missing values, creates dummy variables, and normalizes features in a reproducible way.</span>
<span id="cb62-232"><a href="#cb62-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-233"><a href="#cb62-233" aria-hidden="true" tabindex="-1"></a><span class="fu">### Model Specification and Training</span></span>
<span id="cb62-234"><a href="#cb62-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-237"><a href="#cb62-237" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-238"><a href="#cb62-238" aria-hidden="true" tabindex="-1"></a><span class="co"># Specify linear regression model</span></span>
<span id="cb62-239"><a href="#cb62-239" aria-hidden="true" tabindex="-1"></a>lm_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-240"><a href="#cb62-240" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"lm"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-241"><a href="#cb62-241" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb62-242"><a href="#cb62-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-243"><a href="#cb62-243" aria-hidden="true" tabindex="-1"></a><span class="co"># Create workflow</span></span>
<span id="cb62-244"><a href="#cb62-244" aria-hidden="true" tabindex="-1"></a>lm_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-245"><a href="#cb62-245" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(ames_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb62-246"><a href="#cb62-246" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec)</span>
<span id="cb62-247"><a href="#cb62-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-248"><a href="#cb62-248" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb62-249"><a href="#cb62-249" aria-hidden="true" tabindex="-1"></a>lm_fit <span class="ot">&lt;-</span> lm_workflow <span class="sc">%&gt;%</span></span>
<span id="cb62-250"><a href="#cb62-250" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(ames_train)</span>
<span id="cb62-251"><a href="#cb62-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-252"><a href="#cb62-252" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and examine coefficients</span></span>
<span id="cb62-253"><a href="#cb62-253" aria-hidden="true" tabindex="-1"></a>lm_coefs <span class="ot">&lt;-</span> lm_fit <span class="sc">%&gt;%</span></span>
<span id="cb62-254"><a href="#cb62-254" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-255"><a href="#cb62-255" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-256"><a href="#cb62-256" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term <span class="sc">!=</span> <span class="st">"(Intercept)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-257"><a href="#cb62-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(estimate))) <span class="sc">%&gt;%</span></span>
<span id="cb62-258"><a href="#cb62-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">20</span>)</span>
<span id="cb62-259"><a href="#cb62-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-260"><a href="#cb62-260" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize top coefficients</span></span>
<span id="cb62-261"><a href="#cb62-261" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(lm_coefs, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(term, estimate), <span class="at">y =</span> estimate)) <span class="sc">+</span></span>
<span id="cb62-262"><a href="#cb62-262" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb62-263"><a href="#cb62-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb62-264"><a href="#cb62-264" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-265"><a href="#cb62-265" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Top 20 Most Influential Features in Linear Regression"</span>,</span>
<span id="cb62-266"><a href="#cb62-266" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Coefficients represent change in log10(Sale_Price) per unit change in feature"</span>,</span>
<span id="cb62-267"><a href="#cb62-267" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Feature"</span>,</span>
<span id="cb62-268"><a href="#cb62-268" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Coefficient"</span></span>
<span id="cb62-269"><a href="#cb62-269" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-270"><a href="#cb62-270" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-271"><a href="#cb62-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-272"><a href="#cb62-272" aria-hidden="true" tabindex="-1"></a>The coefficients tell us the relationship between each feature and the sale price. Since we normalized the predictors, we can compare coefficient magnitudes directly. Positive coefficients increase price, negative ones decrease it.</span>
<span id="cb62-273"><a href="#cb62-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-274"><a href="#cb62-274" aria-hidden="true" tabindex="-1"></a><span class="fu">## Polynomial and Non-linear Regression</span></span>
<span id="cb62-275"><a href="#cb62-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-276"><a href="#cb62-276" aria-hidden="true" tabindex="-1"></a>Sometimes relationships aren't linear. Polynomial regression can capture curved relationships by including polynomial terms.</span>
<span id="cb62-277"><a href="#cb62-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-278"><a href="#cb62-278" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding Polynomial Regression</span></span>
<span id="cb62-279"><a href="#cb62-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-280"><a href="#cb62-280" aria-hidden="true" tabindex="-1"></a>Polynomial regression extends linear regression by adding polynomial terms:</span>
<span id="cb62-281"><a href="#cb62-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-282"><a href="#cb62-282" aria-hidden="true" tabindex="-1"></a>$$Y = \beta_0 + \beta_1X + \beta_2X^2 + ... + \beta_dX^d + \epsilon$$</span>
<span id="cb62-283"><a href="#cb62-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-284"><a href="#cb62-284" aria-hidden="true" tabindex="-1"></a>Let's visualize different polynomial degrees:</span>
<span id="cb62-285"><a href="#cb62-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-288"><a href="#cb62-288" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-289"><a href="#cb62-289" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 12</span></span>
<span id="cb62-290"><a href="#cb62-290" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb62-291"><a href="#cb62-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-292"><a href="#cb62-292" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate non-linear data</span></span>
<span id="cb62-293"><a href="#cb62-293" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb62-294"><a href="#cb62-294" aria-hidden="true" tabindex="-1"></a>nonlinear_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb62-295"><a href="#cb62-295" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">100</span>),</span>
<span id="cb62-296"><a href="#cb62-296" aria-hidden="true" tabindex="-1"></a>  <span class="at">y_true =</span> <span class="dv">10</span> <span class="sc">+</span> <span class="dv">5</span><span class="sc">*</span>x <span class="sc">-</span> <span class="fl">0.5</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.02</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">3</span>,</span>
<span id="cb62-297"><a href="#cb62-297" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y_true <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">sd =</span> <span class="dv">5</span>)</span>
<span id="cb62-298"><a href="#cb62-298" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-299"><a href="#cb62-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-300"><a href="#cb62-300" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models with different polynomial degrees</span></span>
<span id="cb62-301"><a href="#cb62-301" aria-hidden="true" tabindex="-1"></a>degrees <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">10</span>)</span>
<span id="cb62-302"><a href="#cb62-302" aria-hidden="true" tabindex="-1"></a>poly_models <span class="ot">&lt;-</span> <span class="fu">map</span>(degrees, <span class="cf">function</span>(d) {</span>
<span id="cb62-303"><a href="#cb62-303" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="at">degree =</span> d, <span class="at">raw =</span> <span class="cn">TRUE</span>), <span class="at">data =</span> nonlinear_data)</span>
<span id="cb62-304"><a href="#cb62-304" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb62-305"><a href="#cb62-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-306"><a href="#cb62-306" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate predictions</span></span>
<span id="cb62-307"><a href="#cb62-307" aria-hidden="true" tabindex="-1"></a>poly_predictions <span class="ot">&lt;-</span> <span class="fu">map2_df</span>(poly_models, degrees, <span class="cf">function</span>(model, d) {</span>
<span id="cb62-308"><a href="#cb62-308" aria-hidden="true" tabindex="-1"></a>  nonlinear_data <span class="sc">%&gt;%</span></span>
<span id="cb62-309"><a href="#cb62-309" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb62-310"><a href="#cb62-310" aria-hidden="true" tabindex="-1"></a>      <span class="at">y_pred =</span> <span class="fu">predict</span>(model),</span>
<span id="cb62-311"><a href="#cb62-311" aria-hidden="true" tabindex="-1"></a>      <span class="at">degree =</span> <span class="fu">paste</span>(<span class="st">"Degree"</span>, d)</span>
<span id="cb62-312"><a href="#cb62-312" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb62-313"><a href="#cb62-313" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb62-314"><a href="#cb62-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-315"><a href="#cb62-315" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb62-316"><a href="#cb62-316" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(poly_predictions, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb62-317"><a href="#cb62-317" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">data =</span> nonlinear_data) <span class="sc">+</span></span>
<span id="cb62-318"><a href="#cb62-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_pred, <span class="at">color =</span> degree), <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb62-319"><a href="#cb62-319" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> y_true), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, </span>
<span id="cb62-320"><a href="#cb62-320" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> nonlinear_data, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-321"><a href="#cb62-321" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>degree, <span class="at">ncol =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb62-322"><a href="#cb62-322" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb62-323"><a href="#cb62-323" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-324"><a href="#cb62-324" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Polynomial Regression with Different Degrees"</span>,</span>
<span id="cb62-325"><a href="#cb62-325" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Black dashed line shows true relationship. Higher degrees can lead to overfitting."</span>,</span>
<span id="cb62-326"><a href="#cb62-326" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"X"</span>,</span>
<span id="cb62-327"><a href="#cb62-327" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Y"</span></span>
<span id="cb62-328"><a href="#cb62-328" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-329"><a href="#cb62-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb62-330"><a href="#cb62-330" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-331"><a href="#cb62-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-332"><a href="#cb62-332" aria-hidden="true" tabindex="-1"></a>Notice how:</span>
<span id="cb62-333"><a href="#cb62-333" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Degree 1** (linear) underfits - it can't capture the curve</span>
<span id="cb62-334"><a href="#cb62-334" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Degree 2-3** capture the main pattern well</span>
<span id="cb62-335"><a href="#cb62-335" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Degree 10** overfits - it follows noise in the data</span>
<span id="cb62-336"><a href="#cb62-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-337"><a href="#cb62-337" aria-hidden="true" tabindex="-1"></a><span class="fu">### Implementing Polynomial Features</span></span>
<span id="cb62-338"><a href="#cb62-338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-341"><a href="#cb62-341" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-342"><a href="#cb62-342" aria-hidden="true" tabindex="-1"></a><span class="co"># Create recipe with polynomial features</span></span>
<span id="cb62-343"><a href="#cb62-343" aria-hidden="true" tabindex="-1"></a>poly_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> Gr_Liv_Area <span class="sc">+</span> Lot_Area, </span>
<span id="cb62-344"><a href="#cb62-344" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> ames_train) <span class="sc">%&gt;%</span></span>
<span id="cb62-345"><a href="#cb62-345" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(Gr_Liv_Area, <span class="at">degree =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-346"><a href="#cb62-346" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(Lot_Area, <span class="at">degree =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-347"><a href="#cb62-347" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="at">terms =</span> <span class="sc">~</span> Gr_Liv_Area_poly_1<span class="sc">:</span>Lot_Area_poly_1)</span>
<span id="cb62-348"><a href="#cb62-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-349"><a href="#cb62-349" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model with polynomial features</span></span>
<span id="cb62-350"><a href="#cb62-350" aria-hidden="true" tabindex="-1"></a>poly_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-351"><a href="#cb62-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(poly_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb62-352"><a href="#cb62-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec)</span>
<span id="cb62-353"><a href="#cb62-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-354"><a href="#cb62-354" aria-hidden="true" tabindex="-1"></a>poly_fit <span class="ot">&lt;-</span> poly_workflow <span class="sc">%&gt;%</span></span>
<span id="cb62-355"><a href="#cb62-355" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(ames_train)</span>
<span id="cb62-356"><a href="#cb62-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-357"><a href="#cb62-357" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare with simple linear model</span></span>
<span id="cb62-358"><a href="#cb62-358" aria-hidden="true" tabindex="-1"></a>simple_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> Gr_Liv_Area <span class="sc">+</span> Lot_Area, </span>
<span id="cb62-359"><a href="#cb62-359" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> ames_train)</span>
<span id="cb62-360"><a href="#cb62-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-361"><a href="#cb62-361" aria-hidden="true" tabindex="-1"></a>simple_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-362"><a href="#cb62-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(simple_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb62-363"><a href="#cb62-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec)</span>
<span id="cb62-364"><a href="#cb62-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-365"><a href="#cb62-365" aria-hidden="true" tabindex="-1"></a>simple_fit <span class="ot">&lt;-</span> simple_workflow <span class="sc">%&gt;%</span></span>
<span id="cb62-366"><a href="#cb62-366" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(ames_train)</span>
<span id="cb62-367"><a href="#cb62-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-368"><a href="#cb62-368" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate both models</span></span>
<span id="cb62-369"><a href="#cb62-369" aria-hidden="true" tabindex="-1"></a>models_comparison <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb62-370"><a href="#cb62-370" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">c</span>(<span class="st">"Linear"</span>, <span class="st">"Polynomial"</span>),</span>
<span id="cb62-371"><a href="#cb62-371" aria-hidden="true" tabindex="-1"></a>  <span class="at">workflow =</span> <span class="fu">list</span>(simple_workflow, poly_workflow)</span>
<span id="cb62-372"><a href="#cb62-372" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb62-373"><a href="#cb62-373" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-374"><a href="#cb62-374" aria-hidden="true" tabindex="-1"></a>    <span class="at">fit =</span> <span class="fu">map</span>(workflow, <span class="sc">~</span> <span class="fu">fit</span>(., ames_train)),</span>
<span id="cb62-375"><a href="#cb62-375" aria-hidden="true" tabindex="-1"></a>    <span class="at">train_pred =</span> <span class="fu">map</span>(fit, <span class="sc">~</span> <span class="fu">predict</span>(., ames_train)),</span>
<span id="cb62-376"><a href="#cb62-376" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_pred =</span> <span class="fu">map</span>(fit, <span class="sc">~</span> <span class="fu">predict</span>(., ames_test))</span>
<span id="cb62-377"><a href="#cb62-377" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-378"><a href="#cb62-378" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-379"><a href="#cb62-379" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate metrics</span></span>
<span id="cb62-380"><a href="#cb62-380" aria-hidden="true" tabindex="-1"></a>comparison_metrics <span class="ot">&lt;-</span> models_comparison <span class="sc">%&gt;%</span></span>
<span id="cb62-381"><a href="#cb62-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-382"><a href="#cb62-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">train_metrics =</span> <span class="fu">map2</span>(train_pred, <span class="fu">list</span>(ames_train), <span class="sc">~</span> {</span>
<span id="cb62-383"><a href="#cb62-383" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(.x, .y) <span class="sc">%&gt;%</span></span>
<span id="cb62-384"><a href="#cb62-384" aria-hidden="true" tabindex="-1"></a>        <span class="fu">metrics</span>(<span class="at">truth =</span> Sale_Price, <span class="at">estimate =</span> .pred)</span>
<span id="cb62-385"><a href="#cb62-385" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb62-386"><a href="#cb62-386" aria-hidden="true" tabindex="-1"></a>    <span class="at">test_metrics =</span> <span class="fu">map2</span>(test_pred, <span class="fu">list</span>(ames_test), <span class="sc">~</span> {</span>
<span id="cb62-387"><a href="#cb62-387" aria-hidden="true" tabindex="-1"></a>      <span class="fu">bind_cols</span>(.x, .y) <span class="sc">%&gt;%</span></span>
<span id="cb62-388"><a href="#cb62-388" aria-hidden="true" tabindex="-1"></a>        <span class="fu">metrics</span>(<span class="at">truth =</span> Sale_Price, <span class="at">estimate =</span> .pred)</span>
<span id="cb62-389"><a href="#cb62-389" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb62-390"><a href="#cb62-390" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb62-391"><a href="#cb62-391" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(model, train_metrics, test_metrics) <span class="sc">%&gt;%</span></span>
<span id="cb62-392"><a href="#cb62-392" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(train_metrics, test_metrics), </span>
<span id="cb62-393"><a href="#cb62-393" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"dataset"</span>, <span class="at">values_to =</span> <span class="st">"metrics"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-394"><a href="#cb62-394" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(metrics)</span>
<span id="cb62-395"><a href="#cb62-395" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-396"><a href="#cb62-396" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize comparison</span></span>
<span id="cb62-397"><a href="#cb62-397" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison_metrics, </span>
<span id="cb62-398"><a href="#cb62-398" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> .estimate, <span class="at">fill =</span> dataset)) <span class="sc">+</span></span>
<span id="cb62-399"><a href="#cb62-399" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb62-400"><a href="#cb62-400" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>.metric, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb62-401"><a href="#cb62-401" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"train_metrics"</span> <span class="ot">=</span> <span class="st">"lightblue"</span>, </span>
<span id="cb62-402"><a href="#cb62-402" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"test_metrics"</span> <span class="ot">=</span> <span class="st">"darkblue"</span>)) <span class="sc">+</span></span>
<span id="cb62-403"><a href="#cb62-403" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-404"><a href="#cb62-404" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Linear vs Polynomial Model Comparison"</span>,</span>
<span id="cb62-405"><a href="#cb62-405" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Watch for overfitting: train performance much better than test"</span>,</span>
<span id="cb62-406"><a href="#cb62-406" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Metric Value"</span></span>
<span id="cb62-407"><a href="#cb62-407" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-408"><a href="#cb62-408" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-409"><a href="#cb62-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-410"><a href="#cb62-410" aria-hidden="true" tabindex="-1"></a><span class="fu">## Regularization: Ridge, Lasso, and Elastic Net</span></span>
<span id="cb62-411"><a href="#cb62-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-412"><a href="#cb62-412" aria-hidden="true" tabindex="-1"></a>Regularization adds a penalty term to the loss function to prevent overfitting and handle multicollinearity.</span>
<span id="cb62-413"><a href="#cb62-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-414"><a href="#cb62-414" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding Regularization Mathematics</span></span>
<span id="cb62-415"><a href="#cb62-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-416"><a href="#cb62-416" aria-hidden="true" tabindex="-1"></a>The three main types of regularization are:</span>
<span id="cb62-417"><a href="#cb62-417" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-418"><a href="#cb62-418" aria-hidden="true" tabindex="-1"></a>**Ridge Regression (L2 penalty):**</span>
<span id="cb62-419"><a href="#cb62-419" aria-hidden="true" tabindex="-1"></a>$$\text{Loss} = \text{RSS} + \lambda \sum_{j=1}^{p} \beta_j^2$$</span>
<span id="cb62-420"><a href="#cb62-420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-421"><a href="#cb62-421" aria-hidden="true" tabindex="-1"></a>Ridge regression shrinks coefficients toward zero but never exactly to zero. It's good when you have many predictors with small effects.</span>
<span id="cb62-422"><a href="#cb62-422" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-423"><a href="#cb62-423" aria-hidden="true" tabindex="-1"></a>**Lasso Regression (L1 penalty):**</span>
<span id="cb62-424"><a href="#cb62-424" aria-hidden="true" tabindex="-1"></a>$$\text{Loss} = \text{RSS} + \lambda \sum_{j=1}^{p} |\beta_j|$$</span>
<span id="cb62-425"><a href="#cb62-425" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-426"><a href="#cb62-426" aria-hidden="true" tabindex="-1"></a>Lasso can shrink coefficients exactly to zero, performing automatic feature selection. It's good when you believe only a subset of predictors are important.</span>
<span id="cb62-427"><a href="#cb62-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-428"><a href="#cb62-428" aria-hidden="true" tabindex="-1"></a>**Elastic Net (Combination):**</span>
<span id="cb62-429"><a href="#cb62-429" aria-hidden="true" tabindex="-1"></a>$$\text{Loss} = \text{RSS} + \lambda \left<span class="co">[</span><span class="ot"> \alpha \sum_{j=1}^{p} |\beta_j| + (1-\alpha) \sum_{j=1}^{p} \beta_j^2 \right</span><span class="co">]</span>$$</span>
<span id="cb62-430"><a href="#cb62-430" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-431"><a href="#cb62-431" aria-hidden="true" tabindex="-1"></a>Elastic Net combines Ridge and Lasso, controlled by the mixing parameter α.</span>
<span id="cb62-432"><a href="#cb62-432" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-433"><a href="#cb62-433" aria-hidden="true" tabindex="-1"></a>Let's visualize how regularization affects coefficients:</span>
<span id="cb62-434"><a href="#cb62-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-437"><a href="#cb62-437" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-438"><a href="#cb62-438" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 14</span></span>
<span id="cb62-439"><a href="#cb62-439" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb62-440"><a href="#cb62-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-441"><a href="#cb62-441" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for regularization</span></span>
<span id="cb62-442"><a href="#cb62-442" aria-hidden="true" tabindex="-1"></a>ames_reg <span class="ot">&lt;-</span> ames_train <span class="sc">%&gt;%</span></span>
<span id="cb62-443"><a href="#cb62-443" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sale_Price, Gr_Liv_Area, Garage_Area, Year_Built, </span>
<span id="cb62-444"><a href="#cb62-444" aria-hidden="true" tabindex="-1"></a>         Lot_Area, Total_Bsmt_SF, First_Flr_SF) <span class="sc">%&gt;%</span></span>
<span id="cb62-445"><a href="#cb62-445" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb62-446"><a href="#cb62-446" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-447"><a href="#cb62-447" aria-hidden="true" tabindex="-1"></a><span class="co"># Create model matrix</span></span>
<span id="cb62-448"><a href="#cb62-448" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(Sale_Price <span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> ames_reg)</span>
<span id="cb62-449"><a href="#cb62-449" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> ames_reg<span class="sc">$</span>Sale_Price</span>
<span id="cb62-450"><a href="#cb62-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-451"><a href="#cb62-451" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Ridge regression</span></span>
<span id="cb62-452"><a href="#cb62-452" aria-hidden="true" tabindex="-1"></a>ridge_fit <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X, y, <span class="at">alpha =</span> <span class="dv">0</span>)  <span class="co"># alpha = 0 for Ridge</span></span>
<span id="cb62-453"><a href="#cb62-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-454"><a href="#cb62-454" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Lasso regression</span></span>
<span id="cb62-455"><a href="#cb62-455" aria-hidden="true" tabindex="-1"></a>lasso_fit <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X, y, <span class="at">alpha =</span> <span class="dv">1</span>)  <span class="co"># alpha = 1 for Lasso</span></span>
<span id="cb62-456"><a href="#cb62-456" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-457"><a href="#cb62-457" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit Elastic Net</span></span>
<span id="cb62-458"><a href="#cb62-458" aria-hidden="true" tabindex="-1"></a>elastic_fit <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(X, y, <span class="at">alpha =</span> <span class="fl">0.5</span>)  <span class="co"># alpha = 0.5 for 50/50 mix</span></span>
<span id="cb62-459"><a href="#cb62-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-460"><a href="#cb62-460" aria-hidden="true" tabindex="-1"></a><span class="co"># Create coefficient path plots</span></span>
<span id="cb62-461"><a href="#cb62-461" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb62-462"><a href="#cb62-462" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ridge_fit, <span class="at">xvar =</span> <span class="st">"lambda"</span>, <span class="at">main =</span> <span class="st">"Ridge Regression Path"</span>)</span>
<span id="cb62-463"><a href="#cb62-463" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(lasso_fit, <span class="at">xvar =</span> <span class="st">"lambda"</span>, <span class="at">main =</span> <span class="st">"Lasso Regression Path"</span>)</span>
<span id="cb62-464"><a href="#cb62-464" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(elastic_fit, <span class="at">xvar =</span> <span class="st">"lambda"</span>, <span class="at">main =</span> <span class="st">"Elastic Net Path"</span>)</span>
<span id="cb62-465"><a href="#cb62-465" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-466"><a href="#cb62-466" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-467"><a href="#cb62-467" aria-hidden="true" tabindex="-1"></a>These plots show how coefficients change as the penalty parameter λ increases:</span>
<span id="cb62-468"><a href="#cb62-468" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Ridge**: All coefficients shrink smoothly toward zero but never reach it</span>
<span id="cb62-469"><a href="#cb62-469" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Lasso**: Coefficients can hit zero abruptly (feature selection)</span>
<span id="cb62-470"><a href="#cb62-470" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Elastic Net**: Combination of both behaviors</span>
<span id="cb62-471"><a href="#cb62-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-472"><a href="#cb62-472" aria-hidden="true" tabindex="-1"></a><span class="fu">### Implementing Regularized Regression</span></span>
<span id="cb62-473"><a href="#cb62-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-474"><a href="#cb62-474" aria-hidden="true" tabindex="-1"></a>Now let's implement these methods properly with tidymodels:</span>
<span id="cb62-475"><a href="#cb62-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-478"><a href="#cb62-478" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-479"><a href="#cb62-479" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a more complete recipe</span></span>
<span id="cb62-480"><a href="#cb62-480" aria-hidden="true" tabindex="-1"></a>reg_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> ames_train) <span class="sc">%&gt;%</span></span>
<span id="cb62-481"><a href="#cb62-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_nzv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-482"><a href="#cb62-482" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-483"><a href="#cb62-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_mode</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-484"><a href="#cb62-484" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-485"><a href="#cb62-485" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb62-486"><a href="#cb62-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-487"><a href="#cb62-487" aria-hidden="true" tabindex="-1"></a><span class="co"># Ridge regression</span></span>
<span id="cb62-488"><a href="#cb62-488" aria-hidden="true" tabindex="-1"></a>ridge_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fl">0.01</span>, <span class="at">mixture =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-489"><a href="#cb62-489" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-490"><a href="#cb62-490" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb62-491"><a href="#cb62-491" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-492"><a href="#cb62-492" aria-hidden="true" tabindex="-1"></a><span class="co"># Lasso regression</span></span>
<span id="cb62-493"><a href="#cb62-493" aria-hidden="true" tabindex="-1"></a>lasso_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fl">0.01</span>, <span class="at">mixture =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-494"><a href="#cb62-494" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-495"><a href="#cb62-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb62-496"><a href="#cb62-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-497"><a href="#cb62-497" aria-hidden="true" tabindex="-1"></a><span class="co"># Elastic Net</span></span>
<span id="cb62-498"><a href="#cb62-498" aria-hidden="true" tabindex="-1"></a>elastic_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fl">0.01</span>, <span class="at">mixture =</span> <span class="fl">0.5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-499"><a href="#cb62-499" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-500"><a href="#cb62-500" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb62-501"><a href="#cb62-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-502"><a href="#cb62-502" aria-hidden="true" tabindex="-1"></a><span class="co"># Create workflows</span></span>
<span id="cb62-503"><a href="#cb62-503" aria-hidden="true" tabindex="-1"></a>ridge_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-504"><a href="#cb62-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(reg_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb62-505"><a href="#cb62-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(ridge_spec)</span>
<span id="cb62-506"><a href="#cb62-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-507"><a href="#cb62-507" aria-hidden="true" tabindex="-1"></a>lasso_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-508"><a href="#cb62-508" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(reg_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb62-509"><a href="#cb62-509" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lasso_spec)</span>
<span id="cb62-510"><a href="#cb62-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-511"><a href="#cb62-511" aria-hidden="true" tabindex="-1"></a>elastic_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-512"><a href="#cb62-512" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(reg_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb62-513"><a href="#cb62-513" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(elastic_spec)</span>
<span id="cb62-514"><a href="#cb62-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-515"><a href="#cb62-515" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit all models</span></span>
<span id="cb62-516"><a href="#cb62-516" aria-hidden="true" tabindex="-1"></a>ridge_fit <span class="ot">&lt;-</span> ridge_wf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(ames_train)</span>
<span id="cb62-517"><a href="#cb62-517" aria-hidden="true" tabindex="-1"></a>lasso_fit <span class="ot">&lt;-</span> lasso_wf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(ames_train)</span>
<span id="cb62-518"><a href="#cb62-518" aria-hidden="true" tabindex="-1"></a>elastic_fit <span class="ot">&lt;-</span> elastic_wf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(ames_train)</span>
<span id="cb62-519"><a href="#cb62-519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-520"><a href="#cb62-520" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare number of non-zero coefficients</span></span>
<span id="cb62-521"><a href="#cb62-521" aria-hidden="true" tabindex="-1"></a>n_features <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb62-522"><a href="#cb62-522" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Ridge"</span>, <span class="st">"Lasso"</span>, <span class="st">"Elastic Net"</span>),</span>
<span id="cb62-523"><a href="#cb62-523" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Non-zero Coefficients</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb62-524"><a href="#cb62-524" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">tidy</span>(ridge_fit)<span class="sc">$</span>estimate <span class="sc">!=</span> <span class="dv">0</span>),</span>
<span id="cb62-525"><a href="#cb62-525" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">tidy</span>(lasso_fit)<span class="sc">$</span>estimate <span class="sc">!=</span> <span class="dv">0</span>),</span>
<span id="cb62-526"><a href="#cb62-526" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">tidy</span>(elastic_fit)<span class="sc">$</span>estimate <span class="sc">!=</span> <span class="dv">0</span>)</span>
<span id="cb62-527"><a href="#cb62-527" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb62-528"><a href="#cb62-528" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Total Features</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb62-529"><a href="#cb62-529" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(<span class="fu">tidy</span>(ridge_fit)),</span>
<span id="cb62-530"><a href="#cb62-530" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(<span class="fu">tidy</span>(lasso_fit)),</span>
<span id="cb62-531"><a href="#cb62-531" aria-hidden="true" tabindex="-1"></a>    <span class="fu">nrow</span>(<span class="fu">tidy</span>(elastic_fit))</span>
<span id="cb62-532"><a href="#cb62-532" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-533"><a href="#cb62-533" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-534"><a href="#cb62-534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-535"><a href="#cb62-535" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(n_features)</span>
<span id="cb62-536"><a href="#cb62-536" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-537"><a href="#cb62-537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-538"><a href="#cb62-538" aria-hidden="true" tabindex="-1"></a>Notice how Lasso has fewer non-zero coefficients - it's performing feature selection automatically!</span>
<span id="cb62-539"><a href="#cb62-539" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-540"><a href="#cb62-540" aria-hidden="true" tabindex="-1"></a><span class="fu">## Regression Trees and Random Forests</span></span>
<span id="cb62-541"><a href="#cb62-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-542"><a href="#cb62-542" aria-hidden="true" tabindex="-1"></a>Tree-based methods can capture non-linear relationships and interactions without explicitly specifying them.</span>
<span id="cb62-543"><a href="#cb62-543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-544"><a href="#cb62-544" aria-hidden="true" tabindex="-1"></a><span class="fu">### How Regression Trees Work</span></span>
<span id="cb62-545"><a href="#cb62-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-546"><a href="#cb62-546" aria-hidden="true" tabindex="-1"></a>Regression trees recursively partition the feature space into rectangles, predicting the mean value in each region. The splitting criterion for regression is typically the reduction in RSS:</span>
<span id="cb62-547"><a href="#cb62-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-548"><a href="#cb62-548" aria-hidden="true" tabindex="-1"></a>$$\text{RSS} = \sum_{i \in R_1} (y_i - \hat{y}_{R_1})^2 + \sum_{i \in R_2} (y_i - \hat{y}_{R_2})^2$$</span>
<span id="cb62-549"><a href="#cb62-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-550"><a href="#cb62-550" aria-hidden="true" tabindex="-1"></a>Where $R_1$ and $R_2$ are the two regions created by the split.</span>
<span id="cb62-551"><a href="#cb62-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-554"><a href="#cb62-554" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-555"><a href="#cb62-555" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 12</span></span>
<span id="cb62-556"><a href="#cb62-556" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb62-557"><a href="#cb62-557" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-558"><a href="#cb62-558" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a simple regression tree</span></span>
<span id="cb62-559"><a href="#cb62-559" aria-hidden="true" tabindex="-1"></a>tree_spec <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(</span>
<span id="cb62-560"><a href="#cb62-560" aria-hidden="true" tabindex="-1"></a>  <span class="at">cost_complexity =</span> <span class="fl">0.01</span>,</span>
<span id="cb62-561"><a href="#cb62-561" aria-hidden="true" tabindex="-1"></a>  <span class="at">tree_depth =</span> <span class="dv">4</span>,</span>
<span id="cb62-562"><a href="#cb62-562" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_n =</span> <span class="dv">20</span></span>
<span id="cb62-563"><a href="#cb62-563" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb62-564"><a href="#cb62-564" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"rpart"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-565"><a href="#cb62-565" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb62-566"><a href="#cb62-566" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-567"><a href="#cb62-567" aria-hidden="true" tabindex="-1"></a>tree_fit <span class="ot">&lt;-</span> tree_spec <span class="sc">%&gt;%</span></span>
<span id="cb62-568"><a href="#cb62-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Sale_Price <span class="sc">~</span> Gr_Liv_Area <span class="sc">+</span> Year_Built, <span class="at">data =</span> ames_train)</span>
<span id="cb62-569"><a href="#cb62-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-570"><a href="#cb62-570" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the tree</span></span>
<span id="cb62-571"><a href="#cb62-571" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">require</span>(rpart.plot, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb62-572"><a href="#cb62-572" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rpart.plot</span>(tree_fit<span class="sc">$</span>fit, <span class="at">type =</span> <span class="dv">4</span>, <span class="at">extra =</span> <span class="dv">1</span>, <span class="at">roundint =</span> <span class="cn">FALSE</span>)</span>
<span id="cb62-573"><a href="#cb62-573" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-574"><a href="#cb62-574" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-575"><a href="#cb62-575" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediction surface</span></span>
<span id="cb62-576"><a href="#cb62-576" aria-hidden="true" tabindex="-1"></a>grid <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb62-577"><a href="#cb62-577" aria-hidden="true" tabindex="-1"></a>  <span class="at">Gr_Liv_Area =</span> <span class="fu">seq</span>(<span class="fu">min</span>(ames_train<span class="sc">$</span>Gr_Liv_Area, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb62-578"><a href="#cb62-578" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">max</span>(ames_train<span class="sc">$</span>Gr_Liv_Area, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb62-579"><a href="#cb62-579" aria-hidden="true" tabindex="-1"></a>                     <span class="at">length.out =</span> <span class="dv">100</span>),</span>
<span id="cb62-580"><a href="#cb62-580" aria-hidden="true" tabindex="-1"></a>  <span class="at">Year_Built =</span> <span class="fu">seq</span>(<span class="fu">min</span>(ames_train<span class="sc">$</span>Year_Built, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb62-581"><a href="#cb62-581" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">max</span>(ames_train<span class="sc">$</span>Year_Built, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb62-582"><a href="#cb62-582" aria-hidden="true" tabindex="-1"></a>                   <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb62-583"><a href="#cb62-583" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-584"><a href="#cb62-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-585"><a href="#cb62-585" aria-hidden="true" tabindex="-1"></a>grid_pred <span class="ot">&lt;-</span> tree_fit <span class="sc">%&gt;%</span></span>
<span id="cb62-586"><a href="#cb62-586" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(grid) <span class="sc">%&gt;%</span></span>
<span id="cb62-587"><a href="#cb62-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(grid)</span>
<span id="cb62-588"><a href="#cb62-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-589"><a href="#cb62-589" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize prediction surface</span></span>
<span id="cb62-590"><a href="#cb62-590" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(grid_pred, <span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Year_Built, <span class="at">fill =</span> .pred)) <span class="sc">+</span></span>
<span id="cb62-591"><a href="#cb62-591" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>() <span class="sc">+</span></span>
<span id="cb62-592"><a href="#cb62-592" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb62-593"><a href="#cb62-593" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">sample_n</span>(ames_train, <span class="dv">200</span>), </span>
<span id="cb62-594"><a href="#cb62-594" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">fill =</span> <span class="cn">NULL</span>, <span class="at">color =</span> Sale_Price), </span>
<span id="cb62-595"><a href="#cb62-595" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb62-596"><a href="#cb62-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb62-597"><a href="#cb62-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-598"><a href="#cb62-598" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Regression Tree Prediction Surface"</span>,</span>
<span id="cb62-599"><a href="#cb62-599" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Notice the rectangular regions - characteristic of tree-based methods"</span>,</span>
<span id="cb62-600"><a href="#cb62-600" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Living Area (sq ft)"</span>,</span>
<span id="cb62-601"><a href="#cb62-601" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Year Built"</span>,</span>
<span id="cb62-602"><a href="#cb62-602" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Predicted</span><span class="sc">\n</span><span class="st">log(Price)"</span>,</span>
<span id="cb62-603"><a href="#cb62-603" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Actual</span><span class="sc">\n</span><span class="st">log(Price)"</span></span>
<span id="cb62-604"><a href="#cb62-604" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-605"><a href="#cb62-605" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-606"><a href="#cb62-606" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-607"><a href="#cb62-607" aria-hidden="true" tabindex="-1"></a>The rectangular regions are a key characteristic of tree-based methods. Each rectangle represents a leaf node in the tree, with all observations in that region receiving the same prediction.</span>
<span id="cb62-608"><a href="#cb62-608" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-609"><a href="#cb62-609" aria-hidden="true" tabindex="-1"></a><span class="fu">### Random Forests for Regression</span></span>
<span id="cb62-610"><a href="#cb62-610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-611"><a href="#cb62-611" aria-hidden="true" tabindex="-1"></a>Random Forests improve upon single trees by:</span>
<span id="cb62-612"><a href="#cb62-612" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>Building many trees on bootstrap samples (bagging)</span>
<span id="cb62-613"><a href="#cb62-613" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>Randomly selecting features at each split</span>
<span id="cb62-614"><a href="#cb62-614" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>Averaging predictions across all trees</span>
<span id="cb62-615"><a href="#cb62-615" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-616"><a href="#cb62-616" aria-hidden="true" tabindex="-1"></a>This reduces overfitting and improves generalization:</span>
<span id="cb62-617"><a href="#cb62-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-620"><a href="#cb62-620" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-621"><a href="#cb62-621" aria-hidden="true" tabindex="-1"></a><span class="co"># Random Forest specification</span></span>
<span id="cb62-622"><a href="#cb62-622" aria-hidden="true" tabindex="-1"></a>rf_spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(</span>
<span id="cb62-623"><a href="#cb62-623" aria-hidden="true" tabindex="-1"></a>  <span class="at">trees =</span> <span class="dv">500</span>,</span>
<span id="cb62-624"><a href="#cb62-624" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="dv">10</span>,</span>
<span id="cb62-625"><a href="#cb62-625" aria-hidden="true" tabindex="-1"></a>  <span class="at">min_n =</span> <span class="dv">5</span></span>
<span id="cb62-626"><a href="#cb62-626" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb62-627"><a href="#cb62-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">importance =</span> <span class="st">"impurity"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-628"><a href="#cb62-628" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb62-629"><a href="#cb62-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-630"><a href="#cb62-630" aria-hidden="true" tabindex="-1"></a><span class="co"># Create workflow</span></span>
<span id="cb62-631"><a href="#cb62-631" aria-hidden="true" tabindex="-1"></a>rf_workflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-632"><a href="#cb62-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(reg_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb62-633"><a href="#cb62-633" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(rf_spec)</span>
<span id="cb62-634"><a href="#cb62-634" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-635"><a href="#cb62-635" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit with cross-validation for better evaluation</span></span>
<span id="cb62-636"><a href="#cb62-636" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb62-637"><a href="#cb62-637" aria-hidden="true" tabindex="-1"></a>ames_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(ames_train, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb62-638"><a href="#cb62-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-639"><a href="#cb62-639" aria-hidden="true" tabindex="-1"></a>rf_cv <span class="ot">&lt;-</span> rf_workflow <span class="sc">%&gt;%</span></span>
<span id="cb62-640"><a href="#cb62-640" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(</span>
<span id="cb62-641"><a href="#cb62-641" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> ames_folds,</span>
<span id="cb62-642"><a href="#cb62-642" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(yardstick<span class="sc">::</span>rmse, yardstick<span class="sc">::</span>rsq, yardstick<span class="sc">::</span>mae),</span>
<span id="cb62-643"><a href="#cb62-643" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">control_resamples</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-644"><a href="#cb62-644" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-645"><a href="#cb62-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-646"><a href="#cb62-646" aria-hidden="true" tabindex="-1"></a><span class="co"># Show performance</span></span>
<span id="cb62-647"><a href="#cb62-647" aria-hidden="true" tabindex="-1"></a><span class="fu">collect_metrics</span>(rf_cv) <span class="sc">%&gt;%</span></span>
<span id="cb62-648"><a href="#cb62-648" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">4</span>)</span>
<span id="cb62-649"><a href="#cb62-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-650"><a href="#cb62-650" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit final model for feature importance</span></span>
<span id="cb62-651"><a href="#cb62-651" aria-hidden="true" tabindex="-1"></a>rf_final <span class="ot">&lt;-</span> rf_workflow <span class="sc">%&gt;%</span></span>
<span id="cb62-652"><a href="#cb62-652" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(ames_train)</span>
<span id="cb62-653"><a href="#cb62-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-654"><a href="#cb62-654" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and plot feature importance</span></span>
<span id="cb62-655"><a href="#cb62-655" aria-hidden="true" tabindex="-1"></a>rf_importance <span class="ot">&lt;-</span> rf_final <span class="sc">%&gt;%</span></span>
<span id="cb62-656"><a href="#cb62-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-657"><a href="#cb62-657" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vip</span>(<span class="at">num_features =</span> <span class="dv">20</span>)</span>
<span id="cb62-658"><a href="#cb62-658" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-659"><a href="#cb62-659" aria-hidden="true" tabindex="-1"></a>rf_importance <span class="sc">+</span></span>
<span id="cb62-660"><a href="#cb62-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 20 Most Important Features in Random Forest"</span>,</span>
<span id="cb62-661"><a href="#cb62-661" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Based on impurity reduction"</span>)</span>
<span id="cb62-662"><a href="#cb62-662" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-663"><a href="#cb62-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-664"><a href="#cb62-664" aria-hidden="true" tabindex="-1"></a>Random Forests often provide excellent predictive performance with minimal tuning, making them a go-to method for many regression problems.</span>
<span id="cb62-665"><a href="#cb62-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-666"><a href="#cb62-666" aria-hidden="true" tabindex="-1"></a><span class="fu">## Model Diagnostics and Validation</span></span>
<span id="cb62-667"><a href="#cb62-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-668"><a href="#cb62-668" aria-hidden="true" tabindex="-1"></a>Proper model validation is crucial for ensuring your model will generalize well to new data.</span>
<span id="cb62-669"><a href="#cb62-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-670"><a href="#cb62-670" aria-hidden="true" tabindex="-1"></a><span class="fu">### Residual Analysis</span></span>
<span id="cb62-671"><a href="#cb62-671" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-672"><a href="#cb62-672" aria-hidden="true" tabindex="-1"></a>Residual analysis helps identify problems with model assumptions:</span>
<span id="cb62-673"><a href="#cb62-673" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-676"><a href="#cb62-676" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-677"><a href="#cb62-677" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 14</span></span>
<span id="cb62-678"><a href="#cb62-678" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb62-679"><a href="#cb62-679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-680"><a href="#cb62-680" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predictions from our linear model</span></span>
<span id="cb62-681"><a href="#cb62-681" aria-hidden="true" tabindex="-1"></a>lm_pred <span class="ot">&lt;-</span> lm_fit <span class="sc">%&gt;%</span></span>
<span id="cb62-682"><a href="#cb62-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(ames_test) <span class="sc">%&gt;%</span></span>
<span id="cb62-683"><a href="#cb62-683" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(ames_test) <span class="sc">%&gt;%</span></span>
<span id="cb62-684"><a href="#cb62-684" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-685"><a href="#cb62-685" aria-hidden="true" tabindex="-1"></a>    <span class="at">residual =</span> Sale_Price <span class="sc">-</span> .pred,</span>
<span id="cb62-686"><a href="#cb62-686" aria-hidden="true" tabindex="-1"></a>    <span class="at">std_residual =</span> residual <span class="sc">/</span> <span class="fu">sd</span>(residual)</span>
<span id="cb62-687"><a href="#cb62-687" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-688"><a href="#cb62-688" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-689"><a href="#cb62-689" aria-hidden="true" tabindex="-1"></a><span class="co"># Create diagnostic plots</span></span>
<span id="cb62-690"><a href="#cb62-690" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(lm_pred, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> residual)) <span class="sc">+</span></span>
<span id="cb62-691"><a href="#cb62-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb62-692"><a href="#cb62-692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb62-693"><a href="#cb62-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb62-694"><a href="#cb62-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-695"><a href="#cb62-695" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Residuals vs Fitted Values"</span>,</span>
<span id="cb62-696"><a href="#cb62-696" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Look for patterns - should be random scatter around zero"</span>,</span>
<span id="cb62-697"><a href="#cb62-697" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Fitted Values"</span>,</span>
<span id="cb62-698"><a href="#cb62-698" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Residuals"</span></span>
<span id="cb62-699"><a href="#cb62-699" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-700"><a href="#cb62-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-701"><a href="#cb62-701" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(lm_pred, <span class="fu">aes</span>(<span class="at">sample =</span> std_residual)) <span class="sc">+</span></span>
<span id="cb62-702"><a href="#cb62-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq</span>() <span class="sc">+</span></span>
<span id="cb62-703"><a href="#cb62-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_line</span>(<span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb62-704"><a href="#cb62-704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-705"><a href="#cb62-705" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Q-Q Plot"</span>,</span>
<span id="cb62-706"><a href="#cb62-706" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Check normality - points should follow the line"</span>,</span>
<span id="cb62-707"><a href="#cb62-707" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Theoretical Quantiles"</span>,</span>
<span id="cb62-708"><a href="#cb62-708" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Standardized Residuals"</span></span>
<span id="cb62-709"><a href="#cb62-709" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-710"><a href="#cb62-710" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-711"><a href="#cb62-711" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(lm_pred, <span class="fu">aes</span>(<span class="at">x =</span> .pred, <span class="at">y =</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(std_residual)))) <span class="sc">+</span></span>
<span id="cb62-712"><a href="#cb62-712" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb62-713"><a href="#cb62-713" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb62-714"><a href="#cb62-714" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-715"><a href="#cb62-715" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Scale-Location Plot"</span>,</span>
<span id="cb62-716"><a href="#cb62-716" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Check homoscedasticity - spread should be constant"</span>,</span>
<span id="cb62-717"><a href="#cb62-717" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Fitted Values"</span>,</span>
<span id="cb62-718"><a href="#cb62-718" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"√|Standardized Residuals|"</span></span>
<span id="cb62-719"><a href="#cb62-719" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-720"><a href="#cb62-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-721"><a href="#cb62-721" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(lm_pred, <span class="fu">aes</span>(<span class="at">x =</span> residual)) <span class="sc">+</span></span>
<span id="cb62-722"><a href="#cb62-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">fill =</span> <span class="st">"lightblue"</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb62-723"><a href="#cb62-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">after_stat</span>(count)), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb62-724"><a href="#cb62-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-725"><a href="#cb62-725" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Residuals"</span>,</span>
<span id="cb62-726"><a href="#cb62-726" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Should be approximately normal"</span>,</span>
<span id="cb62-727"><a href="#cb62-727" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Residual"</span>,</span>
<span id="cb62-728"><a href="#cb62-728" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Count"</span></span>
<span id="cb62-729"><a href="#cb62-729" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-730"><a href="#cb62-730" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-731"><a href="#cb62-731" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4)</span>
<span id="cb62-732"><a href="#cb62-732" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-733"><a href="#cb62-733" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-734"><a href="#cb62-734" aria-hidden="true" tabindex="-1"></a>Each plot reveals different aspects:</span>
<span id="cb62-735"><a href="#cb62-735" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Pattern in residuals vs fitted**: Indicates non-linearity</span>
<span id="cb62-736"><a href="#cb62-736" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Deviation from Q-Q line**: Indicates non-normality</span>
<span id="cb62-737"><a href="#cb62-737" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Funnel shape in scale-location**: Indicates heteroscedasticity</span>
<span id="cb62-738"><a href="#cb62-738" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Skewed residual distribution**: May need transformation</span>
<span id="cb62-739"><a href="#cb62-739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-740"><a href="#cb62-740" aria-hidden="true" tabindex="-1"></a><span class="fu">### Cross-Validation for Model Selection</span></span>
<span id="cb62-741"><a href="#cb62-741" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-742"><a href="#cb62-742" aria-hidden="true" tabindex="-1"></a>Cross-validation provides unbiased estimates of model performance:</span>
<span id="cb62-743"><a href="#cb62-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-746"><a href="#cb62-746" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-747"><a href="#cb62-747" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare multiple models using cross-validation</span></span>
<span id="cb62-748"><a href="#cb62-748" aria-hidden="true" tabindex="-1"></a>models_list <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb62-749"><a href="#cb62-749" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Linear"</span> <span class="ot">=</span> lm_spec,</span>
<span id="cb62-750"><a href="#cb62-750" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Ridge"</span> <span class="ot">=</span> ridge_spec,</span>
<span id="cb62-751"><a href="#cb62-751" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Lasso"</span> <span class="ot">=</span> lasso_spec,</span>
<span id="cb62-752"><a href="#cb62-752" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Random Forest"</span> <span class="ot">=</span> rf_spec,</span>
<span id="cb62-753"><a href="#cb62-753" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Decision Tree"</span> <span class="ot">=</span> tree_spec</span>
<span id="cb62-754"><a href="#cb62-754" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-755"><a href="#cb62-755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-756"><a href="#cb62-756" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate all models</span></span>
<span id="cb62-757"><a href="#cb62-757" aria-hidden="true" tabindex="-1"></a>cv_results <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="fu">names</span>(models_list), <span class="cf">function</span>(model_name) {</span>
<span id="cb62-758"><a href="#cb62-758" aria-hidden="true" tabindex="-1"></a>  wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-759"><a href="#cb62-759" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(reg_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb62-760"><a href="#cb62-760" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(models_list[[model_name]])</span>
<span id="cb62-761"><a href="#cb62-761" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb62-762"><a href="#cb62-762" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit_resamples</span>(</span>
<span id="cb62-763"><a href="#cb62-763" aria-hidden="true" tabindex="-1"></a>    wf,</span>
<span id="cb62-764"><a href="#cb62-764" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> ames_folds,</span>
<span id="cb62-765"><a href="#cb62-765" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(yardstick<span class="sc">::</span>rmse, yardstick<span class="sc">::</span>rsq, yardstick<span class="sc">::</span>mae)</span>
<span id="cb62-766"><a href="#cb62-766" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb62-767"><a href="#cb62-767" aria-hidden="true" tabindex="-1"></a>    <span class="fu">collect_metrics</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-768"><a href="#cb62-768" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> model_name)</span>
<span id="cb62-769"><a href="#cb62-769" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb62-770"><a href="#cb62-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-771"><a href="#cb62-771" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize comparison</span></span>
<span id="cb62-772"><a href="#cb62-772" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cv_results, <span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> mean, <span class="at">fill =</span> model)) <span class="sc">+</span></span>
<span id="cb62-773"><a href="#cb62-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb62-774"><a href="#cb62-774" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> mean <span class="sc">-</span> std_err, <span class="at">ymax =</span> mean <span class="sc">+</span> std_err), </span>
<span id="cb62-775"><a href="#cb62-775" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb62-776"><a href="#cb62-776" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>.metric, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb62-777"><a href="#cb62-777" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb62-778"><a href="#cb62-778" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-779"><a href="#cb62-779" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Model Comparison via 5-Fold Cross-Validation"</span>,</span>
<span id="cb62-780"><a href="#cb62-780" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Error bars show standard error across folds"</span>,</span>
<span id="cb62-781"><a href="#cb62-781" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Metric Value"</span></span>
<span id="cb62-782"><a href="#cb62-782" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-783"><a href="#cb62-783" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb62-784"><a href="#cb62-784" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb62-785"><a href="#cb62-785" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-786"><a href="#cb62-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-787"><a href="#cb62-787" aria-hidden="true" tabindex="-1"></a><span class="fu">## Advanced Topics</span></span>
<span id="cb62-788"><a href="#cb62-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-789"><a href="#cb62-789" aria-hidden="true" tabindex="-1"></a><span class="fu">### Dealing with Multicollinearity</span></span>
<span id="cb62-790"><a href="#cb62-790" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-791"><a href="#cb62-791" aria-hidden="true" tabindex="-1"></a>Multicollinearity occurs when predictors are highly correlated, making coefficient interpretation difficult:</span>
<span id="cb62-792"><a href="#cb62-792" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-795"><a href="#cb62-795" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-796"><a href="#cb62-796" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 10</span></span>
<span id="cb62-797"><a href="#cb62-797" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 8</span></span>
<span id="cb62-798"><a href="#cb62-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-799"><a href="#cb62-799" aria-hidden="true" tabindex="-1"></a><span class="co"># Check correlation among numeric predictors</span></span>
<span id="cb62-800"><a href="#cb62-800" aria-hidden="true" tabindex="-1"></a>numeric_features <span class="ot">&lt;-</span> ames_train <span class="sc">%&gt;%</span></span>
<span id="cb62-801"><a href="#cb62-801" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb62-802"><a href="#cb62-802" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Sale_Price) <span class="sc">%&gt;%</span></span>
<span id="cb62-803"><a href="#cb62-803" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb62-804"><a href="#cb62-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-805"><a href="#cb62-805" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(numeric_features)</span>
<span id="cb62-806"><a href="#cb62-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-807"><a href="#cb62-807" aria-hidden="true" tabindex="-1"></a><span class="co"># Find highly correlated pairs</span></span>
<span id="cb62-808"><a href="#cb62-808" aria-hidden="true" tabindex="-1"></a>high_cor <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">abs</span>(cor_matrix) <span class="sc">&gt;</span> <span class="fl">0.8</span> <span class="sc">&amp;</span> cor_matrix <span class="sc">!=</span> <span class="dv">1</span>, <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-809"><a href="#cb62-809" aria-hidden="true" tabindex="-1"></a>high_cor_pairs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb62-810"><a href="#cb62-810" aria-hidden="true" tabindex="-1"></a>  <span class="at">var1 =</span> <span class="fu">rownames</span>(cor_matrix)[high_cor[,<span class="dv">1</span>]],</span>
<span id="cb62-811"><a href="#cb62-811" aria-hidden="true" tabindex="-1"></a>  <span class="at">var2 =</span> <span class="fu">colnames</span>(cor_matrix)[high_cor[,<span class="dv">2</span>]],</span>
<span id="cb62-812"><a href="#cb62-812" aria-hidden="true" tabindex="-1"></a>  <span class="at">correlation =</span> cor_matrix[high_cor]</span>
<span id="cb62-813"><a href="#cb62-813" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb62-814"><a href="#cb62-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(var1 <span class="sc">&lt;</span> var2) <span class="sc">%&gt;%</span>  <span class="co"># Remove duplicates</span></span>
<span id="cb62-815"><a href="#cb62-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(correlation)))</span>
<span id="cb62-816"><a href="#cb62-816" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-817"><a href="#cb62-817" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Highly correlated variable pairs:"</span>)</span>
<span id="cb62-818"><a href="#cb62-818" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(high_cor_pairs, <span class="dv">10</span>) <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb62-819"><a href="#cb62-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-820"><a href="#cb62-820" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize correlation matrix</span></span>
<span id="cb62-821"><a href="#cb62-821" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(cor_matrix, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">type =</span> <span class="st">"upper"</span>, </span>
<span id="cb62-822"><a href="#cb62-822" aria-hidden="true" tabindex="-1"></a>         <span class="at">order =</span> <span class="st">"hclust"</span>, <span class="at">tl.cex =</span> <span class="fl">0.6</span>, <span class="at">tl.col =</span> <span class="st">"black"</span>,</span>
<span id="cb62-823"><a href="#cb62-823" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag =</span> <span class="cn">FALSE</span>, <span class="at">addCoef.col =</span> <span class="st">"black"</span>, <span class="at">number.cex =</span> <span class="fl">0.4</span>)</span>
<span id="cb62-824"><a href="#cb62-824" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-825"><a href="#cb62-825" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-826"><a href="#cb62-826" aria-hidden="true" tabindex="-1"></a>High correlations between predictors can cause:</span>
<span id="cb62-827"><a href="#cb62-827" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Unstable coefficient estimates</span>
<span id="cb62-828"><a href="#cb62-828" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Large standard errors</span>
<span id="cb62-829"><a href="#cb62-829" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Difficulty interpreting individual effects</span>
<span id="cb62-830"><a href="#cb62-830" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-831"><a href="#cb62-831" aria-hidden="true" tabindex="-1"></a>Solutions include:</span>
<span id="cb62-832"><a href="#cb62-832" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Remove one of the correlated variables</span>
<span id="cb62-833"><a href="#cb62-833" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use PCA to create uncorrelated components</span>
<span id="cb62-834"><a href="#cb62-834" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Apply regularization (Ridge regression handles multicollinearity well)</span>
<span id="cb62-835"><a href="#cb62-835" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-836"><a href="#cb62-836" aria-hidden="true" tabindex="-1"></a><span class="fu">### Handling Non-constant Variance (Heteroscedasticity)</span></span>
<span id="cb62-837"><a href="#cb62-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-838"><a href="#cb62-838" aria-hidden="true" tabindex="-1"></a>When variance changes with the fitted values, we can apply transformations:</span>
<span id="cb62-839"><a href="#cb62-839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-842"><a href="#cb62-842" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-843"><a href="#cb62-843" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 12</span></span>
<span id="cb62-844"><a href="#cb62-844" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 6</span></span>
<span id="cb62-845"><a href="#cb62-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-846"><a href="#cb62-846" aria-hidden="true" tabindex="-1"></a><span class="co"># Example with original scale prices (not log-transformed)</span></span>
<span id="cb62-847"><a href="#cb62-847" aria-hidden="true" tabindex="-1"></a>ames_original <span class="ot">&lt;-</span> ames <span class="sc">%&gt;%</span></span>
<span id="cb62-848"><a href="#cb62-848" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sale_Price, Gr_Liv_Area, Year_Built, Overall_Cond) <span class="sc">%&gt;%</span></span>
<span id="cb62-849"><a href="#cb62-849" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb62-850"><a href="#cb62-850" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-851"><a href="#cb62-851" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model on original scale</span></span>
<span id="cb62-852"><a href="#cb62-852" aria-hidden="true" tabindex="-1"></a>original_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> ames_original)</span>
<span id="cb62-853"><a href="#cb62-853" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-854"><a href="#cb62-854" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model on log scale</span></span>
<span id="cb62-855"><a href="#cb62-855" aria-hidden="true" tabindex="-1"></a>log_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(Sale_Price) <span class="sc">~</span> ., <span class="at">data =</span> ames_original)</span>
<span id="cb62-856"><a href="#cb62-856" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-857"><a href="#cb62-857" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare residual plots</span></span>
<span id="cb62-858"><a href="#cb62-858" aria-hidden="true" tabindex="-1"></a>orig_pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb62-859"><a href="#cb62-859" aria-hidden="true" tabindex="-1"></a>  <span class="at">fitted =</span> <span class="fu">fitted</span>(original_fit),</span>
<span id="cb62-860"><a href="#cb62-860" aria-hidden="true" tabindex="-1"></a>  <span class="at">residual =</span> <span class="fu">residuals</span>(original_fit),</span>
<span id="cb62-861"><a href="#cb62-861" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"Original Scale"</span></span>
<span id="cb62-862"><a href="#cb62-862" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-863"><a href="#cb62-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-864"><a href="#cb62-864" aria-hidden="true" tabindex="-1"></a>log_pred <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb62-865"><a href="#cb62-865" aria-hidden="true" tabindex="-1"></a>  <span class="at">fitted =</span> <span class="fu">fitted</span>(log_fit),</span>
<span id="cb62-866"><a href="#cb62-866" aria-hidden="true" tabindex="-1"></a>  <span class="at">residual =</span> <span class="fu">residuals</span>(log_fit),</span>
<span id="cb62-867"><a href="#cb62-867" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="st">"Log Scale"</span></span>
<span id="cb62-868"><a href="#cb62-868" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-869"><a href="#cb62-869" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-870"><a href="#cb62-870" aria-hidden="true" tabindex="-1"></a>combined_pred <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(orig_pred, log_pred)</span>
<span id="cb62-871"><a href="#cb62-871" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-872"><a href="#cb62-872" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(combined_pred, <span class="fu">aes</span>(<span class="at">x =</span> fitted, <span class="at">y =</span> residual)) <span class="sc">+</span></span>
<span id="cb62-873"><a href="#cb62-873" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb62-874"><a href="#cb62-874" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb62-875"><a href="#cb62-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb62-876"><a href="#cb62-876" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>model, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb62-877"><a href="#cb62-877" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-878"><a href="#cb62-878" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Effect of Log Transformation on Heteroscedasticity"</span>,</span>
<span id="cb62-879"><a href="#cb62-879" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Log transformation often stabilizes variance"</span>,</span>
<span id="cb62-880"><a href="#cb62-880" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Fitted Values"</span>,</span>
<span id="cb62-881"><a href="#cb62-881" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Residuals"</span></span>
<span id="cb62-882"><a href="#cb62-882" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-883"><a href="#cb62-883" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-884"><a href="#cb62-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-885"><a href="#cb62-885" aria-hidden="true" tabindex="-1"></a>The log transformation has stabilized the variance - notice how the spread of residuals is more constant in the log scale model.</span>
<span id="cb62-886"><a href="#cb62-886" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-887"><a href="#cb62-887" aria-hidden="true" tabindex="-1"></a><span class="fu">## Practical Example: Complete Regression Pipeline</span></span>
<span id="cb62-888"><a href="#cb62-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-889"><a href="#cb62-889" aria-hidden="true" tabindex="-1"></a>Let's put everything together in a comprehensive example:</span>
<span id="cb62-890"><a href="#cb62-890" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-893"><a href="#cb62-893" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-894"><a href="#cb62-894" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a complete modeling pipeline</span></span>
<span id="cb62-895"><a href="#cb62-895" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Data preparation</span></span>
<span id="cb62-896"><a href="#cb62-896" aria-hidden="true" tabindex="-1"></a>concrete_clean <span class="ot">&lt;-</span> concrete <span class="sc">%&gt;%</span></span>
<span id="cb62-897"><a href="#cb62-897" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb62-898"><a href="#cb62-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-899"><a href="#cb62-899" aria-hidden="true" tabindex="-1"></a>concrete_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(concrete_clean, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb62-900"><a href="#cb62-900" aria-hidden="true" tabindex="-1"></a>concrete_train <span class="ot">&lt;-</span> <span class="fu">training</span>(concrete_split)</span>
<span id="cb62-901"><a href="#cb62-901" aria-hidden="true" tabindex="-1"></a>concrete_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(concrete_split)</span>
<span id="cb62-902"><a href="#cb62-902" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-903"><a href="#cb62-903" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Exploratory data analysis</span></span>
<span id="cb62-904"><a href="#cb62-904" aria-hidden="true" tabindex="-1"></a>concrete_summary <span class="ot">&lt;-</span> concrete_train <span class="sc">%&gt;%</span></span>
<span id="cb62-905"><a href="#cb62-905" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"variable"</span>, <span class="at">values_to =</span> <span class="st">"value"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-906"><a href="#cb62-906" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(variable) <span class="sc">%&gt;%</span></span>
<span id="cb62-907"><a href="#cb62-907" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb62-908"><a href="#cb62-908" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb62-909"><a href="#cb62-909" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> <span class="fu">sd</span>(value),</span>
<span id="cb62-910"><a href="#cb62-910" aria-hidden="true" tabindex="-1"></a>    <span class="at">min =</span> <span class="fu">min</span>(value),</span>
<span id="cb62-911"><a href="#cb62-911" aria-hidden="true" tabindex="-1"></a>    <span class="at">max =</span> <span class="fu">max</span>(value)</span>
<span id="cb62-912"><a href="#cb62-912" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-913"><a href="#cb62-913" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-914"><a href="#cb62-914" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Dataset summary:"</span>)</span>
<span id="cb62-915"><a href="#cb62-915" aria-hidden="true" tabindex="-1"></a>concrete_summary <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb62-916"><a href="#cb62-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-917"><a href="#cb62-917" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create recipe with feature engineering</span></span>
<span id="cb62-918"><a href="#cb62-918" aria-hidden="true" tabindex="-1"></a>concrete_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(compressive_strength <span class="sc">~</span> ., <span class="at">data =</span> concrete_train) <span class="sc">%&gt;%</span></span>
<span id="cb62-919"><a href="#cb62-919" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-920"><a href="#cb62-920" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_poly</span>(age, <span class="at">degree =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-921"><a href="#cb62-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_interact</span>(<span class="at">terms =</span> <span class="sc">~</span> cement<span class="sc">:</span>water)</span>
<span id="cb62-922"><a href="#cb62-922" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-923"><a href="#cb62-923" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Specify multiple models</span></span>
<span id="cb62-924"><a href="#cb62-924" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb62-925"><a href="#cb62-925" aria-hidden="true" tabindex="-1"></a>  <span class="at">linear =</span> <span class="fu">linear_reg</span>() <span class="sc">%&gt;%</span> <span class="fu">set_engine</span>(<span class="st">"lm"</span>),</span>
<span id="cb62-926"><a href="#cb62-926" aria-hidden="true" tabindex="-1"></a>  <span class="at">ridge =</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fu">tune</span>(), <span class="at">mixture =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>),</span>
<span id="cb62-927"><a href="#cb62-927" aria-hidden="true" tabindex="-1"></a>  <span class="at">rf =</span> <span class="fu">rand_forest</span>(<span class="at">mtry =</span> <span class="fu">tune</span>(), <span class="at">trees =</span> <span class="dv">500</span>, <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb62-928"><a href="#cb62-928" aria-hidden="true" tabindex="-1"></a>    <span class="fu">set_engine</span>(<span class="st">"ranger"</span>) <span class="sc">%&gt;%</span> <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb62-929"><a href="#cb62-929" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-930"><a href="#cb62-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-931"><a href="#cb62-931" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Create workflows</span></span>
<span id="cb62-932"><a href="#cb62-932" aria-hidden="true" tabindex="-1"></a>workflows <span class="ot">&lt;-</span> <span class="fu">map</span>(models, <span class="cf">function</span>(model) {</span>
<span id="cb62-933"><a href="#cb62-933" aria-hidden="true" tabindex="-1"></a>  <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-934"><a href="#cb62-934" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_recipe</span>(concrete_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb62-935"><a href="#cb62-935" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_model</span>(model)</span>
<span id="cb62-936"><a href="#cb62-936" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb62-937"><a href="#cb62-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-938"><a href="#cb62-938" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Tune hyperparameters for models that need it</span></span>
<span id="cb62-939"><a href="#cb62-939" aria-hidden="true" tabindex="-1"></a>concrete_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(concrete_train, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb62-940"><a href="#cb62-940" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-941"><a href="#cb62-941" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune Ridge</span></span>
<span id="cb62-942"><a href="#cb62-942" aria-hidden="true" tabindex="-1"></a>ridge_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(<span class="fu">penalty</span>(), <span class="at">levels =</span> <span class="dv">10</span>)</span>
<span id="cb62-943"><a href="#cb62-943" aria-hidden="true" tabindex="-1"></a>ridge_tune <span class="ot">&lt;-</span> workflows<span class="sc">$</span>ridge <span class="sc">%&gt;%</span></span>
<span id="cb62-944"><a href="#cb62-944" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb62-945"><a href="#cb62-945" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> concrete_folds,</span>
<span id="cb62-946"><a href="#cb62-946" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> ridge_grid,</span>
<span id="cb62-947"><a href="#cb62-947" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(yardstick<span class="sc">::</span>rmse, yardstick<span class="sc">::</span>rsq)</span>
<span id="cb62-948"><a href="#cb62-948" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-949"><a href="#cb62-949" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-950"><a href="#cb62-950" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune Random Forest</span></span>
<span id="cb62-951"><a href="#cb62-951" aria-hidden="true" tabindex="-1"></a>rf_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(</span>
<span id="cb62-952"><a href="#cb62-952" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mtry</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">7</span>)),</span>
<span id="cb62-953"><a href="#cb62-953" aria-hidden="true" tabindex="-1"></a>  <span class="fu">min_n</span>(),</span>
<span id="cb62-954"><a href="#cb62-954" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="dv">5</span></span>
<span id="cb62-955"><a href="#cb62-955" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-956"><a href="#cb62-956" aria-hidden="true" tabindex="-1"></a>rf_tune <span class="ot">&lt;-</span> workflows<span class="sc">$</span>rf <span class="sc">%&gt;%</span></span>
<span id="cb62-957"><a href="#cb62-957" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb62-958"><a href="#cb62-958" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> concrete_folds,</span>
<span id="cb62-959"><a href="#cb62-959" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> rf_grid,</span>
<span id="cb62-960"><a href="#cb62-960" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(yardstick<span class="sc">::</span>rmse, yardstick<span class="sc">::</span>rsq)</span>
<span id="cb62-961"><a href="#cb62-961" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-962"><a href="#cb62-962" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-963"><a href="#cb62-963" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Select best models</span></span>
<span id="cb62-964"><a href="#cb62-964" aria-hidden="true" tabindex="-1"></a>best_ridge <span class="ot">&lt;-</span> <span class="fu">select_best</span>(ridge_tune, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span>
<span id="cb62-965"><a href="#cb62-965" aria-hidden="true" tabindex="-1"></a>best_rf <span class="ot">&lt;-</span> <span class="fu">select_best</span>(rf_tune, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span>
<span id="cb62-966"><a href="#cb62-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-967"><a href="#cb62-967" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. Finalize workflows</span></span>
<span id="cb62-968"><a href="#cb62-968" aria-hidden="true" tabindex="-1"></a>final_linear <span class="ot">&lt;-</span> workflows<span class="sc">$</span>linear</span>
<span id="cb62-969"><a href="#cb62-969" aria-hidden="true" tabindex="-1"></a>final_ridge <span class="ot">&lt;-</span> workflows<span class="sc">$</span>ridge <span class="sc">%&gt;%</span> <span class="fu">finalize_workflow</span>(best_ridge)</span>
<span id="cb62-970"><a href="#cb62-970" aria-hidden="true" tabindex="-1"></a>final_rf <span class="ot">&lt;-</span> workflows<span class="sc">$</span>rf <span class="sc">%&gt;%</span> <span class="fu">finalize_workflow</span>(best_rf)</span>
<span id="cb62-971"><a href="#cb62-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-972"><a href="#cb62-972" aria-hidden="true" tabindex="-1"></a><span class="co"># 9. Fit final models and evaluate</span></span>
<span id="cb62-973"><a href="#cb62-973" aria-hidden="true" tabindex="-1"></a>final_fits <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb62-974"><a href="#cb62-974" aria-hidden="true" tabindex="-1"></a>  <span class="at">linear =</span> final_linear <span class="sc">%&gt;%</span> <span class="fu">fit</span>(concrete_train),</span>
<span id="cb62-975"><a href="#cb62-975" aria-hidden="true" tabindex="-1"></a>  <span class="at">ridge =</span> final_ridge <span class="sc">%&gt;%</span> <span class="fu">fit</span>(concrete_train),</span>
<span id="cb62-976"><a href="#cb62-976" aria-hidden="true" tabindex="-1"></a>  <span class="at">rf =</span> final_rf <span class="sc">%&gt;%</span> <span class="fu">fit</span>(concrete_train)</span>
<span id="cb62-977"><a href="#cb62-977" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-978"><a href="#cb62-978" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-979"><a href="#cb62-979" aria-hidden="true" tabindex="-1"></a><span class="co"># 10. Make predictions and evaluate</span></span>
<span id="cb62-980"><a href="#cb62-980" aria-hidden="true" tabindex="-1"></a>test_results <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="fu">names</span>(final_fits), <span class="cf">function</span>(model_name) {</span>
<span id="cb62-981"><a href="#cb62-981" aria-hidden="true" tabindex="-1"></a>  final_fits[[model_name]] <span class="sc">%&gt;%</span></span>
<span id="cb62-982"><a href="#cb62-982" aria-hidden="true" tabindex="-1"></a>    <span class="fu">predict</span>(concrete_test) <span class="sc">%&gt;%</span></span>
<span id="cb62-983"><a href="#cb62-983" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(concrete_test) <span class="sc">%&gt;%</span></span>
<span id="cb62-984"><a href="#cb62-984" aria-hidden="true" tabindex="-1"></a>    <span class="fu">metrics</span>(<span class="at">truth =</span> compressive_strength, <span class="at">estimate =</span> .pred) <span class="sc">%&gt;%</span></span>
<span id="cb62-985"><a href="#cb62-985" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">model =</span> model_name)</span>
<span id="cb62-986"><a href="#cb62-986" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb62-987"><a href="#cb62-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-988"><a href="#cb62-988" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize final comparison</span></span>
<span id="cb62-989"><a href="#cb62-989" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(test_results, <span class="fu">aes</span>(<span class="at">x =</span> model, <span class="at">y =</span> .estimate, <span class="at">fill =</span> model)) <span class="sc">+</span></span>
<span id="cb62-990"><a href="#cb62-990" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb62-991"><a href="#cb62-991" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>.metric, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb62-992"><a href="#cb62-992" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb62-993"><a href="#cb62-993" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-994"><a href="#cb62-994" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Final Model Comparison on Test Set"</span>,</span>
<span id="cb62-995"><a href="#cb62-995" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Concrete compressive strength prediction"</span>,</span>
<span id="cb62-996"><a href="#cb62-996" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Metric Value"</span></span>
<span id="cb62-997"><a href="#cb62-997" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-998"><a href="#cb62-998" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb62-999"><a href="#cb62-999" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1000"><a href="#cb62-1000" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1001"><a href="#cb62-1001" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb62-1002"><a href="#cb62-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1003"><a href="#cb62-1003" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 1: Implement Regularization with Tuning</span></span>
<span id="cb62-1004"><a href="#cb62-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1005"><a href="#cb62-1005" aria-hidden="true" tabindex="-1"></a>Build a regularized regression model with proper hyperparameter tuning:</span>
<span id="cb62-1006"><a href="#cb62-1006" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1009"><a href="#cb62-1009" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1010"><a href="#cb62-1010" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb62-1011"><a href="#cb62-1011" aria-hidden="true" tabindex="-1"></a><span class="co"># Use the Ames dataset to predict Sale_Price</span></span>
<span id="cb62-1012"><a href="#cb62-1012" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an elastic net model with tuned penalty and mixture</span></span>
<span id="cb62-1013"><a href="#cb62-1013" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1014"><a href="#cb62-1014" aria-hidden="true" tabindex="-1"></a><span class="co"># Simpler recipe for exercise</span></span>
<span id="cb62-1015"><a href="#cb62-1015" aria-hidden="true" tabindex="-1"></a>elastic_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> Gr_Liv_Area <span class="sc">+</span> Year_Built <span class="sc">+</span> Overall_Cond <span class="sc">+</span> </span>
<span id="cb62-1016"><a href="#cb62-1016" aria-hidden="true" tabindex="-1"></a>                        Neighborhood <span class="sc">+</span> Total_Bsmt_SF, <span class="at">data =</span> ames_train) <span class="sc">%&gt;%</span></span>
<span id="cb62-1017"><a href="#cb62-1017" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_impute_median</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-1018"><a href="#cb62-1018" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-1019"><a href="#cb62-1019" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>())</span>
<span id="cb62-1020"><a href="#cb62-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1021"><a href="#cb62-1021" aria-hidden="true" tabindex="-1"></a><span class="co"># Elastic net specification with tuning</span></span>
<span id="cb62-1022"><a href="#cb62-1022" aria-hidden="true" tabindex="-1"></a>elastic_tune_spec <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(</span>
<span id="cb62-1023"><a href="#cb62-1023" aria-hidden="true" tabindex="-1"></a>  <span class="at">penalty =</span> <span class="fu">tune</span>(),</span>
<span id="cb62-1024"><a href="#cb62-1024" aria-hidden="true" tabindex="-1"></a>  <span class="at">mixture =</span> <span class="fu">tune</span>()</span>
<span id="cb62-1025"><a href="#cb62-1025" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb62-1026"><a href="#cb62-1026" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-1027"><a href="#cb62-1027" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>)</span>
<span id="cb62-1028"><a href="#cb62-1028" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1029"><a href="#cb62-1029" aria-hidden="true" tabindex="-1"></a><span class="co"># Workflow</span></span>
<span id="cb62-1030"><a href="#cb62-1030" aria-hidden="true" tabindex="-1"></a>elastic_tune_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-1031"><a href="#cb62-1031" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(elastic_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb62-1032"><a href="#cb62-1032" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(elastic_tune_spec)</span>
<span id="cb62-1033"><a href="#cb62-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1034"><a href="#cb62-1034" aria-hidden="true" tabindex="-1"></a><span class="co"># Tuning grid</span></span>
<span id="cb62-1035"><a href="#cb62-1035" aria-hidden="true" tabindex="-1"></a>elastic_grid <span class="ot">&lt;-</span> <span class="fu">grid_regular</span>(</span>
<span id="cb62-1036"><a href="#cb62-1036" aria-hidden="true" tabindex="-1"></a>  <span class="fu">penalty</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">0</span>)),</span>
<span id="cb62-1037"><a href="#cb62-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mixture</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb62-1038"><a href="#cb62-1038" aria-hidden="true" tabindex="-1"></a>  <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb62-1039"><a href="#cb62-1039" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-1040"><a href="#cb62-1040" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1041"><a href="#cb62-1041" aria-hidden="true" tabindex="-1"></a><span class="co"># Create resamples</span></span>
<span id="cb62-1042"><a href="#cb62-1042" aria-hidden="true" tabindex="-1"></a>ames_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(ames_train, <span class="at">v =</span> <span class="dv">5</span>)</span>
<span id="cb62-1043"><a href="#cb62-1043" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1044"><a href="#cb62-1044" aria-hidden="true" tabindex="-1"></a><span class="co"># Tune the model</span></span>
<span id="cb62-1045"><a href="#cb62-1045" aria-hidden="true" tabindex="-1"></a>elastic_tuned <span class="ot">&lt;-</span> elastic_tune_wf <span class="sc">%&gt;%</span></span>
<span id="cb62-1046"><a href="#cb62-1046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb62-1047"><a href="#cb62-1047" aria-hidden="true" tabindex="-1"></a>    <span class="at">resamples =</span> ames_folds,</span>
<span id="cb62-1048"><a href="#cb62-1048" aria-hidden="true" tabindex="-1"></a>    <span class="at">grid =</span> elastic_grid,</span>
<span id="cb62-1049"><a href="#cb62-1049" aria-hidden="true" tabindex="-1"></a>    <span class="at">metrics =</span> yardstick<span class="sc">::</span><span class="fu">metric_set</span>(yardstick<span class="sc">::</span>rmse, yardstick<span class="sc">::</span>rsq, yardstick<span class="sc">::</span>mae)</span>
<span id="cb62-1050"><a href="#cb62-1050" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1051"><a href="#cb62-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1052"><a href="#cb62-1052" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize tuning results</span></span>
<span id="cb62-1053"><a href="#cb62-1053" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(elastic_tuned) <span class="sc">+</span></span>
<span id="cb62-1054"><a href="#cb62-1054" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Elastic Net Tuning Results"</span>,</span>
<span id="cb62-1055"><a href="#cb62-1055" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Performance across different penalty and mixture values"</span>)</span>
<span id="cb62-1056"><a href="#cb62-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1057"><a href="#cb62-1057" aria-hidden="true" tabindex="-1"></a><span class="co"># Select and fit best model</span></span>
<span id="cb62-1058"><a href="#cb62-1058" aria-hidden="true" tabindex="-1"></a>best_elastic <span class="ot">&lt;-</span> <span class="fu">select_best</span>(elastic_tuned, <span class="at">metric =</span> <span class="st">"rmse"</span>)</span>
<span id="cb62-1059"><a href="#cb62-1059" aria-hidden="true" tabindex="-1"></a>final_elastic <span class="ot">&lt;-</span> elastic_tune_wf <span class="sc">%&gt;%</span></span>
<span id="cb62-1060"><a href="#cb62-1060" aria-hidden="true" tabindex="-1"></a>  <span class="fu">finalize_workflow</span>(best_elastic) <span class="sc">%&gt;%</span></span>
<span id="cb62-1061"><a href="#cb62-1061" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(ames_train)</span>
<span id="cb62-1062"><a href="#cb62-1062" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1063"><a href="#cb62-1063" aria-hidden="true" tabindex="-1"></a><span class="co"># Evaluate on test set</span></span>
<span id="cb62-1064"><a href="#cb62-1064" aria-hidden="true" tabindex="-1"></a>elastic_test_pred <span class="ot">&lt;-</span> final_elastic <span class="sc">%&gt;%</span></span>
<span id="cb62-1065"><a href="#cb62-1065" aria-hidden="true" tabindex="-1"></a>  <span class="fu">predict</span>(ames_test) <span class="sc">%&gt;%</span></span>
<span id="cb62-1066"><a href="#cb62-1066" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(ames_test)</span>
<span id="cb62-1067"><a href="#cb62-1067" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1068"><a href="#cb62-1068" aria-hidden="true" tabindex="-1"></a>elastic_metrics <span class="ot">&lt;-</span> elastic_test_pred <span class="sc">%&gt;%</span></span>
<span id="cb62-1069"><a href="#cb62-1069" aria-hidden="true" tabindex="-1"></a>  <span class="fu">metrics</span>(<span class="at">truth =</span> Sale_Price, <span class="at">estimate =</span> .pred)</span>
<span id="cb62-1070"><a href="#cb62-1070" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1071"><a href="#cb62-1071" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Best hyperparameters:"</span>)</span>
<span id="cb62-1072"><a href="#cb62-1072" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(best_elastic)</span>
<span id="cb62-1073"><a href="#cb62-1073" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Test set performance:"</span>)</span>
<span id="cb62-1074"><a href="#cb62-1074" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(elastic_metrics)</span>
<span id="cb62-1075"><a href="#cb62-1075" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1076"><a href="#cb62-1076" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1077"><a href="#cb62-1077" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 2: Diagnose and Fix Model Problems</span></span>
<span id="cb62-1078"><a href="#cb62-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1079"><a href="#cb62-1079" aria-hidden="true" tabindex="-1"></a>Identify and address issues in a regression model:</span>
<span id="cb62-1080"><a href="#cb62-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1083"><a href="#cb62-1083" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1084"><a href="#cb62-1084" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb62-1085"><a href="#cb62-1085" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a problematic model and fix it</span></span>
<span id="cb62-1086"><a href="#cb62-1086" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1087"><a href="#cb62-1087" aria-hidden="true" tabindex="-1"></a><span class="co"># Intentionally problematic model (using highly correlated predictors)</span></span>
<span id="cb62-1088"><a href="#cb62-1088" aria-hidden="true" tabindex="-1"></a>problem_data <span class="ot">&lt;-</span> ames_train <span class="sc">%&gt;%</span></span>
<span id="cb62-1089"><a href="#cb62-1089" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Sale_Price, Gr_Liv_Area, Total_Bsmt_SF, First_Flr_SF, </span>
<span id="cb62-1090"><a href="#cb62-1090" aria-hidden="true" tabindex="-1"></a>         Second_Flr_SF, Garage_Area, Garage_Cars) <span class="sc">%&gt;%</span></span>
<span id="cb62-1091"><a href="#cb62-1091" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb62-1092"><a href="#cb62-1092" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1093"><a href="#cb62-1093" aria-hidden="true" tabindex="-1"></a><span class="co"># Check correlations</span></span>
<span id="cb62-1094"><a href="#cb62-1094" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(problem_data[,<span class="sc">-</span><span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb62-1095"><a href="#cb62-1095" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corrplot</span>(<span class="at">method =</span> <span class="st">"number"</span>, <span class="at">type =</span> <span class="st">"upper"</span>)</span>
<span id="cb62-1096"><a href="#cb62-1096" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1097"><a href="#cb62-1097" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit problematic model</span></span>
<span id="cb62-1098"><a href="#cb62-1098" aria-hidden="true" tabindex="-1"></a>problem_fit <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> problem_data)</span>
<span id="cb62-1099"><a href="#cb62-1099" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(problem_fit)</span>
<span id="cb62-1100"><a href="#cb62-1100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1101"><a href="#cb62-1101" aria-hidden="true" tabindex="-1"></a><span class="co"># Note the high VIF (Variance Inflation Factor)</span></span>
<span id="cb62-1102"><a href="#cb62-1102" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">require</span>(car, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb62-1103"><a href="#cb62-1103" aria-hidden="true" tabindex="-1"></a>  vif_values <span class="ot">&lt;-</span> car<span class="sc">::</span><span class="fu">vif</span>(problem_fit)</span>
<span id="cb62-1104"><a href="#cb62-1104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Variance Inflation Factors:"</span>)</span>
<span id="cb62-1105"><a href="#cb62-1105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(vif_values)</span>
<span id="cb62-1106"><a href="#cb62-1106" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb62-1107"><a href="#cb62-1107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1108"><a href="#cb62-1108" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix 1: Remove highly correlated variables</span></span>
<span id="cb62-1109"><a href="#cb62-1109" aria-hidden="true" tabindex="-1"></a>fixed_data1 <span class="ot">&lt;-</span> problem_data <span class="sc">%&gt;%</span></span>
<span id="cb62-1110"><a href="#cb62-1110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Garage_Cars, <span class="sc">-</span>Second_Flr_SF)  <span class="co"># Remove redundant variables</span></span>
<span id="cb62-1111"><a href="#cb62-1111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1112"><a href="#cb62-1112" aria-hidden="true" tabindex="-1"></a>fixed_fit1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> fixed_data1)</span>
<span id="cb62-1113"><a href="#cb62-1113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1114"><a href="#cb62-1114" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix 2: Use PCA</span></span>
<span id="cb62-1115"><a href="#cb62-1115" aria-hidden="true" tabindex="-1"></a>pca_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> problem_data) <span class="sc">%&gt;%</span></span>
<span id="cb62-1116"><a href="#cb62-1116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-1117"><a href="#cb62-1117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_pca</span>(<span class="fu">all_predictors</span>(), <span class="at">num_comp =</span> <span class="dv">4</span>)</span>
<span id="cb62-1118"><a href="#cb62-1118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1119"><a href="#cb62-1119" aria-hidden="true" tabindex="-1"></a>pca_fit <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-1120"><a href="#cb62-1120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_recipe</span>(pca_recipe) <span class="sc">%&gt;%</span></span>
<span id="cb62-1121"><a href="#cb62-1121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_model</span>(lm_spec) <span class="sc">%&gt;%</span></span>
<span id="cb62-1122"><a href="#cb62-1122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(problem_data)</span>
<span id="cb62-1123"><a href="#cb62-1123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1124"><a href="#cb62-1124" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix 3: Use Ridge regression</span></span>
<span id="cb62-1125"><a href="#cb62-1125" aria-hidden="true" tabindex="-1"></a>ridge_fix <span class="ot">&lt;-</span> <span class="fu">linear_reg</span>(<span class="at">penalty =</span> <span class="fl">0.1</span>, <span class="at">mixture =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-1126"><a href="#cb62-1126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"glmnet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-1127"><a href="#cb62-1127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(Sale_Price <span class="sc">~</span> ., <span class="at">data =</span> problem_data)</span>
<span id="cb62-1128"><a href="#cb62-1128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1129"><a href="#cb62-1129" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare solutions</span></span>
<span id="cb62-1130"><a href="#cb62-1130" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Original model R-squared:"</span>, <span class="fu">summary</span>(problem_fit)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-1131"><a href="#cb62-1131" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Fixed model R-squared:"</span>, <span class="fu">summary</span>(fixed_fit1)<span class="sc">$</span>r.squared, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb62-1132"><a href="#cb62-1132" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1133"><a href="#cb62-1133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1134"><a href="#cb62-1134" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 3: Non-linear Relationships</span></span>
<span id="cb62-1135"><a href="#cb62-1135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1136"><a href="#cb62-1136" aria-hidden="true" tabindex="-1"></a>Explore and model non-linear relationships:</span>
<span id="cb62-1137"><a href="#cb62-1137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1140"><a href="#cb62-1140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb62-1141"><a href="#cb62-1141" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb62-1142"><a href="#cb62-1142" aria-hidden="true" tabindex="-1"></a><span class="co"># Create synthetic data with non-linear relationship</span></span>
<span id="cb62-1143"><a href="#cb62-1143" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb62-1144"><a href="#cb62-1144" aria-hidden="true" tabindex="-1"></a>nonlinear_ex <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb62-1145"><a href="#cb62-1145" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">200</span>),</span>
<span id="cb62-1146"><a href="#cb62-1146" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="dv">5</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span><span class="fu">sin</span>(x) <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span> <span class="sc">-</span> <span class="fl">0.05</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">3</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb62-1147"><a href="#cb62-1147" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-1148"><a href="#cb62-1148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1149"><a href="#cb62-1149" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the relationship</span></span>
<span id="cb62-1150"><a href="#cb62-1150" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nonlinear_ex, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb62-1151"><a href="#cb62-1151" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb62-1152"><a href="#cb62-1152" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb62-1153"><a href="#cb62-1153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Non-linear Relationship to Model"</span>)</span>
<span id="cb62-1154"><a href="#cb62-1154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1155"><a href="#cb62-1155" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare different approaches</span></span>
<span id="cb62-1156"><a href="#cb62-1156" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Linear model (will underfit)</span></span>
<span id="cb62-1157"><a href="#cb62-1157" aria-hidden="true" tabindex="-1"></a>linear_ex <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> nonlinear_ex)</span>
<span id="cb62-1158"><a href="#cb62-1158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1159"><a href="#cb62-1159" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Polynomial regression</span></span>
<span id="cb62-1160"><a href="#cb62-1160" aria-hidden="true" tabindex="-1"></a>poly_ex <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x, <span class="dv">5</span>), <span class="at">data =</span> nonlinear_ex)</span>
<span id="cb62-1161"><a href="#cb62-1161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1162"><a href="#cb62-1162" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Spline regression</span></span>
<span id="cb62-1163"><a href="#cb62-1163" aria-hidden="true" tabindex="-1"></a>spline_ex <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> splines<span class="sc">::</span><span class="fu">ns</span>(x, <span class="at">df =</span> <span class="dv">5</span>), <span class="at">data =</span> nonlinear_ex)</span>
<span id="cb62-1164"><a href="#cb62-1164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1165"><a href="#cb62-1165" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Random Forest</span></span>
<span id="cb62-1166"><a href="#cb62-1166" aria-hidden="true" tabindex="-1"></a>rf_ex <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>(<span class="at">trees =</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-1167"><a href="#cb62-1167" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-1168"><a href="#cb62-1168" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-1169"><a href="#cb62-1169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(y <span class="sc">~</span> x, <span class="at">data =</span> nonlinear_ex)</span>
<span id="cb62-1170"><a href="#cb62-1170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1171"><a href="#cb62-1171" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate predictions</span></span>
<span id="cb62-1172"><a href="#cb62-1172" aria-hidden="true" tabindex="-1"></a>predictions_ex <span class="ot">&lt;-</span> nonlinear_ex <span class="sc">%&gt;%</span></span>
<span id="cb62-1173"><a href="#cb62-1173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb62-1174"><a href="#cb62-1174" aria-hidden="true" tabindex="-1"></a>    <span class="at">linear =</span> <span class="fu">predict</span>(linear_ex, nonlinear_ex),</span>
<span id="cb62-1175"><a href="#cb62-1175" aria-hidden="true" tabindex="-1"></a>    <span class="at">polynomial =</span> <span class="fu">predict</span>(poly_ex, nonlinear_ex),</span>
<span id="cb62-1176"><a href="#cb62-1176" aria-hidden="true" tabindex="-1"></a>    <span class="at">spline =</span> <span class="fu">predict</span>(spline_ex, nonlinear_ex),</span>
<span id="cb62-1177"><a href="#cb62-1177" aria-hidden="true" tabindex="-1"></a>    <span class="at">rf =</span> <span class="fu">predict</span>(rf_ex, nonlinear_ex)<span class="sc">$</span>.pred</span>
<span id="cb62-1178"><a href="#cb62-1178" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb62-1179"><a href="#cb62-1179" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(linear, polynomial, spline, rf), </span>
<span id="cb62-1180"><a href="#cb62-1180" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="st">"model"</span>, <span class="at">values_to =</span> <span class="st">"prediction"</span>)</span>
<span id="cb62-1181"><a href="#cb62-1181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1182"><a href="#cb62-1182" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize all models</span></span>
<span id="cb62-1183"><a href="#cb62-1183" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(predictions_ex, <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb62-1184"><a href="#cb62-1184" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> y), <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb62-1185"><a href="#cb62-1185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> prediction, <span class="at">color =</span> model), <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb62-1186"><a href="#cb62-1186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>model) <span class="sc">+</span></span>
<span id="cb62-1187"><a href="#cb62-1187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb62-1188"><a href="#cb62-1188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb62-1189"><a href="#cb62-1189" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comparison of Methods for Non-linear Relationships"</span>,</span>
<span id="cb62-1190"><a href="#cb62-1190" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Different approaches to capturing non-linearity"</span></span>
<span id="cb62-1191"><a href="#cb62-1191" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb62-1192"><a href="#cb62-1192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb62-1193"><a href="#cb62-1193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1194"><a href="#cb62-1194" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate performance</span></span>
<span id="cb62-1195"><a href="#cb62-1195" aria-hidden="true" tabindex="-1"></a>performance_ex <span class="ot">&lt;-</span> predictions_ex <span class="sc">%&gt;%</span></span>
<span id="cb62-1196"><a href="#cb62-1196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb62-1197"><a href="#cb62-1197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb62-1198"><a href="#cb62-1198" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmse =</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((y <span class="sc">-</span> prediction)<span class="sc">^</span><span class="dv">2</span>)),</span>
<span id="cb62-1199"><a href="#cb62-1199" aria-hidden="true" tabindex="-1"></a>    <span class="at">mae =</span> <span class="fu">mean</span>(<span class="fu">abs</span>(y <span class="sc">-</span> prediction)),</span>
<span id="cb62-1200"><a href="#cb62-1200" aria-hidden="true" tabindex="-1"></a>    <span class="at">r_squared =</span> <span class="fu">cor</span>(y, prediction)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb62-1201"><a href="#cb62-1201" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-1202"><a href="#cb62-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1203"><a href="#cb62-1203" aria-hidden="true" tabindex="-1"></a>performance_ex <span class="sc">%&gt;%</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb62-1204"><a href="#cb62-1204" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb62-1205"><a href="#cb62-1205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1206"><a href="#cb62-1206" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb62-1207"><a href="#cb62-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1208"><a href="#cb62-1208" aria-hidden="true" tabindex="-1"></a>In this comprehensive chapter, you've learned:</span>
<span id="cb62-1209"><a href="#cb62-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1210"><a href="#cb62-1210" aria-hidden="true" tabindex="-1"></a>✅ **Linear regression theory**: OLS, assumptions, diagnostics  </span>
<span id="cb62-1211"><a href="#cb62-1211" aria-hidden="true" tabindex="-1"></a>✅ **Polynomial and non-linear regression**: Capturing curved relationships  </span>
<span id="cb62-1212"><a href="#cb62-1212" aria-hidden="true" tabindex="-1"></a>✅ **Regularization techniques**: Ridge, Lasso, and Elastic Net  </span>
<span id="cb62-1213"><a href="#cb62-1213" aria-hidden="true" tabindex="-1"></a>✅ **Tree-based methods**: Decision trees and Random Forests  </span>
<span id="cb62-1214"><a href="#cb62-1214" aria-hidden="true" tabindex="-1"></a>✅ **Model validation**: Cross-validation, residual analysis  </span>
<span id="cb62-1215"><a href="#cb62-1215" aria-hidden="true" tabindex="-1"></a>✅ **Advanced topics**: Multicollinearity, heteroscedasticity  </span>
<span id="cb62-1216"><a href="#cb62-1216" aria-hidden="true" tabindex="-1"></a>✅ **Complete workflows**: From data preparation to final evaluation  </span>
<span id="cb62-1217"><a href="#cb62-1217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1218"><a href="#cb62-1218" aria-hidden="true" tabindex="-1"></a>Key takeaways:</span>
<span id="cb62-1219"><a href="#cb62-1219" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Always check model assumptions before interpreting results</span>
<span id="cb62-1220"><a href="#cb62-1220" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use regularization when you have many predictors or multicollinearity</span>
<span id="cb62-1221"><a href="#cb62-1221" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Tree-based methods are powerful for capturing non-linear patterns</span>
<span id="cb62-1222"><a href="#cb62-1222" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Cross-validation is essential for honest model evaluation</span>
<span id="cb62-1223"><a href="#cb62-1223" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Different problems require different approaches - no single best method</span>
<span id="cb62-1224"><a href="#cb62-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1225"><a href="#cb62-1225" aria-hidden="true" tabindex="-1"></a><span class="fu">## What's Next?</span></span>
<span id="cb62-1226"><a href="#cb62-1226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1227"><a href="#cb62-1227" aria-hidden="true" tabindex="-1"></a>In <span class="co">[</span><span class="ot">Chapter 16</span><span class="co">](16-ensemble-methods.Rmd)</span>, we'll explore ensemble methods in depth, learning how to combine multiple models for superior performance.</span>
<span id="cb62-1228"><a href="#cb62-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1229"><a href="#cb62-1229" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional Resources</span></span>
<span id="cb62-1230"><a href="#cb62-1230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-1231"><a href="#cb62-1231" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">An Introduction to Statistical Learning</span><span class="co">](https://www.statlearning.com/)</span> - Chapters 3, 6, 8</span>
<span id="cb62-1232"><a href="#cb62-1232" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">The Elements of Statistical Learning</span><span class="co">](https://hastie.su.domains/ElemStatLearn/)</span> - Chapters 3, 4, 15</span>
<span id="cb62-1233"><a href="#cb62-1233" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Applied Predictive Modeling</span><span class="co">](http://appliedpredictivemodeling.com/)</span> - Chapters 6-8</span>
<span id="cb62-1234"><a href="#cb62-1234" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Regression and Other Stories</span><span class="co">](https://avehtari.github.io/ROS-Examples/)</span> - Comprehensive regression guide</span>
<span id="cb62-1235"><a href="#cb62-1235" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Tidy Modeling with R</span><span class="co">](https://www.tmwr.org/)</span> - Chapters 7-11</span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>