<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="David Sarrat González, Juan R González">
<meta name="dcterms.date" content="2025-10-06">

<title>Chapter 7: Working with Strings and Dates - Text and Time in the Tidyverse – Tidyverse &amp; Machine Learning Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-4a990d8dcb58f517c7c86712b8f2ac7c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-90ee96a17764a76d4fcf3f331faa145e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Tidyverse &amp; Machine Learning Workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-1-tidyverse" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part 1: Tidyverse</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-1-tidyverse">    
        <li>
    <a class="dropdown-item" href="./01-introduction.html">
 <span class="dropdown-text">Ch 1: Introduction to Tidyverse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02-data-import.html">
 <span class="dropdown-text">Ch 2: Data Import with readr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-data-wrangling.html">
 <span class="dropdown-text">Ch 3: Data Wrangling with dplyr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-data-tidying.html">
 <span class="dropdown-text">Ch 4: Data Tidying with tidyr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./05-visualization.html">
 <span class="dropdown-text">Ch 5: Visualization with ggplot2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./06-functional-programming.html">
 <span class="dropdown-text">Ch 6: Functional Programming with purrr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./07-strings-dates.html">
 <span class="dropdown-text">Ch 7: Strings and Dates</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="./quiz-block-1.html">
 <span class="dropdown-text">Block 1 Assessment</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-2-tidymodels" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part 2: Tidymodels</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-2-tidymodels">    
        <li>
    <a class="dropdown-item" href="./08-tidymodels-intro.html">
 <span class="dropdown-text">Ch 8: Introduction to Tidymodels</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./09-data-splitting.html">
 <span class="dropdown-text">Ch 9: Data Splitting &amp; Resampling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./10-feature-engineering.html">
 <span class="dropdown-text">Ch 10: Feature Engineering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./11-model-specification.html">
 <span class="dropdown-text">Ch 11: Model Specification</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./12-workflows-evaluation.html">
 <span class="dropdown-text">Ch 12: Workflows &amp; Evaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./13-hyperparameter-tuning.html">
 <span class="dropdown-text">Ch 13: Hyperparameter Tuning</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="./quiz-block-2.html">
 <span class="dropdown-text">Block 2 Assessment</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-3-machine-learning" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part 3: Machine Learning</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-3-machine-learning">    
        <li>
    <a class="dropdown-item" href="./14-classification.html">
 <span class="dropdown-text">Ch 14: Classification Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./15-regression.html">
 <span class="dropdown-text">Ch 15: Regression Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./16-ensemble-methods.html">
 <span class="dropdown-text">Ch 16: Ensemble Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./17-unsupervised-learning.html">
 <span class="dropdown-text">Ch 17: Unsupervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./18-model-deployment.html">
 <span class="dropdown-text">Ch 18: Model Deployment</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="./quiz-block-3.html">
 <span class="dropdown-text">Block 3 Assessment</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives">Learning Objectives</a></li>
  <li><a href="#why-strings-and-dates-matter" id="toc-why-strings-and-dates-matter" class="nav-link" data-scroll-target="#why-strings-and-dates-matter">Why Strings and Dates Matter</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#part-1-string-manipulation-with-stringr" id="toc-part-1-string-manipulation-with-stringr" class="nav-link" data-scroll-target="#part-1-string-manipulation-with-stringr">Part 1: String Manipulation with stringr</a>
  <ul class="collapse">
  <li><a href="#understanding-strings-in-r" id="toc-understanding-strings-in-r" class="nav-link" data-scroll-target="#understanding-strings-in-r">Understanding Strings in R</a></li>
  <li><a href="#string-transformation" id="toc-string-transformation" class="nav-link" data-scroll-target="#string-transformation">String Transformation</a></li>
  <li><a href="#pattern-matching-and-regular-expressions" id="toc-pattern-matching-and-regular-expressions" class="nav-link" data-scroll-target="#pattern-matching-and-regular-expressions">Pattern Matching and Regular Expressions</a></li>
  <li><a href="#advanced-pattern-matching" id="toc-advanced-pattern-matching" class="nav-link" data-scroll-target="#advanced-pattern-matching">Advanced Pattern Matching</a></li>
  <li><a href="#string-splitting-and-combining" id="toc-string-splitting-and-combining" class="nav-link" data-scroll-target="#string-splitting-and-combining">String Splitting and Combining</a></li>
  </ul></li>
  <li><a href="#part-2-date-and-time-with-lubridate" id="toc-part-2-date-and-time-with-lubridate" class="nav-link" data-scroll-target="#part-2-date-and-time-with-lubridate">Part 2: Date and Time with lubridate</a>
  <ul class="collapse">
  <li><a href="#understanding-temporal-data" id="toc-understanding-temporal-data" class="nav-link" data-scroll-target="#understanding-temporal-data">Understanding Temporal Data</a></li>
  <li><a href="#date-components-and-arithmetic" id="toc-date-components-and-arithmetic" class="nav-link" data-scroll-target="#date-components-and-arithmetic">Date Components and Arithmetic</a></li>
  <li><a href="#working-with-time" id="toc-working-with-time" class="nav-link" data-scroll-target="#working-with-time">Working with Time</a></li>
  <li><a href="#time-zones---the-hidden-complexity" id="toc-time-zones---the-hidden-complexity" class="nav-link" data-scroll-target="#time-zones---the-hidden-complexity">Time Zones - The Hidden Complexity</a></li>
  <li><a href="#intervals-durations-and-periods" id="toc-intervals-durations-and-periods" class="nav-link" data-scroll-target="#intervals-durations-and-periods">Intervals, Durations, and Periods</a></li>
  </ul></li>
  <li><a href="#combining-strings-and-dates-in-real-analysis" id="toc-combining-strings-and-dates-in-real-analysis" class="nav-link" data-scroll-target="#combining-strings-and-dates-in-real-analysis">Combining Strings and Dates in Real Analysis</a>
  <ul class="collapse">
  <li><a href="#visualization-of-string-and-date-patterns" id="toc-visualization-of-string-and-date-patterns" class="nav-link" data-scroll-target="#visualization-of-string-and-date-patterns">Visualization of String and Date Patterns</a></li>
  </ul></li>
  <li><a href="#advanced-string-patterns" id="toc-advanced-string-patterns" class="nav-link" data-scroll-target="#advanced-string-patterns">Advanced String Patterns</a>
  <ul class="collapse">
  <li><a href="#working-with-structured-text" id="toc-working-with-structured-text" class="nav-link" data-scroll-target="#working-with-structured-text">Working with Structured Text</a></li>
  <li><a href="#text-normalization-and-cleaning" id="toc-text-normalization-and-cleaning" class="nav-link" data-scroll-target="#text-normalization-and-cleaning">Text Normalization and Cleaning</a></li>
  </ul></li>
  <li><a href="#working-with-date-ranges-and-business-logic" id="toc-working-with-date-ranges-and-business-logic" class="nav-link" data-scroll-target="#working-with-date-ranges-and-business-logic">Working with Date Ranges and Business Logic</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-1-email-parsing-and-validation" id="toc-exercise-1-email-parsing-and-validation" class="nav-link" data-scroll-target="#exercise-1-email-parsing-and-validation">Exercise 1: Email Parsing and Validation</a></li>
  <li><a href="#exercise-2-date-range-calculations" id="toc-exercise-2-date-range-calculations" class="nav-link" data-scroll-target="#exercise-2-date-range-calculations">Exercise 2: Date Range Calculations</a></li>
  <li><a href="#exercise-3-log-file-analysis" id="toc-exercise-3-log-file-analysis" class="nav-link" data-scroll-target="#exercise-3-log-file-analysis">Exercise 3: Log File Analysis</a></li>
  <li><a href="#exercise-4-text-mining-product-reviews" id="toc-exercise-4-text-mining-product-reviews" class="nav-link" data-scroll-target="#exercise-4-text-mining-product-reviews">Exercise 4: Text Mining Product Reviews</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#whats-next" id="toc-whats-next" class="nav-link" data-scroll-target="#whats-next">What’s Next?</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Chapter 7: Working with Strings and Dates - Text and Time in the Tidyverse</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>David Sarrat González, Juan R González </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 6, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h2>
<p>By the end of this chapter, you will master:</p>
<ul>
<li>String manipulation with stringr</li>
<li>Pattern matching with regular expressions</li>
<li>Text cleaning and extraction</li>
<li>Date and time handling with lubridate</li>
<li>Time zone management</li>
<li>Date arithmetic and intervals</li>
<li>Combining text and temporal data in analyses</li>
<li>Real-world applications and best practices</li>
</ul>
</section>
<section id="why-strings-and-dates-matter" class="level2">
<h2 class="anchored" data-anchor-id="why-strings-and-dates-matter">Why Strings and Dates Matter</h2>
<p>In real-world data analysis, you’ll rarely work with perfectly clean numeric data. Most datasets contain: - <strong>Text data</strong>: Names, addresses, descriptions, categories, IDs - <strong>Temporal data</strong>: Timestamps, dates, durations, time zones</p>
<p>These data types are notoriously tricky to work with because: - Text can be messy, inconsistent, and encoded differently - Dates come in countless formats - Time zones add complexity - Both require special handling for analysis</p>
<p>The tidyverse provides powerful, consistent tools to tackle these challenges. Let’s master them!</p>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>-- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --
v dplyr     1.1.4     v readr     2.1.5
v forcats   1.0.0     v stringr   1.5.2
v ggplot2   4.0.0     v tibble    3.3.0
v lubridate 1.9.4     v tidyr     1.3.1
v purrr     1.1.0     
-- Conflicts ------------------------------------------ tidyverse_conflicts() --
x dplyr::filter() masks stats::filter()
x dplyr::lag()    masks stats::lag()
i Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)  <span class="co"># For dates and times</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)    <span class="co"># For string manipulation (loaded with tidyverse)</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hms)        <span class="co"># For time-of-day values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Adjuntando el paquete: 'hms'

The following object is masked from 'package:lubridate':

    hms</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll create various example datasets throughout</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="part-1-string-manipulation-with-stringr" class="level2">
<h2 class="anchored" data-anchor-id="part-1-string-manipulation-with-stringr">Part 1: String Manipulation with stringr</h2>
<section id="understanding-strings-in-r" class="level3">
<h3 class="anchored" data-anchor-id="understanding-strings-in-r">Understanding Strings in R</h3>
<p>Strings (text data) are fundamental to data analysis, but they’re often the messiest part of our data. The <code>stringr</code> package provides a consistent, intuitive interface for string manipulation.</p>
<p>All stringr functions: - Start with <code>str_</code> for easy autocomplete - Take the string as the first argument (pipe-friendly) - Use consistent naming conventions - Handle NA values gracefully</p>
<p>Let’s start with basic operations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create example strings</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>messy_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"  John Smith  "</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mary jones"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ROBERT BROWN"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Sarah O'Connor"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"José García"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"anne-marie wilson"</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic string information</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">str_length</span>(messy_names)  <span class="co"># Length of each string</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14 10 12 14 25 NA 17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str_count</span>(messy_names, <span class="at">pattern =</span> <span class="st">" "</span>)  <span class="co"># Count spaces</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  5  1  1  1  1 NA  1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The power of vectorization - operations work on entire vectors</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">original =</span> messy_names,</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">length =</span> <span class="fu">str_length</span>(messy_names),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_spaces =</span> <span class="fu">str_count</span>(messy_names, <span class="st">" "</span>),</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_vowels =</span> <span class="fu">str_count</span>(messy_names, <span class="st">"[aeiouAEIOU]"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   original length n_spaces n_vowels
1              John Smith       14        5        2
2                mary jones     10        1        3
3              ROBERT BROWN     12        1        3
4            Sarah O'Connor     14        1        5
5 Jos&lt;U+00E9&gt; Garc&lt;U+00ED&gt;a     25        1        7
6                      &lt;NA&gt;     NA       NA       NA
7         anne-marie wilson     17        1        7</code></pre>
</div>
</div>
<p>Notice how stringr handles NA values gracefully - operations on NA return NA rather than erroring out. This is crucial for real-world data processing.</p>
</section>
<section id="string-transformation" class="level3">
<h3 class="anchored" data-anchor-id="string-transformation">String Transformation</h3>
<p>Let’s clean up our messy names systematically:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step-by-step cleaning</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>cleaned_names <span class="ot">&lt;-</span> messy_names <span class="sc">%&gt;%</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_trim</span>() <span class="sc">%&gt;%</span>                    <span class="co"># Remove leading/trailing whitespace</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_squish</span>() <span class="sc">%&gt;%</span>                  <span class="co"># Remove extra internal whitespace</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_to_title</span>() <span class="sc">%&gt;%</span>                <span class="co"># Proper case (Title Case)</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">"'"</span>, <span class="st">"'"</span>)         <span class="co"># Standardize apostrophes</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare before and after</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">original =</span> messy_names,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">cleaned =</span> cleaned_names</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 x 2
  original                    cleaned                  
  &lt;chr&gt;                       &lt;chr&gt;                    
1 "  John Smith  "            John Smith               
2 "mary jones"                Mary Jones               
3 "ROBERT BROWN"              Robert Brown             
4 "Sarah O'Connor"            Sarah O'connor           
5 "Jos&lt;U+00E9&gt; Garc&lt;U+00ED&gt;a" Jos&lt;U+00e9&gt; Garc&lt;U+00ed&gt;A
6  &lt;NA&gt;                       &lt;NA&gt;                     
7 "anne-marie wilson"         Anne-Marie Wilson        </code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Other case transformations</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>case_examples <span class="ot">&lt;-</span> <span class="st">"The Quick BROWN Fox"</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">original =</span> case_examples,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">str_to_lower</span>(case_examples),</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">str_to_upper</span>(case_examples),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="fu">str_to_title</span>(case_examples),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">sentence =</span> <span class="fu">str_to_sentence</span>(case_examples)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 5
  original            lower               upper               title     sentence
  &lt;chr&gt;               &lt;chr&gt;               &lt;chr&gt;               &lt;chr&gt;     &lt;chr&gt;   
1 The Quick BROWN Fox the quick brown fox THE QUICK BROWN FOX The Quic~ The qui~</code></pre>
</div>
</div>
<p>Each transformation serves a specific purpose: - <code>str_trim()</code>: Removes accidental spaces from data entry - <code>str_squish()</code>: Fixes multiple spaces between words - <code>str_to_title()</code>: Standardizes capitalization for names - <code>str_replace_all()</code>: Fixes encoding issues with special characters</p>
</section>
<section id="pattern-matching-and-regular-expressions" class="level3">
<h3 class="anchored" data-anchor-id="pattern-matching-and-regular-expressions">Pattern Matching and Regular Expressions</h3>
<p>Regular expressions (regex) are powerful pattern-matching tools. While they look cryptic at first, they’re invaluable for text processing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample text data</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>emails <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"john.doe@company.com"</span>,</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"alice@university.edu"</span>,</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bob.smith@email.co.uk"</span>,</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"invalid-email"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"another@domain.org"</span>,</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"not an email at all"</span>,</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect patterns</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>has_at <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(emails, <span class="st">"@"</span>)  <span class="co"># Simple pattern</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>has_dot_com <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(emails, <span class="st">"</span><span class="sc">\\</span><span class="st">.com$"</span>)  <span class="co"># .com at end ($ = end of string)</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract patterns</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>domains <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(emails, <span class="st">"@[^.]+</span><span class="sc">\\</span><span class="st">.[a-z]+"</span>)  <span class="co"># Extract domain</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>usernames <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(emails, <span class="st">"^[^@]+"</span>)  <span class="co"># Everything before @</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a summary</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>email_analysis <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">email =</span> emails,</span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_valid =</span> <span class="fu">str_detect</span>(emails, <span class="st">"^[^@]+@[^@]+</span><span class="sc">\\</span><span class="st">.[^@]+$"</span>),</span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">username =</span> usernames,</span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">domain =</span> <span class="fu">str_remove</span>(domains, <span class="st">"@"</span>),</span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">tld =</span> <span class="fu">str_extract</span>(emails, <span class="st">"</span><span class="sc">\\</span><span class="st">.[a-z]+$"</span>)</span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(email_analysis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 x 5
  email                 is_valid username            domain         tld  
  &lt;chr&gt;                 &lt;lgl&gt;    &lt;chr&gt;               &lt;chr&gt;          &lt;chr&gt;
1 john.doe@company.com  TRUE     john.doe            company.com    .com 
2 alice@university.edu  TRUE     alice               university.edu .edu 
3 bob.smith@email.co.uk TRUE     bob.smith           email.co       .uk  
4 invalid-email         FALSE    invalid-email       &lt;NA&gt;           &lt;NA&gt; 
5 another@domain.org    TRUE     another             domain.org     .org 
6 not an email at all   FALSE    not an email at all &lt;NA&gt;           &lt;NA&gt; 
7 &lt;NA&gt;                  NA       &lt;NA&gt;                &lt;NA&gt;           &lt;NA&gt; </code></pre>
</div>
</div>
<p>Let’s break down these regex patterns: - <code>@</code> - Literal @ symbol - <code>\\.</code> - Literal period (. alone means “any character”) - <code>^</code> - Start of string - <code>$</code> - End of string - <code>[^@]+</code> - One or more characters that are NOT @ - <code>[a-z]+</code> - One or more lowercase letters</p>
</section>
<section id="advanced-pattern-matching" class="level3">
<h3 class="anchored" data-anchor-id="advanced-pattern-matching">Advanced Pattern Matching</h3>
<p>Let’s work with more complex patterns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Phone numbers in various formats</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>phone_numbers <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(555) 123-4567"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"555-123-4567"</span>,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"5551234567"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"555.123.4567"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"+1 555 123 4567"</span>,</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Call me at 555-1234"</span>,</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"invalid"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract digits only</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>digits_only <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(phone_numbers, <span class="st">"[^0-9]"</span>)</span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(digits_only)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "5551234567"  "5551234567"  "5551234567"  "5551234567"  "15551234567"
[6] "5551234"     ""            NA           </code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize format</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>standardized <span class="ot">&lt;-</span> phone_numbers <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove_all</span>(<span class="st">"[^0-9]"</span>) <span class="sc">%&gt;%</span>  <span class="co"># Remove non-digits</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">"^1"</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span>      <span class="co"># Remove leading 1</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">"(</span><span class="sc">\\</span><span class="st">d{3})(</span><span class="sc">\\</span><span class="st">d{3})(</span><span class="sc">\\</span><span class="st">d{4})"</span>, <span class="st">"(</span><span class="sc">\\</span><span class="st">1) </span><span class="sc">\\</span><span class="st">2-</span><span class="sc">\\</span><span class="st">3"</span>)  <span class="co"># Format</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">original =</span> phone_numbers,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">standardized =</span> standardized</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 x 2
  original            standardized    
  &lt;chr&gt;               &lt;chr&gt;           
1 (555) 123-4567      "(555) 123-4567"
2 555-123-4567        "(555) 123-4567"
3 5551234567          "(555) 123-4567"
4 555.123.4567        "(555) 123-4567"
5 +1 555 123 4567     "(555) 123-4567"
6 Call me at 555-1234 "5551234"       
7 invalid             ""              
8 &lt;NA&gt;                 &lt;NA&gt;           </code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract structured information</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>addresses <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"123 Main St, New York, NY 10001"</span>,</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"456 Oak Avenue, Los Angeles, CA 90028"</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"789 Elm Rd, Chicago, IL 60601"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"321 Pine Street, Houston, TX 77002"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract components using regex groups</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>address_parts <span class="ot">&lt;-</span> <span class="fu">str_match</span>(addresses, </span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(</span><span class="sc">\\</span><span class="st">d+) ([^,]+), ([^,]+), ([A-Z]{2}) (</span><span class="sc">\\</span><span class="st">d{5})"</span>)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(address_parts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"full"</span>, <span class="st">"number"</span>, <span class="st">"street"</span>, <span class="st">"city"</span>, <span class="st">"state"</span>, <span class="st">"zip"</span>)</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(address_parts) <span class="sc">%&gt;%</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>full)  <span class="co"># Remove the full match column</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 x 5
  number street      city        state zip  
  &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;
1 123    Main St     New York    NY    10001
2 456    Oak Avenue  Los Angeles CA    90028
3 789    Elm Rd      Chicago     IL    60601
4 321    Pine Street Houston     TX    77002</code></pre>
</div>
</div>
<p>The power of regex groups (parentheses) is that they let us extract multiple pieces of information in one operation. Each group becomes a separate column in the output.</p>
</section>
<section id="string-splitting-and-combining" class="level3">
<h3 class="anchored" data-anchor-id="string-splitting-and-combining">String Splitting and Combining</h3>
<p>Real data often requires splitting combined fields or joining separate ones:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Full names that need splitting</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>full_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Smith, John"</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Jones, Mary Ann"</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Brown Jr., Robert"</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"O'Connor, Sarah"</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"García-López, José María"</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Split on comma and clean up</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>name_parts <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(full_names, <span class="st">", "</span>, <span class="at">n =</span> <span class="dv">2</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(name_parts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"last_name"</span>, <span class="st">"first_name"</span>)</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>name_df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(name_parts) <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean up any extra spaces</span></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">first_name =</span> <span class="fu">str_trim</span>(first_name),</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">last_name =</span> <span class="fu">str_trim</span>(last_name),</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create display name</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">display_name =</span> <span class="fu">str_c</span>(first_name, <span class="st">" "</span>, last_name),</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create email-friendly version</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">email_name =</span> <span class="fu">str_c</span>(</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_to_lower</span>(<span class="fu">str_extract</span>(first_name, <span class="st">"</span><span class="sc">\\</span><span class="st">w+"</span>)),  <span class="co"># First word only</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>      <span class="st">"."</span>,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_to_lower</span>(<span class="fu">str_replace_all</span>(last_name, <span class="st">"[^a-zA-Z]"</span>, <span class="st">""</span>)),  <span class="co"># Letters only</span></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>      <span class="st">"@company.com"</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(name_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 x 4
  last_name                  first_name               display_name    email_name
  &lt;chr&gt;                      &lt;chr&gt;                    &lt;chr&gt;           &lt;chr&gt;     
1 Smith                      John                     John Smith      john.smit~
2 Jones                      Mary Ann                 Mary Ann Jones  mary.jone~
3 Brown Jr.                  Robert                   Robert Brown J~ robert.br~
4 O'Connor                   Sarah                    Sarah O'Connor  sarah.oco~
5 Garc&lt;U+00ED&gt;a-L&lt;U+00F3&gt;pez Jos&lt;U+00E9&gt; Mar&lt;U+00ED&gt;a Jos&lt;U+00E9&gt; Ma~ jos.garcu~</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combining multiple fields</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>product_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">brand =</span> <span class="fu">c</span>(<span class="st">"Apple"</span>, <span class="st">"Samsung"</span>, <span class="st">"Google"</span>),</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">c</span>(<span class="st">"iPhone"</span>, <span class="st">"Galaxy"</span>, <span class="st">"Pixel"</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">version =</span> <span class="fu">c</span>(<span class="st">"14 Pro"</span>, <span class="st">"S23"</span>, <span class="st">"7a"</span>),</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2022</span>, <span class="dv">2023</span>, <span class="dv">2023</span>)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>product_data <span class="sc">%&gt;%</span></span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Various ways to combine</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_name =</span> <span class="fu">str_c</span>(brand, model, version, <span class="at">sep =</span> <span class="st">" "</span>),</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sku =</span> <span class="fu">str_c</span>(</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_to_upper</span>(<span class="fu">str_sub</span>(brand, <span class="dv">1</span>, <span class="dv">3</span>)),  <span class="co"># First 3 letters of brand</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_extract</span>(version, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>),         <span class="co"># Version number</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>      year,</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">"-"</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">marketing_name =</span> <span class="fu">str_glue</span>(<span class="st">"{brand} {model} {version} ({year})"</span>)</span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 x 7
  brand   model  version  year full_name           sku         marketing_name   
  &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt; &lt;chr&gt;               &lt;chr&gt;       &lt;glue&gt;           
1 Apple   iPhone 14 Pro   2022 Apple iPhone 14 Pro APP-14-2022 Apple iPhone 14 ~
2 Samsung Galaxy S23      2023 Samsung Galaxy S23  SAM-23-2023 Samsung Galaxy S~
3 Google  Pixel  7a       2023 Google Pixel 7a     GOO-7-2023  Google Pixel 7a ~</code></pre>
</div>
</div>
<p>Notice the different joining functions: - <code>str_c()</code>: Basic concatenation with separator - <code>str_glue()</code>: Template-based joining (like Python f-strings) - <code>paste()</code> and <code>paste0()</code>: Base R alternatives (less consistent)</p>
</section>
</section>
<section id="part-2-date-and-time-with-lubridate" class="level2">
<h2 class="anchored" data-anchor-id="part-2-date-and-time-with-lubridate">Part 2: Date and Time with lubridate</h2>
<section id="understanding-temporal-data" class="level3">
<h3 class="anchored" data-anchor-id="understanding-temporal-data">Understanding Temporal Data</h3>
<p>Dates and times are deceptively complex: - Different formats (MM/DD/YYYY vs DD/MM/YYYY) - Time zones - Daylight saving time - Leap years and leap seconds - Different calendar systems</p>
<p>Lubridate makes working with dates intuitive and reliable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Today's date and current time</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">today</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2025-10-01"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">now</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2025-10-01 12:48:28 CEST"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse dates from strings - lubridate is smart!</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>date_strings <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2023-01-15"</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"01/15/2023"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"15-Jan-2023"</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"January 15, 2023"</span>,</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"20230115"</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Different parsing functions for different formats</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>parsed_dates <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">original =</span> date_strings,</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">ymd =</span> <span class="fu">ymd</span>(<span class="st">"2023-01-15"</span>),</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">mdy =</span> <span class="fu">mdy</span>(<span class="st">"01/15/2023"</span>),</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">dmy =</span> <span class="fu">dmy</span>(<span class="st">"15-01-2023"</span>),</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">smart_parse =</span> <span class="fu">parse_date_time</span>(date_strings, </span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">orders =</span> <span class="fu">c</span>(<span class="st">"ymd"</span>, <span class="st">"mdy"</span>, <span class="st">"dmy"</span>, <span class="st">"Bdy"</span>, <span class="st">"ymd"</span>))</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(parsed_dates)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 x 5
  original         ymd        mdy        dmy        smart_parse        
  &lt;chr&gt;            &lt;date&gt;     &lt;date&gt;     &lt;date&gt;     &lt;dttm&gt;             
1 2023-01-15       2023-01-15 2023-01-15 2023-01-15 2023-01-15 00:00:00
2 01/15/2023       2023-01-15 2023-01-15 2023-01-15 2023-01-15 00:00:00
3 15-Jan-2023      2023-01-15 2023-01-15 2023-01-15 2023-01-15 00:00:00
4 January 15, 2023 2023-01-15 2023-01-15 2023-01-15 2023-01-15 00:00:00
5 20230115         2023-01-15 2023-01-15 2023-01-15 2023-01-15 00:00:00</code></pre>
</div>
</div>
<p>The genius of lubridate is the intuitive function names: - <code>ymd()</code>: Year-Month-Day - <code>mdy()</code>: Month-Day-Year - <code>dmy()</code>: Day-Month-Year - <code>ymd_hms()</code>: With time included</p>
</section>
<section id="date-components-and-arithmetic" class="level3">
<h3 class="anchored" data-anchor-id="date-components-and-arithmetic">Date Components and Arithmetic</h3>
<p>Once we have dates, we can extract components and do arithmetic:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a date range</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">ymd</span>(<span class="st">"2023-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"month"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>date_analysis <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> dates,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">month =</span> <span class="fu">month</span>(date),</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">month_name =</span> <span class="fu">month</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">FALSE</span>),</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">day =</span> <span class="fu">day</span>(date),</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">weekday =</span> <span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">FALSE</span>),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">quarter =</span> <span class="fu">quarter</span>(date),</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_of_year =</span> <span class="fu">week</span>(date),</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">day_of_year =</span> <span class="fu">yday</span>(date),</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_weekend =</span> <span class="fu">wday</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>),  <span class="co"># Sunday = 1, Saturday = 7</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">days_in_month =</span> <span class="fu">days_in_month</span>(date)</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(date_analysis, <span class="at">n =</span> <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 x 11
   date        year month month_name   day weekday   quarter week_of_year
   &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt;      &lt;int&gt; &lt;ord&gt;       &lt;int&gt;        &lt;dbl&gt;
 1 2023-01-01  2023     1 January        1 Sunday          1            1
 2 2023-02-01  2023     2 February       1 Wednesday       1            5
 3 2023-03-01  2023     3 March          1 Wednesday       1            9
 4 2023-04-01  2023     4 April          1 Saturday        2           13
 5 2023-05-01  2023     5 May            1 Monday          2           18
 6 2023-06-01  2023     6 June           1 Thursday        2           22
 7 2023-07-01  2023     7 July           1 Saturday        3           26
 8 2023-08-01  2023     8 August         1 Tuesday         3           31
 9 2023-09-01  2023     9 September      1 Friday          3           35
10 2023-10-01  2023    10 October        1 Sunday          4           40
11 2023-11-01  2023    11 November       1 Wednesday       4           44
12 2023-12-01  2023    12 December       1 Friday          4           48
# i 3 more variables: day_of_year &lt;dbl&gt;, is_weekend &lt;lgl&gt;, days_in_month &lt;int&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Date arithmetic is intuitive</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>reference_date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"2023-06-15"</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="fu">c</span>(</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Original date"</span>,</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Plus 30 days"</span>,</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Plus 2 months"</span>,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Plus 1 year"</span>,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Next Monday"</span>,</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"End of month"</span>,</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Beginning of year"</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">c</span>(</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    reference_date,</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    reference_date <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">30</span>),</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>    reference_date <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">2</span>),</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>    reference_date <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>),</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ceiling_date</span>(reference_date, <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">1</span>),</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ceiling_date</span>(reference_date, <span class="st">"month"</span>) <span class="sc">-</span> <span class="fu">days</span>(<span class="dv">1</span>),</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">floor_date</span>(reference_date, <span class="st">"year"</span>)</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 x 2
  description       date      
  &lt;chr&gt;             &lt;date&gt;    
1 Original date     2023-06-15
2 Plus 30 days      2023-07-15
3 Plus 2 months     2023-08-15
4 Plus 1 year       2024-06-15
5 Next Monday       2023-06-19
6 End of month      2023-06-30
7 Beginning of year 2023-01-01</code></pre>
</div>
</div>
<p>Key insights about date arithmetic: - Adding days is straightforward - Adding months/years handles edge cases (e.g., Jan 31 + 1 month = Feb 28/29) - <code>floor_date()</code> and <code>ceiling_date()</code> are perfect for grouping</p>
</section>
<section id="working-with-time" class="level3">
<h3 class="anchored" data-anchor-id="working-with-time">Working with Time</h3>
<p>Time adds another layer of complexity:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Different time representations</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>time_examples <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">datetime_string =</span> <span class="fu">c</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2023-06-15 14:30:00"</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2023-06-15 2:30:00 PM"</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"15/06/2023 14:30"</span>,</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"June 15, 2023 2:30 PM"</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse with different formats</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>parsed_times <span class="ot">&lt;-</span> time_examples <span class="sc">%&gt;%</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">parsed =</span> <span class="fu">parse_date_time</span>(datetime_string, </span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">orders =</span> <span class="fu">c</span>(<span class="st">"ymd HMS"</span>, <span class="st">"ymd IMS p"</span>, <span class="st">"dmy HM"</span>, <span class="st">"Bdy IMS p"</span>)),</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_only =</span> <span class="fu">as_date</span>(parsed),</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_only =</span> <span class="fu">format</span>(parsed, <span class="st">"%H:%M:%S"</span>),</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour =</span> <span class="fu">hour</span>(parsed),</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">minute =</span> <span class="fu">minute</span>(parsed),</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">am_pm =</span> <span class="fu">if_else</span>(<span class="fu">hour</span>(parsed) <span class="sc">&lt;</span> <span class="dv">12</span>, <span class="st">"AM"</span>, <span class="st">"PM"</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(parsed_times)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 x 7
  datetime_string    parsed              date_only  time_only  hour minute am_pm
  &lt;chr&gt;              &lt;dttm&gt;              &lt;date&gt;     &lt;chr&gt;     &lt;int&gt;  &lt;int&gt; &lt;chr&gt;
1 2023-06-15 14:30:~ 2023-06-15 14:30:00 2023-06-15 14:30:00     14     30 PM   
2 2023-06-15 2:30:0~ 2023-06-15 14:30:00 2023-06-15 14:30:00     14     30 PM   
3 15/06/2023 14:30   2015-06-20 23:14:30 2015-06-20 23:14:30     23     14 PM   
4 June 15, 2023 2:3~ NA                  NA         &lt;NA&gt;         NA     NA &lt;NA&gt; </code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time differences and durations</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-06-15 09:00:00"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-06-15 17:30:00"</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Different ways to express time differences</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>time_diff <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(time_diff)  <span class="co"># In seconds by default</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Time difference of 8.5 hours</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to different units</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">unit =</span> <span class="fu">c</span>(<span class="st">"seconds"</span>, <span class="st">"minutes"</span>, <span class="st">"hours"</span>, <span class="st">"days"</span>),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(time_diff, <span class="at">units =</span> <span class="st">"secs"</span>),</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(time_diff, <span class="at">units =</span> <span class="st">"mins"</span>),</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(time_diff, <span class="at">units =</span> <span class="st">"hours"</span>),</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(time_diff, <span class="at">units =</span> <span class="st">"days"</span>)</span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 x 2
  unit        value
  &lt;chr&gt;       &lt;dbl&gt;
1 seconds 30600    
2 minutes   510    
3 hours       8.5  
4 days        0.354</code></pre>
</div>
</div>
</section>
<section id="time-zones---the-hidden-complexity" class="level3">
<h3 class="anchored" data-anchor-id="time-zones---the-hidden-complexity">Time Zones - The Hidden Complexity</h3>
<p>Time zones are often the source of subtle bugs in data analysis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Working with time zones</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>utc_time <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-06-15 12:00:00"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to different time zones</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>time_zones <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">timezone =</span> <span class="fu">c</span>(<span class="st">"UTC"</span>, <span class="st">"America/New_York"</span>, <span class="st">"Europe/London"</span>, </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Asia/Tokyo"</span>, <span class="st">"Australia/Sydney"</span>),</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">local_time =</span> <span class="fu">c</span>(</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    utc_time,</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with_tz</span>(utc_time, <span class="st">"America/New_York"</span>),</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with_tz</span>(utc_time, <span class="st">"Europe/London"</span>),</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with_tz</span>(utc_time, <span class="st">"Asia/Tokyo"</span>),</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with_tz</span>(utc_time, <span class="st">"Australia/Sydney"</span>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset_hours =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">10</span>)  <span class="co"># Offset from UTC (varies with DST!)</span></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(time_zones)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 x 3
  timezone         local_time          offset_hours
  &lt;chr&gt;            &lt;dttm&gt;                     &lt;dbl&gt;
1 UTC              2023-06-15 12:00:00            0
2 America/New_York 2023-06-15 12:00:00           -4
3 Europe/London    2023-06-15 12:00:00            1
4 Asia/Tokyo       2023-06-15 12:00:00            9
5 Australia/Sydney 2023-06-15 12:00:00           10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Force_tz vs with_tz</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>ambiguous_time <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-06-15 12:00:00"</span>)  <span class="co"># No timezone specified</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="fu">c</span>(</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Original (no tz)"</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"with_tz - converts time"</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"force_tz - keeps time, changes zone"</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">result =</span> <span class="fu">c</span>(</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(ambiguous_time),</span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(<span class="fu">with_tz</span>(ambiguous_time, <span class="st">"America/New_York"</span>)),</span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(<span class="fu">force_tz</span>(ambiguous_time, <span class="st">"America/New_York"</span>))</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-15"><a href="#cb46-15" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 x 2
  description                         result             
  &lt;chr&gt;                               &lt;chr&gt;              
1 Original (no tz)                    2023-06-15 12:00:00
2 with_tz - converts time             2023-06-15 08:00:00
3 force_tz - keeps time, changes zone 2023-06-15 12:00:00</code></pre>
</div>
</div>
<p>The difference between <code>with_tz()</code> and <code>force_tz()</code>: - <code>with_tz()</code>: Changes the display timezone (same moment in time) - <code>force_tz()</code>: Changes the timezone interpretation (different moment)</p>
</section>
<section id="intervals-durations-and-periods" class="level3">
<h3 class="anchored" data-anchor-id="intervals-durations-and-periods">Intervals, Durations, and Periods</h3>
<p>Lubridate distinguishes between three concepts:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Intervals: specific start and end times</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>interval_1 <span class="ot">&lt;-</span> <span class="fu">interval</span>(<span class="fu">ymd</span>(<span class="st">"2023-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2023-12-31"</span>))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>interval_2 <span class="ot">&lt;-</span> <span class="fu">interval</span>(<span class="fu">ymd</span>(<span class="st">"2023-06-01"</span>), <span class="fu">ymd</span>(<span class="st">"2023-08-31"</span>))</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check overlap</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="fu">int_overlaps</span>(interval_1, interval_2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Durations: exact time spans (in seconds)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>duration_1 <span class="ot">&lt;-</span> <span class="fu">ddays</span>(<span class="dv">7</span>) <span class="sc">+</span> <span class="fu">dhours</span>(<span class="dv">3</span>) <span class="sc">+</span> <span class="fu">dminutes</span>(<span class="dv">30</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(duration_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "617400s (~1.02 weeks)"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Periods: human-friendly time spans</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>period_1 <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">+</span> <span class="fu">hours</span>(<span class="dv">3</span>) <span class="sc">+</span> <span class="fu">minutes</span>(<span class="dv">30</span>)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(period_1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "7d 3H 30M 0S"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The difference matters!</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Consider daylight saving time</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>dst_start <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-03-11 00:00:00"</span>, <span class="at">tz =</span> <span class="st">"America/New_York"</span>)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="fu">c</span>(</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Original time"</span>,</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Plus duration (24 hours)"</span>,</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Plus period (1 day)"</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">result =</span> <span class="fu">c</span>(</span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>    dst_start,</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>    dst_start <span class="sc">+</span> <span class="fu">ddays</span>(<span class="dv">1</span>),  <span class="co"># Exactly 24 hours later</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>    dst_start <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">1</span>)    <span class="co"># Next calendar day at same time</span></span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 x 2
  description              result             
  &lt;chr&gt;                    &lt;dttm&gt;             
1 Original time            2023-03-11 00:00:00
2 Plus duration (24 hours) 2023-03-12 00:00:00
3 Plus period (1 day)      2023-03-12 00:00:00</code></pre>
</div>
</div>
<p>Use: - <strong>Intervals</strong>: When you need specific start/end times - <strong>Durations</strong>: For exact time calculations - <strong>Periods</strong>: For human-friendly calculations</p>
</section>
</section>
<section id="combining-strings-and-dates-in-real-analysis" class="level2">
<h2 class="anchored" data-anchor-id="combining-strings-and-dates-in-real-analysis">Combining Strings and Dates in Real Analysis</h2>
<p>Let’s work with a realistic example combining both:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a realistic dataset - customer support tickets</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>n_tickets <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>support_tickets <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticket_id =</span> <span class="fu">sprintf</span>(<span class="st">"TICK-%06d"</span>, <span class="dv">1</span><span class="sc">:</span>n_tickets),</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">created_at =</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-01-01 00:00:00"</span>) <span class="sc">+</span> </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seconds</span>(<span class="fu">runif</span>(n_tickets, <span class="dv">0</span>, <span class="dv">365</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">60</span>)),</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">customer_email =</span> <span class="fu">str_c</span>(</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"john"</span>, <span class="st">"mary"</span>, <span class="st">"bob"</span>, <span class="st">"alice"</span>, <span class="st">"charlie"</span>), n_tickets, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, n_tickets, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"@"</span>,</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"gmail.com"</span>, <span class="st">"yahoo.com"</span>, <span class="st">"company.com"</span>), n_tickets, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">subject =</span> <span class="fu">sample</span>(<span class="fu">c</span>(</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Login issue - can't access account"</span>,</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Payment failed - ERROR 402"</span>,</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Question about pricing"</span>,</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Feature request: dark mode"</span>,</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bug report - app crashes on startup"</span>,</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Refund request #12345"</span></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>  ), n_tickets, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">priority =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>, <span class="st">"Critical"</span>), n_tickets, </span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>                   <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>)),</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">resolved_at =</span> created_at <span class="sc">+</span> <span class="fu">hours</span>(<span class="fu">round</span>(<span class="fu">rexp</span>(n_tickets, <span class="at">rate =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">24</span>)))  <span class="co"># Exponential resolution time</span></span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">resolved_at =</span> <span class="fu">if_else</span>(<span class="fu">runif</span>(n_tickets) <span class="sc">&lt;</span> <span class="fl">0.1</span>, NA_POSIXct_, resolved_at)  <span class="co"># 10% unresolved</span></span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze the tickets</span></span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>ticket_analysis <span class="ot">&lt;-</span> support_tickets <span class="sc">%&gt;%</span></span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract information from strings</span></span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">issue_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(subject, <span class="st">"Login|access|password"</span>) <span class="sc">~</span> <span class="st">"Authentication"</span>,</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(subject, <span class="st">"Payment|refund|billing"</span>) <span class="sc">~</span> <span class="st">"Billing"</span>,</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(subject, <span class="st">"Bug|crash|error"</span>) <span class="sc">~</span> <span class="st">"Bug"</span>,</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(subject, <span class="st">"Feature|request"</span>) <span class="sc">~</span> <span class="st">"Feature Request"</span>,</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_error_code =</span> <span class="fu">str_detect</span>(subject, <span class="st">"ERROR </span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">error_code =</span> <span class="fu">str_extract</span>(subject, <span class="st">"ERROR </span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract from email</span></span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">email_domain =</span> <span class="fu">str_extract</span>(customer_email, <span class="st">"@(.+)$"</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">"@"</span>),</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_corporate =</span> email_domain <span class="sc">==</span> <span class="st">"company.com"</span>,</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Date/time analysis</span></span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">created_date =</span> <span class="fu">as_date</span>(created_at),</span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">created_hour =</span> <span class="fu">hour</span>(created_at),</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">created_weekday =</span> <span class="fu">wday</span>(created_at, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">created_month =</span> <span class="fu">month</span>(created_at, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_business_hours =</span> <span class="fu">between</span>(created_hour, <span class="dv">9</span>, <span class="dv">17</span>),</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_weekend =</span> <span class="fu">wday</span>(created_at) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>),</span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Resolution time</span></span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">resolution_time =</span> <span class="fu">as.numeric</span>(resolved_at <span class="sc">-</span> created_at, <span class="at">units =</span> <span class="st">"hours"</span>),</span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_resolved =</span> <span class="sc">!</span><span class="fu">is.na</span>(resolved_at),</span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">resolution_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(resolution_time) <span class="sc">~</span> <span class="st">"Unresolved"</span>,</span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>      resolution_time <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"&lt; 1 hour"</span>,</span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>      resolution_time <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"1-4 hours"</span>,</span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a>      resolution_time <span class="sc">&lt;</span> <span class="dv">24</span> <span class="sc">~</span> <span class="st">"4-24 hours"</span>,</span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a>      resolution_time <span class="sc">&lt;</span> <span class="dv">72</span> <span class="sc">~</span> <span class="st">"1-3 days"</span>,</span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"&gt; 3 days"</span></span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-70"><a href="#cb56-70" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb56-71"><a href="#cb56-71" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> ticket_analysis <span class="sc">%&gt;%</span></span>
<span id="cb56-72"><a href="#cb56-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(issue_type, priority) <span class="sc">%&gt;%</span></span>
<span id="cb56-73"><a href="#cb56-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb56-74"><a href="#cb56-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb56-75"><a href="#cb56-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">resolved_pct =</span> <span class="fu">mean</span>(is_resolved) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb56-76"><a href="#cb56-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_resolution_hours =</span> <span class="fu">mean</span>(resolution_time, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-77"><a href="#cb56-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_resolution_hours =</span> <span class="fu">median</span>(resolution_time, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb56-78"><a href="#cb56-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb56-79"><a href="#cb56-79" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb56-80"><a href="#cb56-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(issue_type, priority)</span>
<span id="cb56-81"><a href="#cb56-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-82"><a href="#cb56-82" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_stats, <span class="at">n =</span> <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 x 6
   issue_type      priority count resolved_pct avg_resolution_hours
   &lt;chr&gt;           &lt;chr&gt;    &lt;int&gt;        &lt;dbl&gt;                &lt;dbl&gt;
 1 Authentication  Critical    12         91.7                 20.8
 2 Authentication  High        11         90.9                 20.3
 3 Authentication  Low         28         78.6                 23.9
 4 Authentication  Medium      29         93.1                 20.4
 5 Billing         Critical     4         75                   25.7
 6 Billing         High        18         83.3                 11.6
 7 Billing         Low         29         96.6                 30.7
 8 Billing         Medium      22         86.4                 29.2
 9 Bug             Critical    10        100                   32  
10 Bug             High        18         83.3                 25.6
11 Bug             Low         45         97.8                 39.7
12 Bug             Medium      25         88                   18.6
13 Feature Request Critical    23        100                   17.7
14 Feature Request High        27         92.6                 16.6
15 Feature Request Low         61         88.5                 29.9
16 Feature Request Medium      50         84                   21.5
17 Other           Critical    11         72.7                 20.6
18 Other           High        14         92.9                 26.8
19 Other           Low         31         96.8                 23.2
20 Other           Medium      32         84.4                 19.4
# i 1 more variable: median_resolution_hours &lt;dbl&gt;</code></pre>
</div>
</div>
<p>This analysis demonstrates: - Extracting categories from free text - Finding patterns in strings - Working with timestamps - Calculating time differences - Combining string and date operations</p>
<section id="visualization-of-string-and-date-patterns" class="level3">
<h3 class="anchored" data-anchor-id="visualization-of-string-and-date-patterns">Visualization of String and Date Patterns</h3>
<p>Let’s visualize our findings:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ticket volume over time</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> ticket_analysis <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(created_date) <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> created_date, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Daily Ticket Volume"</span>,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"With smoothed trend line"</span>,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Tickets"</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Hour of day pattern</span></span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> ticket_analysis <span class="sc">%&gt;%</span></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(created_hour, is_weekend) <span class="sc">%&gt;%</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> created_hour, <span class="at">y =</span> n, <span class="at">fill =</span> is_weekend)) <span class="sc">+</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>, <span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"coral"</span>)) <span class="sc">+</span></span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Tickets by Hour of Day"</span>,</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Weekday vs Weekend patterns"</span>,</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Day"</span>,</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Tickets"</span>,</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Weekend"</span></span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">23</span>, <span class="dv">3</span>))</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Issue types by priority</span></span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> ticket_analysis <span class="sc">%&gt;%</span></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(issue_type, priority) <span class="sc">%&gt;%</span></span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">priority =</span> <span class="fu">factor</span>(priority, </span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>, <span class="st">"Critical"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> issue_type, <span class="at">y =</span> n, <span class="at">fill =</span> priority)) <span class="sc">+</span></span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Issue Types by Priority"</span>,</span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Proportion of priority levels"</span>,</span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Issue Type"</span>,</span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion"</span>,</span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Priority"</span></span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolution time distribution</span></span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> ticket_analysis <span class="sc">%&gt;%</span></span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(is_resolved) <span class="sc">%&gt;%</span></span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> resolution_time, <span class="at">fill =</span> priority)) <span class="sc">+</span></span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb58-53"><a href="#cb58-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>priority) <span class="sc">+</span></span>
<span id="cb58-54"><a href="#cb58-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb58-55"><a href="#cb58-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Resolution Time Distribution"</span>,</span>
<span id="cb58-56"><a href="#cb58-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Log scale, by priority"</span>,</span>
<span id="cb58-57"><a href="#cb58-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Resolution Time (hours, log scale)"</span>,</span>
<span id="cb58-58"><a href="#cb58-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Count"</span></span>
<span id="cb58-59"><a href="#cb58-59" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-60"><a href="#cb58-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb58-61"><a href="#cb58-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-62"><a href="#cb58-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine plots</span></span>
<span id="cb58-63"><a href="#cb58-63" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb58-64"><a href="#cb58-64" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4) <span class="sc">+</span></span>
<span id="cb58-65"><a href="#cb58-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb58-66"><a href="#cb58-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Support Ticket Analysis"</span>,</span>
<span id="cb58-67"><a href="#cb58-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Combining string extraction and temporal patterns"</span></span>
<span id="cb58-68"><a href="#cb58-68" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-strings-dates_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="1344"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="advanced-string-patterns" class="level2">
<h2 class="anchored" data-anchor-id="advanced-string-patterns">Advanced String Patterns</h2>
<section id="working-with-structured-text" class="level3">
<h3 class="anchored" data-anchor-id="working-with-structured-text">Working with Structured Text</h3>
<p>Many datasets contain semi-structured text that needs parsing:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Log file entries</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>log_entries <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[2023-06-15 10:30:45] INFO: User john_doe logged in from 192.168.1.100"</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[2023-06-15 10:31:02] ERROR: Database connection failed - timeout after 30s"</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[2023-06-15 10:31:15] WARNING: High memory usage detected (85%)"</span>,</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[2023-06-15 10:32:00] INFO: Backup completed successfully"</span>,</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[2023-06-15 10:33:21] ERROR: File not found: /data/config.json"</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse log entries with regex</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>parsed_logs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">log =</span> log_entries) <span class="sc">%&gt;%</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract timestamp</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">timestamp =</span> <span class="fu">str_extract</span>(log, <span class="st">"</span><span class="sc">\\</span><span class="st">[([^</span><span class="sc">\\</span><span class="st">]]+)</span><span class="sc">\\</span><span class="st">]"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">]"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ymd_hms</span>(),</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract log level</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">level =</span> <span class="fu">str_extract</span>(log, <span class="st">"INFO|ERROR|WARNING|DEBUG"</span>),</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract message</span></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">message =</span> <span class="fu">str_extract</span>(log, <span class="st">"(?&lt;=: ).*$"</span>),  <span class="co"># Everything after ": "</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract specific patterns</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">username =</span> <span class="fu">str_extract</span>(message, <span class="st">"User (</span><span class="sc">\\</span><span class="st">w+)"</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">"User "</span>),</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">ip_address =</span> <span class="fu">str_extract</span>(message, <span class="st">"</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_path =</span> <span class="fu">str_extract</span>(message, <span class="st">"/[</span><span class="sc">\\</span><span class="st">w/</span><span class="sc">\\</span><span class="st">.]+"</span>),</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">duration =</span> <span class="fu">str_extract</span>(message, <span class="st">"</span><span class="sc">\\</span><span class="st">d+s"</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">"s"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>parsed_logs <span class="sc">%&gt;%</span></span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>log) <span class="sc">%&gt;%</span>  <span class="co"># Remove original for display</span></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 x 7
  timestamp           level   message     username ip_address file_path duration
  &lt;dttm&gt;              &lt;chr&gt;   &lt;chr&gt;       &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;        &lt;dbl&gt;
1 2023-06-15 10:30:45 INFO    User john_~ john_doe 192.168.1~ &lt;NA&gt;            NA
2 2023-06-15 10:31:02 ERROR   Database c~ &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;            30
3 2023-06-15 10:31:15 WARNING High memor~ &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;            NA
4 2023-06-15 10:32:00 INFO    Backup com~ &lt;NA&gt;     &lt;NA&gt;       &lt;NA&gt;            NA
5 2023-06-15 10:33:21 ERROR   File not f~ &lt;NA&gt;     &lt;NA&gt;       /data/co~       NA</code></pre>
</div>
</div>
</section>
<section id="text-normalization-and-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="text-normalization-and-cleaning">Text Normalization and Cleaning</h3>
<p>Real text data needs extensive cleaning:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Messy product descriptions</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>messy_products <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Apple iPhone 14 Pro Max - 256GB - Space Black!!!"</span>,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"samsung galaxy s23 ultra 512gb phantom black"</span>,</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Google Pixel 7 Pro (128 GB) -- Obsidian"</span>,</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OnePlus 11 5G | 16GB RAM | 256GB Storage"</span>,</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"  Xiaomi 13 Pro    256GB/12GB    Ceramic Black  "</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Comprehensive cleaning pipeline</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>clean_products <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">original =</span> messy_products) <span class="sc">%&gt;%</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 1: Basic cleaning</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">cleaned =</span> <span class="fu">str_trim</span>(original) <span class="sc">%&gt;%</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_squish</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove_all</span>(<span class="st">"!!!|</span><span class="sc">\\</span><span class="st">||--"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>, <span class="st">" "</span>),</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 2: Extract components</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">brand =</span> <span class="fu">str_extract</span>(cleaned, <span class="st">"^</span><span class="sc">\\</span><span class="st">w+"</span>) <span class="sc">%&gt;%</span> <span class="fu">str_to_title</span>(),</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">storage =</span> <span class="fu">str_extract</span>(cleaned, <span class="st">"</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">s*GB"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_to_upper</span>(),</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">ram =</span> <span class="fu">str_extract</span>(cleaned, <span class="st">"</span><span class="sc">\\</span><span class="st">d+GB</span><span class="sc">\\</span><span class="st">s*RAM|RAM</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+GB"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_extract</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"GB"</span>),</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">str_extract</span>(cleaned, </span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Space Black|Phantom Black|Obsidian|Ceramic Black"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_to_title</span>(),</span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 3: Standardized format</span></span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">standardized =</span> <span class="fu">str_glue</span>(<span class="st">"{brand} - {storage} Storage - {color}"</span>)</span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb61-37"><a href="#cb61-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-38"><a href="#cb61-38" aria-hidden="true" tabindex="-1"></a>clean_products <span class="sc">%&gt;%</span></span>
<span id="cb61-39"><a href="#cb61-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(original, standardized)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 x 2
  original                                           standardized               
  &lt;chr&gt;                                              &lt;glue&gt;                     
1 "Apple iPhone 14 Pro Max - 256GB - Space Black!!!" Apple - 256GB Storage - Sp~
2 "samsung galaxy s23 ultra 512gb phantom black"     Samsung - NA Storage - NA  
3 "Google Pixel 7 Pro (128 GB) -- Obsidian"          Google - 128GB Storage - O~
4 "OnePlus 11 5G | 16GB RAM | 256GB Storage"         Oneplus - 16GB Storage - NA
5 "  Xiaomi 13 Pro    256GB/12GB    Ceramic Black  " Xiaomi - 256GB Storage - C~</code></pre>
</div>
</div>
</section>
</section>
<section id="working-with-date-ranges-and-business-logic" class="level2">
<h2 class="anchored" data-anchor-id="working-with-date-ranges-and-business-logic">Working with Date Ranges and Business Logic</h2>
<p>Real-world applications often involve complex date logic:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Business calendar functions</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>is_business_day <span class="ot">&lt;-</span> <span class="cf">function</span>(date) {</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">wday</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>)  <span class="co"># Not weekend</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>next_business_day <span class="ot">&lt;-</span> <span class="cf">function</span>(date) {</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  next_day <span class="ot">&lt;-</span> date <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="sc">!</span><span class="fu">is_business_day</span>(next_day)) {</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    next_day <span class="ot">&lt;-</span> next_day <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(next_day)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>add_business_days <span class="ot">&lt;-</span> <span class="cf">function</span>(date, n) {</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> date</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">next_business_day</span>(result)</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Project timeline</span></span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>project_tasks <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">task =</span> <span class="fu">c</span>(<span class="st">"Planning"</span>, <span class="st">"Development"</span>, <span class="st">"Testing"</span>, <span class="st">"Deployment"</span>, <span class="st">"Review"</span>),</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">duration_days =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">10</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">start_date =</span> <span class="fu">ymd</span>(<span class="st">"2023-07-03"</span>)  <span class="co"># Starting on a Monday</span></span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate end dates considering only business days</span></span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a>project_timeline <span class="ot">&lt;-</span> project_tasks <span class="sc">%&gt;%</span></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simple calendar days</span></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_date_calendar =</span> start_date <span class="sc">+</span> <span class="fu">days</span>(duration_days <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Business days only</span></span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_date_business =</span> <span class="fu">map2</span>(start_date, duration_days, </span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">~</span><span class="fu">add_business_days</span>(.x, .y <span class="sc">-</span> <span class="dv">1</span>)),</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_date_business =</span> <span class="fu">as_date</span>(<span class="fu">unlist</span>(end_date_business)),</span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Actual duration including weekends</span></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">actual_calendar_days =</span> <span class="fu">as.numeric</span>(end_date_business <span class="sc">-</span> start_date <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Next task start</span></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">next_start =</span> <span class="fu">lead</span>(end_date_business) <span class="sc">%&gt;%</span> </span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">map_if</span>(<span class="sc">~!</span><span class="fu">is.na</span>(.), <span class="sc">~</span><span class="fu">next_business_day</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_date</span>()</span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a>project_timeline <span class="sc">%&gt;%</span></span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(task, duration_days, start_date, end_date_business, actual_calendar_days)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 x 5
  task        duration_days start_date end_date_business actual_calendar_days
  &lt;chr&gt;               &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;                           &lt;dbl&gt;
1 Planning                5 2023-07-03 2023-07-07                           5
2 Development            15 2023-07-03 2023-07-21                          19
3 Testing                10 2023-07-03 2023-07-14                          12
4 Deployment              2 2023-07-03 2023-07-04                           2
5 Review                  3 2023-07-03 2023-07-05                           3</code></pre>
</div>
</div>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<section id="exercise-1-email-parsing-and-validation" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1-email-parsing-and-validation">Exercise 1: Email Parsing and Validation</h3>
<p>Parse and validate a set of email addresses:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>email_data <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"john.doe@company.com"</span>,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"alice_smith@university.edu"</span>,</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bob@sub.domain.co.uk"</span>,</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"invalid.email"</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"no-at-sign.com"</span>,</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"@missing-user.com"</span>,</span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"user@"</span>,</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"first.last+tag@gmail.com"</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>email_validation <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">email =</span> email_data) <span class="sc">%&gt;%</span></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check basic structure</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_at =</span> <span class="fu">str_detect</span>(email, <span class="st">"@"</span>),</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_dot_after_at =</span> <span class="fu">str_detect</span>(email, <span class="st">"@.*</span><span class="sc">\\</span><span class="st">."</span>),</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract parts</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">username =</span> <span class="fu">str_extract</span>(email, <span class="st">"^[^@]+"</span>),</span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">domain =</span> <span class="fu">str_extract</span>(email, <span class="st">"@(.+)$"</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">"@"</span>),</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">tld =</span> <span class="fu">str_extract</span>(email, <span class="st">"</span><span class="sc">\\</span><span class="st">.[a-z]+$"</span>),</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate</span></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">valid_username =</span> <span class="fu">str_detect</span>(username, <span class="st">"^[a-zA-Z0-9._+-]+$"</span>),</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">valid_domain =</span> <span class="fu">str_detect</span>(domain, <span class="st">"^[a-zA-Z0-9.-]+</span><span class="sc">\\</span><span class="st">.[a-zA-Z]{2,}$"</span>),</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overall validity</span></span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid =</span> has_at <span class="sc">&amp;</span> has_dot_after_at <span class="sc">&amp;</span> </span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>               <span class="sc">!</span><span class="fu">is.na</span>(username) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(domain) <span class="sc">&amp;</span></span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>               valid_username <span class="sc">&amp;</span> valid_domain</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>email_validation <span class="sc">%&gt;%</span></span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(email, username, domain, is_valid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 x 4
  email                      username       domain           is_valid
  &lt;chr&gt;                      &lt;chr&gt;          &lt;chr&gt;            &lt;lgl&gt;   
1 john.doe@company.com       john.doe       company.com      TRUE    
2 alice_smith@university.edu alice_smith    university.edu   TRUE    
3 bob@sub.domain.co.uk       bob            sub.domain.co.uk TRUE    
4 invalid.email              invalid.email  &lt;NA&gt;             FALSE   
5 no-at-sign.com             no-at-sign.com &lt;NA&gt;             FALSE   
6 @missing-user.com          &lt;NA&gt;           missing-user.com FALSE   
7 user@                      user           &lt;NA&gt;             FALSE   
8 first.last+tag@gmail.com   first.last+tag gmail.com        TRUE    </code></pre>
</div>
</div>
</section>
<section id="exercise-2-date-range-calculations" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2-date-range-calculations">Exercise 2: Date Range Calculations</h3>
<p>Calculate various date ranges and intervals:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate age, next birthday, days until birthday</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>people <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>, <span class="st">"Diana"</span>),</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">birth_date =</span> <span class="fu">ymd</span>(<span class="fu">c</span>(<span class="st">"1990-03-15"</span>, <span class="st">"1985-07-22"</span>, <span class="st">"1995-12-01"</span>, <span class="st">"2000-01-30"</span>))</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>today_date <span class="ot">&lt;-</span> <span class="fu">today</span>()</span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a>people_ages <span class="ot">&lt;-</span> people <span class="sc">%&gt;%</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate age</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_years =</span> <span class="fu">interval</span>(birth_date, today_date) <span class="sc">/</span> <span class="fu">years</span>(<span class="dv">1</span>),</span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_exact =</span> <span class="fu">floor</span>(age_years),</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Next birthday</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">birthday_this_year =</span> <span class="st">`</span><span class="at">year&lt;-</span><span class="st">`</span>(birth_date, <span class="fu">year</span>(today_date)),</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">next_birthday =</span> <span class="fu">if_else</span>(</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>      birthday_this_year <span class="sc">&lt;</span> today_date,</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">year&lt;-</span><span class="st">`</span>(birth_date, <span class="fu">year</span>(today_date) <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>      birthday_this_year</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Days until birthday</span></span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">days_to_birthday =</span> <span class="fu">as.numeric</span>(next_birthday <span class="sc">-</span> today_date),</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Day of week for next birthday</span></span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">birthday_weekday =</span> <span class="fu">wday</span>(next_birthday, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">FALSE</span>)</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>people_ages <span class="sc">%&gt;%</span></span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, age_exact, next_birthday, days_to_birthday, birthday_weekday)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 x 5
  name    age_exact next_birthday days_to_birthday birthday_weekday
  &lt;chr&gt;       &lt;dbl&gt; &lt;date&gt;                   &lt;dbl&gt; &lt;ord&gt;           
1 Alice          35 2026-03-15                 165 Sunday          
2 Bob            40 2026-07-22                 294 Wednesday       
3 Charlie        29 2025-12-01                  61 Monday          
4 Diana          25 2026-01-30                 121 Friday          </code></pre>
</div>
</div>
</section>
<section id="exercise-3-log-file-analysis" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3-log-file-analysis">Exercise 3: Log File Analysis</h3>
<p>Analyze server log patterns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate sample log data</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>n_logs <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>log_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">timestamp =</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-06-01 00:00:00"</span>) <span class="sc">+</span> <span class="fu">seconds</span>(<span class="fu">sort</span>(<span class="fu">runif</span>(n_logs, <span class="dv">0</span>, <span class="dv">30</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">60</span>))),</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">level =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"INFO"</span>, <span class="st">"WARNING"</span>, <span class="st">"ERROR"</span>, <span class="st">"DEBUG"</span>), n_logs, </span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.15</span>, <span class="fl">0.05</span>)),</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">service =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"auth"</span>, <span class="st">"api"</span>, <span class="st">"database"</span>, <span class="st">"cache"</span>), n_logs, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">message =</span> <span class="fu">sample</span>(<span class="fu">c</span>(</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Request processed successfully"</span>,</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Connection timeout after 30s"</span>,</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Invalid authentication token"</span>,</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cache miss for key: user_123"</span>,</span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Database query took 1250ms"</span>,</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Rate limit exceeded for IP 192.168.1.1"</span></span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>  ), n_logs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_entry =</span> <span class="fu">str_glue</span>(<span class="st">"[{timestamp}] {level} [{service}]: {message}"</span>)</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb69-23"><a href="#cb69-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-24"><a href="#cb69-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze the logs</span></span>
<span id="cb69-25"><a href="#cb69-25" aria-hidden="true" tabindex="-1"></a>log_analysis <span class="ot">&lt;-</span> log_data <span class="sc">%&gt;%</span></span>
<span id="cb69-26"><a href="#cb69-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb69-27"><a href="#cb69-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as_date</span>(timestamp),</span>
<span id="cb69-28"><a href="#cb69-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour =</span> <span class="fu">hour</span>(timestamp),</span>
<span id="cb69-29"><a href="#cb69-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-30"><a href="#cb69-30" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract metrics from messages</span></span>
<span id="cb69-31"><a href="#cb69-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_timeout =</span> <span class="fu">str_detect</span>(message, <span class="st">"timeout"</span>),</span>
<span id="cb69-32"><a href="#cb69-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">timeout_duration =</span> <span class="fu">str_extract</span>(message, <span class="st">"</span><span class="sc">\\</span><span class="st">d+s"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb69-33"><a href="#cb69-33" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove</span>(<span class="st">"s"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb69-34"><a href="#cb69-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-35"><a href="#cb69-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_ip =</span> <span class="fu">str_detect</span>(message, <span class="st">"</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb69-36"><a href="#cb69-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">ip_address =</span> <span class="fu">str_extract</span>(message, <span class="st">"</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb69-37"><a href="#cb69-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-38"><a href="#cb69-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">query_time =</span> <span class="fu">str_extract</span>(message, <span class="st">"</span><span class="sc">\\</span><span class="st">d+ms"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb69-39"><a href="#cb69-39" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove</span>(<span class="st">"ms"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb69-40"><a href="#cb69-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb69-41"><a href="#cb69-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Categorize issues</span></span>
<span id="cb69-42"><a href="#cb69-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">issue_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb69-43"><a href="#cb69-43" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(message, <span class="st">"timeout|slow|took </span><span class="sc">\\</span><span class="st">d+ms"</span>) <span class="sc">~</span> <span class="st">"Performance"</span>,</span>
<span id="cb69-44"><a href="#cb69-44" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(message, <span class="st">"Invalid|error|failed"</span>) <span class="sc">~</span> <span class="st">"Error"</span>,</span>
<span id="cb69-45"><a href="#cb69-45" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(message, <span class="st">"exceeded|limit"</span>) <span class="sc">~</span> <span class="st">"Rate Limiting"</span>,</span>
<span id="cb69-46"><a href="#cb69-46" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Normal"</span></span>
<span id="cb69-47"><a href="#cb69-47" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb69-48"><a href="#cb69-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb69-49"><a href="#cb69-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-50"><a href="#cb69-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary by service and level</span></span>
<span id="cb69-51"><a href="#cb69-51" aria-hidden="true" tabindex="-1"></a>log_summary <span class="ot">&lt;-</span> log_analysis <span class="sc">%&gt;%</span></span>
<span id="cb69-52"><a href="#cb69-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(service, level) <span class="sc">%&gt;%</span></span>
<span id="cb69-53"><a href="#cb69-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb69-54"><a href="#cb69-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb69-55"><a href="#cb69-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_errors =</span> <span class="fu">mean</span>(issue_type <span class="sc">==</span> <span class="st">"Error"</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb69-56"><a href="#cb69-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_query_time =</span> <span class="fu">mean</span>(query_time, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb69-57"><a href="#cb69-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb69-58"><a href="#cb69-58" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb69-59"><a href="#cb69-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(service, level)</span>
<span id="cb69-60"><a href="#cb69-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-61"><a href="#cb69-61" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(log_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 16 x 5
   service  level   count pct_errors avg_query_time
   &lt;chr&gt;    &lt;chr&gt;   &lt;int&gt;      &lt;dbl&gt;          &lt;dbl&gt;
 1 api      DEBUG       8      25               NaN
 2 api      ERROR      48      25              1250
 3 api      INFO      122      16.4            1250
 4 api      WARNING    80      15              1250
 5 auth     DEBUG      11      18.2            1250
 6 auth     ERROR      34      14.7            1250
 7 auth     INFO      137      13.9            1250
 8 auth     WARNING    65      16.9            1250
 9 cache    DEBUG      13       0              1250
10 cache    ERROR      33      27.3            1250
11 cache    INFO      116      20.7            1250
12 cache    WARNING    81      18.5            1250
13 database DEBUG      15       6.67           1250
14 database ERROR      42       9.52           1250
15 database INFO      127      15.0            1250
16 database WARNING    68      23.5            1250</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Time pattern analysis</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>hourly_pattern <span class="ot">&lt;-</span> log_analysis <span class="sc">%&gt;%</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hour, level) <span class="sc">%&gt;%</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> count, <span class="at">color =</span> level)) <span class="sc">+</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"INFO"</span> <span class="ot">=</span> <span class="st">"green"</span>,</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"WARNING"</span> <span class="ot">=</span> <span class="st">"orange"</span>, </span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ERROR"</span> <span class="ot">=</span> <span class="st">"red"</span>,</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DEBUG"</span> <span class="ot">=</span> <span class="st">"blue"</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Log Patterns by Hour"</span>,</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Day"</span>,</span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Log Count"</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hourly_pattern)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-strings-dates_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exercise-4-text-mining-product-reviews" class="level3">
<h3 class="anchored" data-anchor-id="exercise-4-text-mining-product-reviews">Exercise 4: Text Mining Product Reviews</h3>
<p>Analyze product review text and dates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate sample review data</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>n_reviews <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>reviews <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">review_id =</span> <span class="dv">1</span><span class="sc">:</span>n_reviews,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">review_date =</span> <span class="fu">ymd</span>(<span class="st">"2023-01-01"</span>) <span class="sc">+</span> <span class="fu">days</span>(<span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">180</span>, n_reviews, <span class="at">replace =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">rating =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, n_reviews, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.35</span>, <span class="fl">0.3</span>)),</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">review_text =</span> <span class="fu">sample</span>(<span class="fu">c</span>(</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Great product! Highly recommend. Fast shipping too."</span>,</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Terrible quality. Broke after one day. Very disappointed."</span>,</span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Good value for money. Works as expected."</span>,</span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amazing! Best purchase ever! 10/10 would buy again!"</span>,</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Not bad, but not great either. Average product."</span>,</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Excellent customer service. Product is okay."</span>,</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Waste of money. Do not buy!"</span>,</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pretty good, some minor issues but overall satisfied."</span>,</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Perfect! Exactly what I needed. Five stars!"</span>,</span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Meh. Expected better for the price."</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>  ), n_reviews, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze reviews</span></span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>review_analysis <span class="ot">&lt;-</span> reviews <span class="sc">%&gt;%</span></span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Text length and complexity</span></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_length =</span> <span class="fu">str_length</span>(review_text),</span>
<span id="cb72-29"><a href="#cb72-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">word_count =</span> <span class="fu">str_count</span>(review_text, <span class="st">"</span><span class="sc">\\</span><span class="st">w+"</span>),</span>
<span id="cb72-30"><a href="#cb72-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">sentence_count =</span> <span class="fu">str_count</span>(review_text, <span class="st">"[.!?]"</span>),</span>
<span id="cb72-31"><a href="#cb72-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_word_length =</span> text_length <span class="sc">/</span> word_count,</span>
<span id="cb72-32"><a href="#cb72-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-33"><a href="#cb72-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sentiment indicators</span></span>
<span id="cb72-34"><a href="#cb72-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_positive =</span> <span class="fu">str_detect</span>(review_text, </span>
<span id="cb72-35"><a href="#cb72-35" aria-hidden="true" tabindex="-1"></a>      <span class="st">"(?i)great|excellent|amazing|perfect|love|best"</span>),</span>
<span id="cb72-36"><a href="#cb72-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_negative =</span> <span class="fu">str_detect</span>(review_text, </span>
<span id="cb72-37"><a href="#cb72-37" aria-hidden="true" tabindex="-1"></a>      <span class="st">"(?i)terrible|bad|worst|hate|disappoint|waste"</span>),</span>
<span id="cb72-38"><a href="#cb72-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-39"><a href="#cb72-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">exclamation_count =</span> <span class="fu">str_count</span>(review_text, <span class="st">"!"</span>),</span>
<span id="cb72-40"><a href="#cb72-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-41"><a href="#cb72-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time-based features</span></span>
<span id="cb72-42"><a href="#cb72-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">review_month =</span> <span class="fu">month</span>(review_date, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-43"><a href="#cb72-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">review_weekday =</span> <span class="fu">wday</span>(review_date, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb72-44"><a href="#cb72-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">days_since_launch =</span> <span class="fu">as.numeric</span>(review_date <span class="sc">-</span> <span class="fu">min</span>(review_date)),</span>
<span id="cb72-45"><a href="#cb72-45" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb72-46"><a href="#cb72-46" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Categorize sentiment</span></span>
<span id="cb72-47"><a href="#cb72-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">sentiment =</span> <span class="fu">case_when</span>(</span>
<span id="cb72-48"><a href="#cb72-48" aria-hidden="true" tabindex="-1"></a>      has_positive <span class="sc">&amp;</span> <span class="sc">!</span>has_negative <span class="sc">~</span> <span class="st">"Positive"</span>,</span>
<span id="cb72-49"><a href="#cb72-49" aria-hidden="true" tabindex="-1"></a>      has_negative <span class="sc">&amp;</span> <span class="sc">!</span>has_positive <span class="sc">~</span> <span class="st">"Negative"</span>,</span>
<span id="cb72-50"><a href="#cb72-50" aria-hidden="true" tabindex="-1"></a>      has_positive <span class="sc">&amp;</span> has_negative <span class="sc">~</span> <span class="st">"Mixed"</span>,</span>
<span id="cb72-51"><a href="#cb72-51" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Neutral"</span></span>
<span id="cb72-52"><a href="#cb72-52" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb72-53"><a href="#cb72-53" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb72-54"><a href="#cb72-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-55"><a href="#cb72-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between text features and rating</span></span>
<span id="cb72-56"><a href="#cb72-56" aria-hidden="true" tabindex="-1"></a>feature_correlation <span class="ot">&lt;-</span> review_analysis <span class="sc">%&gt;%</span></span>
<span id="cb72-57"><a href="#cb72-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb72-58"><a href="#cb72-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">cor_length_rating =</span> <span class="fu">cor</span>(text_length, rating),</span>
<span id="cb72-59"><a href="#cb72-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">cor_exclamation_rating =</span> <span class="fu">cor</span>(exclamation_count, rating),</span>
<span id="cb72-60"><a href="#cb72-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">cor_positive_rating =</span> <span class="fu">cor</span>(<span class="fu">as.numeric</span>(has_positive), rating),</span>
<span id="cb72-61"><a href="#cb72-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">cor_negative_rating =</span> <span class="fu">cor</span>(<span class="fu">as.numeric</span>(has_negative), rating)</span>
<span id="cb72-62"><a href="#cb72-62" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb72-63"><a href="#cb72-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-64"><a href="#cb72-64" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Feature correlations with rating:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Feature correlations with rating:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(feature_correlation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 4
  cor_length_rating cor_exclamation_rating cor_positive_rating
              &lt;dbl&gt;                  &lt;dbl&gt;               &lt;dbl&gt;
1           -0.0412                -0.0605             -0.0880
# i 1 more variable: cor_negative_rating &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sentiment vs actual rating</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>sentiment_accuracy <span class="ot">&lt;-</span> review_analysis <span class="sc">%&gt;%</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sentiment) <span class="sc">%&gt;%</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_rating =</span> <span class="fu">mean</span>(rating),</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Sentiment analysis accuracy:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Sentiment analysis accuracy:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sentiment_accuracy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 x 3
  sentiment avg_rating count
  &lt;chr&gt;          &lt;dbl&gt; &lt;int&gt;
1 Mixed           3.64    22
2 Negative        3.47    32
3 Neutral         3.77    64
4 Positive        3.41    82</code></pre>
</div>
</div>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>In this comprehensive chapter, you’ve mastered:</p>
<p>✅ <strong>String manipulation with stringr</strong> - Pattern matching and regular expressions - Text cleaning and standardization - String splitting and combining - Advanced text extraction</p>
<p>✅ <strong>Date and time handling with lubridate</strong> - Parsing various date formats - Date arithmetic and components - Time zones and daylight saving - Intervals, durations, and periods</p>
<p>✅ <strong>Combined analysis</strong> - Real-world text and temporal data - Log file parsing - Business date calculations - Pattern extraction and validation</p>
<p>Key takeaways: - Always validate and clean text data before analysis - Be explicit about time zones to avoid bugs - Regular expressions are powerful but need practice - Combine string and date operations for rich insights - Document your cleaning and parsing decisions</p>
</section>
<section id="whats-next" class="level2">
<h2 class="anchored" data-anchor-id="whats-next">What’s Next?</h2>
<p>Congratulations! You’ve completed all the fundamental tidyverse concepts from Block 1. Before moving to machine learning, we recommend taking our <strong><a href="./quiz-block-1.html">Block 1 Assessment</a></strong> to test your understanding of the core R and tidyverse concepts you’ve learned.</p>
<p>Once you’ve mastered these fundamentals, continue to <a href="./08-tidymodels-intro.html">Chapter 8</a> where we transition to machine learning with tidymodels, building on your data manipulation skills.</p>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<ul>
<li><a href="https://stringr.tidyverse.org/">stringr Documentation</a></li>
<li><a href="https://lubridate.tidyverse.org/">lubridate Documentation</a></li>
<li><a href="https://regex101.com/">Regular Expression Testing</a></li>
<li><a href="https://r4ds.had.co.nz/strings.html">R for Data Science - Strings</a></li>
<li><a href="https://r4ds.had.co.nz/dates-and-times.html">R for Data Science - Dates and Times</a></li>
<li><a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">Time Zone Database</a></li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Find all elements with class 'quarto-title-meta-heading' that contain "Author"
    const authorHeadings = document.querySelectorAll('.quarto-title-meta-heading');
    
    authorHeadings.forEach(function(heading) {
        if (heading.textContent.trim() === 'Author') {
            heading.textContent = 'Authors';
        }
    });
});
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb80" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Chapter 7: Working with Strings and Dates - Text and Time in the Tidyverse"</span></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "David Sarrat González, Juan R González"</span></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a>By the end of this chapter, you will master:</span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>String manipulation with stringr</span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pattern matching with regular expressions</span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Text cleaning and extraction</span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Date and time handling with lubridate</span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Time zone management</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Date arithmetic and intervals</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Combining text and temporal data in analyses</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Real-world applications and best practices</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a><span class="fu">## Why Strings and Dates Matter</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>In real-world data analysis, you'll rarely work with perfectly clean numeric data. Most datasets contain:</span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Text data**: Names, addresses, descriptions, categories, IDs</span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Temporal data**: Timestamps, dates, durations, time zones</span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>These data types are notoriously tricky to work with because:</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Text can be messy, inconsistent, and encoded differently</span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Dates come in countless formats</span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Time zones add complexity</span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Both require special handling for analysis</span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>The tidyverse provides powerful, consistent tools to tackle these challenges. Let's master them!</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setup</span></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-42"><a href="#cb80-42" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-43"><a href="#cb80-43" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: true</span></span>
<span id="cb80-44"><a href="#cb80-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb80-45"><a href="#cb80-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)  <span class="co"># For dates and times</span></span>
<span id="cb80-46"><a href="#cb80-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)    <span class="co"># For string manipulation (loaded with tidyverse)</span></span>
<span id="cb80-47"><a href="#cb80-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hms)        <span class="co"># For time-of-day values</span></span>
<span id="cb80-48"><a href="#cb80-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-49"><a href="#cb80-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb80-50"><a href="#cb80-50" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb80-51"><a href="#cb80-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-52"><a href="#cb80-52" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll create various example datasets throughout</span></span>
<span id="cb80-53"><a href="#cb80-53" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb80-54"><a href="#cb80-54" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-55"><a href="#cb80-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-56"><a href="#cb80-56" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 1: String Manipulation with stringr</span></span>
<span id="cb80-57"><a href="#cb80-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-58"><a href="#cb80-58" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding Strings in R</span></span>
<span id="cb80-59"><a href="#cb80-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-60"><a href="#cb80-60" aria-hidden="true" tabindex="-1"></a>Strings (text data) are fundamental to data analysis, but they're often the messiest part of our data. The <span class="in">`stringr`</span> package provides a consistent, intuitive interface for string manipulation.</span>
<span id="cb80-61"><a href="#cb80-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-62"><a href="#cb80-62" aria-hidden="true" tabindex="-1"></a>All stringr functions:</span>
<span id="cb80-63"><a href="#cb80-63" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Start with <span class="in">`str_`</span> for easy autocomplete</span>
<span id="cb80-64"><a href="#cb80-64" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Take the string as the first argument (pipe-friendly)</span>
<span id="cb80-65"><a href="#cb80-65" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Use consistent naming conventions</span>
<span id="cb80-66"><a href="#cb80-66" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Handle NA values gracefully</span>
<span id="cb80-67"><a href="#cb80-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-68"><a href="#cb80-68" aria-hidden="true" tabindex="-1"></a>Let's start with basic operations:</span>
<span id="cb80-69"><a href="#cb80-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-72"><a href="#cb80-72" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-73"><a href="#cb80-73" aria-hidden="true" tabindex="-1"></a><span class="co"># Create example strings</span></span>
<span id="cb80-74"><a href="#cb80-74" aria-hidden="true" tabindex="-1"></a>messy_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb80-75"><a href="#cb80-75" aria-hidden="true" tabindex="-1"></a>  <span class="st">"  John Smith  "</span>,</span>
<span id="cb80-76"><a href="#cb80-76" aria-hidden="true" tabindex="-1"></a>  <span class="st">"mary jones"</span>,</span>
<span id="cb80-77"><a href="#cb80-77" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ROBERT BROWN"</span>,</span>
<span id="cb80-78"><a href="#cb80-78" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Sarah O'Connor"</span>,</span>
<span id="cb80-79"><a href="#cb80-79" aria-hidden="true" tabindex="-1"></a>  <span class="st">"José García"</span>,</span>
<span id="cb80-80"><a href="#cb80-80" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span>,</span>
<span id="cb80-81"><a href="#cb80-81" aria-hidden="true" tabindex="-1"></a>  <span class="st">"anne-marie wilson"</span></span>
<span id="cb80-82"><a href="#cb80-82" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-83"><a href="#cb80-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-84"><a href="#cb80-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic string information</span></span>
<span id="cb80-85"><a href="#cb80-85" aria-hidden="true" tabindex="-1"></a><span class="fu">str_length</span>(messy_names)  <span class="co"># Length of each string</span></span>
<span id="cb80-86"><a href="#cb80-86" aria-hidden="true" tabindex="-1"></a><span class="fu">str_count</span>(messy_names, <span class="at">pattern =</span> <span class="st">" "</span>)  <span class="co"># Count spaces</span></span>
<span id="cb80-87"><a href="#cb80-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-88"><a href="#cb80-88" aria-hidden="true" tabindex="-1"></a><span class="co"># The power of vectorization - operations work on entire vectors</span></span>
<span id="cb80-89"><a href="#cb80-89" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb80-90"><a href="#cb80-90" aria-hidden="true" tabindex="-1"></a>  <span class="at">original =</span> messy_names,</span>
<span id="cb80-91"><a href="#cb80-91" aria-hidden="true" tabindex="-1"></a>  <span class="at">length =</span> <span class="fu">str_length</span>(messy_names),</span>
<span id="cb80-92"><a href="#cb80-92" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_spaces =</span> <span class="fu">str_count</span>(messy_names, <span class="st">" "</span>),</span>
<span id="cb80-93"><a href="#cb80-93" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_vowels =</span> <span class="fu">str_count</span>(messy_names, <span class="st">"[aeiouAEIOU]"</span>)</span>
<span id="cb80-94"><a href="#cb80-94" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-95"><a href="#cb80-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-96"><a href="#cb80-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-97"><a href="#cb80-97" aria-hidden="true" tabindex="-1"></a>Notice how stringr handles NA values gracefully - operations on NA return NA rather than erroring out. This is crucial for real-world data processing.</span>
<span id="cb80-98"><a href="#cb80-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-99"><a href="#cb80-99" aria-hidden="true" tabindex="-1"></a><span class="fu">### String Transformation</span></span>
<span id="cb80-100"><a href="#cb80-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-101"><a href="#cb80-101" aria-hidden="true" tabindex="-1"></a>Let's clean up our messy names systematically:</span>
<span id="cb80-102"><a href="#cb80-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-105"><a href="#cb80-105" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-106"><a href="#cb80-106" aria-hidden="true" tabindex="-1"></a><span class="co"># Step-by-step cleaning</span></span>
<span id="cb80-107"><a href="#cb80-107" aria-hidden="true" tabindex="-1"></a>cleaned_names <span class="ot">&lt;-</span> messy_names <span class="sc">%&gt;%</span></span>
<span id="cb80-108"><a href="#cb80-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_trim</span>() <span class="sc">%&gt;%</span>                    <span class="co"># Remove leading/trailing whitespace</span></span>
<span id="cb80-109"><a href="#cb80-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_squish</span>() <span class="sc">%&gt;%</span>                  <span class="co"># Remove extra internal whitespace</span></span>
<span id="cb80-110"><a href="#cb80-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_to_title</span>() <span class="sc">%&gt;%</span>                <span class="co"># Proper case (Title Case)</span></span>
<span id="cb80-111"><a href="#cb80-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace_all</span>(<span class="st">"'"</span>, <span class="st">"'"</span>)         <span class="co"># Standardize apostrophes</span></span>
<span id="cb80-112"><a href="#cb80-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-113"><a href="#cb80-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare before and after</span></span>
<span id="cb80-114"><a href="#cb80-114" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb80-115"><a href="#cb80-115" aria-hidden="true" tabindex="-1"></a>  <span class="at">original =</span> messy_names,</span>
<span id="cb80-116"><a href="#cb80-116" aria-hidden="true" tabindex="-1"></a>  <span class="at">cleaned =</span> cleaned_names</span>
<span id="cb80-117"><a href="#cb80-117" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb80-118"><a href="#cb80-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb80-119"><a href="#cb80-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-120"><a href="#cb80-120" aria-hidden="true" tabindex="-1"></a><span class="co"># Other case transformations</span></span>
<span id="cb80-121"><a href="#cb80-121" aria-hidden="true" tabindex="-1"></a>case_examples <span class="ot">&lt;-</span> <span class="st">"The Quick BROWN Fox"</span></span>
<span id="cb80-122"><a href="#cb80-122" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb80-123"><a href="#cb80-123" aria-hidden="true" tabindex="-1"></a>  <span class="at">original =</span> case_examples,</span>
<span id="cb80-124"><a href="#cb80-124" aria-hidden="true" tabindex="-1"></a>  <span class="at">lower =</span> <span class="fu">str_to_lower</span>(case_examples),</span>
<span id="cb80-125"><a href="#cb80-125" aria-hidden="true" tabindex="-1"></a>  <span class="at">upper =</span> <span class="fu">str_to_upper</span>(case_examples),</span>
<span id="cb80-126"><a href="#cb80-126" aria-hidden="true" tabindex="-1"></a>  <span class="at">title =</span> <span class="fu">str_to_title</span>(case_examples),</span>
<span id="cb80-127"><a href="#cb80-127" aria-hidden="true" tabindex="-1"></a>  <span class="at">sentence =</span> <span class="fu">str_to_sentence</span>(case_examples)</span>
<span id="cb80-128"><a href="#cb80-128" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-129"><a href="#cb80-129" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-130"><a href="#cb80-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-131"><a href="#cb80-131" aria-hidden="true" tabindex="-1"></a>Each transformation serves a specific purpose:</span>
<span id="cb80-132"><a href="#cb80-132" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`str_trim()`</span>: Removes accidental spaces from data entry</span>
<span id="cb80-133"><a href="#cb80-133" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`str_squish()`</span>: Fixes multiple spaces between words</span>
<span id="cb80-134"><a href="#cb80-134" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`str_to_title()`</span>: Standardizes capitalization for names</span>
<span id="cb80-135"><a href="#cb80-135" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`str_replace_all()`</span>: Fixes encoding issues with special characters</span>
<span id="cb80-136"><a href="#cb80-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-137"><a href="#cb80-137" aria-hidden="true" tabindex="-1"></a><span class="fu">### Pattern Matching and Regular Expressions</span></span>
<span id="cb80-138"><a href="#cb80-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-139"><a href="#cb80-139" aria-hidden="true" tabindex="-1"></a>Regular expressions (regex) are powerful pattern-matching tools. While they look cryptic at first, they're invaluable for text processing.</span>
<span id="cb80-140"><a href="#cb80-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-143"><a href="#cb80-143" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-144"><a href="#cb80-144" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample text data</span></span>
<span id="cb80-145"><a href="#cb80-145" aria-hidden="true" tabindex="-1"></a>emails <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb80-146"><a href="#cb80-146" aria-hidden="true" tabindex="-1"></a>  <span class="st">"john.doe@company.com"</span>,</span>
<span id="cb80-147"><a href="#cb80-147" aria-hidden="true" tabindex="-1"></a>  <span class="st">"alice@university.edu"</span>,</span>
<span id="cb80-148"><a href="#cb80-148" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bob.smith@email.co.uk"</span>,</span>
<span id="cb80-149"><a href="#cb80-149" aria-hidden="true" tabindex="-1"></a>  <span class="st">"invalid-email"</span>,</span>
<span id="cb80-150"><a href="#cb80-150" aria-hidden="true" tabindex="-1"></a>  <span class="st">"another@domain.org"</span>,</span>
<span id="cb80-151"><a href="#cb80-151" aria-hidden="true" tabindex="-1"></a>  <span class="st">"not an email at all"</span>,</span>
<span id="cb80-152"><a href="#cb80-152" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span></span>
<span id="cb80-153"><a href="#cb80-153" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-154"><a href="#cb80-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-155"><a href="#cb80-155" aria-hidden="true" tabindex="-1"></a><span class="co"># Detect patterns</span></span>
<span id="cb80-156"><a href="#cb80-156" aria-hidden="true" tabindex="-1"></a>has_at <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(emails, <span class="st">"@"</span>)  <span class="co"># Simple pattern</span></span>
<span id="cb80-157"><a href="#cb80-157" aria-hidden="true" tabindex="-1"></a>has_dot_com <span class="ot">&lt;-</span> <span class="fu">str_detect</span>(emails, <span class="st">"</span><span class="sc">\\</span><span class="st">.com$"</span>)  <span class="co"># .com at end ($ = end of string)</span></span>
<span id="cb80-158"><a href="#cb80-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-159"><a href="#cb80-159" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract patterns</span></span>
<span id="cb80-160"><a href="#cb80-160" aria-hidden="true" tabindex="-1"></a>domains <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(emails, <span class="st">"@[^.]+</span><span class="sc">\\</span><span class="st">.[a-z]+"</span>)  <span class="co"># Extract domain</span></span>
<span id="cb80-161"><a href="#cb80-161" aria-hidden="true" tabindex="-1"></a>usernames <span class="ot">&lt;-</span> <span class="fu">str_extract</span>(emails, <span class="st">"^[^@]+"</span>)  <span class="co"># Everything before @</span></span>
<span id="cb80-162"><a href="#cb80-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-163"><a href="#cb80-163" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a summary</span></span>
<span id="cb80-164"><a href="#cb80-164" aria-hidden="true" tabindex="-1"></a>email_analysis <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-165"><a href="#cb80-165" aria-hidden="true" tabindex="-1"></a>  <span class="at">email =</span> emails,</span>
<span id="cb80-166"><a href="#cb80-166" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_valid =</span> <span class="fu">str_detect</span>(emails, <span class="st">"^[^@]+@[^@]+</span><span class="sc">\\</span><span class="st">.[^@]+$"</span>),</span>
<span id="cb80-167"><a href="#cb80-167" aria-hidden="true" tabindex="-1"></a>  <span class="at">username =</span> usernames,</span>
<span id="cb80-168"><a href="#cb80-168" aria-hidden="true" tabindex="-1"></a>  <span class="at">domain =</span> <span class="fu">str_remove</span>(domains, <span class="st">"@"</span>),</span>
<span id="cb80-169"><a href="#cb80-169" aria-hidden="true" tabindex="-1"></a>  <span class="at">tld =</span> <span class="fu">str_extract</span>(emails, <span class="st">"</span><span class="sc">\\</span><span class="st">.[a-z]+$"</span>)</span>
<span id="cb80-170"><a href="#cb80-170" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-171"><a href="#cb80-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-172"><a href="#cb80-172" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(email_analysis)</span>
<span id="cb80-173"><a href="#cb80-173" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-174"><a href="#cb80-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-175"><a href="#cb80-175" aria-hidden="true" tabindex="-1"></a>Let's break down these regex patterns:</span>
<span id="cb80-176"><a href="#cb80-176" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`@`</span> - Literal @ symbol</span>
<span id="cb80-177"><a href="#cb80-177" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`\\.`</span> - Literal period (. alone means "any character")</span>
<span id="cb80-178"><a href="#cb80-178" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`^`</span> - Start of string</span>
<span id="cb80-179"><a href="#cb80-179" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`$`</span> - End of string</span>
<span id="cb80-180"><a href="#cb80-180" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`[^@]+`</span> - One or more characters that are NOT @</span>
<span id="cb80-181"><a href="#cb80-181" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`[a-z]+`</span> - One or more lowercase letters</span>
<span id="cb80-182"><a href="#cb80-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-183"><a href="#cb80-183" aria-hidden="true" tabindex="-1"></a><span class="fu">### Advanced Pattern Matching</span></span>
<span id="cb80-184"><a href="#cb80-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-185"><a href="#cb80-185" aria-hidden="true" tabindex="-1"></a>Let's work with more complex patterns:</span>
<span id="cb80-186"><a href="#cb80-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-189"><a href="#cb80-189" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-190"><a href="#cb80-190" aria-hidden="true" tabindex="-1"></a><span class="co"># Phone numbers in various formats</span></span>
<span id="cb80-191"><a href="#cb80-191" aria-hidden="true" tabindex="-1"></a>phone_numbers <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb80-192"><a href="#cb80-192" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(555) 123-4567"</span>,</span>
<span id="cb80-193"><a href="#cb80-193" aria-hidden="true" tabindex="-1"></a>  <span class="st">"555-123-4567"</span>,</span>
<span id="cb80-194"><a href="#cb80-194" aria-hidden="true" tabindex="-1"></a>  <span class="st">"5551234567"</span>,</span>
<span id="cb80-195"><a href="#cb80-195" aria-hidden="true" tabindex="-1"></a>  <span class="st">"555.123.4567"</span>,</span>
<span id="cb80-196"><a href="#cb80-196" aria-hidden="true" tabindex="-1"></a>  <span class="st">"+1 555 123 4567"</span>,</span>
<span id="cb80-197"><a href="#cb80-197" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Call me at 555-1234"</span>,</span>
<span id="cb80-198"><a href="#cb80-198" aria-hidden="true" tabindex="-1"></a>  <span class="st">"invalid"</span>,</span>
<span id="cb80-199"><a href="#cb80-199" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NA</span></span>
<span id="cb80-200"><a href="#cb80-200" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-201"><a href="#cb80-201" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-202"><a href="#cb80-202" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract digits only</span></span>
<span id="cb80-203"><a href="#cb80-203" aria-hidden="true" tabindex="-1"></a>digits_only <span class="ot">&lt;-</span> <span class="fu">str_remove_all</span>(phone_numbers, <span class="st">"[^0-9]"</span>)</span>
<span id="cb80-204"><a href="#cb80-204" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(digits_only)</span>
<span id="cb80-205"><a href="#cb80-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-206"><a href="#cb80-206" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize format</span></span>
<span id="cb80-207"><a href="#cb80-207" aria-hidden="true" tabindex="-1"></a>standardized <span class="ot">&lt;-</span> phone_numbers <span class="sc">%&gt;%</span></span>
<span id="cb80-208"><a href="#cb80-208" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_remove_all</span>(<span class="st">"[^0-9]"</span>) <span class="sc">%&gt;%</span>  <span class="co"># Remove non-digits</span></span>
<span id="cb80-209"><a href="#cb80-209" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">"^1"</span>, <span class="st">""</span>) <span class="sc">%&gt;%</span>      <span class="co"># Remove leading 1</span></span>
<span id="cb80-210"><a href="#cb80-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">str_replace</span>(<span class="st">"(</span><span class="sc">\\</span><span class="st">d{3})(</span><span class="sc">\\</span><span class="st">d{3})(</span><span class="sc">\\</span><span class="st">d{4})"</span>, <span class="st">"(</span><span class="sc">\\</span><span class="st">1) </span><span class="sc">\\</span><span class="st">2-</span><span class="sc">\\</span><span class="st">3"</span>)  <span class="co"># Format</span></span>
<span id="cb80-211"><a href="#cb80-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-212"><a href="#cb80-212" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb80-213"><a href="#cb80-213" aria-hidden="true" tabindex="-1"></a>  <span class="at">original =</span> phone_numbers,</span>
<span id="cb80-214"><a href="#cb80-214" aria-hidden="true" tabindex="-1"></a>  <span class="at">standardized =</span> standardized</span>
<span id="cb80-215"><a href="#cb80-215" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-216"><a href="#cb80-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-217"><a href="#cb80-217" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract structured information</span></span>
<span id="cb80-218"><a href="#cb80-218" aria-hidden="true" tabindex="-1"></a>addresses <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb80-219"><a href="#cb80-219" aria-hidden="true" tabindex="-1"></a>  <span class="st">"123 Main St, New York, NY 10001"</span>,</span>
<span id="cb80-220"><a href="#cb80-220" aria-hidden="true" tabindex="-1"></a>  <span class="st">"456 Oak Avenue, Los Angeles, CA 90028"</span>,</span>
<span id="cb80-221"><a href="#cb80-221" aria-hidden="true" tabindex="-1"></a>  <span class="st">"789 Elm Rd, Chicago, IL 60601"</span>,</span>
<span id="cb80-222"><a href="#cb80-222" aria-hidden="true" tabindex="-1"></a>  <span class="st">"321 Pine Street, Houston, TX 77002"</span></span>
<span id="cb80-223"><a href="#cb80-223" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-224"><a href="#cb80-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-225"><a href="#cb80-225" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract components using regex groups</span></span>
<span id="cb80-226"><a href="#cb80-226" aria-hidden="true" tabindex="-1"></a>address_parts <span class="ot">&lt;-</span> <span class="fu">str_match</span>(addresses, </span>
<span id="cb80-227"><a href="#cb80-227" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(</span><span class="sc">\\</span><span class="st">d+) ([^,]+), ([^,]+), ([A-Z]{2}) (</span><span class="sc">\\</span><span class="st">d{5})"</span>)</span>
<span id="cb80-228"><a href="#cb80-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-229"><a href="#cb80-229" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(address_parts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"full"</span>, <span class="st">"number"</span>, <span class="st">"street"</span>, <span class="st">"city"</span>, <span class="st">"state"</span>, <span class="st">"zip"</span>)</span>
<span id="cb80-230"><a href="#cb80-230" aria-hidden="true" tabindex="-1"></a><span class="fu">as_tibble</span>(address_parts) <span class="sc">%&gt;%</span></span>
<span id="cb80-231"><a href="#cb80-231" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>full)  <span class="co"># Remove the full match column</span></span>
<span id="cb80-232"><a href="#cb80-232" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-233"><a href="#cb80-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-234"><a href="#cb80-234" aria-hidden="true" tabindex="-1"></a>The power of regex groups (parentheses) is that they let us extract multiple pieces of information in one operation. Each group becomes a separate column in the output.</span>
<span id="cb80-235"><a href="#cb80-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-236"><a href="#cb80-236" aria-hidden="true" tabindex="-1"></a><span class="fu">### String Splitting and Combining</span></span>
<span id="cb80-237"><a href="#cb80-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-238"><a href="#cb80-238" aria-hidden="true" tabindex="-1"></a>Real data often requires splitting combined fields or joining separate ones:</span>
<span id="cb80-239"><a href="#cb80-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-242"><a href="#cb80-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-243"><a href="#cb80-243" aria-hidden="true" tabindex="-1"></a><span class="co"># Full names that need splitting</span></span>
<span id="cb80-244"><a href="#cb80-244" aria-hidden="true" tabindex="-1"></a>full_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb80-245"><a href="#cb80-245" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Smith, John"</span>,</span>
<span id="cb80-246"><a href="#cb80-246" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Jones, Mary Ann"</span>,</span>
<span id="cb80-247"><a href="#cb80-247" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Brown Jr., Robert"</span>,</span>
<span id="cb80-248"><a href="#cb80-248" aria-hidden="true" tabindex="-1"></a>  <span class="st">"O'Connor, Sarah"</span>,</span>
<span id="cb80-249"><a href="#cb80-249" aria-hidden="true" tabindex="-1"></a>  <span class="st">"García-López, José María"</span></span>
<span id="cb80-250"><a href="#cb80-250" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-251"><a href="#cb80-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-252"><a href="#cb80-252" aria-hidden="true" tabindex="-1"></a><span class="co"># Split on comma and clean up</span></span>
<span id="cb80-253"><a href="#cb80-253" aria-hidden="true" tabindex="-1"></a>name_parts <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(full_names, <span class="st">", "</span>, <span class="at">n =</span> <span class="dv">2</span>)</span>
<span id="cb80-254"><a href="#cb80-254" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(name_parts) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"last_name"</span>, <span class="st">"first_name"</span>)</span>
<span id="cb80-255"><a href="#cb80-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-256"><a href="#cb80-256" aria-hidden="true" tabindex="-1"></a>name_df <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(name_parts) <span class="sc">%&gt;%</span></span>
<span id="cb80-257"><a href="#cb80-257" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-258"><a href="#cb80-258" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean up any extra spaces</span></span>
<span id="cb80-259"><a href="#cb80-259" aria-hidden="true" tabindex="-1"></a>    <span class="at">first_name =</span> <span class="fu">str_trim</span>(first_name),</span>
<span id="cb80-260"><a href="#cb80-260" aria-hidden="true" tabindex="-1"></a>    <span class="at">last_name =</span> <span class="fu">str_trim</span>(last_name),</span>
<span id="cb80-261"><a href="#cb80-261" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create display name</span></span>
<span id="cb80-262"><a href="#cb80-262" aria-hidden="true" tabindex="-1"></a>    <span class="at">display_name =</span> <span class="fu">str_c</span>(first_name, <span class="st">" "</span>, last_name),</span>
<span id="cb80-263"><a href="#cb80-263" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create email-friendly version</span></span>
<span id="cb80-264"><a href="#cb80-264" aria-hidden="true" tabindex="-1"></a>    <span class="at">email_name =</span> <span class="fu">str_c</span>(</span>
<span id="cb80-265"><a href="#cb80-265" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_to_lower</span>(<span class="fu">str_extract</span>(first_name, <span class="st">"</span><span class="sc">\\</span><span class="st">w+"</span>)),  <span class="co"># First word only</span></span>
<span id="cb80-266"><a href="#cb80-266" aria-hidden="true" tabindex="-1"></a>      <span class="st">"."</span>,</span>
<span id="cb80-267"><a href="#cb80-267" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_to_lower</span>(<span class="fu">str_replace_all</span>(last_name, <span class="st">"[^a-zA-Z]"</span>, <span class="st">""</span>)),  <span class="co"># Letters only</span></span>
<span id="cb80-268"><a href="#cb80-268" aria-hidden="true" tabindex="-1"></a>      <span class="st">"@company.com"</span></span>
<span id="cb80-269"><a href="#cb80-269" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb80-270"><a href="#cb80-270" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-271"><a href="#cb80-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-272"><a href="#cb80-272" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(name_df)</span>
<span id="cb80-273"><a href="#cb80-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-274"><a href="#cb80-274" aria-hidden="true" tabindex="-1"></a><span class="co"># Combining multiple fields</span></span>
<span id="cb80-275"><a href="#cb80-275" aria-hidden="true" tabindex="-1"></a>product_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-276"><a href="#cb80-276" aria-hidden="true" tabindex="-1"></a>  <span class="at">brand =</span> <span class="fu">c</span>(<span class="st">"Apple"</span>, <span class="st">"Samsung"</span>, <span class="st">"Google"</span>),</span>
<span id="cb80-277"><a href="#cb80-277" aria-hidden="true" tabindex="-1"></a>  <span class="at">model =</span> <span class="fu">c</span>(<span class="st">"iPhone"</span>, <span class="st">"Galaxy"</span>, <span class="st">"Pixel"</span>),</span>
<span id="cb80-278"><a href="#cb80-278" aria-hidden="true" tabindex="-1"></a>  <span class="at">version =</span> <span class="fu">c</span>(<span class="st">"14 Pro"</span>, <span class="st">"S23"</span>, <span class="st">"7a"</span>),</span>
<span id="cb80-279"><a href="#cb80-279" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2022</span>, <span class="dv">2023</span>, <span class="dv">2023</span>)</span>
<span id="cb80-280"><a href="#cb80-280" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-281"><a href="#cb80-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-282"><a href="#cb80-282" aria-hidden="true" tabindex="-1"></a>product_data <span class="sc">%&gt;%</span></span>
<span id="cb80-283"><a href="#cb80-283" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-284"><a href="#cb80-284" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Various ways to combine</span></span>
<span id="cb80-285"><a href="#cb80-285" aria-hidden="true" tabindex="-1"></a>    <span class="at">full_name =</span> <span class="fu">str_c</span>(brand, model, version, <span class="at">sep =</span> <span class="st">" "</span>),</span>
<span id="cb80-286"><a href="#cb80-286" aria-hidden="true" tabindex="-1"></a>    <span class="at">sku =</span> <span class="fu">str_c</span>(</span>
<span id="cb80-287"><a href="#cb80-287" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_to_upper</span>(<span class="fu">str_sub</span>(brand, <span class="dv">1</span>, <span class="dv">3</span>)),  <span class="co"># First 3 letters of brand</span></span>
<span id="cb80-288"><a href="#cb80-288" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_extract</span>(version, <span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>),         <span class="co"># Version number</span></span>
<span id="cb80-289"><a href="#cb80-289" aria-hidden="true" tabindex="-1"></a>      year,</span>
<span id="cb80-290"><a href="#cb80-290" aria-hidden="true" tabindex="-1"></a>      <span class="at">sep =</span> <span class="st">"-"</span></span>
<span id="cb80-291"><a href="#cb80-291" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb80-292"><a href="#cb80-292" aria-hidden="true" tabindex="-1"></a>    <span class="at">marketing_name =</span> <span class="fu">str_glue</span>(<span class="st">"{brand} {model} {version} ({year})"</span>)</span>
<span id="cb80-293"><a href="#cb80-293" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-294"><a href="#cb80-294" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-295"><a href="#cb80-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-296"><a href="#cb80-296" aria-hidden="true" tabindex="-1"></a>Notice the different joining functions:</span>
<span id="cb80-297"><a href="#cb80-297" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`str_c()`</span>: Basic concatenation with separator</span>
<span id="cb80-298"><a href="#cb80-298" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`str_glue()`</span>: Template-based joining (like Python f-strings)</span>
<span id="cb80-299"><a href="#cb80-299" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`paste()`</span> and <span class="in">`paste0()`</span>: Base R alternatives (less consistent)</span>
<span id="cb80-300"><a href="#cb80-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-301"><a href="#cb80-301" aria-hidden="true" tabindex="-1"></a><span class="fu">## Part 2: Date and Time with lubridate</span></span>
<span id="cb80-302"><a href="#cb80-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-303"><a href="#cb80-303" aria-hidden="true" tabindex="-1"></a><span class="fu">### Understanding Temporal Data</span></span>
<span id="cb80-304"><a href="#cb80-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-305"><a href="#cb80-305" aria-hidden="true" tabindex="-1"></a>Dates and times are deceptively complex:</span>
<span id="cb80-306"><a href="#cb80-306" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Different formats (MM/DD/YYYY vs DD/MM/YYYY)</span>
<span id="cb80-307"><a href="#cb80-307" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Time zones</span>
<span id="cb80-308"><a href="#cb80-308" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Daylight saving time</span>
<span id="cb80-309"><a href="#cb80-309" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Leap years and leap seconds</span>
<span id="cb80-310"><a href="#cb80-310" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Different calendar systems</span>
<span id="cb80-311"><a href="#cb80-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-312"><a href="#cb80-312" aria-hidden="true" tabindex="-1"></a>Lubridate makes working with dates intuitive and reliable.</span>
<span id="cb80-313"><a href="#cb80-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-316"><a href="#cb80-316" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-317"><a href="#cb80-317" aria-hidden="true" tabindex="-1"></a><span class="co"># Today's date and current time</span></span>
<span id="cb80-318"><a href="#cb80-318" aria-hidden="true" tabindex="-1"></a><span class="fu">today</span>()</span>
<span id="cb80-319"><a href="#cb80-319" aria-hidden="true" tabindex="-1"></a><span class="fu">now</span>()</span>
<span id="cb80-320"><a href="#cb80-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-321"><a href="#cb80-321" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse dates from strings - lubridate is smart!</span></span>
<span id="cb80-322"><a href="#cb80-322" aria-hidden="true" tabindex="-1"></a>date_strings <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb80-323"><a href="#cb80-323" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2023-01-15"</span>,</span>
<span id="cb80-324"><a href="#cb80-324" aria-hidden="true" tabindex="-1"></a>  <span class="st">"01/15/2023"</span>,</span>
<span id="cb80-325"><a href="#cb80-325" aria-hidden="true" tabindex="-1"></a>  <span class="st">"15-Jan-2023"</span>,</span>
<span id="cb80-326"><a href="#cb80-326" aria-hidden="true" tabindex="-1"></a>  <span class="st">"January 15, 2023"</span>,</span>
<span id="cb80-327"><a href="#cb80-327" aria-hidden="true" tabindex="-1"></a>  <span class="st">"20230115"</span></span>
<span id="cb80-328"><a href="#cb80-328" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-329"><a href="#cb80-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-330"><a href="#cb80-330" aria-hidden="true" tabindex="-1"></a><span class="co"># Different parsing functions for different formats</span></span>
<span id="cb80-331"><a href="#cb80-331" aria-hidden="true" tabindex="-1"></a>parsed_dates <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-332"><a href="#cb80-332" aria-hidden="true" tabindex="-1"></a>  <span class="at">original =</span> date_strings,</span>
<span id="cb80-333"><a href="#cb80-333" aria-hidden="true" tabindex="-1"></a>  <span class="at">ymd =</span> <span class="fu">ymd</span>(<span class="st">"2023-01-15"</span>),</span>
<span id="cb80-334"><a href="#cb80-334" aria-hidden="true" tabindex="-1"></a>  <span class="at">mdy =</span> <span class="fu">mdy</span>(<span class="st">"01/15/2023"</span>),</span>
<span id="cb80-335"><a href="#cb80-335" aria-hidden="true" tabindex="-1"></a>  <span class="at">dmy =</span> <span class="fu">dmy</span>(<span class="st">"15-01-2023"</span>),</span>
<span id="cb80-336"><a href="#cb80-336" aria-hidden="true" tabindex="-1"></a>  <span class="at">smart_parse =</span> <span class="fu">parse_date_time</span>(date_strings, </span>
<span id="cb80-337"><a href="#cb80-337" aria-hidden="true" tabindex="-1"></a>    <span class="at">orders =</span> <span class="fu">c</span>(<span class="st">"ymd"</span>, <span class="st">"mdy"</span>, <span class="st">"dmy"</span>, <span class="st">"Bdy"</span>, <span class="st">"ymd"</span>))</span>
<span id="cb80-338"><a href="#cb80-338" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-339"><a href="#cb80-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-340"><a href="#cb80-340" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(parsed_dates)</span>
<span id="cb80-341"><a href="#cb80-341" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-342"><a href="#cb80-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-343"><a href="#cb80-343" aria-hidden="true" tabindex="-1"></a>The genius of lubridate is the intuitive function names:</span>
<span id="cb80-344"><a href="#cb80-344" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`ymd()`</span>: Year-Month-Day</span>
<span id="cb80-345"><a href="#cb80-345" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`mdy()`</span>: Month-Day-Year</span>
<span id="cb80-346"><a href="#cb80-346" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`dmy()`</span>: Day-Month-Year</span>
<span id="cb80-347"><a href="#cb80-347" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`ymd_hms()`</span>: With time included</span>
<span id="cb80-348"><a href="#cb80-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-349"><a href="#cb80-349" aria-hidden="true" tabindex="-1"></a><span class="fu">### Date Components and Arithmetic</span></span>
<span id="cb80-350"><a href="#cb80-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-351"><a href="#cb80-351" aria-hidden="true" tabindex="-1"></a>Once we have dates, we can extract components and do arithmetic:</span>
<span id="cb80-352"><a href="#cb80-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-355"><a href="#cb80-355" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-356"><a href="#cb80-356" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a date range</span></span>
<span id="cb80-357"><a href="#cb80-357" aria-hidden="true" tabindex="-1"></a>dates <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">ymd</span>(<span class="st">"2023-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2023-12-31"</span>), <span class="at">by =</span> <span class="st">"month"</span>)</span>
<span id="cb80-358"><a href="#cb80-358" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-359"><a href="#cb80-359" aria-hidden="true" tabindex="-1"></a>date_analysis <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-360"><a href="#cb80-360" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> dates,</span>
<span id="cb80-361"><a href="#cb80-361" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">year</span>(date),</span>
<span id="cb80-362"><a href="#cb80-362" aria-hidden="true" tabindex="-1"></a>  <span class="at">month =</span> <span class="fu">month</span>(date),</span>
<span id="cb80-363"><a href="#cb80-363" aria-hidden="true" tabindex="-1"></a>  <span class="at">month_name =</span> <span class="fu">month</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">FALSE</span>),</span>
<span id="cb80-364"><a href="#cb80-364" aria-hidden="true" tabindex="-1"></a>  <span class="at">day =</span> <span class="fu">day</span>(date),</span>
<span id="cb80-365"><a href="#cb80-365" aria-hidden="true" tabindex="-1"></a>  <span class="at">weekday =</span> <span class="fu">wday</span>(date, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">FALSE</span>),</span>
<span id="cb80-366"><a href="#cb80-366" aria-hidden="true" tabindex="-1"></a>  <span class="at">quarter =</span> <span class="fu">quarter</span>(date),</span>
<span id="cb80-367"><a href="#cb80-367" aria-hidden="true" tabindex="-1"></a>  <span class="at">week_of_year =</span> <span class="fu">week</span>(date),</span>
<span id="cb80-368"><a href="#cb80-368" aria-hidden="true" tabindex="-1"></a>  <span class="at">day_of_year =</span> <span class="fu">yday</span>(date),</span>
<span id="cb80-369"><a href="#cb80-369" aria-hidden="true" tabindex="-1"></a>  <span class="at">is_weekend =</span> <span class="fu">wday</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>),  <span class="co"># Sunday = 1, Saturday = 7</span></span>
<span id="cb80-370"><a href="#cb80-370" aria-hidden="true" tabindex="-1"></a>  <span class="at">days_in_month =</span> <span class="fu">days_in_month</span>(date)</span>
<span id="cb80-371"><a href="#cb80-371" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-372"><a href="#cb80-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-373"><a href="#cb80-373" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(date_analysis, <span class="at">n =</span> <span class="dv">12</span>)</span>
<span id="cb80-374"><a href="#cb80-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-375"><a href="#cb80-375" aria-hidden="true" tabindex="-1"></a><span class="co"># Date arithmetic is intuitive</span></span>
<span id="cb80-376"><a href="#cb80-376" aria-hidden="true" tabindex="-1"></a>reference_date <span class="ot">&lt;-</span> <span class="fu">ymd</span>(<span class="st">"2023-06-15"</span>)</span>
<span id="cb80-377"><a href="#cb80-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-378"><a href="#cb80-378" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb80-379"><a href="#cb80-379" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="fu">c</span>(</span>
<span id="cb80-380"><a href="#cb80-380" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Original date"</span>,</span>
<span id="cb80-381"><a href="#cb80-381" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Plus 30 days"</span>,</span>
<span id="cb80-382"><a href="#cb80-382" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Plus 2 months"</span>,</span>
<span id="cb80-383"><a href="#cb80-383" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Plus 1 year"</span>,</span>
<span id="cb80-384"><a href="#cb80-384" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Next Monday"</span>,</span>
<span id="cb80-385"><a href="#cb80-385" aria-hidden="true" tabindex="-1"></a>    <span class="st">"End of month"</span>,</span>
<span id="cb80-386"><a href="#cb80-386" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Beginning of year"</span></span>
<span id="cb80-387"><a href="#cb80-387" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb80-388"><a href="#cb80-388" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">c</span>(</span>
<span id="cb80-389"><a href="#cb80-389" aria-hidden="true" tabindex="-1"></a>    reference_date,</span>
<span id="cb80-390"><a href="#cb80-390" aria-hidden="true" tabindex="-1"></a>    reference_date <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">30</span>),</span>
<span id="cb80-391"><a href="#cb80-391" aria-hidden="true" tabindex="-1"></a>    reference_date <span class="sc">+</span> <span class="fu">months</span>(<span class="dv">2</span>),</span>
<span id="cb80-392"><a href="#cb80-392" aria-hidden="true" tabindex="-1"></a>    reference_date <span class="sc">+</span> <span class="fu">years</span>(<span class="dv">1</span>),</span>
<span id="cb80-393"><a href="#cb80-393" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ceiling_date</span>(reference_date, <span class="st">"week"</span>, <span class="at">week_start =</span> <span class="dv">1</span>),</span>
<span id="cb80-394"><a href="#cb80-394" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ceiling_date</span>(reference_date, <span class="st">"month"</span>) <span class="sc">-</span> <span class="fu">days</span>(<span class="dv">1</span>),</span>
<span id="cb80-395"><a href="#cb80-395" aria-hidden="true" tabindex="-1"></a>    <span class="fu">floor_date</span>(reference_date, <span class="st">"year"</span>)</span>
<span id="cb80-396"><a href="#cb80-396" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-397"><a href="#cb80-397" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-398"><a href="#cb80-398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-399"><a href="#cb80-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-400"><a href="#cb80-400" aria-hidden="true" tabindex="-1"></a>Key insights about date arithmetic:</span>
<span id="cb80-401"><a href="#cb80-401" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Adding days is straightforward</span>
<span id="cb80-402"><a href="#cb80-402" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Adding months/years handles edge cases (e.g., Jan 31 + 1 month = Feb 28/29)</span>
<span id="cb80-403"><a href="#cb80-403" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`floor_date()`</span> and <span class="in">`ceiling_date()`</span> are perfect for grouping</span>
<span id="cb80-404"><a href="#cb80-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-405"><a href="#cb80-405" aria-hidden="true" tabindex="-1"></a><span class="fu">### Working with Time</span></span>
<span id="cb80-406"><a href="#cb80-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-407"><a href="#cb80-407" aria-hidden="true" tabindex="-1"></a>Time adds another layer of complexity:</span>
<span id="cb80-408"><a href="#cb80-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-411"><a href="#cb80-411" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-412"><a href="#cb80-412" aria-hidden="true" tabindex="-1"></a><span class="co"># Different time representations</span></span>
<span id="cb80-413"><a href="#cb80-413" aria-hidden="true" tabindex="-1"></a>time_examples <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-414"><a href="#cb80-414" aria-hidden="true" tabindex="-1"></a>  <span class="at">datetime_string =</span> <span class="fu">c</span>(</span>
<span id="cb80-415"><a href="#cb80-415" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2023-06-15 14:30:00"</span>,</span>
<span id="cb80-416"><a href="#cb80-416" aria-hidden="true" tabindex="-1"></a>    <span class="st">"2023-06-15 2:30:00 PM"</span>,</span>
<span id="cb80-417"><a href="#cb80-417" aria-hidden="true" tabindex="-1"></a>    <span class="st">"15/06/2023 14:30"</span>,</span>
<span id="cb80-418"><a href="#cb80-418" aria-hidden="true" tabindex="-1"></a>    <span class="st">"June 15, 2023 2:30 PM"</span></span>
<span id="cb80-419"><a href="#cb80-419" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-420"><a href="#cb80-420" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-421"><a href="#cb80-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-422"><a href="#cb80-422" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse with different formats</span></span>
<span id="cb80-423"><a href="#cb80-423" aria-hidden="true" tabindex="-1"></a>parsed_times <span class="ot">&lt;-</span> time_examples <span class="sc">%&gt;%</span></span>
<span id="cb80-424"><a href="#cb80-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-425"><a href="#cb80-425" aria-hidden="true" tabindex="-1"></a>    <span class="at">parsed =</span> <span class="fu">parse_date_time</span>(datetime_string, </span>
<span id="cb80-426"><a href="#cb80-426" aria-hidden="true" tabindex="-1"></a>      <span class="at">orders =</span> <span class="fu">c</span>(<span class="st">"ymd HMS"</span>, <span class="st">"ymd IMS p"</span>, <span class="st">"dmy HM"</span>, <span class="st">"Bdy IMS p"</span>)),</span>
<span id="cb80-427"><a href="#cb80-427" aria-hidden="true" tabindex="-1"></a>    <span class="at">date_only =</span> <span class="fu">as_date</span>(parsed),</span>
<span id="cb80-428"><a href="#cb80-428" aria-hidden="true" tabindex="-1"></a>    <span class="at">time_only =</span> <span class="fu">format</span>(parsed, <span class="st">"%H:%M:%S"</span>),</span>
<span id="cb80-429"><a href="#cb80-429" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour =</span> <span class="fu">hour</span>(parsed),</span>
<span id="cb80-430"><a href="#cb80-430" aria-hidden="true" tabindex="-1"></a>    <span class="at">minute =</span> <span class="fu">minute</span>(parsed),</span>
<span id="cb80-431"><a href="#cb80-431" aria-hidden="true" tabindex="-1"></a>    <span class="at">am_pm =</span> <span class="fu">if_else</span>(<span class="fu">hour</span>(parsed) <span class="sc">&lt;</span> <span class="dv">12</span>, <span class="st">"AM"</span>, <span class="st">"PM"</span>)</span>
<span id="cb80-432"><a href="#cb80-432" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-433"><a href="#cb80-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-434"><a href="#cb80-434" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(parsed_times)</span>
<span id="cb80-435"><a href="#cb80-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-436"><a href="#cb80-436" aria-hidden="true" tabindex="-1"></a><span class="co"># Time differences and durations</span></span>
<span id="cb80-437"><a href="#cb80-437" aria-hidden="true" tabindex="-1"></a>start_time <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-06-15 09:00:00"</span>)</span>
<span id="cb80-438"><a href="#cb80-438" aria-hidden="true" tabindex="-1"></a>end_time <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-06-15 17:30:00"</span>)</span>
<span id="cb80-439"><a href="#cb80-439" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-440"><a href="#cb80-440" aria-hidden="true" tabindex="-1"></a><span class="co"># Different ways to express time differences</span></span>
<span id="cb80-441"><a href="#cb80-441" aria-hidden="true" tabindex="-1"></a>time_diff <span class="ot">&lt;-</span> end_time <span class="sc">-</span> start_time</span>
<span id="cb80-442"><a href="#cb80-442" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(time_diff)  <span class="co"># In seconds by default</span></span>
<span id="cb80-443"><a href="#cb80-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-444"><a href="#cb80-444" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to different units</span></span>
<span id="cb80-445"><a href="#cb80-445" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb80-446"><a href="#cb80-446" aria-hidden="true" tabindex="-1"></a>  <span class="at">unit =</span> <span class="fu">c</span>(<span class="st">"seconds"</span>, <span class="st">"minutes"</span>, <span class="st">"hours"</span>, <span class="st">"days"</span>),</span>
<span id="cb80-447"><a href="#cb80-447" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(</span>
<span id="cb80-448"><a href="#cb80-448" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(time_diff, <span class="at">units =</span> <span class="st">"secs"</span>),</span>
<span id="cb80-449"><a href="#cb80-449" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(time_diff, <span class="at">units =</span> <span class="st">"mins"</span>),</span>
<span id="cb80-450"><a href="#cb80-450" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(time_diff, <span class="at">units =</span> <span class="st">"hours"</span>),</span>
<span id="cb80-451"><a href="#cb80-451" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.numeric</span>(time_diff, <span class="at">units =</span> <span class="st">"days"</span>)</span>
<span id="cb80-452"><a href="#cb80-452" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-453"><a href="#cb80-453" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-454"><a href="#cb80-454" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-455"><a href="#cb80-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-456"><a href="#cb80-456" aria-hidden="true" tabindex="-1"></a><span class="fu">### Time Zones - The Hidden Complexity</span></span>
<span id="cb80-457"><a href="#cb80-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-458"><a href="#cb80-458" aria-hidden="true" tabindex="-1"></a>Time zones are often the source of subtle bugs in data analysis:</span>
<span id="cb80-459"><a href="#cb80-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-462"><a href="#cb80-462" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-463"><a href="#cb80-463" aria-hidden="true" tabindex="-1"></a><span class="co"># Working with time zones</span></span>
<span id="cb80-464"><a href="#cb80-464" aria-hidden="true" tabindex="-1"></a>utc_time <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-06-15 12:00:00"</span>, <span class="at">tz =</span> <span class="st">"UTC"</span>)</span>
<span id="cb80-465"><a href="#cb80-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-466"><a href="#cb80-466" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to different time zones</span></span>
<span id="cb80-467"><a href="#cb80-467" aria-hidden="true" tabindex="-1"></a>time_zones <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-468"><a href="#cb80-468" aria-hidden="true" tabindex="-1"></a>  <span class="at">timezone =</span> <span class="fu">c</span>(<span class="st">"UTC"</span>, <span class="st">"America/New_York"</span>, <span class="st">"Europe/London"</span>, </span>
<span id="cb80-469"><a href="#cb80-469" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Asia/Tokyo"</span>, <span class="st">"Australia/Sydney"</span>),</span>
<span id="cb80-470"><a href="#cb80-470" aria-hidden="true" tabindex="-1"></a>  <span class="at">local_time =</span> <span class="fu">c</span>(</span>
<span id="cb80-471"><a href="#cb80-471" aria-hidden="true" tabindex="-1"></a>    utc_time,</span>
<span id="cb80-472"><a href="#cb80-472" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with_tz</span>(utc_time, <span class="st">"America/New_York"</span>),</span>
<span id="cb80-473"><a href="#cb80-473" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with_tz</span>(utc_time, <span class="st">"Europe/London"</span>),</span>
<span id="cb80-474"><a href="#cb80-474" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with_tz</span>(utc_time, <span class="st">"Asia/Tokyo"</span>),</span>
<span id="cb80-475"><a href="#cb80-475" aria-hidden="true" tabindex="-1"></a>    <span class="fu">with_tz</span>(utc_time, <span class="st">"Australia/Sydney"</span>)</span>
<span id="cb80-476"><a href="#cb80-476" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb80-477"><a href="#cb80-477" aria-hidden="true" tabindex="-1"></a>  <span class="at">offset_hours =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="sc">-</span><span class="dv">4</span>, <span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">10</span>)  <span class="co"># Offset from UTC (varies with DST!)</span></span>
<span id="cb80-478"><a href="#cb80-478" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-479"><a href="#cb80-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-480"><a href="#cb80-480" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(time_zones)</span>
<span id="cb80-481"><a href="#cb80-481" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-482"><a href="#cb80-482" aria-hidden="true" tabindex="-1"></a><span class="co"># Force_tz vs with_tz</span></span>
<span id="cb80-483"><a href="#cb80-483" aria-hidden="true" tabindex="-1"></a>ambiguous_time <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-06-15 12:00:00"</span>)  <span class="co"># No timezone specified</span></span>
<span id="cb80-484"><a href="#cb80-484" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-485"><a href="#cb80-485" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb80-486"><a href="#cb80-486" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="fu">c</span>(</span>
<span id="cb80-487"><a href="#cb80-487" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Original (no tz)"</span>,</span>
<span id="cb80-488"><a href="#cb80-488" aria-hidden="true" tabindex="-1"></a>    <span class="st">"with_tz - converts time"</span>,</span>
<span id="cb80-489"><a href="#cb80-489" aria-hidden="true" tabindex="-1"></a>    <span class="st">"force_tz - keeps time, changes zone"</span></span>
<span id="cb80-490"><a href="#cb80-490" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb80-491"><a href="#cb80-491" aria-hidden="true" tabindex="-1"></a>  <span class="at">result =</span> <span class="fu">c</span>(</span>
<span id="cb80-492"><a href="#cb80-492" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(ambiguous_time),</span>
<span id="cb80-493"><a href="#cb80-493" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(<span class="fu">with_tz</span>(ambiguous_time, <span class="st">"America/New_York"</span>)),</span>
<span id="cb80-494"><a href="#cb80-494" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.character</span>(<span class="fu">force_tz</span>(ambiguous_time, <span class="st">"America/New_York"</span>))</span>
<span id="cb80-495"><a href="#cb80-495" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-496"><a href="#cb80-496" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-497"><a href="#cb80-497" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-498"><a href="#cb80-498" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-499"><a href="#cb80-499" aria-hidden="true" tabindex="-1"></a>The difference between <span class="in">`with_tz()`</span> and <span class="in">`force_tz()`</span>:</span>
<span id="cb80-500"><a href="#cb80-500" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`with_tz()`</span>: Changes the display timezone (same moment in time)</span>
<span id="cb80-501"><a href="#cb80-501" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="in">`force_tz()`</span>: Changes the timezone interpretation (different moment)</span>
<span id="cb80-502"><a href="#cb80-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-503"><a href="#cb80-503" aria-hidden="true" tabindex="-1"></a><span class="fu">### Intervals, Durations, and Periods</span></span>
<span id="cb80-504"><a href="#cb80-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-505"><a href="#cb80-505" aria-hidden="true" tabindex="-1"></a>Lubridate distinguishes between three concepts:</span>
<span id="cb80-506"><a href="#cb80-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-509"><a href="#cb80-509" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-510"><a href="#cb80-510" aria-hidden="true" tabindex="-1"></a><span class="co"># Intervals: specific start and end times</span></span>
<span id="cb80-511"><a href="#cb80-511" aria-hidden="true" tabindex="-1"></a>interval_1 <span class="ot">&lt;-</span> <span class="fu">interval</span>(<span class="fu">ymd</span>(<span class="st">"2023-01-01"</span>), <span class="fu">ymd</span>(<span class="st">"2023-12-31"</span>))</span>
<span id="cb80-512"><a href="#cb80-512" aria-hidden="true" tabindex="-1"></a>interval_2 <span class="ot">&lt;-</span> <span class="fu">interval</span>(<span class="fu">ymd</span>(<span class="st">"2023-06-01"</span>), <span class="fu">ymd</span>(<span class="st">"2023-08-31"</span>))</span>
<span id="cb80-513"><a href="#cb80-513" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-514"><a href="#cb80-514" aria-hidden="true" tabindex="-1"></a><span class="co"># Check overlap</span></span>
<span id="cb80-515"><a href="#cb80-515" aria-hidden="true" tabindex="-1"></a><span class="fu">int_overlaps</span>(interval_1, interval_2)</span>
<span id="cb80-516"><a href="#cb80-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-517"><a href="#cb80-517" aria-hidden="true" tabindex="-1"></a><span class="co"># Durations: exact time spans (in seconds)</span></span>
<span id="cb80-518"><a href="#cb80-518" aria-hidden="true" tabindex="-1"></a>duration_1 <span class="ot">&lt;-</span> <span class="fu">ddays</span>(<span class="dv">7</span>) <span class="sc">+</span> <span class="fu">dhours</span>(<span class="dv">3</span>) <span class="sc">+</span> <span class="fu">dminutes</span>(<span class="dv">30</span>)</span>
<span id="cb80-519"><a href="#cb80-519" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(duration_1)</span>
<span id="cb80-520"><a href="#cb80-520" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-521"><a href="#cb80-521" aria-hidden="true" tabindex="-1"></a><span class="co"># Periods: human-friendly time spans</span></span>
<span id="cb80-522"><a href="#cb80-522" aria-hidden="true" tabindex="-1"></a>period_1 <span class="ot">&lt;-</span> <span class="fu">days</span>(<span class="dv">7</span>) <span class="sc">+</span> <span class="fu">hours</span>(<span class="dv">3</span>) <span class="sc">+</span> <span class="fu">minutes</span>(<span class="dv">30</span>)</span>
<span id="cb80-523"><a href="#cb80-523" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(period_1)</span>
<span id="cb80-524"><a href="#cb80-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-525"><a href="#cb80-525" aria-hidden="true" tabindex="-1"></a><span class="co"># The difference matters!</span></span>
<span id="cb80-526"><a href="#cb80-526" aria-hidden="true" tabindex="-1"></a><span class="co"># Consider daylight saving time</span></span>
<span id="cb80-527"><a href="#cb80-527" aria-hidden="true" tabindex="-1"></a>dst_start <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-03-11 00:00:00"</span>, <span class="at">tz =</span> <span class="st">"America/New_York"</span>)</span>
<span id="cb80-528"><a href="#cb80-528" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-529"><a href="#cb80-529" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb80-530"><a href="#cb80-530" aria-hidden="true" tabindex="-1"></a>  <span class="at">description =</span> <span class="fu">c</span>(</span>
<span id="cb80-531"><a href="#cb80-531" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Original time"</span>,</span>
<span id="cb80-532"><a href="#cb80-532" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Plus duration (24 hours)"</span>,</span>
<span id="cb80-533"><a href="#cb80-533" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Plus period (1 day)"</span></span>
<span id="cb80-534"><a href="#cb80-534" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb80-535"><a href="#cb80-535" aria-hidden="true" tabindex="-1"></a>  <span class="at">result =</span> <span class="fu">c</span>(</span>
<span id="cb80-536"><a href="#cb80-536" aria-hidden="true" tabindex="-1"></a>    dst_start,</span>
<span id="cb80-537"><a href="#cb80-537" aria-hidden="true" tabindex="-1"></a>    dst_start <span class="sc">+</span> <span class="fu">ddays</span>(<span class="dv">1</span>),  <span class="co"># Exactly 24 hours later</span></span>
<span id="cb80-538"><a href="#cb80-538" aria-hidden="true" tabindex="-1"></a>    dst_start <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">1</span>)    <span class="co"># Next calendar day at same time</span></span>
<span id="cb80-539"><a href="#cb80-539" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-540"><a href="#cb80-540" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-541"><a href="#cb80-541" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-542"><a href="#cb80-542" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-543"><a href="#cb80-543" aria-hidden="true" tabindex="-1"></a>Use:</span>
<span id="cb80-544"><a href="#cb80-544" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Intervals**: When you need specific start/end times</span>
<span id="cb80-545"><a href="#cb80-545" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Durations**: For exact time calculations</span>
<span id="cb80-546"><a href="#cb80-546" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Periods**: For human-friendly calculations</span>
<span id="cb80-547"><a href="#cb80-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-548"><a href="#cb80-548" aria-hidden="true" tabindex="-1"></a><span class="fu">## Combining Strings and Dates in Real Analysis</span></span>
<span id="cb80-549"><a href="#cb80-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-550"><a href="#cb80-550" aria-hidden="true" tabindex="-1"></a>Let's work with a realistic example combining both:</span>
<span id="cb80-551"><a href="#cb80-551" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-554"><a href="#cb80-554" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-555"><a href="#cb80-555" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a realistic dataset - customer support tickets</span></span>
<span id="cb80-556"><a href="#cb80-556" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb80-557"><a href="#cb80-557" aria-hidden="true" tabindex="-1"></a>n_tickets <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb80-558"><a href="#cb80-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-559"><a href="#cb80-559" aria-hidden="true" tabindex="-1"></a>support_tickets <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-560"><a href="#cb80-560" aria-hidden="true" tabindex="-1"></a>  <span class="at">ticket_id =</span> <span class="fu">sprintf</span>(<span class="st">"TICK-%06d"</span>, <span class="dv">1</span><span class="sc">:</span>n_tickets),</span>
<span id="cb80-561"><a href="#cb80-561" aria-hidden="true" tabindex="-1"></a>  <span class="at">created_at =</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-01-01 00:00:00"</span>) <span class="sc">+</span> </span>
<span id="cb80-562"><a href="#cb80-562" aria-hidden="true" tabindex="-1"></a>    <span class="fu">seconds</span>(<span class="fu">runif</span>(n_tickets, <span class="dv">0</span>, <span class="dv">365</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">60</span>)),</span>
<span id="cb80-563"><a href="#cb80-563" aria-hidden="true" tabindex="-1"></a>  <span class="at">customer_email =</span> <span class="fu">str_c</span>(</span>
<span id="cb80-564"><a href="#cb80-564" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"john"</span>, <span class="st">"mary"</span>, <span class="st">"bob"</span>, <span class="st">"alice"</span>, <span class="st">"charlie"</span>), n_tickets, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-565"><a href="#cb80-565" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, n_tickets, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-566"><a href="#cb80-566" aria-hidden="true" tabindex="-1"></a>    <span class="st">"@"</span>,</span>
<span id="cb80-567"><a href="#cb80-567" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"gmail.com"</span>, <span class="st">"yahoo.com"</span>, <span class="st">"company.com"</span>), n_tickets, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-568"><a href="#cb80-568" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb80-569"><a href="#cb80-569" aria-hidden="true" tabindex="-1"></a>  <span class="at">subject =</span> <span class="fu">sample</span>(<span class="fu">c</span>(</span>
<span id="cb80-570"><a href="#cb80-570" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Login issue - can't access account"</span>,</span>
<span id="cb80-571"><a href="#cb80-571" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Payment failed - ERROR 402"</span>,</span>
<span id="cb80-572"><a href="#cb80-572" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Question about pricing"</span>,</span>
<span id="cb80-573"><a href="#cb80-573" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Feature request: dark mode"</span>,</span>
<span id="cb80-574"><a href="#cb80-574" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Bug report - app crashes on startup"</span>,</span>
<span id="cb80-575"><a href="#cb80-575" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Refund request #12345"</span></span>
<span id="cb80-576"><a href="#cb80-576" aria-hidden="true" tabindex="-1"></a>  ), n_tickets, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-577"><a href="#cb80-577" aria-hidden="true" tabindex="-1"></a>  <span class="at">priority =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>, <span class="st">"Critical"</span>), n_tickets, </span>
<span id="cb80-578"><a href="#cb80-578" aria-hidden="true" tabindex="-1"></a>                   <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.4</span>, <span class="fl">0.3</span>, <span class="fl">0.2</span>, <span class="fl">0.1</span>)),</span>
<span id="cb80-579"><a href="#cb80-579" aria-hidden="true" tabindex="-1"></a>  <span class="at">resolved_at =</span> created_at <span class="sc">+</span> <span class="fu">hours</span>(<span class="fu">round</span>(<span class="fu">rexp</span>(n_tickets, <span class="at">rate =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">24</span>)))  <span class="co"># Exponential resolution time</span></span>
<span id="cb80-580"><a href="#cb80-580" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb80-581"><a href="#cb80-581" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-582"><a href="#cb80-582" aria-hidden="true" tabindex="-1"></a>    <span class="at">resolved_at =</span> <span class="fu">if_else</span>(<span class="fu">runif</span>(n_tickets) <span class="sc">&lt;</span> <span class="fl">0.1</span>, NA_POSIXct_, resolved_at)  <span class="co"># 10% unresolved</span></span>
<span id="cb80-583"><a href="#cb80-583" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-584"><a href="#cb80-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-585"><a href="#cb80-585" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze the tickets</span></span>
<span id="cb80-586"><a href="#cb80-586" aria-hidden="true" tabindex="-1"></a>ticket_analysis <span class="ot">&lt;-</span> support_tickets <span class="sc">%&gt;%</span></span>
<span id="cb80-587"><a href="#cb80-587" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-588"><a href="#cb80-588" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract information from strings</span></span>
<span id="cb80-589"><a href="#cb80-589" aria-hidden="true" tabindex="-1"></a>    <span class="at">issue_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb80-590"><a href="#cb80-590" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(subject, <span class="st">"Login|access|password"</span>) <span class="sc">~</span> <span class="st">"Authentication"</span>,</span>
<span id="cb80-591"><a href="#cb80-591" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(subject, <span class="st">"Payment|refund|billing"</span>) <span class="sc">~</span> <span class="st">"Billing"</span>,</span>
<span id="cb80-592"><a href="#cb80-592" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(subject, <span class="st">"Bug|crash|error"</span>) <span class="sc">~</span> <span class="st">"Bug"</span>,</span>
<span id="cb80-593"><a href="#cb80-593" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(subject, <span class="st">"Feature|request"</span>) <span class="sc">~</span> <span class="st">"Feature Request"</span>,</span>
<span id="cb80-594"><a href="#cb80-594" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span></span>
<span id="cb80-595"><a href="#cb80-595" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb80-596"><a href="#cb80-596" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_error_code =</span> <span class="fu">str_detect</span>(subject, <span class="st">"ERROR </span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb80-597"><a href="#cb80-597" aria-hidden="true" tabindex="-1"></a>    <span class="at">error_code =</span> <span class="fu">str_extract</span>(subject, <span class="st">"ERROR </span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb80-598"><a href="#cb80-598" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-599"><a href="#cb80-599" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract from email</span></span>
<span id="cb80-600"><a href="#cb80-600" aria-hidden="true" tabindex="-1"></a>    <span class="at">email_domain =</span> <span class="fu">str_extract</span>(customer_email, <span class="st">"@(.+)$"</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">"@"</span>),</span>
<span id="cb80-601"><a href="#cb80-601" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_corporate =</span> email_domain <span class="sc">==</span> <span class="st">"company.com"</span>,</span>
<span id="cb80-602"><a href="#cb80-602" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-603"><a href="#cb80-603" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Date/time analysis</span></span>
<span id="cb80-604"><a href="#cb80-604" aria-hidden="true" tabindex="-1"></a>    <span class="at">created_date =</span> <span class="fu">as_date</span>(created_at),</span>
<span id="cb80-605"><a href="#cb80-605" aria-hidden="true" tabindex="-1"></a>    <span class="at">created_hour =</span> <span class="fu">hour</span>(created_at),</span>
<span id="cb80-606"><a href="#cb80-606" aria-hidden="true" tabindex="-1"></a>    <span class="at">created_weekday =</span> <span class="fu">wday</span>(created_at, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-607"><a href="#cb80-607" aria-hidden="true" tabindex="-1"></a>    <span class="at">created_month =</span> <span class="fu">month</span>(created_at, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-608"><a href="#cb80-608" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_business_hours =</span> <span class="fu">between</span>(created_hour, <span class="dv">9</span>, <span class="dv">17</span>),</span>
<span id="cb80-609"><a href="#cb80-609" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_weekend =</span> <span class="fu">wday</span>(created_at) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>),</span>
<span id="cb80-610"><a href="#cb80-610" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-611"><a href="#cb80-611" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Resolution time</span></span>
<span id="cb80-612"><a href="#cb80-612" aria-hidden="true" tabindex="-1"></a>    <span class="at">resolution_time =</span> <span class="fu">as.numeric</span>(resolved_at <span class="sc">-</span> created_at, <span class="at">units =</span> <span class="st">"hours"</span>),</span>
<span id="cb80-613"><a href="#cb80-613" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_resolved =</span> <span class="sc">!</span><span class="fu">is.na</span>(resolved_at),</span>
<span id="cb80-614"><a href="#cb80-614" aria-hidden="true" tabindex="-1"></a>    <span class="at">resolution_category =</span> <span class="fu">case_when</span>(</span>
<span id="cb80-615"><a href="#cb80-615" aria-hidden="true" tabindex="-1"></a>      <span class="fu">is.na</span>(resolution_time) <span class="sc">~</span> <span class="st">"Unresolved"</span>,</span>
<span id="cb80-616"><a href="#cb80-616" aria-hidden="true" tabindex="-1"></a>      resolution_time <span class="sc">&lt;</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"&lt; 1 hour"</span>,</span>
<span id="cb80-617"><a href="#cb80-617" aria-hidden="true" tabindex="-1"></a>      resolution_time <span class="sc">&lt;</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"1-4 hours"</span>,</span>
<span id="cb80-618"><a href="#cb80-618" aria-hidden="true" tabindex="-1"></a>      resolution_time <span class="sc">&lt;</span> <span class="dv">24</span> <span class="sc">~</span> <span class="st">"4-24 hours"</span>,</span>
<span id="cb80-619"><a href="#cb80-619" aria-hidden="true" tabindex="-1"></a>      resolution_time <span class="sc">&lt;</span> <span class="dv">72</span> <span class="sc">~</span> <span class="st">"1-3 days"</span>,</span>
<span id="cb80-620"><a href="#cb80-620" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"&gt; 3 days"</span></span>
<span id="cb80-621"><a href="#cb80-621" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb80-622"><a href="#cb80-622" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-623"><a href="#cb80-623" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-624"><a href="#cb80-624" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics</span></span>
<span id="cb80-625"><a href="#cb80-625" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> ticket_analysis <span class="sc">%&gt;%</span></span>
<span id="cb80-626"><a href="#cb80-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(issue_type, priority) <span class="sc">%&gt;%</span></span>
<span id="cb80-627"><a href="#cb80-627" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb80-628"><a href="#cb80-628" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb80-629"><a href="#cb80-629" aria-hidden="true" tabindex="-1"></a>    <span class="at">resolved_pct =</span> <span class="fu">mean</span>(is_resolved) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb80-630"><a href="#cb80-630" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_resolution_hours =</span> <span class="fu">mean</span>(resolution_time, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-631"><a href="#cb80-631" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_resolution_hours =</span> <span class="fu">median</span>(resolution_time, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-632"><a href="#cb80-632" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb80-633"><a href="#cb80-633" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb80-634"><a href="#cb80-634" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(issue_type, priority)</span>
<span id="cb80-635"><a href="#cb80-635" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-636"><a href="#cb80-636" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(summary_stats, <span class="at">n =</span> <span class="dv">20</span>)</span>
<span id="cb80-637"><a href="#cb80-637" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-638"><a href="#cb80-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-639"><a href="#cb80-639" aria-hidden="true" tabindex="-1"></a>This analysis demonstrates:</span>
<span id="cb80-640"><a href="#cb80-640" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Extracting categories from free text</span>
<span id="cb80-641"><a href="#cb80-641" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Finding patterns in strings</span>
<span id="cb80-642"><a href="#cb80-642" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Working with timestamps</span>
<span id="cb80-643"><a href="#cb80-643" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Calculating time differences</span>
<span id="cb80-644"><a href="#cb80-644" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Combining string and date operations</span>
<span id="cb80-645"><a href="#cb80-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-646"><a href="#cb80-646" aria-hidden="true" tabindex="-1"></a><span class="fu">### Visualization of String and Date Patterns</span></span>
<span id="cb80-647"><a href="#cb80-647" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-648"><a href="#cb80-648" aria-hidden="true" tabindex="-1"></a>Let's visualize our findings:</span>
<span id="cb80-649"><a href="#cb80-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-652"><a href="#cb80-652" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-653"><a href="#cb80-653" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-width: 14</span></span>
<span id="cb80-654"><a href="#cb80-654" aria-hidden="true" tabindex="-1"></a><span class="co">#| fig-height: 10</span></span>
<span id="cb80-655"><a href="#cb80-655" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-656"><a href="#cb80-656" aria-hidden="true" tabindex="-1"></a><span class="co"># Ticket volume over time</span></span>
<span id="cb80-657"><a href="#cb80-657" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> ticket_analysis <span class="sc">%&gt;%</span></span>
<span id="cb80-658"><a href="#cb80-658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(created_date) <span class="sc">%&gt;%</span></span>
<span id="cb80-659"><a href="#cb80-659" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> created_date, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb80-660"><a href="#cb80-660" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"steelblue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb80-661"><a href="#cb80-661" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"loess"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb80-662"><a href="#cb80-662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb80-663"><a href="#cb80-663" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Daily Ticket Volume"</span>,</span>
<span id="cb80-664"><a href="#cb80-664" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"With smoothed trend line"</span>,</span>
<span id="cb80-665"><a href="#cb80-665" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb80-666"><a href="#cb80-666" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Tickets"</span></span>
<span id="cb80-667"><a href="#cb80-667" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-668"><a href="#cb80-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-669"><a href="#cb80-669" aria-hidden="true" tabindex="-1"></a><span class="co"># Hour of day pattern</span></span>
<span id="cb80-670"><a href="#cb80-670" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> ticket_analysis <span class="sc">%&gt;%</span></span>
<span id="cb80-671"><a href="#cb80-671" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(created_hour, is_weekend) <span class="sc">%&gt;%</span></span>
<span id="cb80-672"><a href="#cb80-672" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> created_hour, <span class="at">y =</span> n, <span class="at">fill =</span> is_weekend)) <span class="sc">+</span></span>
<span id="cb80-673"><a href="#cb80-673" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"dodge"</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb80-674"><a href="#cb80-674" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>, <span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"coral"</span>)) <span class="sc">+</span></span>
<span id="cb80-675"><a href="#cb80-675" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb80-676"><a href="#cb80-676" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Tickets by Hour of Day"</span>,</span>
<span id="cb80-677"><a href="#cb80-677" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Weekday vs Weekend patterns"</span>,</span>
<span id="cb80-678"><a href="#cb80-678" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Day"</span>,</span>
<span id="cb80-679"><a href="#cb80-679" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Tickets"</span>,</span>
<span id="cb80-680"><a href="#cb80-680" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Weekend"</span></span>
<span id="cb80-681"><a href="#cb80-681" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb80-682"><a href="#cb80-682" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">23</span>, <span class="dv">3</span>))</span>
<span id="cb80-683"><a href="#cb80-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-684"><a href="#cb80-684" aria-hidden="true" tabindex="-1"></a><span class="co"># Issue types by priority</span></span>
<span id="cb80-685"><a href="#cb80-685" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> ticket_analysis <span class="sc">%&gt;%</span></span>
<span id="cb80-686"><a href="#cb80-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(issue_type, priority) <span class="sc">%&gt;%</span></span>
<span id="cb80-687"><a href="#cb80-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">priority =</span> <span class="fu">factor</span>(priority, </span>
<span id="cb80-688"><a href="#cb80-688" aria-hidden="true" tabindex="-1"></a>    <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>, <span class="st">"Critical"</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb80-689"><a href="#cb80-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> issue_type, <span class="at">y =</span> n, <span class="at">fill =</span> priority)) <span class="sc">+</span></span>
<span id="cb80-690"><a href="#cb80-690" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">position =</span> <span class="st">"fill"</span>) <span class="sc">+</span></span>
<span id="cb80-691"><a href="#cb80-691" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb80-692"><a href="#cb80-692" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb80-693"><a href="#cb80-693" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Issue Types by Priority"</span>,</span>
<span id="cb80-694"><a href="#cb80-694" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Proportion of priority levels"</span>,</span>
<span id="cb80-695"><a href="#cb80-695" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Issue Type"</span>,</span>
<span id="cb80-696"><a href="#cb80-696" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion"</span>,</span>
<span id="cb80-697"><a href="#cb80-697" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Priority"</span></span>
<span id="cb80-698"><a href="#cb80-698" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb80-699"><a href="#cb80-699" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb80-700"><a href="#cb80-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-701"><a href="#cb80-701" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolution time distribution</span></span>
<span id="cb80-702"><a href="#cb80-702" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> ticket_analysis <span class="sc">%&gt;%</span></span>
<span id="cb80-703"><a href="#cb80-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(is_resolved) <span class="sc">%&gt;%</span></span>
<span id="cb80-704"><a href="#cb80-704" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> resolution_time, <span class="at">fill =</span> priority)) <span class="sc">+</span></span>
<span id="cb80-705"><a href="#cb80-705" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins =</span> <span class="dv">30</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb80-706"><a href="#cb80-706" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_log10</span>() <span class="sc">+</span></span>
<span id="cb80-707"><a href="#cb80-707" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>() <span class="sc">+</span></span>
<span id="cb80-708"><a href="#cb80-708" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>priority) <span class="sc">+</span></span>
<span id="cb80-709"><a href="#cb80-709" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb80-710"><a href="#cb80-710" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Resolution Time Distribution"</span>,</span>
<span id="cb80-711"><a href="#cb80-711" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Log scale, by priority"</span>,</span>
<span id="cb80-712"><a href="#cb80-712" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Resolution Time (hours, log scale)"</span>,</span>
<span id="cb80-713"><a href="#cb80-713" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Count"</span></span>
<span id="cb80-714"><a href="#cb80-714" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb80-715"><a href="#cb80-715" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb80-716"><a href="#cb80-716" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-717"><a href="#cb80-717" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine plots</span></span>
<span id="cb80-718"><a href="#cb80-718" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb80-719"><a href="#cb80-719" aria-hidden="true" tabindex="-1"></a>(p1 <span class="sc">+</span> p2) <span class="sc">/</span> (p3 <span class="sc">+</span> p4) <span class="sc">+</span></span>
<span id="cb80-720"><a href="#cb80-720" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_annotation</span>(</span>
<span id="cb80-721"><a href="#cb80-721" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Support Ticket Analysis"</span>,</span>
<span id="cb80-722"><a href="#cb80-722" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Combining string extraction and temporal patterns"</span></span>
<span id="cb80-723"><a href="#cb80-723" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-724"><a href="#cb80-724" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-725"><a href="#cb80-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-726"><a href="#cb80-726" aria-hidden="true" tabindex="-1"></a><span class="fu">## Advanced String Patterns</span></span>
<span id="cb80-727"><a href="#cb80-727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-728"><a href="#cb80-728" aria-hidden="true" tabindex="-1"></a><span class="fu">### Working with Structured Text</span></span>
<span id="cb80-729"><a href="#cb80-729" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-730"><a href="#cb80-730" aria-hidden="true" tabindex="-1"></a>Many datasets contain semi-structured text that needs parsing:</span>
<span id="cb80-731"><a href="#cb80-731" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-734"><a href="#cb80-734" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-735"><a href="#cb80-735" aria-hidden="true" tabindex="-1"></a><span class="co"># Log file entries</span></span>
<span id="cb80-736"><a href="#cb80-736" aria-hidden="true" tabindex="-1"></a>log_entries <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb80-737"><a href="#cb80-737" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[2023-06-15 10:30:45] INFO: User john_doe logged in from 192.168.1.100"</span>,</span>
<span id="cb80-738"><a href="#cb80-738" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[2023-06-15 10:31:02] ERROR: Database connection failed - timeout after 30s"</span>,</span>
<span id="cb80-739"><a href="#cb80-739" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[2023-06-15 10:31:15] WARNING: High memory usage detected (85%)"</span>,</span>
<span id="cb80-740"><a href="#cb80-740" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[2023-06-15 10:32:00] INFO: Backup completed successfully"</span>,</span>
<span id="cb80-741"><a href="#cb80-741" aria-hidden="true" tabindex="-1"></a>  <span class="st">"[2023-06-15 10:33:21] ERROR: File not found: /data/config.json"</span></span>
<span id="cb80-742"><a href="#cb80-742" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-743"><a href="#cb80-743" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-744"><a href="#cb80-744" aria-hidden="true" tabindex="-1"></a><span class="co"># Parse log entries with regex</span></span>
<span id="cb80-745"><a href="#cb80-745" aria-hidden="true" tabindex="-1"></a>parsed_logs <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">log =</span> log_entries) <span class="sc">%&gt;%</span></span>
<span id="cb80-746"><a href="#cb80-746" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-747"><a href="#cb80-747" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract timestamp</span></span>
<span id="cb80-748"><a href="#cb80-748" aria-hidden="true" tabindex="-1"></a>    <span class="at">timestamp =</span> <span class="fu">str_extract</span>(log, <span class="st">"</span><span class="sc">\\</span><span class="st">[([^</span><span class="sc">\\</span><span class="st">]]+)</span><span class="sc">\\</span><span class="st">]"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-749"><a href="#cb80-749" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">[|</span><span class="sc">\\</span><span class="st">]"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-750"><a href="#cb80-750" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ymd_hms</span>(),</span>
<span id="cb80-751"><a href="#cb80-751" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-752"><a href="#cb80-752" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract log level</span></span>
<span id="cb80-753"><a href="#cb80-753" aria-hidden="true" tabindex="-1"></a>    <span class="at">level =</span> <span class="fu">str_extract</span>(log, <span class="st">"INFO|ERROR|WARNING|DEBUG"</span>),</span>
<span id="cb80-754"><a href="#cb80-754" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-755"><a href="#cb80-755" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract message</span></span>
<span id="cb80-756"><a href="#cb80-756" aria-hidden="true" tabindex="-1"></a>    <span class="at">message =</span> <span class="fu">str_extract</span>(log, <span class="st">"(?&lt;=: ).*$"</span>),  <span class="co"># Everything after ": "</span></span>
<span id="cb80-757"><a href="#cb80-757" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-758"><a href="#cb80-758" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract specific patterns</span></span>
<span id="cb80-759"><a href="#cb80-759" aria-hidden="true" tabindex="-1"></a>    <span class="at">username =</span> <span class="fu">str_extract</span>(message, <span class="st">"User (</span><span class="sc">\\</span><span class="st">w+)"</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">"User "</span>),</span>
<span id="cb80-760"><a href="#cb80-760" aria-hidden="true" tabindex="-1"></a>    <span class="at">ip_address =</span> <span class="fu">str_extract</span>(message, <span class="st">"</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb80-761"><a href="#cb80-761" aria-hidden="true" tabindex="-1"></a>    <span class="at">file_path =</span> <span class="fu">str_extract</span>(message, <span class="st">"/[</span><span class="sc">\\</span><span class="st">w/</span><span class="sc">\\</span><span class="st">.]+"</span>),</span>
<span id="cb80-762"><a href="#cb80-762" aria-hidden="true" tabindex="-1"></a>    <span class="at">duration =</span> <span class="fu">str_extract</span>(message, <span class="st">"</span><span class="sc">\\</span><span class="st">d+s"</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">"s"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb80-763"><a href="#cb80-763" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-764"><a href="#cb80-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-765"><a href="#cb80-765" aria-hidden="true" tabindex="-1"></a>parsed_logs <span class="sc">%&gt;%</span></span>
<span id="cb80-766"><a href="#cb80-766" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>log) <span class="sc">%&gt;%</span>  <span class="co"># Remove original for display</span></span>
<span id="cb80-767"><a href="#cb80-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>()</span>
<span id="cb80-768"><a href="#cb80-768" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-769"><a href="#cb80-769" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-770"><a href="#cb80-770" aria-hidden="true" tabindex="-1"></a><span class="fu">### Text Normalization and Cleaning</span></span>
<span id="cb80-771"><a href="#cb80-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-772"><a href="#cb80-772" aria-hidden="true" tabindex="-1"></a>Real text data needs extensive cleaning:</span>
<span id="cb80-773"><a href="#cb80-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-776"><a href="#cb80-776" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-777"><a href="#cb80-777" aria-hidden="true" tabindex="-1"></a><span class="co"># Messy product descriptions</span></span>
<span id="cb80-778"><a href="#cb80-778" aria-hidden="true" tabindex="-1"></a>messy_products <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb80-779"><a href="#cb80-779" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Apple iPhone 14 Pro Max - 256GB - Space Black!!!"</span>,</span>
<span id="cb80-780"><a href="#cb80-780" aria-hidden="true" tabindex="-1"></a>  <span class="st">"samsung galaxy s23 ultra 512gb phantom black"</span>,</span>
<span id="cb80-781"><a href="#cb80-781" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Google Pixel 7 Pro (128 GB) -- Obsidian"</span>,</span>
<span id="cb80-782"><a href="#cb80-782" aria-hidden="true" tabindex="-1"></a>  <span class="st">"OnePlus 11 5G | 16GB RAM | 256GB Storage"</span>,</span>
<span id="cb80-783"><a href="#cb80-783" aria-hidden="true" tabindex="-1"></a>  <span class="st">"  Xiaomi 13 Pro    256GB/12GB    Ceramic Black  "</span></span>
<span id="cb80-784"><a href="#cb80-784" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-785"><a href="#cb80-785" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-786"><a href="#cb80-786" aria-hidden="true" tabindex="-1"></a><span class="co"># Comprehensive cleaning pipeline</span></span>
<span id="cb80-787"><a href="#cb80-787" aria-hidden="true" tabindex="-1"></a>clean_products <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">original =</span> messy_products) <span class="sc">%&gt;%</span></span>
<span id="cb80-788"><a href="#cb80-788" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-789"><a href="#cb80-789" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 1: Basic cleaning</span></span>
<span id="cb80-790"><a href="#cb80-790" aria-hidden="true" tabindex="-1"></a>    <span class="at">cleaned =</span> <span class="fu">str_trim</span>(original) <span class="sc">%&gt;%</span></span>
<span id="cb80-791"><a href="#cb80-791" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_squish</span>() <span class="sc">%&gt;%</span></span>
<span id="cb80-792"><a href="#cb80-792" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove_all</span>(<span class="st">"!!!|</span><span class="sc">\\</span><span class="st">||--"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-793"><a href="#cb80-793" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>, <span class="st">" "</span>),</span>
<span id="cb80-794"><a href="#cb80-794" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-795"><a href="#cb80-795" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 2: Extract components</span></span>
<span id="cb80-796"><a href="#cb80-796" aria-hidden="true" tabindex="-1"></a>    <span class="at">brand =</span> <span class="fu">str_extract</span>(cleaned, <span class="st">"^</span><span class="sc">\\</span><span class="st">w+"</span>) <span class="sc">%&gt;%</span> <span class="fu">str_to_title</span>(),</span>
<span id="cb80-797"><a href="#cb80-797" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-798"><a href="#cb80-798" aria-hidden="true" tabindex="-1"></a>    <span class="at">storage =</span> <span class="fu">str_extract</span>(cleaned, <span class="st">"</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">s*GB"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-799"><a href="#cb80-799" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-800"><a href="#cb80-800" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_to_upper</span>(),</span>
<span id="cb80-801"><a href="#cb80-801" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-802"><a href="#cb80-802" aria-hidden="true" tabindex="-1"></a>    <span class="at">ram =</span> <span class="fu">str_extract</span>(cleaned, <span class="st">"</span><span class="sc">\\</span><span class="st">d+GB</span><span class="sc">\\</span><span class="st">s*RAM|RAM</span><span class="sc">\\</span><span class="st">s*</span><span class="sc">\\</span><span class="st">d+GB"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-803"><a href="#cb80-803" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_extract</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">d+"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-804"><a href="#cb80-804" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(<span class="st">"GB"</span>),</span>
<span id="cb80-805"><a href="#cb80-805" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-806"><a href="#cb80-806" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="fu">str_extract</span>(cleaned, </span>
<span id="cb80-807"><a href="#cb80-807" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Space Black|Phantom Black|Obsidian|Ceramic Black"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-808"><a href="#cb80-808" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_to_title</span>(),</span>
<span id="cb80-809"><a href="#cb80-809" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-810"><a href="#cb80-810" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Step 3: Standardized format</span></span>
<span id="cb80-811"><a href="#cb80-811" aria-hidden="true" tabindex="-1"></a>    <span class="at">standardized =</span> <span class="fu">str_glue</span>(<span class="st">"{brand} - {storage} Storage - {color}"</span>)</span>
<span id="cb80-812"><a href="#cb80-812" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-813"><a href="#cb80-813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-814"><a href="#cb80-814" aria-hidden="true" tabindex="-1"></a>clean_products <span class="sc">%&gt;%</span></span>
<span id="cb80-815"><a href="#cb80-815" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(original, standardized)</span>
<span id="cb80-816"><a href="#cb80-816" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-817"><a href="#cb80-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-818"><a href="#cb80-818" aria-hidden="true" tabindex="-1"></a><span class="fu">## Working with Date Ranges and Business Logic</span></span>
<span id="cb80-819"><a href="#cb80-819" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-820"><a href="#cb80-820" aria-hidden="true" tabindex="-1"></a>Real-world applications often involve complex date logic:</span>
<span id="cb80-821"><a href="#cb80-821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-824"><a href="#cb80-824" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-825"><a href="#cb80-825" aria-hidden="true" tabindex="-1"></a><span class="co"># Business calendar functions</span></span>
<span id="cb80-826"><a href="#cb80-826" aria-hidden="true" tabindex="-1"></a>is_business_day <span class="ot">&lt;-</span> <span class="cf">function</span>(date) {</span>
<span id="cb80-827"><a href="#cb80-827" aria-hidden="true" tabindex="-1"></a>  <span class="sc">!</span><span class="fu">wday</span>(date) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">7</span>)  <span class="co"># Not weekend</span></span>
<span id="cb80-828"><a href="#cb80-828" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-829"><a href="#cb80-829" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-830"><a href="#cb80-830" aria-hidden="true" tabindex="-1"></a>next_business_day <span class="ot">&lt;-</span> <span class="cf">function</span>(date) {</span>
<span id="cb80-831"><a href="#cb80-831" aria-hidden="true" tabindex="-1"></a>  next_day <span class="ot">&lt;-</span> date <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb80-832"><a href="#cb80-832" aria-hidden="true" tabindex="-1"></a>  <span class="cf">while</span> (<span class="sc">!</span><span class="fu">is_business_day</span>(next_day)) {</span>
<span id="cb80-833"><a href="#cb80-833" aria-hidden="true" tabindex="-1"></a>    next_day <span class="ot">&lt;-</span> next_day <span class="sc">+</span> <span class="fu">days</span>(<span class="dv">1</span>)</span>
<span id="cb80-834"><a href="#cb80-834" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-835"><a href="#cb80-835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(next_day)</span>
<span id="cb80-836"><a href="#cb80-836" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-837"><a href="#cb80-837" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-838"><a href="#cb80-838" aria-hidden="true" tabindex="-1"></a>add_business_days <span class="ot">&lt;-</span> <span class="cf">function</span>(date, n) {</span>
<span id="cb80-839"><a href="#cb80-839" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> date</span>
<span id="cb80-840"><a href="#cb80-840" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb80-841"><a href="#cb80-841" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">next_business_day</span>(result)</span>
<span id="cb80-842"><a href="#cb80-842" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-843"><a href="#cb80-843" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb80-844"><a href="#cb80-844" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb80-845"><a href="#cb80-845" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-846"><a href="#cb80-846" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Project timeline</span></span>
<span id="cb80-847"><a href="#cb80-847" aria-hidden="true" tabindex="-1"></a>project_tasks <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-848"><a href="#cb80-848" aria-hidden="true" tabindex="-1"></a>  <span class="at">task =</span> <span class="fu">c</span>(<span class="st">"Planning"</span>, <span class="st">"Development"</span>, <span class="st">"Testing"</span>, <span class="st">"Deployment"</span>, <span class="st">"Review"</span>),</span>
<span id="cb80-849"><a href="#cb80-849" aria-hidden="true" tabindex="-1"></a>  <span class="at">duration_days =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">15</span>, <span class="dv">10</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb80-850"><a href="#cb80-850" aria-hidden="true" tabindex="-1"></a>  <span class="at">start_date =</span> <span class="fu">ymd</span>(<span class="st">"2023-07-03"</span>)  <span class="co"># Starting on a Monday</span></span>
<span id="cb80-851"><a href="#cb80-851" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-852"><a href="#cb80-852" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-853"><a href="#cb80-853" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate end dates considering only business days</span></span>
<span id="cb80-854"><a href="#cb80-854" aria-hidden="true" tabindex="-1"></a>project_timeline <span class="ot">&lt;-</span> project_tasks <span class="sc">%&gt;%</span></span>
<span id="cb80-855"><a href="#cb80-855" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-856"><a href="#cb80-856" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simple calendar days</span></span>
<span id="cb80-857"><a href="#cb80-857" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_date_calendar =</span> start_date <span class="sc">+</span> <span class="fu">days</span>(duration_days <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb80-858"><a href="#cb80-858" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-859"><a href="#cb80-859" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Business days only</span></span>
<span id="cb80-860"><a href="#cb80-860" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_date_business =</span> <span class="fu">map2</span>(start_date, duration_days, </span>
<span id="cb80-861"><a href="#cb80-861" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">~</span><span class="fu">add_business_days</span>(.x, .y <span class="sc">-</span> <span class="dv">1</span>)),</span>
<span id="cb80-862"><a href="#cb80-862" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_date_business =</span> <span class="fu">as_date</span>(<span class="fu">unlist</span>(end_date_business)),</span>
<span id="cb80-863"><a href="#cb80-863" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-864"><a href="#cb80-864" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Actual duration including weekends</span></span>
<span id="cb80-865"><a href="#cb80-865" aria-hidden="true" tabindex="-1"></a>    <span class="at">actual_calendar_days =</span> <span class="fu">as.numeric</span>(end_date_business <span class="sc">-</span> start_date <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb80-866"><a href="#cb80-866" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-867"><a href="#cb80-867" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Next task start</span></span>
<span id="cb80-868"><a href="#cb80-868" aria-hidden="true" tabindex="-1"></a>    <span class="at">next_start =</span> <span class="fu">lead</span>(end_date_business) <span class="sc">%&gt;%</span> </span>
<span id="cb80-869"><a href="#cb80-869" aria-hidden="true" tabindex="-1"></a>      <span class="fu">map_if</span>(<span class="sc">~!</span><span class="fu">is.na</span>(.), <span class="sc">~</span><span class="fu">next_business_day</span>(.)) <span class="sc">%&gt;%</span></span>
<span id="cb80-870"><a href="#cb80-870" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>() <span class="sc">%&gt;%</span></span>
<span id="cb80-871"><a href="#cb80-871" aria-hidden="true" tabindex="-1"></a>      <span class="fu">as_date</span>()</span>
<span id="cb80-872"><a href="#cb80-872" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-873"><a href="#cb80-873" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-874"><a href="#cb80-874" aria-hidden="true" tabindex="-1"></a>project_timeline <span class="sc">%&gt;%</span></span>
<span id="cb80-875"><a href="#cb80-875" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(task, duration_days, start_date, end_date_business, actual_calendar_days)</span>
<span id="cb80-876"><a href="#cb80-876" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-877"><a href="#cb80-877" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-878"><a href="#cb80-878" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb80-879"><a href="#cb80-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-880"><a href="#cb80-880" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 1: Email Parsing and Validation</span></span>
<span id="cb80-881"><a href="#cb80-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-882"><a href="#cb80-882" aria-hidden="true" tabindex="-1"></a>Parse and validate a set of email addresses:</span>
<span id="cb80-883"><a href="#cb80-883" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-886"><a href="#cb80-886" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-887"><a href="#cb80-887" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb80-888"><a href="#cb80-888" aria-hidden="true" tabindex="-1"></a>email_data <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb80-889"><a href="#cb80-889" aria-hidden="true" tabindex="-1"></a>  <span class="st">"john.doe@company.com"</span>,</span>
<span id="cb80-890"><a href="#cb80-890" aria-hidden="true" tabindex="-1"></a>  <span class="st">"alice_smith@university.edu"</span>,</span>
<span id="cb80-891"><a href="#cb80-891" aria-hidden="true" tabindex="-1"></a>  <span class="st">"bob@sub.domain.co.uk"</span>,</span>
<span id="cb80-892"><a href="#cb80-892" aria-hidden="true" tabindex="-1"></a>  <span class="st">"invalid.email"</span>,</span>
<span id="cb80-893"><a href="#cb80-893" aria-hidden="true" tabindex="-1"></a>  <span class="st">"no-at-sign.com"</span>,</span>
<span id="cb80-894"><a href="#cb80-894" aria-hidden="true" tabindex="-1"></a>  <span class="st">"@missing-user.com"</span>,</span>
<span id="cb80-895"><a href="#cb80-895" aria-hidden="true" tabindex="-1"></a>  <span class="st">"user@"</span>,</span>
<span id="cb80-896"><a href="#cb80-896" aria-hidden="true" tabindex="-1"></a>  <span class="st">"first.last+tag@gmail.com"</span></span>
<span id="cb80-897"><a href="#cb80-897" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-898"><a href="#cb80-898" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-899"><a href="#cb80-899" aria-hidden="true" tabindex="-1"></a>email_validation <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">email =</span> email_data) <span class="sc">%&gt;%</span></span>
<span id="cb80-900"><a href="#cb80-900" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-901"><a href="#cb80-901" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Check basic structure</span></span>
<span id="cb80-902"><a href="#cb80-902" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_at =</span> <span class="fu">str_detect</span>(email, <span class="st">"@"</span>),</span>
<span id="cb80-903"><a href="#cb80-903" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_dot_after_at =</span> <span class="fu">str_detect</span>(email, <span class="st">"@.*</span><span class="sc">\\</span><span class="st">."</span>),</span>
<span id="cb80-904"><a href="#cb80-904" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-905"><a href="#cb80-905" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract parts</span></span>
<span id="cb80-906"><a href="#cb80-906" aria-hidden="true" tabindex="-1"></a>    <span class="at">username =</span> <span class="fu">str_extract</span>(email, <span class="st">"^[^@]+"</span>),</span>
<span id="cb80-907"><a href="#cb80-907" aria-hidden="true" tabindex="-1"></a>    <span class="at">domain =</span> <span class="fu">str_extract</span>(email, <span class="st">"@(.+)$"</span>) <span class="sc">%&gt;%</span> <span class="fu">str_remove</span>(<span class="st">"@"</span>),</span>
<span id="cb80-908"><a href="#cb80-908" aria-hidden="true" tabindex="-1"></a>    <span class="at">tld =</span> <span class="fu">str_extract</span>(email, <span class="st">"</span><span class="sc">\\</span><span class="st">.[a-z]+$"</span>),</span>
<span id="cb80-909"><a href="#cb80-909" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-910"><a href="#cb80-910" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Validate</span></span>
<span id="cb80-911"><a href="#cb80-911" aria-hidden="true" tabindex="-1"></a>    <span class="at">valid_username =</span> <span class="fu">str_detect</span>(username, <span class="st">"^[a-zA-Z0-9._+-]+$"</span>),</span>
<span id="cb80-912"><a href="#cb80-912" aria-hidden="true" tabindex="-1"></a>    <span class="at">valid_domain =</span> <span class="fu">str_detect</span>(domain, <span class="st">"^[a-zA-Z0-9.-]+</span><span class="sc">\\</span><span class="st">.[a-zA-Z]{2,}$"</span>),</span>
<span id="cb80-913"><a href="#cb80-913" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-914"><a href="#cb80-914" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Overall validity</span></span>
<span id="cb80-915"><a href="#cb80-915" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_valid =</span> has_at <span class="sc">&amp;</span> has_dot_after_at <span class="sc">&amp;</span> </span>
<span id="cb80-916"><a href="#cb80-916" aria-hidden="true" tabindex="-1"></a>               <span class="sc">!</span><span class="fu">is.na</span>(username) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(domain) <span class="sc">&amp;</span></span>
<span id="cb80-917"><a href="#cb80-917" aria-hidden="true" tabindex="-1"></a>               valid_username <span class="sc">&amp;</span> valid_domain</span>
<span id="cb80-918"><a href="#cb80-918" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-919"><a href="#cb80-919" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-920"><a href="#cb80-920" aria-hidden="true" tabindex="-1"></a>email_validation <span class="sc">%&gt;%</span></span>
<span id="cb80-921"><a href="#cb80-921" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(email, username, domain, is_valid)</span>
<span id="cb80-922"><a href="#cb80-922" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-923"><a href="#cb80-923" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-924"><a href="#cb80-924" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 2: Date Range Calculations</span></span>
<span id="cb80-925"><a href="#cb80-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-926"><a href="#cb80-926" aria-hidden="true" tabindex="-1"></a>Calculate various date ranges and intervals:</span>
<span id="cb80-927"><a href="#cb80-927" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-930"><a href="#cb80-930" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-931"><a href="#cb80-931" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb80-932"><a href="#cb80-932" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate age, next birthday, days until birthday</span></span>
<span id="cb80-933"><a href="#cb80-933" aria-hidden="true" tabindex="-1"></a>people <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-934"><a href="#cb80-934" aria-hidden="true" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>, <span class="st">"Diana"</span>),</span>
<span id="cb80-935"><a href="#cb80-935" aria-hidden="true" tabindex="-1"></a>  <span class="at">birth_date =</span> <span class="fu">ymd</span>(<span class="fu">c</span>(<span class="st">"1990-03-15"</span>, <span class="st">"1985-07-22"</span>, <span class="st">"1995-12-01"</span>, <span class="st">"2000-01-30"</span>))</span>
<span id="cb80-936"><a href="#cb80-936" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-937"><a href="#cb80-937" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-938"><a href="#cb80-938" aria-hidden="true" tabindex="-1"></a>today_date <span class="ot">&lt;-</span> <span class="fu">today</span>()</span>
<span id="cb80-939"><a href="#cb80-939" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-940"><a href="#cb80-940" aria-hidden="true" tabindex="-1"></a>people_ages <span class="ot">&lt;-</span> people <span class="sc">%&gt;%</span></span>
<span id="cb80-941"><a href="#cb80-941" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-942"><a href="#cb80-942" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate age</span></span>
<span id="cb80-943"><a href="#cb80-943" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_years =</span> <span class="fu">interval</span>(birth_date, today_date) <span class="sc">/</span> <span class="fu">years</span>(<span class="dv">1</span>),</span>
<span id="cb80-944"><a href="#cb80-944" aria-hidden="true" tabindex="-1"></a>    <span class="at">age_exact =</span> <span class="fu">floor</span>(age_years),</span>
<span id="cb80-945"><a href="#cb80-945" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-946"><a href="#cb80-946" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Next birthday</span></span>
<span id="cb80-947"><a href="#cb80-947" aria-hidden="true" tabindex="-1"></a>    <span class="at">birthday_this_year =</span> <span class="st">`</span><span class="at">year&lt;-</span><span class="st">`</span>(birth_date, <span class="fu">year</span>(today_date)),</span>
<span id="cb80-948"><a href="#cb80-948" aria-hidden="true" tabindex="-1"></a>    <span class="at">next_birthday =</span> <span class="fu">if_else</span>(</span>
<span id="cb80-949"><a href="#cb80-949" aria-hidden="true" tabindex="-1"></a>      birthday_this_year <span class="sc">&lt;</span> today_date,</span>
<span id="cb80-950"><a href="#cb80-950" aria-hidden="true" tabindex="-1"></a>      <span class="st">`</span><span class="at">year&lt;-</span><span class="st">`</span>(birth_date, <span class="fu">year</span>(today_date) <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb80-951"><a href="#cb80-951" aria-hidden="true" tabindex="-1"></a>      birthday_this_year</span>
<span id="cb80-952"><a href="#cb80-952" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb80-953"><a href="#cb80-953" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-954"><a href="#cb80-954" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Days until birthday</span></span>
<span id="cb80-955"><a href="#cb80-955" aria-hidden="true" tabindex="-1"></a>    <span class="at">days_to_birthday =</span> <span class="fu">as.numeric</span>(next_birthday <span class="sc">-</span> today_date),</span>
<span id="cb80-956"><a href="#cb80-956" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-957"><a href="#cb80-957" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Day of week for next birthday</span></span>
<span id="cb80-958"><a href="#cb80-958" aria-hidden="true" tabindex="-1"></a>    <span class="at">birthday_weekday =</span> <span class="fu">wday</span>(next_birthday, <span class="at">label =</span> <span class="cn">TRUE</span>, <span class="at">abbr =</span> <span class="cn">FALSE</span>)</span>
<span id="cb80-959"><a href="#cb80-959" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-960"><a href="#cb80-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-961"><a href="#cb80-961" aria-hidden="true" tabindex="-1"></a>people_ages <span class="sc">%&gt;%</span></span>
<span id="cb80-962"><a href="#cb80-962" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(name, age_exact, next_birthday, days_to_birthday, birthday_weekday)</span>
<span id="cb80-963"><a href="#cb80-963" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-964"><a href="#cb80-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-965"><a href="#cb80-965" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 3: Log File Analysis</span></span>
<span id="cb80-966"><a href="#cb80-966" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-967"><a href="#cb80-967" aria-hidden="true" tabindex="-1"></a>Analyze server log patterns:</span>
<span id="cb80-968"><a href="#cb80-968" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-971"><a href="#cb80-971" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-972"><a href="#cb80-972" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb80-973"><a href="#cb80-973" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate sample log data</span></span>
<span id="cb80-974"><a href="#cb80-974" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb80-975"><a href="#cb80-975" aria-hidden="true" tabindex="-1"></a>n_logs <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb80-976"><a href="#cb80-976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-977"><a href="#cb80-977" aria-hidden="true" tabindex="-1"></a>log_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-978"><a href="#cb80-978" aria-hidden="true" tabindex="-1"></a>  <span class="at">timestamp =</span> <span class="fu">ymd_hms</span>(<span class="st">"2023-06-01 00:00:00"</span>) <span class="sc">+</span> <span class="fu">seconds</span>(<span class="fu">sort</span>(<span class="fu">runif</span>(n_logs, <span class="dv">0</span>, <span class="dv">30</span><span class="sc">*</span><span class="dv">24</span><span class="sc">*</span><span class="dv">60</span><span class="sc">*</span><span class="dv">60</span>))),</span>
<span id="cb80-979"><a href="#cb80-979" aria-hidden="true" tabindex="-1"></a>  <span class="at">level =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"INFO"</span>, <span class="st">"WARNING"</span>, <span class="st">"ERROR"</span>, <span class="st">"DEBUG"</span>), n_logs, </span>
<span id="cb80-980"><a href="#cb80-980" aria-hidden="true" tabindex="-1"></a>                <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.3</span>, <span class="fl">0.15</span>, <span class="fl">0.05</span>)),</span>
<span id="cb80-981"><a href="#cb80-981" aria-hidden="true" tabindex="-1"></a>  <span class="at">service =</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">"auth"</span>, <span class="st">"api"</span>, <span class="st">"database"</span>, <span class="st">"cache"</span>), n_logs, <span class="at">replace =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-982"><a href="#cb80-982" aria-hidden="true" tabindex="-1"></a>  <span class="at">message =</span> <span class="fu">sample</span>(<span class="fu">c</span>(</span>
<span id="cb80-983"><a href="#cb80-983" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Request processed successfully"</span>,</span>
<span id="cb80-984"><a href="#cb80-984" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Connection timeout after 30s"</span>,</span>
<span id="cb80-985"><a href="#cb80-985" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Invalid authentication token"</span>,</span>
<span id="cb80-986"><a href="#cb80-986" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Cache miss for key: user_123"</span>,</span>
<span id="cb80-987"><a href="#cb80-987" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Database query took 1250ms"</span>,</span>
<span id="cb80-988"><a href="#cb80-988" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Rate limit exceeded for IP 192.168.1.1"</span></span>
<span id="cb80-989"><a href="#cb80-989" aria-hidden="true" tabindex="-1"></a>  ), n_logs, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-990"><a href="#cb80-990" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb80-991"><a href="#cb80-991" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-992"><a href="#cb80-992" aria-hidden="true" tabindex="-1"></a>    <span class="at">log_entry =</span> <span class="fu">str_glue</span>(<span class="st">"[{timestamp}] {level} [{service}]: {message}"</span>)</span>
<span id="cb80-993"><a href="#cb80-993" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-994"><a href="#cb80-994" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-995"><a href="#cb80-995" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze the logs</span></span>
<span id="cb80-996"><a href="#cb80-996" aria-hidden="true" tabindex="-1"></a>log_analysis <span class="ot">&lt;-</span> log_data <span class="sc">%&gt;%</span></span>
<span id="cb80-997"><a href="#cb80-997" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-998"><a href="#cb80-998" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as_date</span>(timestamp),</span>
<span id="cb80-999"><a href="#cb80-999" aria-hidden="true" tabindex="-1"></a>    <span class="at">hour =</span> <span class="fu">hour</span>(timestamp),</span>
<span id="cb80-1000"><a href="#cb80-1000" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-1001"><a href="#cb80-1001" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract metrics from messages</span></span>
<span id="cb80-1002"><a href="#cb80-1002" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_timeout =</span> <span class="fu">str_detect</span>(message, <span class="st">"timeout"</span>),</span>
<span id="cb80-1003"><a href="#cb80-1003" aria-hidden="true" tabindex="-1"></a>    <span class="at">timeout_duration =</span> <span class="fu">str_extract</span>(message, <span class="st">"</span><span class="sc">\\</span><span class="st">d+s"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-1004"><a href="#cb80-1004" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove</span>(<span class="st">"s"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb80-1005"><a href="#cb80-1005" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-1006"><a href="#cb80-1006" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_ip =</span> <span class="fu">str_detect</span>(message, <span class="st">"</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb80-1007"><a href="#cb80-1007" aria-hidden="true" tabindex="-1"></a>    <span class="at">ip_address =</span> <span class="fu">str_extract</span>(message, <span class="st">"</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+</span><span class="sc">\\</span><span class="st">.</span><span class="sc">\\</span><span class="st">d+"</span>),</span>
<span id="cb80-1008"><a href="#cb80-1008" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-1009"><a href="#cb80-1009" aria-hidden="true" tabindex="-1"></a>    <span class="at">query_time =</span> <span class="fu">str_extract</span>(message, <span class="st">"</span><span class="sc">\\</span><span class="st">d+ms"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb80-1010"><a href="#cb80-1010" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_remove</span>(<span class="st">"ms"</span>) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>(),</span>
<span id="cb80-1011"><a href="#cb80-1011" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-1012"><a href="#cb80-1012" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Categorize issues</span></span>
<span id="cb80-1013"><a href="#cb80-1013" aria-hidden="true" tabindex="-1"></a>    <span class="at">issue_type =</span> <span class="fu">case_when</span>(</span>
<span id="cb80-1014"><a href="#cb80-1014" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(message, <span class="st">"timeout|slow|took </span><span class="sc">\\</span><span class="st">d+ms"</span>) <span class="sc">~</span> <span class="st">"Performance"</span>,</span>
<span id="cb80-1015"><a href="#cb80-1015" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(message, <span class="st">"Invalid|error|failed"</span>) <span class="sc">~</span> <span class="st">"Error"</span>,</span>
<span id="cb80-1016"><a href="#cb80-1016" aria-hidden="true" tabindex="-1"></a>      <span class="fu">str_detect</span>(message, <span class="st">"exceeded|limit"</span>) <span class="sc">~</span> <span class="st">"Rate Limiting"</span>,</span>
<span id="cb80-1017"><a href="#cb80-1017" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Normal"</span></span>
<span id="cb80-1018"><a href="#cb80-1018" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb80-1019"><a href="#cb80-1019" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-1020"><a href="#cb80-1020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1021"><a href="#cb80-1021" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary by service and level</span></span>
<span id="cb80-1022"><a href="#cb80-1022" aria-hidden="true" tabindex="-1"></a>log_summary <span class="ot">&lt;-</span> log_analysis <span class="sc">%&gt;%</span></span>
<span id="cb80-1023"><a href="#cb80-1023" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(service, level) <span class="sc">%&gt;%</span></span>
<span id="cb80-1024"><a href="#cb80-1024" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb80-1025"><a href="#cb80-1025" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb80-1026"><a href="#cb80-1026" aria-hidden="true" tabindex="-1"></a>    <span class="at">pct_errors =</span> <span class="fu">mean</span>(issue_type <span class="sc">==</span> <span class="st">"Error"</span>) <span class="sc">*</span> <span class="dv">100</span>,</span>
<span id="cb80-1027"><a href="#cb80-1027" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_query_time =</span> <span class="fu">mean</span>(query_time, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-1028"><a href="#cb80-1028" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb80-1029"><a href="#cb80-1029" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb80-1030"><a href="#cb80-1030" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(service, level)</span>
<span id="cb80-1031"><a href="#cb80-1031" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1032"><a href="#cb80-1032" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(log_summary)</span>
<span id="cb80-1033"><a href="#cb80-1033" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1034"><a href="#cb80-1034" aria-hidden="true" tabindex="-1"></a><span class="co"># Time pattern analysis</span></span>
<span id="cb80-1035"><a href="#cb80-1035" aria-hidden="true" tabindex="-1"></a>hourly_pattern <span class="ot">&lt;-</span> log_analysis <span class="sc">%&gt;%</span></span>
<span id="cb80-1036"><a href="#cb80-1036" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(hour, level) <span class="sc">%&gt;%</span></span>
<span id="cb80-1037"><a href="#cb80-1037" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-1038"><a href="#cb80-1038" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> hour, <span class="at">y =</span> count, <span class="at">color =</span> level)) <span class="sc">+</span></span>
<span id="cb80-1039"><a href="#cb80-1039" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb80-1040"><a href="#cb80-1040" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(</span>
<span id="cb80-1041"><a href="#cb80-1041" aria-hidden="true" tabindex="-1"></a>    <span class="st">"INFO"</span> <span class="ot">=</span> <span class="st">"green"</span>,</span>
<span id="cb80-1042"><a href="#cb80-1042" aria-hidden="true" tabindex="-1"></a>    <span class="st">"WARNING"</span> <span class="ot">=</span> <span class="st">"orange"</span>, </span>
<span id="cb80-1043"><a href="#cb80-1043" aria-hidden="true" tabindex="-1"></a>    <span class="st">"ERROR"</span> <span class="ot">=</span> <span class="st">"red"</span>,</span>
<span id="cb80-1044"><a href="#cb80-1044" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DEBUG"</span> <span class="ot">=</span> <span class="st">"blue"</span></span>
<span id="cb80-1045"><a href="#cb80-1045" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb80-1046"><a href="#cb80-1046" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb80-1047"><a href="#cb80-1047" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Log Patterns by Hour"</span>,</span>
<span id="cb80-1048"><a href="#cb80-1048" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hour of Day"</span>,</span>
<span id="cb80-1049"><a href="#cb80-1049" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Log Count"</span></span>
<span id="cb80-1050"><a href="#cb80-1050" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-1051"><a href="#cb80-1051" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1052"><a href="#cb80-1052" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(hourly_pattern)</span>
<span id="cb80-1053"><a href="#cb80-1053" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1054"><a href="#cb80-1054" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1055"><a href="#cb80-1055" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 4: Text Mining Product Reviews</span></span>
<span id="cb80-1056"><a href="#cb80-1056" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1057"><a href="#cb80-1057" aria-hidden="true" tabindex="-1"></a>Analyze product review text and dates:</span>
<span id="cb80-1058"><a href="#cb80-1058" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1061"><a href="#cb80-1061" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb80-1062"><a href="#cb80-1062" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb80-1063"><a href="#cb80-1063" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate sample review data</span></span>
<span id="cb80-1064"><a href="#cb80-1064" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb80-1065"><a href="#cb80-1065" aria-hidden="true" tabindex="-1"></a>n_reviews <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb80-1066"><a href="#cb80-1066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1067"><a href="#cb80-1067" aria-hidden="true" tabindex="-1"></a>reviews <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb80-1068"><a href="#cb80-1068" aria-hidden="true" tabindex="-1"></a>  <span class="at">review_id =</span> <span class="dv">1</span><span class="sc">:</span>n_reviews,</span>
<span id="cb80-1069"><a href="#cb80-1069" aria-hidden="true" tabindex="-1"></a>  <span class="at">review_date =</span> <span class="fu">ymd</span>(<span class="st">"2023-01-01"</span>) <span class="sc">+</span> <span class="fu">days</span>(<span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">180</span>, n_reviews, <span class="at">replace =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb80-1070"><a href="#cb80-1070" aria-hidden="true" tabindex="-1"></a>  <span class="at">rating =</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, n_reviews, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.05</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.35</span>, <span class="fl">0.3</span>)),</span>
<span id="cb80-1071"><a href="#cb80-1071" aria-hidden="true" tabindex="-1"></a>  <span class="at">review_text =</span> <span class="fu">sample</span>(<span class="fu">c</span>(</span>
<span id="cb80-1072"><a href="#cb80-1072" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Great product! Highly recommend. Fast shipping too."</span>,</span>
<span id="cb80-1073"><a href="#cb80-1073" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Terrible quality. Broke after one day. Very disappointed."</span>,</span>
<span id="cb80-1074"><a href="#cb80-1074" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Good value for money. Works as expected."</span>,</span>
<span id="cb80-1075"><a href="#cb80-1075" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Amazing! Best purchase ever! 10/10 would buy again!"</span>,</span>
<span id="cb80-1076"><a href="#cb80-1076" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Not bad, but not great either. Average product."</span>,</span>
<span id="cb80-1077"><a href="#cb80-1077" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Excellent customer service. Product is okay."</span>,</span>
<span id="cb80-1078"><a href="#cb80-1078" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Waste of money. Do not buy!"</span>,</span>
<span id="cb80-1079"><a href="#cb80-1079" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Pretty good, some minor issues but overall satisfied."</span>,</span>
<span id="cb80-1080"><a href="#cb80-1080" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Perfect! Exactly what I needed. Five stars!"</span>,</span>
<span id="cb80-1081"><a href="#cb80-1081" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Meh. Expected better for the price."</span></span>
<span id="cb80-1082"><a href="#cb80-1082" aria-hidden="true" tabindex="-1"></a>  ), n_reviews, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb80-1083"><a href="#cb80-1083" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-1084"><a href="#cb80-1084" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1085"><a href="#cb80-1085" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze reviews</span></span>
<span id="cb80-1086"><a href="#cb80-1086" aria-hidden="true" tabindex="-1"></a>review_analysis <span class="ot">&lt;-</span> reviews <span class="sc">%&gt;%</span></span>
<span id="cb80-1087"><a href="#cb80-1087" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb80-1088"><a href="#cb80-1088" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Text length and complexity</span></span>
<span id="cb80-1089"><a href="#cb80-1089" aria-hidden="true" tabindex="-1"></a>    <span class="at">text_length =</span> <span class="fu">str_length</span>(review_text),</span>
<span id="cb80-1090"><a href="#cb80-1090" aria-hidden="true" tabindex="-1"></a>    <span class="at">word_count =</span> <span class="fu">str_count</span>(review_text, <span class="st">"</span><span class="sc">\\</span><span class="st">w+"</span>),</span>
<span id="cb80-1091"><a href="#cb80-1091" aria-hidden="true" tabindex="-1"></a>    <span class="at">sentence_count =</span> <span class="fu">str_count</span>(review_text, <span class="st">"[.!?]"</span>),</span>
<span id="cb80-1092"><a href="#cb80-1092" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_word_length =</span> text_length <span class="sc">/</span> word_count,</span>
<span id="cb80-1093"><a href="#cb80-1093" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-1094"><a href="#cb80-1094" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sentiment indicators</span></span>
<span id="cb80-1095"><a href="#cb80-1095" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_positive =</span> <span class="fu">str_detect</span>(review_text, </span>
<span id="cb80-1096"><a href="#cb80-1096" aria-hidden="true" tabindex="-1"></a>      <span class="st">"(?i)great|excellent|amazing|perfect|love|best"</span>),</span>
<span id="cb80-1097"><a href="#cb80-1097" aria-hidden="true" tabindex="-1"></a>    <span class="at">has_negative =</span> <span class="fu">str_detect</span>(review_text, </span>
<span id="cb80-1098"><a href="#cb80-1098" aria-hidden="true" tabindex="-1"></a>      <span class="st">"(?i)terrible|bad|worst|hate|disappoint|waste"</span>),</span>
<span id="cb80-1099"><a href="#cb80-1099" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-1100"><a href="#cb80-1100" aria-hidden="true" tabindex="-1"></a>    <span class="at">exclamation_count =</span> <span class="fu">str_count</span>(review_text, <span class="st">"!"</span>),</span>
<span id="cb80-1101"><a href="#cb80-1101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-1102"><a href="#cb80-1102" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Time-based features</span></span>
<span id="cb80-1103"><a href="#cb80-1103" aria-hidden="true" tabindex="-1"></a>    <span class="at">review_month =</span> <span class="fu">month</span>(review_date, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-1104"><a href="#cb80-1104" aria-hidden="true" tabindex="-1"></a>    <span class="at">review_weekday =</span> <span class="fu">wday</span>(review_date, <span class="at">label =</span> <span class="cn">TRUE</span>),</span>
<span id="cb80-1105"><a href="#cb80-1105" aria-hidden="true" tabindex="-1"></a>    <span class="at">days_since_launch =</span> <span class="fu">as.numeric</span>(review_date <span class="sc">-</span> <span class="fu">min</span>(review_date)),</span>
<span id="cb80-1106"><a href="#cb80-1106" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb80-1107"><a href="#cb80-1107" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Categorize sentiment</span></span>
<span id="cb80-1108"><a href="#cb80-1108" aria-hidden="true" tabindex="-1"></a>    <span class="at">sentiment =</span> <span class="fu">case_when</span>(</span>
<span id="cb80-1109"><a href="#cb80-1109" aria-hidden="true" tabindex="-1"></a>      has_positive <span class="sc">&amp;</span> <span class="sc">!</span>has_negative <span class="sc">~</span> <span class="st">"Positive"</span>,</span>
<span id="cb80-1110"><a href="#cb80-1110" aria-hidden="true" tabindex="-1"></a>      has_negative <span class="sc">&amp;</span> <span class="sc">!</span>has_positive <span class="sc">~</span> <span class="st">"Negative"</span>,</span>
<span id="cb80-1111"><a href="#cb80-1111" aria-hidden="true" tabindex="-1"></a>      has_positive <span class="sc">&amp;</span> has_negative <span class="sc">~</span> <span class="st">"Mixed"</span>,</span>
<span id="cb80-1112"><a href="#cb80-1112" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Neutral"</span></span>
<span id="cb80-1113"><a href="#cb80-1113" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb80-1114"><a href="#cb80-1114" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-1115"><a href="#cb80-1115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1116"><a href="#cb80-1116" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation between text features and rating</span></span>
<span id="cb80-1117"><a href="#cb80-1117" aria-hidden="true" tabindex="-1"></a>feature_correlation <span class="ot">&lt;-</span> review_analysis <span class="sc">%&gt;%</span></span>
<span id="cb80-1118"><a href="#cb80-1118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb80-1119"><a href="#cb80-1119" aria-hidden="true" tabindex="-1"></a>    <span class="at">cor_length_rating =</span> <span class="fu">cor</span>(text_length, rating),</span>
<span id="cb80-1120"><a href="#cb80-1120" aria-hidden="true" tabindex="-1"></a>    <span class="at">cor_exclamation_rating =</span> <span class="fu">cor</span>(exclamation_count, rating),</span>
<span id="cb80-1121"><a href="#cb80-1121" aria-hidden="true" tabindex="-1"></a>    <span class="at">cor_positive_rating =</span> <span class="fu">cor</span>(<span class="fu">as.numeric</span>(has_positive), rating),</span>
<span id="cb80-1122"><a href="#cb80-1122" aria-hidden="true" tabindex="-1"></a>    <span class="at">cor_negative_rating =</span> <span class="fu">cor</span>(<span class="fu">as.numeric</span>(has_negative), rating)</span>
<span id="cb80-1123"><a href="#cb80-1123" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-1124"><a href="#cb80-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1125"><a href="#cb80-1125" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Feature correlations with rating:"</span>)</span>
<span id="cb80-1126"><a href="#cb80-1126" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(feature_correlation)</span>
<span id="cb80-1127"><a href="#cb80-1127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1128"><a href="#cb80-1128" aria-hidden="true" tabindex="-1"></a><span class="co"># Sentiment vs actual rating</span></span>
<span id="cb80-1129"><a href="#cb80-1129" aria-hidden="true" tabindex="-1"></a>sentiment_accuracy <span class="ot">&lt;-</span> review_analysis <span class="sc">%&gt;%</span></span>
<span id="cb80-1130"><a href="#cb80-1130" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sentiment) <span class="sc">%&gt;%</span></span>
<span id="cb80-1131"><a href="#cb80-1131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb80-1132"><a href="#cb80-1132" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_rating =</span> <span class="fu">mean</span>(rating),</span>
<span id="cb80-1133"><a href="#cb80-1133" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb80-1134"><a href="#cb80-1134" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb80-1135"><a href="#cb80-1135" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-1136"><a href="#cb80-1136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1137"><a href="#cb80-1137" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Sentiment analysis accuracy:"</span>)</span>
<span id="cb80-1138"><a href="#cb80-1138" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(sentiment_accuracy)</span>
<span id="cb80-1139"><a href="#cb80-1139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb80-1140"><a href="#cb80-1140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1141"><a href="#cb80-1141" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb80-1142"><a href="#cb80-1142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1143"><a href="#cb80-1143" aria-hidden="true" tabindex="-1"></a>In this comprehensive chapter, you've mastered:</span>
<span id="cb80-1144"><a href="#cb80-1144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1145"><a href="#cb80-1145" aria-hidden="true" tabindex="-1"></a>✅ **String manipulation with stringr**</span>
<span id="cb80-1146"><a href="#cb80-1146" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Pattern matching and regular expressions</span>
<span id="cb80-1147"><a href="#cb80-1147" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Text cleaning and standardization</span>
<span id="cb80-1148"><a href="#cb80-1148" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>String splitting and combining</span>
<span id="cb80-1149"><a href="#cb80-1149" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Advanced text extraction</span>
<span id="cb80-1150"><a href="#cb80-1150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1151"><a href="#cb80-1151" aria-hidden="true" tabindex="-1"></a>✅ **Date and time handling with lubridate**</span>
<span id="cb80-1152"><a href="#cb80-1152" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Parsing various date formats</span>
<span id="cb80-1153"><a href="#cb80-1153" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Date arithmetic and components</span>
<span id="cb80-1154"><a href="#cb80-1154" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Time zones and daylight saving</span>
<span id="cb80-1155"><a href="#cb80-1155" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Intervals, durations, and periods</span>
<span id="cb80-1156"><a href="#cb80-1156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1157"><a href="#cb80-1157" aria-hidden="true" tabindex="-1"></a>✅ **Combined analysis**</span>
<span id="cb80-1158"><a href="#cb80-1158" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Real-world text and temporal data</span>
<span id="cb80-1159"><a href="#cb80-1159" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Log file parsing</span>
<span id="cb80-1160"><a href="#cb80-1160" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Business date calculations</span>
<span id="cb80-1161"><a href="#cb80-1161" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Pattern extraction and validation</span>
<span id="cb80-1162"><a href="#cb80-1162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1163"><a href="#cb80-1163" aria-hidden="true" tabindex="-1"></a>Key takeaways:</span>
<span id="cb80-1164"><a href="#cb80-1164" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Always validate and clean text data before analysis</span>
<span id="cb80-1165"><a href="#cb80-1165" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Be explicit about time zones to avoid bugs</span>
<span id="cb80-1166"><a href="#cb80-1166" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Regular expressions are powerful but need practice</span>
<span id="cb80-1167"><a href="#cb80-1167" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Combine string and date operations for rich insights</span>
<span id="cb80-1168"><a href="#cb80-1168" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Document your cleaning and parsing decisions</span>
<span id="cb80-1169"><a href="#cb80-1169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1170"><a href="#cb80-1170" aria-hidden="true" tabindex="-1"></a><span class="fu">## What's Next?</span></span>
<span id="cb80-1171"><a href="#cb80-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1172"><a href="#cb80-1172" aria-hidden="true" tabindex="-1"></a>Congratulations! You've completed all the fundamental tidyverse concepts from Block 1. Before moving to machine learning, we recommend taking our **[Block 1 Assessment](quiz-block-1.qmd)** to test your understanding of the core R and tidyverse concepts you've learned.</span>
<span id="cb80-1173"><a href="#cb80-1173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1174"><a href="#cb80-1174" aria-hidden="true" tabindex="-1"></a>Once you've mastered these fundamentals, continue to <span class="co">[</span><span class="ot">Chapter 8</span><span class="co">](08-tidymodels-intro.Rmd)</span> where we transition to machine learning with tidymodels, building on your data manipulation skills.</span>
<span id="cb80-1175"><a href="#cb80-1175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1176"><a href="#cb80-1176" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional Resources</span></span>
<span id="cb80-1177"><a href="#cb80-1177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-1178"><a href="#cb80-1178" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">stringr Documentation</span><span class="co">](https://stringr.tidyverse.org/)</span></span>
<span id="cb80-1179"><a href="#cb80-1179" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">lubridate Documentation</span><span class="co">](https://lubridate.tidyverse.org/)</span></span>
<span id="cb80-1180"><a href="#cb80-1180" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Regular Expression Testing</span><span class="co">](https://regex101.com/)</span></span>
<span id="cb80-1181"><a href="#cb80-1181" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">R for Data Science - Strings</span><span class="co">](https://r4ds.had.co.nz/strings.html)</span></span>
<span id="cb80-1182"><a href="#cb80-1182" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">R for Data Science - Dates and Times</span><span class="co">](https://r4ds.had.co.nz/dates-and-times.html)</span></span>
<span id="cb80-1183"><a href="#cb80-1183" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Time Zone Database</span><span class="co">](https://en.wikipedia.org/wiki/List_of_tz_database_time_zones)</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>