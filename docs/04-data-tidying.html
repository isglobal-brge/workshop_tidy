<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="David Sarrat GonzÃ¡lez, Juan R GonzÃ¡lez">
<meta name="dcterms.date" content="2025-10-06">

<title>Chapter 4: Data Tidying with tidyr â€“ Tidyverse &amp; Machine Learning Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-4a990d8dcb58f517c7c86712b8f2ac7c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-90ee96a17764a76d4fcf3f331faa145e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Tidyverse &amp; Machine Learning Workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-1-tidyverse" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part 1: Tidyverse</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-1-tidyverse">    
        <li>
    <a class="dropdown-item" href="./01-introduction.html">
 <span class="dropdown-text">Ch 1: Introduction to Tidyverse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02-data-import.html">
 <span class="dropdown-text">Ch 2: Data Import with readr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-data-wrangling.html">
 <span class="dropdown-text">Ch 3: Data Wrangling with dplyr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-data-tidying.html">
 <span class="dropdown-text">Ch 4: Data Tidying with tidyr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./05-visualization.html">
 <span class="dropdown-text">Ch 5: Visualization with ggplot2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./06-functional-programming.html">
 <span class="dropdown-text">Ch 6: Functional Programming with purrr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./07-strings-dates.html">
 <span class="dropdown-text">Ch 7: Strings and Dates</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="./quiz-block-1.html">
 <span class="dropdown-text">Block 1 Assessment</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-2-tidymodels" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part 2: Tidymodels</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-2-tidymodels">    
        <li>
    <a class="dropdown-item" href="./08-tidymodels-intro.html">
 <span class="dropdown-text">Ch 8: Introduction to Tidymodels</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./09-data-splitting.html">
 <span class="dropdown-text">Ch 9: Data Splitting &amp; Resampling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./10-feature-engineering.html">
 <span class="dropdown-text">Ch 10: Feature Engineering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./11-model-specification.html">
 <span class="dropdown-text">Ch 11: Model Specification</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./12-workflows-evaluation.html">
 <span class="dropdown-text">Ch 12: Workflows &amp; Evaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./13-hyperparameter-tuning.html">
 <span class="dropdown-text">Ch 13: Hyperparameter Tuning</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="./quiz-block-2.html">
 <span class="dropdown-text">Block 2 Assessment</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-3-machine-learning" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part 3: Machine Learning</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-3-machine-learning">    
        <li>
    <a class="dropdown-item" href="./14-classification.html">
 <span class="dropdown-text">Ch 14: Classification Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./15-regression.html">
 <span class="dropdown-text">Ch 15: Regression Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./16-ensemble-methods.html">
 <span class="dropdown-text">Ch 16: Ensemble Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./17-unsupervised-learning.html">
 <span class="dropdown-text">Ch 17: Unsupervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./18-model-deployment.html">
 <span class="dropdown-text">Ch 18: Model Deployment</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="./quiz-block-3.html">
 <span class="dropdown-text">Block 3 Assessment</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives">Learning Objectives</a></li>
  <li><a href="#setup" id="toc-setup" class="nav-link" data-scroll-target="#setup">Setup</a></li>
  <li><a href="#tidy-data-principles" id="toc-tidy-data-principles" class="nav-link" data-scroll-target="#tidy-data-principles">Tidy Data Principles</a>
  <ul class="collapse">
  <li><a href="#what-makes-data-tidy" id="toc-what-makes-data-tidy" class="nav-link" data-scroll-target="#what-makes-data-tidy">What Makes Data Tidy?</a></li>
  <li><a href="#why-tidy-data" id="toc-why-tidy-data" class="nav-link" data-scroll-target="#why-tidy-data">Why Tidy Data?</a></li>
  <li><a href="#common-problems-with-messy-data" id="toc-common-problems-with-messy-data" class="nav-link" data-scroll-target="#common-problems-with-messy-data">Common Problems with Messy Data</a></li>
  </ul></li>
  <li><a href="#pivoting-data" id="toc-pivoting-data" class="nav-link" data-scroll-target="#pivoting-data">Pivoting Data</a>
  <ul class="collapse">
  <li><a href="#pivot_longer-wide-to-long" id="toc-pivot_longer-wide-to-long" class="nav-link" data-scroll-target="#pivot_longer-wide-to-long">pivot_longer(): Wide to Long</a></li>
  <li><a href="#pivot_wider-long-to-wide" id="toc-pivot_wider-long-to-wide" class="nav-link" data-scroll-target="#pivot_wider-long-to-wide">pivot_wider(): Long to Wide</a></li>
  <li><a href="#complex-pivoting-examples" id="toc-complex-pivoting-examples" class="nav-link" data-scroll-target="#complex-pivoting-examples">Complex Pivoting Examples</a></li>
  </ul></li>
  <li><a href="#separating-and-uniting-columns" id="toc-separating-and-uniting-columns" class="nav-link" data-scroll-target="#separating-and-uniting-columns">Separating and Uniting Columns</a>
  <ul class="collapse">
  <li><a href="#separate-split-one-column-into-multiple" id="toc-separate-split-one-column-into-multiple" class="nav-link" data-scroll-target="#separate-split-one-column-into-multiple">separate(): Split One Column into Multiple</a></li>
  <li><a href="#separate_rows-create-multiple-rows" id="toc-separate_rows-create-multiple-rows" class="nav-link" data-scroll-target="#separate_rows-create-multiple-rows">separate_rows(): Create Multiple Rows</a></li>
  <li><a href="#unite-combine-multiple-columns" id="toc-unite-combine-multiple-columns" class="nav-link" data-scroll-target="#unite-combine-multiple-columns">unite(): Combine Multiple Columns</a></li>
  </ul></li>
  <li><a href="#handling-missing-values" id="toc-handling-missing-values" class="nav-link" data-scroll-target="#handling-missing-values">Handling Missing Values</a>
  <ul class="collapse">
  <li><a href="#explicit-vs-implicit-missing-values" id="toc-explicit-vs-implicit-missing-values" class="nav-link" data-scroll-target="#explicit-vs-implicit-missing-values">Explicit vs Implicit Missing Values</a></li>
  <li><a href="#drop_na-and-replace_na" id="toc-drop_na-and-replace_na" class="nav-link" data-scroll-target="#drop_na-and-replace_na">drop_na() and replace_na()</a></li>
  <li><a href="#advanced-missing-value-patterns" id="toc-advanced-missing-value-patterns" class="nav-link" data-scroll-target="#advanced-missing-value-patterns">Advanced Missing Value Patterns</a></li>
  </ul></li>
  <li><a href="#nesting-and-unnesting" id="toc-nesting-and-unnesting" class="nav-link" data-scroll-target="#nesting-and-unnesting">Nesting and Unnesting</a>
  <ul class="collapse">
  <li><a href="#creating-nested-data" id="toc-creating-nested-data" class="nav-link" data-scroll-target="#creating-nested-data">Creating Nested Data</a></li>
  <li><a href="#working-with-nested-data" id="toc-working-with-nested-data" class="nav-link" data-scroll-target="#working-with-nested-data">Working with Nested Data</a></li>
  <li><a href="#unnesting" id="toc-unnesting" class="nav-link" data-scroll-target="#unnesting">Unnesting</a></li>
  </ul></li>
  <li><a href="#list-columns" id="toc-list-columns" class="nav-link" data-scroll-target="#list-columns">List Columns</a>
  <ul class="collapse">
  <li><a href="#creating-and-working-with-list-columns" id="toc-creating-and-working-with-list-columns" class="nav-link" data-scroll-target="#creating-and-working-with-list-columns">Creating and Working with List Columns</a></li>
  <li><a href="#advanced-list-column-operations" id="toc-advanced-list-column-operations" class="nav-link" data-scroll-target="#advanced-list-column-operations">Advanced List Column Operations</a></li>
  </ul></li>
  <li><a href="#expanding-and-completing-data" id="toc-expanding-and-completing-data" class="nav-link" data-scroll-target="#expanding-and-completing-data">Expanding and Completing Data</a>
  <ul class="collapse">
  <li><a href="#expand-all-combinations" id="toc-expand-all-combinations" class="nav-link" data-scroll-target="#expand-all-combinations">expand(): All Combinations</a></li>
  <li><a href="#crossing-and-nesting" id="toc-crossing-and-nesting" class="nav-link" data-scroll-target="#crossing-and-nesting">crossing() and nesting()</a></li>
  </ul></li>
  <li><a href="#real-world-tidying-examples" id="toc-real-world-tidying-examples" class="nav-link" data-scroll-target="#real-world-tidying-examples">Real-World Tidying Examples</a>
  <ul class="collapse">
  <li><a href="#example-1-survey-data" id="toc-example-1-survey-data" class="nav-link" data-scroll-target="#example-1-survey-data">Example 1: Survey Data</a></li>
  <li><a href="#example-2-time-series-data" id="toc-example-2-time-series-data" class="nav-link" data-scroll-target="#example-2-time-series-data">Example 2: Time Series Data</a></li>
  <li><a href="#example-3-hierarchical-data" id="toc-example-3-hierarchical-data" class="nav-link" data-scroll-target="#example-3-hierarchical-data">Example 3: Hierarchical Data</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-1-complex-pivoting" id="toc-exercise-1-complex-pivoting" class="nav-link" data-scroll-target="#exercise-1-complex-pivoting">Exercise 1: Complex Pivoting</a></li>
  <li><a href="#exercise-2-nested-data-analysis" id="toc-exercise-2-nested-data-analysis" class="nav-link" data-scroll-target="#exercise-2-nested-data-analysis">Exercise 2: Nested Data Analysis</a></li>
  <li><a href="#exercise-3-complex-missing-data" id="toc-exercise-3-complex-missing-data" class="nav-link" data-scroll-target="#exercise-3-complex-missing-data">Exercise 3: Complex Missing Data</a></li>
  <li><a href="#exercise-4-real-world-data-cleaning" id="toc-exercise-4-real-world-data-cleaning" class="nav-link" data-scroll-target="#exercise-4-real-world-data-cleaning">Exercise 4: Real-World Data Cleaning</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#whats-next" id="toc-whats-next" class="nav-link" data-scroll-target="#whats-next">Whatâ€™s Next?</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Chapter 4: Data Tidying with tidyr</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>David Sarrat GonzÃ¡lez, Juan R GonzÃ¡lez </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 6, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h2>
<p>By the end of this chapter, you will master:</p>
<ul>
<li>Understanding tidy data principles</li>
<li>Pivoting data between wide and long formats</li>
<li>Separating and uniting columns</li>
<li>Handling missing values systematically</li>
<li>Nesting and unnesting data</li>
<li>Working with list-columns</li>
<li>Expanding and completing data</li>
<li>Advanced tidying techniques</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Download R Script
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can download the complete R code for this chapter: <a href="R_scripts/04-data-tidying.R" class="btn btn-primary" download="04-data-tidying.R">ðŸ“¥ Download 04-data-tidying.R</a></p>
</div>
</div>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll create various messy datasets to practice tidying</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># For reproducibility</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tidy-data-principles" class="level2">
<h2 class="anchored" data-anchor-id="tidy-data-principles">Tidy Data Principles</h2>
<section id="what-makes-data-tidy" class="level3">
<h3 class="anchored" data-anchor-id="what-makes-data-tidy">What Makes Data Tidy?</h3>
<p>Tidy data follows three interrelated rules:</p>
<ol type="1">
<li><strong>Each variable forms a column</strong></li>
<li><strong>Each observation forms a row</strong></li>
<li><strong>Each type of observational unit forms a table</strong></li>
</ol>
</section>
<section id="why-tidy-data" class="level3">
<h3 class="anchored" data-anchor-id="why-tidy-data">Why Tidy Data?</h3>
<ul>
<li>Consistent structure makes tools easier to learn</li>
<li>Râ€™s vectorized operations work naturally with tidy data</li>
<li>Supports the grammar of data manipulation</li>
</ul>
</section>
<section id="common-problems-with-messy-data" class="level3">
<h3 class="anchored" data-anchor-id="common-problems-with-messy-data">Common Problems with Messy Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem 1: Column headers are values, not variable names</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>messy1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> <span class="fu">c</span>(<span class="st">"Afghanistan"</span>, <span class="st">"Brazil"</span>, <span class="st">"China"</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">1999</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">745</span>, <span class="dv">37737</span>, <span class="dv">212258</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">2000</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2666</span>, <span class="dv">80488</span>, <span class="dv">213766</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Messy data - years as columns:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Messy data - years as columns:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>messy1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 3
  country     `1999` `2000`
  &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;
1 Afghanistan    745   2666
2 Brazil       37737  80488
3 China       212258 213766</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy version</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>tidy1 <span class="ot">&lt;-</span> messy1 <span class="sc">%&gt;%</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="st">`</span><span class="at">1999</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2000</span><span class="st">`</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"cases"</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(year))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Tidy version:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tidy version:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>tidy1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 3
  country      year  cases
  &lt;chr&gt;       &lt;int&gt;  &lt;dbl&gt;
1 Afghanistan  1999    745
2 Afghanistan  2000   2666
3 Brazil       1999  37737
4 Brazil       2000  80488
5 China        1999 212258
6 China        2000 213766</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem 2: Multiple variables in one column</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>messy2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> <span class="fu">c</span>(<span class="st">"Afghanistan"</span>, <span class="st">"Brazil"</span>, <span class="st">"China"</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> <span class="fu">c</span>(<span class="st">"745/19987071"</span>, <span class="st">"37737/172006362"</span>, <span class="st">"212258/1272915272"</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Messy data - multiple values in one column:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Messy data - multiple values in one column:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>messy2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 2
  country     rate             
  &lt;chr&gt;       &lt;chr&gt;            
1 Afghanistan 745/19987071     
2 Brazil      37737/172006362  
3 China       212258/1272915272</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy version</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>tidy2 <span class="ot">&lt;-</span> messy2 <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"cases"</span>, <span class="st">"population"</span>), <span class="at">sep =</span> <span class="st">"/"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate_per_10k =</span> cases <span class="sc">/</span> population <span class="sc">*</span> <span class="dv">10000</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Tidy version:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tidy version:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>tidy2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 4
  country      cases population rate_per_10k
  &lt;chr&gt;        &lt;int&gt;      &lt;int&gt;        &lt;dbl&gt;
1 Afghanistan    745   19987071        0.373
2 Brazil       37737  172006362        2.19 
3 China       212258 1272915272        1.67 </code></pre>
</div>
</div>
</section>
</section>
<section id="pivoting-data" class="level2">
<h2 class="anchored" data-anchor-id="pivoting-data">Pivoting Data</h2>
<section id="pivot_longer-wide-to-long" class="level3">
<h3 class="anchored" data-anchor-id="pivot_longer-wide-to-long">pivot_longer(): Wide to Long</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Wide format data</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">student =</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">math_score =</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">92</span>, <span class="dv">78</span>),</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">science_score =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">88</span>, <span class="dv">85</span>),</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">english_score =</span> <span class="fu">c</span>(<span class="dv">88</span>, <span class="dv">85</span>, <span class="dv">90</span>),</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">history_score =</span> <span class="fu">c</span>(<span class="dv">92</span>, <span class="dv">90</span>, <span class="dv">88</span>)</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Wide format:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Wide format:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>wide_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 5
  student math_score science_score english_score history_score
  &lt;chr&gt;        &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
1 Alice           85            90            88            92
2 Bob             92            88            85            90
3 Charlie         78            85            90            88</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic pivot_longer</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> wide_data <span class="sc">%&gt;%</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">"_score"</span>),</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"subject"</span>,</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"score"</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Long format:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Long format:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>long_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 Ã— 3
   student subject       score
   &lt;chr&gt;   &lt;chr&gt;         &lt;dbl&gt;
 1 Alice   math_score       85
 2 Alice   science_score    90
 3 Alice   english_score    88
 4 Alice   history_score    92
 5 Bob     math_score       92
 6 Bob     science_score    88
 7 Bob     english_score    85
 8 Bob     history_score    90
 9 Charlie math_score       78
10 Charlie science_score    85
11 Charlie english_score    90
12 Charlie history_score    88</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Advanced: Extract parts of column names</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>long_data_clean <span class="ot">&lt;-</span> wide_data <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">"_score"</span>),</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"subject"</span>,</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">"(.*)_score"</span>,  <span class="co"># Extract subject name without "_score"</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"score"</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Long format with cleaned names:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Long format with cleaned names:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>long_data_clean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 Ã— 3
   student subject score
   &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;
 1 Alice   math       85
 2 Alice   science    90
 3 Alice   english    88
 4 Alice   history    92
 5 Bob     math       92
 6 Bob     science    88
 7 Bob     english    85
 8 Bob     history    90
 9 Charlie math       78
10 Charlie science    85
11 Charlie english    90
12 Charlie history    88</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple value columns</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>quarterly_sales <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">company =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>),</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">revenue_q1 =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">150</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">revenue_q2 =</span> <span class="fu">c</span>(<span class="dv">110</span>, <span class="dv">210</span>, <span class="dv">160</span>),</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">costs_q1 =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">150</span>, <span class="dv">120</span>),</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">costs_q2 =</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">155</span>, <span class="dv">125</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>quarterly_long <span class="ot">&lt;-</span> quarterly_sales <span class="sc">%&gt;%</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>company,</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"quarter"</span>),</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">"_"</span></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Multiple value columns:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Multiple value columns:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>quarterly_long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 4
  company quarter revenue costs
  &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;
1 A       q1          100    80
2 A       q2          110    85
3 B       q1          200   150
4 B       q2          210   155
5 C       q1          150   120
6 C       q2          160   125</code></pre>
</div>
</div>
</section>
<section id="pivot_wider-long-to-wide" class="level3">
<h3 class="anchored" data-anchor-id="pivot_wider-long-to-wide">pivot_wider(): Long to Wide</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic pivot_wider</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>wide_again <span class="ot">&lt;-</span> long_data_clean <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> subject,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> score</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Back to wide format:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Back to wide format:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>wide_again</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 5
  student  math science english history
  &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 Alice      85      90      88      92
2 Bob        92      88      85      90
3 Charlie    78      85      90      88</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># With custom column names</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>wide_custom <span class="ot">&lt;-</span> long_data_clean <span class="sc">%&gt;%</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> subject,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> score,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"score_"</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Wide with custom names:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Wide with custom names:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>wide_custom</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 5
  student score_math score_science score_english score_history
  &lt;chr&gt;        &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;         &lt;dbl&gt;
1 Alice           85            90            88            92
2 Bob             92            88            85            90
3 Charlie         78            85            90            88</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Handling multiple values</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>multi_observations <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">day =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">measurement =</span> <span class="fu">c</span>(<span class="st">"temp"</span>, <span class="st">"humidity"</span>, <span class="st">"temp"</span>, <span class="st">"humidity"</span>, <span class="st">"temp"</span>, <span class="st">"humidity"</span>),</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">60</span>, <span class="dv">22</span>, <span class="dv">55</span>, <span class="dv">21</span>, <span class="dv">58</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>wide_multi <span class="ot">&lt;-</span> multi_observations <span class="sc">%&gt;%</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> measurement,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> value</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Multiple measurements to wide:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Multiple measurements to wide:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>wide_multi</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 3
    day  temp humidity
  &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
1     1    20       60
2     2    22       55
3     3    21       58</code></pre>
</div>
</div>
</section>
<section id="complex-pivoting-examples" class="level3">
<h3 class="anchored" data-anchor-id="complex-pivoting-examples">Complex Pivoting Examples</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Real-world example with gapminder</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>gapminder_wide <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, continent, year, lifeExp) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> year,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"year_"</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> lifeExp</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Gapminder in wide format:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Gapminder in wide format:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>gapminder_wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 14
  country  continent year_1952 year_1957 year_1962 year_1967 year_1972 year_1977
  &lt;fct&gt;    &lt;fct&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
1 Afghaniâ€¦ Asia           28.8      30.3      32.0      34.0      36.1      38.4
2 Albania  Europe         55.2      59.3      64.8      66.2      67.7      68.9
3 Algeria  Africa         43.1      45.7      48.3      51.4      54.5      58.0
4 Angola   Africa         30.0      32.0      34        36.0      37.9      39.5
5 Argentiâ€¦ Americas       62.5      64.4      65.1      65.6      67.1      68.5
6 Australâ€¦ Oceania        69.1      70.3      70.9      71.1      71.9      73.5
# â„¹ 6 more variables: year_1982 &lt;dbl&gt;, year_1987 &lt;dbl&gt;, year_1992 &lt;dbl&gt;,
#   year_1997 &lt;dbl&gt;, year_2002 &lt;dbl&gt;, year_2007 &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a correlation matrix format</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>penguins_corr <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"var1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>var1,</span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"var2"</span>,</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"correlation"</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(var1 <span class="sc">&lt;</span> var2)  <span class="co"># Keep only upper triangle</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Correlation matrix in long format:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Correlation matrix in long format:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>penguins_corr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 3
   var1              var2              correlation
   &lt;chr&gt;             &lt;chr&gt;                   &lt;dbl&gt;
 1 bill_length_mm    flipper_length_mm      0.656 
 2 bill_length_mm    body_mass_g            0.595 
 3 bill_length_mm    year                   0.0545
 4 bill_depth_mm     bill_length_mm        -0.235 
 5 bill_depth_mm     flipper_length_mm     -0.584 
 6 bill_depth_mm     body_mass_g           -0.472 
 7 bill_depth_mm     year                  -0.0604
 8 flipper_length_mm year                   0.170 
 9 body_mass_g       flipper_length_mm      0.871 
10 body_mass_g       year                   0.0422</code></pre>
</div>
</div>
</section>
</section>
<section id="separating-and-uniting-columns" class="level2">
<h2 class="anchored" data-anchor-id="separating-and-uniting-columns">Separating and Uniting Columns</h2>
<section id="separate-split-one-column-into-multiple" class="level3">
<h3 class="anchored" data-anchor-id="separate-split-one-column-into-multiple">separate(): Split One Column into Multiple</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic separation</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>dates_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">c</span>(<span class="st">"2023-01-15"</span>, <span class="st">"2023-02-20"</span>, <span class="st">"2023-03-25"</span>),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">115</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>separated_dates <span class="ot">&lt;-</span> dates_data <span class="sc">%&gt;%</span></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(date, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span>), <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Separated date components:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Separated date components:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>separated_dates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 4
   year month   day value
  &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
1  2023     1    15   100
2  2023     2    20   120
3  2023     3    25   115</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Separation with regular expressions</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>complex_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">code =</span> <span class="fu">c</span>(<span class="st">"USA-NY-001"</span>, <span class="st">"CAN-ON-002"</span>, <span class="st">"MEX-DF-003"</span>),</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sales =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">1500</span>, <span class="dv">800</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>separated_complex <span class="ot">&lt;-</span> complex_data <span class="sc">%&gt;%</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>    code, </span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"state"</span>, <span class="st">"id"</span>),</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"-"</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Complex separation:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Complex separation:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>separated_complex</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 4
  country state id    sales
  &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
1 USA     NY    001    1000
2 CAN     ON    002    1500
3 MEX     DF    003     800</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep original column</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>with_original <span class="ot">&lt;-</span> complex_data <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>    code,</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"state"</span>, <span class="st">"id"</span>),</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"-"</span>,</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove =</span> <span class="cn">FALSE</span>  <span class="co"># Keep original column</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"With original column:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "With original column:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>with_original</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 5
  code       country state id    sales
  &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
1 USA-NY-001 USA     NY    001    1000
2 CAN-ON-002 CAN     ON    002    1500
3 MEX-DF-003 MEX     DF    003     800</code></pre>
</div>
</div>
</section>
<section id="separate_rows-create-multiple-rows" class="level3">
<h3 class="anchored" data-anchor-id="separate_rows-create-multiple-rows">separate_rows(): Create Multiple Rows</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data with multiple values in cells</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>multi_value_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">person =</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>),</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">languages =</span> <span class="fu">c</span>(<span class="st">"R,Python,SQL"</span>, <span class="st">"R,JavaScript"</span>, <span class="st">"Python,SQL,Julia"</span>),</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">years_exp =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">7</span>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>separated_rows <span class="ot">&lt;-</span> multi_value_data <span class="sc">%&gt;%</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(languages, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Multiple values to rows:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Multiple values to rows:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>separated_rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 Ã— 3
  person  languages  years_exp
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 Alice   R                  5
2 Alice   Python             5
3 Alice   SQL                5
4 Bob     R                  3
5 Bob     JavaScript         3
6 Charlie Python             7
7 Charlie SQL                7
8 Charlie Julia              7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Count languages per person</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>language_counts <span class="ot">&lt;-</span> separated_rows <span class="sc">%&gt;%</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person) <span class="sc">%&gt;%</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_languages =</span> <span class="fu">n</span>(),</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">languages_list =</span> <span class="fu">paste</span>(languages, <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Language summary:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Language summary:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>language_counts</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 3
  person  num_languages languages_list    
  &lt;chr&gt;           &lt;int&gt; &lt;chr&gt;             
1 Alice               3 R, Python, SQL    
2 Bob                 2 R, JavaScript     
3 Charlie             3 Python, SQL, Julia</code></pre>
</div>
</div>
</section>
<section id="unite-combine-multiple-columns" class="level3">
<h3 class="anchored" data-anchor-id="unite-combine-multiple-columns">unite(): Combine Multiple Columns</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic unite</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>address_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">street_num =</span> <span class="fu">c</span>(<span class="st">"123"</span>, <span class="st">"456"</span>, <span class="st">"789"</span>),</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">street_name =</span> <span class="fu">c</span>(<span class="st">"Main St"</span>, <span class="st">"Oak Ave"</span>, <span class="st">"Park Rd"</span>),</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">city =</span> <span class="fu">c</span>(<span class="st">"Boston"</span>, <span class="st">"New York"</span>, <span class="st">"Chicago"</span>),</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">c</span>(<span class="st">"MA"</span>, <span class="st">"NY"</span>, <span class="st">"IL"</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>united_address <span class="ot">&lt;-</span> address_data <span class="sc">%&gt;%</span></span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(full_address, street_num, street_name, city, state, <span class="at">sep =</span> <span class="st">", "</span>)</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"United address:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "United address:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>united_address</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 1
  full_address              
  &lt;chr&gt;                     
1 123, Main St, Boston, MA  
2 456, Oak Ave, New York, NY
3 789, Park Rd, Chicago, IL </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unite with custom separator</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>date_parts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2023</span>, <span class="dv">2023</span>, <span class="dv">2023</span>),</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">month =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">day =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>united_dates <span class="ot">&lt;-</span> date_parts <span class="sc">%&gt;%</span></span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(date, year, month, day, <span class="at">sep =</span> <span class="st">"-"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"United dates:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "United dates:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>united_dates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 1
  date      
  &lt;date&gt;    
1 2023-01-15
2 2023-02-20
3 2023-03-25</code></pre>
</div>
</div>
</section>
</section>
<section id="handling-missing-values" class="level2">
<h2 class="anchored" data-anchor-id="handling-missing-values">Handling Missing Values</h2>
<section id="explicit-vs-implicit-missing-values" class="level3">
<h3 class="anchored" data-anchor-id="explicit-vs-implicit-missing-values">Explicit vs Implicit Missing Values</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset with implicit missing values</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>stocks <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2022</span>),</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">quarter =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">revenue =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">110</span>, <span class="dv">130</span>, <span class="dv">125</span>)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Data with implicit missing values:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Data with implicit missing values:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>stocks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 3
   year quarter revenue
  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1  2020       1     100
2  2020       4     120
3  2021       2     110
4  2022       1     130
5  2022       3     125</code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make implicit missing values explicit</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>complete_stocks <span class="ot">&lt;-</span> stocks <span class="sc">%&gt;%</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(year, quarter)</span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"After complete():"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "After complete():"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>complete_stocks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 Ã— 3
    year quarter revenue
   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1  2020       1     100
 2  2020       2      NA
 3  2020       3      NA
 4  2020       4     120
 5  2021       1      NA
 6  2021       2     110
 7  2021       3      NA
 8  2021       4      NA
 9  2022       1     130
10  2022       2      NA
11  2022       3     125
12  2022       4      NA</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing values</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>filled_stocks <span class="ot">&lt;-</span> complete_stocks <span class="sc">%&gt;%</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, quarter) <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(revenue, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"After filling:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "After filling:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>filled_stocks</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 Ã— 3
    year quarter revenue
   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1  2020       1     100
 2  2020       2     100
 3  2020       3     100
 4  2020       4     120
 5  2021       1     120
 6  2021       2     110
 7  2021       3     110
 8  2021       4     110
 9  2022       1     130
10  2022       2     130
11  2022       3     125
12  2022       4     125</code></pre>
</div>
</div>
</section>
<section id="drop_na-and-replace_na" class="level3">
<h3 class="anchored" data-anchor-id="drop_na-and-replace_na">drop_na() and replace_na()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data with NAs</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>messy_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="cn">NA</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="cn">NA</span>),</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="cn">NA</span>, <span class="dv">50</span>)</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Data with NAs:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Data with NAs:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>messy_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 3
      x y         z
  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1     1 a        10
2     2 &lt;NA&gt;     20
3    NA c        30
4     4 d        NA
5     5 &lt;NA&gt;     50</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with any NA</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>clean_all <span class="ot">&lt;-</span> messy_data <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Drop all NAs:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Drop all NAs:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>clean_all</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 3
      x y         z
  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1     1 a        10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop NAs from specific columns</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>clean_x <span class="ot">&lt;-</span> messy_data <span class="sc">%&gt;%</span></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(x)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Drop NAs from x only:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Drop NAs from x only:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>clean_x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 3
      x y         z
  &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
1     1 a        10
2     2 &lt;NA&gt;     20
3     4 d        NA
4     5 &lt;NA&gt;     50</code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NAs with specific values</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>replaced_data <span class="ot">&lt;-</span> messy_data <span class="sc">%&gt;%</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">0</span>,</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"missing"</span>,</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> <span class="fu">mean</span>(messy_data<span class="sc">$</span>z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Replaced NAs:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Replaced NAs:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>replaced_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 3
      x y           z
  &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;
1     1 a        10  
2     2 missing  20  
3     0 c        30  
4     4 d        27.5
5     5 missing  50  </code></pre>
</div>
</div>
</section>
<section id="advanced-missing-value-patterns" class="level3">
<h3 class="anchored" data-anchor-id="advanced-missing-value-patterns">Advanced Missing Value Patterns</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create time series with gaps</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>time_series <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2023-01-01"</span>, <span class="st">"2023-01-03"</span>, <span class="st">"2023-01-07"</span>, <span class="st">"2023-01-08"</span>)),</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">105</span>, <span class="dv">115</span>, <span class="dv">118</span>)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the time series</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>complete_series <span class="ot">&lt;-</span> time_series <span class="sc">%&gt;%</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">date =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(date), <span class="fu">max</span>(date), <span class="at">by =</span> <span class="st">"day"</span>))</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Complete time series:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Complete time series:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a>complete_series</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 Ã— 2
  date       value
  &lt;date&gt;     &lt;dbl&gt;
1 2023-01-01   100
2 2023-01-02    NA
3 2023-01-03   105
4 2023-01-04    NA
5 2023-01-05    NA
6 2023-01-06    NA
7 2023-01-07   115
8 2023-01-08   118</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Forward fill (last observation carried forward)</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>filled_series <span class="ot">&lt;-</span> complete_series <span class="sc">%&gt;%</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(value, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Forward filled:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Forward filled:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>filled_series</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 Ã— 2
  date       value
  &lt;date&gt;     &lt;dbl&gt;
1 2023-01-01   100
2 2023-01-02   100
3 2023-01-03   105
4 2023-01-04   105
5 2023-01-05   105
6 2023-01-06   105
7 2023-01-07   115
8 2023-01-08   118</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolation (requires zoo package)</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">require</span>(zoo, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  interpolated <span class="ot">&lt;-</span> complete_series <span class="sc">%&gt;%</span></span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value_interpolated =</span> zoo<span class="sc">::</span><span class="fu">na.approx</span>(value, <span class="at">na.rm =</span> <span class="cn">FALSE</span>))</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Linear interpolation:"</span>)</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  interpolated</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Linear interpolation:"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 Ã— 3
  date       value value_interpolated
  &lt;date&gt;     &lt;dbl&gt;              &lt;dbl&gt;
1 2023-01-01   100               100 
2 2023-01-02    NA               102.
3 2023-01-03   105               105 
4 2023-01-04    NA               108.
5 2023-01-05    NA               110 
6 2023-01-06    NA               112.
7 2023-01-07   115               115 
8 2023-01-08   118               118 </code></pre>
</div>
</div>
</section>
</section>
<section id="nesting-and-unnesting" class="level2">
<h2 class="anchored" data-anchor-id="nesting-and-unnesting">Nesting and Unnesting</h2>
<section id="creating-nested-data" class="level3">
<h3 class="anchored" data-anchor-id="creating-nested-data">Creating Nested Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group and nest</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>nested_penguins <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, island) <span class="sc">%&gt;%</span></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Nested penguins data:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Nested penguins data:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>nested_penguins</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 3
# Groups:   species, island [5]
  species   island    data              
  &lt;fct&gt;     &lt;fct&gt;     &lt;list&gt;            
1 Adelie    Torgersen &lt;tibble [52 Ã— 6]&gt; 
2 Adelie    Biscoe    &lt;tibble [44 Ã— 6]&gt; 
3 Adelie    Dream     &lt;tibble [56 Ã— 6]&gt; 
4 Gentoo    Biscoe    &lt;tibble [124 Ã— 6]&gt;
5 Chinstrap Dream     &lt;tibble [68 Ã— 6]&gt; </code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Access nested data</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"First nested tibble:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "First nested tibble:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>nested_penguins<span class="sc">$</span>data[[<span class="dv">1</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 52 Ã— 6
   bill_length_mm bill_depth_mm flipper_length_mm body_mass_g sex     year
            &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt; &lt;fct&gt;  &lt;int&gt;
 1           39.1          18.7               181        3750 male    2007
 2           39.5          17.4               186        3800 female  2007
 3           40.3          18                 195        3250 female  2007
 4           NA            NA                  NA          NA &lt;NA&gt;    2007
 5           36.7          19.3               193        3450 female  2007
 6           39.3          20.6               190        3650 male    2007
 7           38.9          17.8               181        3625 female  2007
 8           39.2          19.6               195        4675 male    2007
 9           34.1          18.1               193        3475 &lt;NA&gt;    2007
10           42            20.2               190        4250 &lt;NA&gt;    2007
# â„¹ 42 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nested with custom columns</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>custom_nest <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span></span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(</span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">bill_data =</span> <span class="fu">c</span>(bill_length_mm, bill_depth_mm),</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">body_data =</span> <span class="fu">c</span>(flipper_length_mm, body_mass_g)</span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Custom nested columns:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Custom nested columns:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>custom_nest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 35 Ã— 6
# Groups:   species [3]
   species island    sex     year bill_data         body_data        
   &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt;  &lt;int&gt; &lt;list&gt;            &lt;list&gt;           
 1 Adelie  Torgersen male    2007 &lt;tibble [7 Ã— 2]&gt;  &lt;tibble [7 Ã— 2]&gt; 
 2 Adelie  Torgersen female  2007 &lt;tibble [8 Ã— 2]&gt;  &lt;tibble [8 Ã— 2]&gt; 
 3 Adelie  Torgersen &lt;NA&gt;    2007 &lt;tibble [5 Ã— 2]&gt;  &lt;tibble [5 Ã— 2]&gt; 
 4 Adelie  Biscoe    female  2007 &lt;tibble [5 Ã— 2]&gt;  &lt;tibble [5 Ã— 2]&gt; 
 5 Adelie  Biscoe    male    2007 &lt;tibble [5 Ã— 2]&gt;  &lt;tibble [5 Ã— 2]&gt; 
 6 Adelie  Dream     female  2007 &lt;tibble [9 Ã— 2]&gt;  &lt;tibble [9 Ã— 2]&gt; 
 7 Adelie  Dream     male    2007 &lt;tibble [10 Ã— 2]&gt; &lt;tibble [10 Ã— 2]&gt;
 8 Adelie  Dream     &lt;NA&gt;    2007 &lt;tibble [1 Ã— 2]&gt;  &lt;tibble [1 Ã— 2]&gt; 
 9 Adelie  Biscoe    female  2008 &lt;tibble [9 Ã— 2]&gt;  &lt;tibble [9 Ã— 2]&gt; 
10 Adelie  Biscoe    male    2008 &lt;tibble [9 Ã— 2]&gt;  &lt;tibble [9 Ã— 2]&gt; 
# â„¹ 25 more rows</code></pre>
</div>
</div>
</section>
<section id="working-with-nested-data" class="level3">
<h3 class="anchored" data-anchor-id="working-with-nested-data">Working with Nested Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply functions to nested data</span></span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>nested_summary <span class="ot">&lt;-</span> nested_penguins <span class="sc">%&gt;%</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_obs =</span> <span class="fu">map_int</span>(data, nrow),</span>
<span id="cb133-5"><a href="#cb133-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_mass =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span> <span class="fu">mean</span>(.<span class="sc">$</span>body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb133-6"><a href="#cb133-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">mass_range =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span> <span class="fu">diff</span>(<span class="fu">range</span>(.<span class="sc">$</span>body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb133-7"><a href="#cb133-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb133-8"><a href="#cb133-8" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Summary of nested data:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Summary of nested data:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>nested_summary <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 5
# Groups:   species, island [5]
  species   island    n_obs avg_mass mass_range
  &lt;fct&gt;     &lt;fct&gt;     &lt;int&gt;    &lt;dbl&gt;      &lt;dbl&gt;
1 Adelie    Torgersen    52    3706.       1800
2 Adelie    Biscoe       44    3710.       1925
3 Adelie    Dream        56    3688.       1750
4 Gentoo    Biscoe      124    5076.       2350
5 Chinstrap Dream        68    3733.       2100</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models to nested data</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a>nested_models <span class="ot">&lt;-</span> nested_penguins <span class="sc">%&gt;%</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> flipper_length_mm, <span class="at">data =</span> .)),</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">r_squared =</span> <span class="fu">map_dbl</span>(model, <span class="sc">~</span> <span class="fu">summary</span>(.)<span class="sc">$</span>r.squared)</span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Models fitted to nested data:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Models fitted to nested data:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a>nested_models <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>data, <span class="sc">-</span>model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 3
# Groups:   species, island [5]
  species   island    r_squared
  &lt;fct&gt;     &lt;fct&gt;         &lt;dbl&gt;
1 Adelie    Torgersen     0.190
2 Adelie    Biscoe        0.277
3 Adelie    Dream         0.212
4 Gentoo    Biscoe        0.494
5 Chinstrap Dream         0.412</code></pre>
</div>
</div>
</section>
<section id="unnesting" class="level3">
<h3 class="anchored" data-anchor-id="unnesting">Unnesting</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic unnest</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>unnested <span class="ot">&lt;-</span> nested_penguins <span class="sc">%&gt;%</span></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unnested data (first 10 rows):"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unnested data (first 10 rows):"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(unnested, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 8
# Groups:   species, island [1]
   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g
   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;
 1 Adelie  Torgersen           39.1          18.7               181        3750
 2 Adelie  Torgersen           39.5          17.4               186        3800
 3 Adelie  Torgersen           40.3          18                 195        3250
 4 Adelie  Torgersen           NA            NA                  NA          NA
 5 Adelie  Torgersen           36.7          19.3               193        3450
 6 Adelie  Torgersen           39.3          20.6               190        3650
 7 Adelie  Torgersen           38.9          17.8               181        3625
 8 Adelie  Torgersen           39.2          19.6               195        4675
 9 Adelie  Torgersen           34.1          18.1               193        3475
10 Adelie  Torgersen           42            20.2               190        4250
# â„¹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unnest with selection</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>partial_unnest <span class="ot">&lt;-</span> custom_nest <span class="sc">%&gt;%</span></span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(bill_data) <span class="sc">%&gt;%</span></span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Partial unnest:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Partial unnest:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>partial_unnest</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 Ã— 7
# Groups:   species [1]
   species island    sex     year bill_length_mm bill_depth_mm body_data       
   &lt;fct&gt;   &lt;fct&gt;     &lt;fct&gt;  &lt;int&gt;          &lt;dbl&gt;         &lt;dbl&gt; &lt;list&gt;          
 1 Adelie  Torgersen male    2007           39.1          18.7 &lt;tibble [7 Ã— 2]&gt;
 2 Adelie  Torgersen male    2007           39.3          20.6 &lt;tibble [7 Ã— 2]&gt;
 3 Adelie  Torgersen male    2007           39.2          19.6 &lt;tibble [7 Ã— 2]&gt;
 4 Adelie  Torgersen male    2007           38.6          21.2 &lt;tibble [7 Ã— 2]&gt;
 5 Adelie  Torgersen male    2007           34.6          21.1 &lt;tibble [7 Ã— 2]&gt;
 6 Adelie  Torgersen male    2007           42.5          20.7 &lt;tibble [7 Ã— 2]&gt;
 7 Adelie  Torgersen male    2007           46            21.5 &lt;tibble [7 Ã— 2]&gt;
 8 Adelie  Torgersen female  2007           39.5          17.4 &lt;tibble [8 Ã— 2]&gt;
 9 Adelie  Torgersen female  2007           40.3          18   &lt;tibble [8 Ã— 2]&gt;
10 Adelie  Torgersen female  2007           36.7          19.3 &lt;tibble [8 Ã— 2]&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unnest wider (for list columns with consistent structure)</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>summary_data <span class="ot">&lt;-</span> nested_penguins <span class="sc">%&gt;%</span></span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">summary =</span> <span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">tibble</span>(</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_mass =</span> <span class="fu">mean</span>(.<span class="sc">$</span>body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_mass =</span> <span class="fu">sd</span>(.<span class="sc">$</span>body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">%&gt;%</span></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(summary)</span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unnest wider:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unnest wider:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>summary_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 5
# Groups:   species, island [5]
  species   island    mean_mass sd_mass     n
  &lt;fct&gt;     &lt;fct&gt;         &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;
1 Adelie    Torgersen     3706.    445.     1
2 Adelie    Biscoe        3710.    488.     1
3 Adelie    Dream         3688.    455.     1
4 Gentoo    Biscoe        5076.    504.     1
5 Chinstrap Dream         3733.    384.     1</code></pre>
</div>
</div>
</section>
</section>
<section id="list-columns" class="level2">
<h2 class="anchored" data-anchor-id="list-columns">List Columns</h2>
<section id="creating-and-working-with-list-columns" class="level3">
<h3 class="anchored" data-anchor-id="creating-and-working-with-list-columns">Creating and Working with List Columns</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create list columns</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>list_col_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">values =</span> <span class="fu">list</span>(</span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb153-7"><a href="#cb153-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)</span>
<span id="cb153-8"><a href="#cb153-8" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb153-9"><a href="#cb153-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">metadata =</span> <span class="fu">list</span>(</span>
<span id="cb153-10"><a href="#cb153-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"A"</span>, <span class="at">quality =</span> <span class="st">"high"</span>),</span>
<span id="cb153-11"><a href="#cb153-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"B"</span>, <span class="at">quality =</span> <span class="st">"medium"</span>),</span>
<span id="cb153-12"><a href="#cb153-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"A"</span>, <span class="at">quality =</span> <span class="st">"low"</span>)</span>
<span id="cb153-13"><a href="#cb153-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb153-14"><a href="#cb153-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb153-15"><a href="#cb153-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Data with list columns:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Data with list columns:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a>list_col_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 3
     id values    metadata        
  &lt;int&gt; &lt;list&gt;    &lt;list&gt;          
1     1 &lt;dbl [3]&gt; &lt;named list [2]&gt;
2     2 &lt;dbl [2]&gt; &lt;named list [2]&gt;
3     3 &lt;dbl [4]&gt; &lt;named list [2]&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract from list columns</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>extracted <span class="ot">&lt;-</span> list_col_data <span class="sc">%&gt;%</span></span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb157-4"><a href="#cb157-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_values =</span> <span class="fu">map_int</span>(values, length),</span>
<span id="cb157-5"><a href="#cb157-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_values =</span> <span class="fu">map_dbl</span>(values, sum),</span>
<span id="cb157-6"><a href="#cb157-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">map_chr</span>(metadata, <span class="st">"type"</span>),</span>
<span id="cb157-7"><a href="#cb157-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">quality =</span> <span class="fu">map_chr</span>(metadata, <span class="st">"quality"</span>)</span>
<span id="cb157-8"><a href="#cb157-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb157-9"><a href="#cb157-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Extracted values:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Extracted values:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a>extracted <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>values, <span class="sc">-</span>metadata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 5
     id n_values sum_values type  quality
  &lt;int&gt;    &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  
1     1        3          6 A     high   
2     2        2          9 B     medium 
3     3        4         30 A     low    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Unnest list columns</span></span>
<span id="cb161-2"><a href="#cb161-2" aria-hidden="true" tabindex="-1"></a>unnested_values <span class="ot">&lt;-</span> list_col_data <span class="sc">%&gt;%</span></span>
<span id="cb161-3"><a href="#cb161-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(values) <span class="sc">%&gt;%</span></span>
<span id="cb161-4"><a href="#cb161-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb161-5"><a href="#cb161-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value_index =</span> <span class="fu">row_number</span>())</span>
<span id="cb161-6"><a href="#cb161-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unnested values:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Unnested values:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a>unnested_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 Ã— 4
# Groups:   id [3]
     id values metadata         value_index
  &lt;int&gt;  &lt;dbl&gt; &lt;list&gt;                 &lt;int&gt;
1     1      1 &lt;named list [2]&gt;           1
2     1      2 &lt;named list [2]&gt;           2
3     1      3 &lt;named list [2]&gt;           3
4     2      4 &lt;named list [2]&gt;           1
5     2      5 &lt;named list [2]&gt;           2
6     3      6 &lt;named list [2]&gt;           1
7     3      7 &lt;named list [2]&gt;           2
8     3      8 &lt;named list [2]&gt;           3
9     3      9 &lt;named list [2]&gt;           4</code></pre>
</div>
</div>
</section>
<section id="advanced-list-column-operations" class="level3">
<h3 class="anchored" data-anchor-id="advanced-list-column-operations">Advanced List Column Operations</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Store complex objects</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb165-4"><a href="#cb165-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb165-5"><a href="#cb165-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb165-6"><a href="#cb165-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb165-7"><a href="#cb165-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit different models</span></span>
<span id="cb165-8"><a href="#cb165-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">lm_model =</span> <span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> flipper_length_mm <span class="sc">+</span> bill_length_mm, <span class="at">data =</span> .)),</span>
<span id="cb165-9"><a href="#cb165-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients</span></span>
<span id="cb165-10"><a href="#cb165-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">coefficients =</span> <span class="fu">map</span>(lm_model, broom<span class="sc">::</span>tidy),</span>
<span id="cb165-11"><a href="#cb165-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get predictions</span></span>
<span id="cb165-12"><a href="#cb165-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">predictions =</span> <span class="fu">map2</span>(lm_model, data, <span class="sc">~</span> broom<span class="sc">::</span><span class="fu">augment</span>(.x, <span class="at">newdata =</span> .y))</span>
<span id="cb165-13"><a href="#cb165-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb165-14"><a href="#cb165-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-15"><a href="#cb165-15" aria-hidden="true" tabindex="-1"></a><span class="co"># View coefficients</span></span>
<span id="cb165-16"><a href="#cb165-16" aria-hidden="true" tabindex="-1"></a>coefficients_df <span class="ot">&lt;-</span> model_data <span class="sc">%&gt;%</span></span>
<span id="cb165-17"><a href="#cb165-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species, coefficients) <span class="sc">%&gt;%</span></span>
<span id="cb165-18"><a href="#cb165-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(coefficients)</span>
<span id="cb165-19"><a href="#cb165-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Model coefficients:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Model coefficients:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a>coefficients_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 Ã— 6
# Groups:   species [3]
  species   term              estimate std.error statistic       p.value
  &lt;fct&gt;     &lt;chr&gt;                &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;         &lt;dbl&gt;
1 Adelie    (Intercept)        -3492.     890.       -3.93 0.000134     
2 Adelie    flipper_length_mm     22.5      4.88      4.60 0.00000928   
3 Adelie    bill_length_mm        75.5     12.0       6.31 0.00000000325
4 Gentoo    (Intercept)        -5524.    1039.       -5.32 0.000000516  
5 Gentoo    flipper_length_mm     36.6      6.18      5.92 0.0000000331 
6 Gentoo    bill_length_mm        56.1     13.1       4.29 0.0000378    
7 Chinstrap (Intercept)        -3212.     957.       -3.36 0.00132      
8 Chinstrap flipper_length_mm     27.7      5.52      5.01 0.00000444   
9 Chinstrap bill_length_mm        31.2     11.8       2.65 0.0101       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract R-squared values</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> model_data <span class="sc">%&gt;%</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r_squared =</span> <span class="fu">map_dbl</span>(lm_model, <span class="sc">~</span> <span class="fu">summary</span>(.)<span class="sc">$</span>r.squared)) <span class="sc">%&gt;%</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species, r_squared)</span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"R-squared values:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "R-squared values:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a>r_squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 2
# Groups:   species [3]
  species   r_squared
  &lt;fct&gt;         &lt;dbl&gt;
1 Adelie        0.387
2 Gentoo        0.573
3 Chinstrap     0.469</code></pre>
</div>
</div>
</section>
</section>
<section id="expanding-and-completing-data" class="level2">
<h2 class="anchored" data-anchor-id="expanding-and-completing-data">Expanding and Completing Data</h2>
<section id="expand-all-combinations" class="level3">
<h3 class="anchored" data-anchor-id="expand-all-combinations">expand(): All Combinations</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create all combinations</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a>experiment_design <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Drug A"</span>, <span class="st">"Drug B"</span>),</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">dose =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>),</span>
<span id="cb173-5"><a href="#cb173-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">replicate =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb173-6"><a href="#cb173-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb173-7"><a href="#cb173-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Experimental design:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Experimental design:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(experiment_design, <span class="dv">12</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 Ã— 3
   treatment  dose replicate
   &lt;chr&gt;     &lt;dbl&gt;     &lt;int&gt;
 1 Control       0         1
 2 Control       0         2
 3 Control       0         3
 4 Control      10         1
 5 Control      10         2
 6 Control      10         3
 7 Control      20         1
 8 Control      20         2
 9 Control      20         3
10 Control      50         1
11 Control      50         2
12 Control      50         3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Expand existing data</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>sales_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">store =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>),</span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">product =</span> <span class="fu">c</span>(<span class="st">"X"</span>, <span class="st">"Y"</span>, <span class="st">"X"</span>),</span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sales =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">120</span>)</span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a>all_combinations <span class="ot">&lt;-</span> sales_data <span class="sc">%&gt;%</span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(store, product)</span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"All store-product combinations:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "All store-product combinations:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a>all_combinations</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 2
  store product
  &lt;chr&gt; &lt;chr&gt;  
1 A     X      
2 A     Y      
3 B     X      
4 B     Y      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete with defaults</span></span>
<span id="cb181-2"><a href="#cb181-2" aria-hidden="true" tabindex="-1"></a>complete_sales <span class="ot">&lt;-</span> sales_data <span class="sc">%&gt;%</span></span>
<span id="cb181-3"><a href="#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(store, product, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">sales =</span> <span class="dv">0</span>))</span>
<span id="cb181-4"><a href="#cb181-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Complete sales data:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Complete sales data:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>complete_sales</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 3
  store product sales
  &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
1 A     X         100
2 A     Y         150
3 B     X         120
4 B     Y           0</code></pre>
</div>
</div>
</section>
<section id="crossing-and-nesting" class="level3">
<h3 class="anchored" data-anchor-id="crossing-and-nesting">crossing() and nesting()</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crossing - all combinations</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>)</span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a>sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"S"</span>, <span class="st">"M"</span>, <span class="st">"L"</span>)</span>
<span id="cb185-4"><a href="#cb185-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-5"><a href="#cb185-5" aria-hidden="true" tabindex="-1"></a>inventory <span class="ot">&lt;-</span> <span class="fu">crossing</span>(</span>
<span id="cb185-6"><a href="#cb185-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> colors,</span>
<span id="cb185-7"><a href="#cb185-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> sizes</span>
<span id="cb185-8"><a href="#cb185-8" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb185-9"><a href="#cb185-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stock =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">50</span>, <span class="fu">n</span>(), <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb185-10"><a href="#cb185-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Inventory matrix:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Inventory matrix:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>inventory</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9 Ã— 3
  color size  stock
  &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
1 blue  L        30
2 blue  M        14
3 blue  S        50
4 green L        13
5 green M         2
6 green S        41
7 red   L        49
8 red   M        42
9 red   S        36</code></pre>
</div>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Nesting - only observed combinations</span></span>
<span id="cb189-2"><a href="#cb189-2" aria-hidden="true" tabindex="-1"></a>observed_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb189-3"><a href="#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">city =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>, <span class="st">"NYC"</span>, <span class="st">"LA"</span>, <span class="st">"LA"</span>, <span class="st">"Chicago"</span>),</span>
<span id="cb189-4"><a href="#cb189-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2021</span>),</span>
<span id="cb189-5"><a href="#cb189-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">110</span>, <span class="dv">95</span>, <span class="dv">105</span>, <span class="dv">115</span>)</span>
<span id="cb189-6"><a href="#cb189-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb189-7"><a href="#cb189-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-8"><a href="#cb189-8" aria-hidden="true" tabindex="-1"></a>nested_combos <span class="ot">&lt;-</span> observed_data <span class="sc">%&gt;%</span></span>
<span id="cb189-9"><a href="#cb189-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(city, year))</span>
<span id="cb189-10"><a href="#cb189-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Nested combinations (only observed):"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Nested combinations (only observed):"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>nested_combos</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 2
  city     year
  &lt;chr&gt;   &lt;dbl&gt;
1 Chicago  2021
2 LA       2020
3 LA       2021
4 NYC      2020
5 NYC      2021</code></pre>
</div>
</div>
</section>
</section>
<section id="real-world-tidying-examples" class="level2">
<h2 class="anchored" data-anchor-id="real-world-tidying-examples">Real-World Tidying Examples</h2>
<section id="example-1-survey-data" class="level3">
<h3 class="anchored" data-anchor-id="example-1-survey-data">Example 1: Survey Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Messy survey data</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a>survey_messy <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">respondent =</span> <span class="fu">c</span>(<span class="st">"R001"</span>, <span class="st">"R002"</span>, <span class="st">"R003"</span>),</span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Q1_satisfied</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">3</span>),</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Q2_satisfied</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Q1_importance</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">4</span>),</span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Q2_importance</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">5</span>),</span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_gender =</span> <span class="fu">c</span>(<span class="st">"25_M"</span>, <span class="st">"30_F"</span>, <span class="st">"28_M"</span>)</span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb193-10"><a href="#cb193-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-11"><a href="#cb193-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy the survey data</span></span>
<span id="cb193-12"><a href="#cb193-12" aria-hidden="true" tabindex="-1"></a>survey_tidy <span class="ot">&lt;-</span> survey_messy <span class="sc">%&gt;%</span></span>
<span id="cb193-13"><a href="#cb193-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate age and gender</span></span>
<span id="cb193-14"><a href="#cb193-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(age_gender, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"gender"</span>), <span class="at">sep =</span> <span class="st">"_"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb193-15"><a href="#cb193-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot questions</span></span>
<span id="cb193-16"><a href="#cb193-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb193-17"><a href="#cb193-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"Q"</span>),</span>
<span id="cb193-18"><a href="#cb193-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"question"</span>, <span class="st">"measure"</span>),</span>
<span id="cb193-19"><a href="#cb193-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">"(.*)_(.*)"</span>,</span>
<span id="cb193-20"><a href="#cb193-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb193-21"><a href="#cb193-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb193-22"><a href="#cb193-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reshape to have satisfaction and importance as columns</span></span>
<span id="cb193-23"><a href="#cb193-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb193-24"><a href="#cb193-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> measure,</span>
<span id="cb193-25"><a href="#cb193-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> value</span>
<span id="cb193-26"><a href="#cb193-26" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb193-27"><a href="#cb193-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-28"><a href="#cb193-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Tidied survey data:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tidied survey data:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>survey_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 6
  respondent   age gender question satisfied importance
  &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;        &lt;dbl&gt;      &lt;dbl&gt;
1 R001          25 M      Q1               4          5
2 R001          25 M      Q2               3          4
3 R002          30 F      Q1               5          5
4 R002          30 F      Q2               4          3
5 R003          28 M      Q1               3          4
6 R003          28 M      Q2               4          5</code></pre>
</div>
</div>
</section>
<section id="example-2-time-series-data" class="level3">
<h3 class="anchored" data-anchor-id="example-2-time-series-data">Example 2: Time Series Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Messy time series</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a>ts_messy <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">date_time =</span> <span class="fu">c</span>(<span class="st">"2023-01-15 10:30"</span>, <span class="st">"2023-01-15 14:45"</span>, <span class="st">"2023-01-16 09:15"</span>),</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">sensor_readings =</span> <span class="fu">c</span>(<span class="st">"temp:22.5;humidity:60"</span>, <span class="st">"temp:23.1;humidity:58"</span>, <span class="st">"temp:21.8;humidity:62"</span>)</span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-7"><a href="#cb197-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy the time series</span></span>
<span id="cb197-8"><a href="#cb197-8" aria-hidden="true" tabindex="-1"></a>ts_tidy <span class="ot">&lt;-</span> ts_messy <span class="sc">%&gt;%</span></span>
<span id="cb197-9"><a href="#cb197-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate date and time</span></span>
<span id="cb197-10"><a href="#cb197-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(date_time, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"time"</span>), <span class="at">sep =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb197-11"><a href="#cb197-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate sensor readings</span></span>
<span id="cb197-12"><a href="#cb197-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(sensor_readings, <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb197-13"><a href="#cb197-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(sensor_readings, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"sensor"</span>, <span class="st">"value"</span>), <span class="at">sep =</span> <span class="st">":"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb197-14"><a href="#cb197-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert date</span></span>
<span id="cb197-15"><a href="#cb197-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb197-16"><a href="#cb197-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb197-17"><a href="#cb197-17" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Tidied time series:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tidied time series:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>ts_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 Ã— 4
  date       time  sensor   value
  &lt;date&gt;     &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;
1 2023-01-15 10:30 temp      22.5
2 2023-01-15 10:30 humidity  60  
3 2023-01-15 14:45 temp      23.1
4 2023-01-15 14:45 humidity  58  
5 2023-01-16 09:15 temp      21.8
6 2023-01-16 09:15 humidity  62  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape for analysis</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a>ts_wide <span class="ot">&lt;-</span> ts_tidy <span class="sc">%&gt;%</span></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb201-4"><a href="#cb201-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> sensor,</span>
<span id="cb201-5"><a href="#cb201-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> value</span>
<span id="cb201-6"><a href="#cb201-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb201-7"><a href="#cb201-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Wide format for analysis:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Wide format for analysis:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>ts_wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 Ã— 4
  date       time   temp humidity
  &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt;    &lt;dbl&gt;
1 2023-01-15 10:30  22.5       60
2 2023-01-15 14:45  23.1       58
3 2023-01-16 09:15  21.8       62</code></pre>
</div>
</div>
</section>
<section id="example-3-hierarchical-data" class="level3">
<h3 class="anchored" data-anchor-id="example-3-hierarchical-data">Example 3: Hierarchical Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hierarchical organization data</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a>org_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">employee =</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>, <span class="st">"Diana"</span>),</span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">department_division =</span> <span class="fu">c</span>(<span class="st">"Sales/North"</span>, <span class="st">"Sales/South"</span>, <span class="st">"IT/Infrastructure"</span>, <span class="st">"IT/Development"</span>),</span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> <span class="fu">c</span>(<span class="st">"revenue:1000000;satisfaction:4.5"</span>, </span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a>              <span class="st">"revenue:800000;satisfaction:4.2"</span>,</span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a>              <span class="st">"tickets:450;uptime:99.9"</span>,</span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a>              <span class="st">"features:12;bugs:3"</span>)</span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy hierarchical data</span></span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a>org_tidy <span class="ot">&lt;-</span> org_data <span class="sc">%&gt;%</span></span>
<span id="cb205-13"><a href="#cb205-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate hierarchy</span></span>
<span id="cb205-14"><a href="#cb205-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(department_division, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"department"</span>, <span class="st">"division"</span>), <span class="at">sep =</span> <span class="st">"/"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb205-15"><a href="#cb205-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate metrics</span></span>
<span id="cb205-16"><a href="#cb205-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(metrics, <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb205-17"><a href="#cb205-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(metrics, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"metric"</span>, <span class="st">"value"</span>), <span class="at">sep =</span> <span class="st">":"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>)</span>
<span id="cb205-18"><a href="#cb205-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb205-19"><a href="#cb205-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Tidied organizational data:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tidied organizational data:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>org_tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 Ã— 5
  employee department division       metric           value
  &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;          &lt;chr&gt;            &lt;dbl&gt;
1 Alice    Sales      North          revenue      1000000  
2 Alice    Sales      North          satisfaction       4.5
3 Bob      Sales      South          revenue       800000  
4 Bob      Sales      South          satisfaction       4.2
5 Charlie  IT         Infrastructure tickets          450  
6 Charlie  IT         Infrastructure uptime            99.9
7 Diana    IT         Development    features          12  
8 Diana    IT         Development    bugs               3  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize by department</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a>dept_summary <span class="ot">&lt;-</span> org_tidy <span class="sc">%&gt;%</span></span>
<span id="cb209-3"><a href="#cb209-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(department, metric) <span class="sc">%&gt;%</span></span>
<span id="cb209-4"><a href="#cb209-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb209-5"><a href="#cb209-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="fu">sum</span>(value),</span>
<span id="cb209-6"><a href="#cb209-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg =</span> <span class="fu">mean</span>(value),</span>
<span id="cb209-7"><a href="#cb209-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb209-8"><a href="#cb209-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb209-9"><a href="#cb209-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb209-10"><a href="#cb209-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> metric,</span>
<span id="cb209-11"><a href="#cb209-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(total, avg),</span>
<span id="cb209-12"><a href="#cb209-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_glue =</span> <span class="st">"{metric}_{.value}"</span></span>
<span id="cb209-13"><a href="#cb209-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb209-14"><a href="#cb209-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-15"><a href="#cb209-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Department summary:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Department summary:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>dept_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 Ã— 13
  department bugs_total features_total tickets_total uptime_total revenue_total
  &lt;chr&gt;           &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;        &lt;dbl&gt;         &lt;dbl&gt;
1 IT                  3             12           450         99.9            NA
2 Sales              NA             NA            NA         NA         1800000
# â„¹ 7 more variables: satisfaction_total &lt;dbl&gt;, bugs_avg &lt;dbl&gt;,
#   features_avg &lt;dbl&gt;, tickets_avg &lt;dbl&gt;, uptime_avg &lt;dbl&gt;, revenue_avg &lt;dbl&gt;,
#   satisfaction_avg &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<section id="exercise-1-complex-pivoting" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1-complex-pivoting">Exercise 1: Complex Pivoting</h3>
<p>Transform this gradebook data into a tidy format suitable for analysis:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Given messy gradebook</span></span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>gradebook <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">student =</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>),</span>
<span id="cb213-4"><a href="#cb213-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Math_Midterm</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">90</span>, <span class="dv">78</span>),</span>
<span id="cb213-5"><a href="#cb213-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Math_Final</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">88</span>, <span class="dv">85</span>, <span class="dv">82</span>),</span>
<span id="cb213-6"><a href="#cb213-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Science_Midterm</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">92</span>, <span class="dv">88</span>, <span class="dv">90</span>),</span>
<span id="cb213-7"><a href="#cb213-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Science_Final</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">92</span>, <span class="dv">88</span>),</span>
<span id="cb213-8"><a href="#cb213-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">attendance_days</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"45/50"</span>, <span class="st">"48/50"</span>, <span class="st">"42/50"</span>)</span>
<span id="cb213-9"><a href="#cb213-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb213-10"><a href="#cb213-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-11"><a href="#cb213-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb213-12"><a href="#cb213-12" aria-hidden="true" tabindex="-1"></a>tidy_gradebook <span class="ot">&lt;-</span> gradebook <span class="sc">%&gt;%</span></span>
<span id="cb213-13"><a href="#cb213-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate attendance</span></span>
<span id="cb213-14"><a href="#cb213-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(attendance_days, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"days_present"</span>, <span class="st">"total_days"</span>), </span>
<span id="cb213-15"><a href="#cb213-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">"/"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb213-16"><a href="#cb213-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate attendance rate</span></span>
<span id="cb213-17"><a href="#cb213-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">attendance_rate =</span> days_present <span class="sc">/</span> total_days) <span class="sc">%&gt;%</span></span>
<span id="cb213-18"><a href="#cb213-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot grades</span></span>
<span id="cb213-19"><a href="#cb213-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb213-20"><a href="#cb213-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">"_Midterm|_Final"</span>),</span>
<span id="cb213-21"><a href="#cb213-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"subject"</span>, <span class="st">"exam"</span>),</span>
<span id="cb213-22"><a href="#cb213-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb213-23"><a href="#cb213-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"score"</span></span>
<span id="cb213-24"><a href="#cb213-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb213-25"><a href="#cb213-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate average by subject</span></span>
<span id="cb213-26"><a href="#cb213-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(student, subject) <span class="sc">%&gt;%</span></span>
<span id="cb213-27"><a href="#cb213-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subject_avg =</span> <span class="fu">mean</span>(score)) <span class="sc">%&gt;%</span></span>
<span id="cb213-28"><a href="#cb213-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb213-29"><a href="#cb213-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb213-30"><a href="#cb213-30" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Tidied gradebook:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Tidied gradebook:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a>tidy_gradebook</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 Ã— 8
   student days_present total_days attendance_rate subject exam    score
   &lt;chr&gt;          &lt;int&gt;      &lt;int&gt;           &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;
 1 Alice             45         50            0.9  Math    Midterm    85
 2 Alice             45         50            0.9  Math    Final      88
 3 Alice             45         50            0.9  Science Midterm    92
 4 Alice             45         50            0.9  Science Final      90
 5 Bob               48         50            0.96 Math    Midterm    90
 6 Bob               48         50            0.96 Math    Final      85
 7 Bob               48         50            0.96 Science Midterm    88
 8 Bob               48         50            0.96 Science Final      92
 9 Charlie           42         50            0.84 Math    Midterm    78
10 Charlie           42         50            0.84 Math    Final      82
11 Charlie           42         50            0.84 Science Midterm    90
12 Charlie           42         50            0.84 Science Final      88
# â„¹ 1 more variable: subject_avg &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="exercise-2-nested-data-analysis" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2-nested-data-analysis">Exercise 2: Nested Data Analysis</h3>
<p>Work with nested gapminder data to calculate decade-wise trends:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>gapminder_nested <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decade =</span> <span class="fu">floor</span>(year <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent, decade) <span class="sc">%&gt;%</span></span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate trends within each group</span></span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_lifeExp =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span> <span class="fu">mean</span>(.<span class="sc">$</span>lifeExp)),</span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">gdp_growth =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span> {</span>
<span id="cb217-10"><a href="#cb217-10" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">nrow</span>(.) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb217-11"><a href="#cb217-11" aria-hidden="true" tabindex="-1"></a>        model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(gdpPercap) <span class="sc">~</span> <span class="fu">I</span>(year <span class="sc">-</span> <span class="fu">min</span>(year)), <span class="at">data =</span> .)</span>
<span id="cb217-12"><a href="#cb217-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coef</span>(model)[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">100</span>  <span class="co"># Percent growth per year</span></span>
<span id="cb217-13"><a href="#cb217-13" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb217-14"><a href="#cb217-14" aria-hidden="true" tabindex="-1"></a>        <span class="cn">NA_real_</span></span>
<span id="cb217-15"><a href="#cb217-15" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb217-16"><a href="#cb217-16" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb217-17"><a href="#cb217-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_total =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span> <span class="fu">sum</span>(.<span class="sc">$</span>pop) <span class="sc">/</span> <span class="fl">1e9</span>),  <span class="co"># In billions</span></span>
<span id="cb217-18"><a href="#cb217-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_countries =</span> <span class="fu">map_int</span>(data, <span class="sc">~</span> <span class="fu">n_distinct</span>(.<span class="sc">$</span>country))</span>
<span id="cb217-19"><a href="#cb217-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb217-20"><a href="#cb217-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-21"><a href="#cb217-21" aria-hidden="true" tabindex="-1"></a>gapminder_summary <span class="ot">&lt;-</span> gapminder_nested <span class="sc">%&gt;%</span></span>
<span id="cb217-22"><a href="#cb217-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">%&gt;%</span></span>
<span id="cb217-23"><a href="#cb217-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(continent, decade)</span>
<span id="cb217-24"><a href="#cb217-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-25"><a href="#cb217-25" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Decade-wise trends by continent:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Decade-wise trends by continent:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a>gapminder_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 30 Ã— 6
# Groups:   continent, decade [30]
   continent decade avg_lifeExp gdp_growth pop_total n_countries
   &lt;fct&gt;      &lt;dbl&gt;       &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;       &lt;int&gt;
 1 Africa      1950        40.2     1.88       0.502          52
 2 Africa      1960        44.3     2.74       0.632          52
 3 Africa      1970        48.5     0.619      0.813          52
 4 Africa      1980        52.5    -1.05       1.07           52
 5 Africa      1990        53.6     0.450      1.40           52
 6 Africa      2000        54.1     2.38       1.76           52
 7 Americas    1950        54.6     2.33       0.732          25
 8 Americas    1960        59.4     2.45       0.914          25
 9 Americas    1970        63.4     2.65       1.11           25
10 Americas    1980        67.2    -0.0866     1.31           25
# â„¹ 20 more rows</code></pre>
</div>
</div>
</section>
<section id="exercise-3-complex-missing-data" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3-complex-missing-data">Exercise 3: Complex Missing Data</h3>
<p>Handle this dataset with various types of missing data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset with complex missing patterns</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>complex_missing <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2023-01-01"</span>, <span class="st">"2023-01-02"</span>, <span class="st">"2023-01-04"</span>, <span class="st">"2023-01-07"</span>)),</span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">store_a =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="cn">NA</span>, <span class="dv">120</span>, <span class="dv">130</span>),</span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">store_b =</span> <span class="fu">c</span>(<span class="dv">200</span>, <span class="dv">210</span>, <span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">store_c =</span> <span class="fu">c</span>(<span class="dv">150</span>, <span class="dv">160</span>, <span class="dv">170</span>, <span class="dv">180</span>)</span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the date sequence</span></span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a>complete_data <span class="ot">&lt;-</span> complex_missing <span class="sc">%&gt;%</span></span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">date =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(date), <span class="fu">max</span>(date), <span class="at">by =</span> <span class="st">"day"</span>))</span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Different filling strategies</span></span>
<span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a>filled_data <span class="ot">&lt;-</span> complete_data <span class="sc">%&gt;%</span></span>
<span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Forward fill for store_a</span></span>
<span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(store_a, <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb221-18"><a href="#cb221-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Interpolate store_b</span></span>
<span id="cb221-19"><a href="#cb221-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb221-20"><a href="#cb221-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">store_b =</span> zoo<span class="sc">::</span><span class="fu">na.approx</span>(store_b, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)</span>
<span id="cb221-21"><a href="#cb221-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb221-22"><a href="#cb221-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average fill for store_c</span></span>
<span id="cb221-23"><a href="#cb221-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb221-24"><a href="#cb221-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">store_c =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(store_c), </span>
<span id="cb221-25"><a href="#cb221-25" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mean</span>(store_c, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb221-26"><a href="#cb221-26" aria-hidden="true" tabindex="-1"></a>                      store_c)</span>
<span id="cb221-27"><a href="#cb221-27" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb221-28"><a href="#cb221-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-29"><a href="#cb221-29" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Original data:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Original data:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>complex_missing</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 4
  date       store_a store_b store_c
  &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 2023-01-01     100     200     150
2 2023-01-02      NA     210     160
3 2023-01-04     120      NA     170
4 2023-01-07     130      NA     180</code></pre>
</div>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"After handling missing values:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "After handling missing values:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>filled_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 Ã— 4
  date       store_a store_b store_c
  &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1 2023-01-01     100     200     150
2 2023-01-02     100     210     160
3 2023-01-03     100      NA     165
4 2023-01-04     120      NA     170
5 2023-01-05     120      NA     165
6 2023-01-06     120      NA     165
7 2023-01-07     130      NA     180</code></pre>
</div>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to long format for analysis</span></span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>long_filled <span class="ot">&lt;-</span> filled_data <span class="sc">%&gt;%</span></span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"store"</span>),</span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"store"</span>,</span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"store_"</span>,</span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"sales"</span></span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Long format for analysis:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Long format for analysis:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>long_filled</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 Ã— 3
   date       store sales
   &lt;date&gt;     &lt;chr&gt; &lt;dbl&gt;
 1 2023-01-01 a       100
 2 2023-01-01 b       200
 3 2023-01-01 c       150
 4 2023-01-02 a       100
 5 2023-01-02 b       210
 6 2023-01-02 c       160
 7 2023-01-03 a       100
 8 2023-01-03 b        NA
 9 2023-01-03 c       165
10 2023-01-04 a       120
# â„¹ 11 more rows</code></pre>
</div>
</div>
</section>
<section id="exercise-4-real-world-data-cleaning" class="level3">
<h3 class="anchored" data-anchor-id="exercise-4-real-world-data-cleaning">Exercise 4: Real-World Data Cleaning</h3>
<p>Clean and reshape this messy real-world dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Messy real-world data</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>messy_sales <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"US-2023-001"</span>, <span class="st">"UK-2023-002"</span>, <span class="st">"CA-2023-003"</span>),</span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">jan_feb_mar =</span> <span class="fu">c</span>(<span class="st">"100,120,115"</span>, <span class="st">"200,210,205"</span>, <span class="st">"150,145,160"</span>),</span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">apr_may_jun =</span> <span class="fu">c</span>(<span class="st">"125,130,135"</span>, <span class="st">"215,220,225"</span>, <span class="st">"165,170,175"</span>),</span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">customer_info =</span> <span class="fu">c</span>(<span class="st">"John Doe|Premium"</span>, <span class="st">"Jane Smith|Standard"</span>, <span class="st">"Bob Johnson|Premium"</span>),</span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">notes =</span> <span class="fu">c</span>(<span class="st">"Q1: Good performance"</span>, <span class="st">"Q1: Steady growth"</span>, <span class="st">"Q1: Meeting targets"</span>)</span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb233-11"><a href="#cb233-11" aria-hidden="true" tabindex="-1"></a>clean_sales <span class="ot">&lt;-</span> messy_sales <span class="sc">%&gt;%</span></span>
<span id="cb233-12"><a href="#cb233-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate ID components</span></span>
<span id="cb233-13"><a href="#cb233-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(id, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"customer_id"</span>), <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb233-14"><a href="#cb233-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate customer info</span></span>
<span id="cb233-15"><a href="#cb233-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(customer_info, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"customer_name"</span>, <span class="st">"tier"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">|"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb233-16"><a href="#cb233-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot quarters</span></span>
<span id="cb233-17"><a href="#cb233-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb233-18"><a href="#cb233-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(jan_feb_mar, apr_may_jun),</span>
<span id="cb233-19"><a href="#cb233-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"quarter"</span>,</span>
<span id="cb233-20"><a href="#cb233-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"monthly_sales"</span></span>
<span id="cb233-21"><a href="#cb233-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb233-22"><a href="#cb233-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate monthly sales</span></span>
<span id="cb233-23"><a href="#cb233-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(monthly_sales, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"month1"</span>, <span class="st">"month2"</span>, <span class="st">"month3"</span>), <span class="at">sep =</span> <span class="st">","</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb233-24"><a href="#cb233-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create proper quarter labels</span></span>
<span id="cb233-25"><a href="#cb233-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb233-26"><a href="#cb233-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">quarter =</span> <span class="fu">case_when</span>(</span>
<span id="cb233-27"><a href="#cb233-27" aria-hidden="true" tabindex="-1"></a>      quarter <span class="sc">==</span> <span class="st">"jan_feb_mar"</span> <span class="sc">~</span> <span class="st">"Q1"</span>,</span>
<span id="cb233-28"><a href="#cb233-28" aria-hidden="true" tabindex="-1"></a>      quarter <span class="sc">==</span> <span class="st">"apr_may_jun"</span> <span class="sc">~</span> <span class="st">"Q2"</span></span>
<span id="cb233-29"><a href="#cb233-29" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb233-30"><a href="#cb233-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb233-31"><a href="#cb233-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot months to long format</span></span>
<span id="cb233-32"><a href="#cb233-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb233-33"><a href="#cb233-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"month"</span>),</span>
<span id="cb233-34"><a href="#cb233-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"month_num"</span>,</span>
<span id="cb233-35"><a href="#cb233-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"month"</span>,</span>
<span id="cb233-36"><a href="#cb233-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"sales"</span></span>
<span id="cb233-37"><a href="#cb233-37" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb233-38"><a href="#cb233-38" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate month</span></span>
<span id="cb233-39"><a href="#cb233-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb233-40"><a href="#cb233-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_num =</span> <span class="fu">as.integer</span>(month_num),</span>
<span id="cb233-41"><a href="#cb233-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">case_when</span>(</span>
<span id="cb233-42"><a href="#cb233-42" aria-hidden="true" tabindex="-1"></a>      quarter <span class="sc">==</span> <span class="st">"Q1"</span> <span class="sc">~</span> month_num,</span>
<span id="cb233-43"><a href="#cb233-43" aria-hidden="true" tabindex="-1"></a>      quarter <span class="sc">==</span> <span class="st">"Q2"</span> <span class="sc">~</span> month_num <span class="sc">+</span> <span class="dv">3</span></span>
<span id="cb233-44"><a href="#cb233-44" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb233-45"><a href="#cb233-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(year, month, <span class="st">"01"</span>, <span class="at">sep =</span> <span class="st">"-"</span>))</span>
<span id="cb233-46"><a href="#cb233-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb233-47"><a href="#cb233-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, country, date, customer_name, tier, sales, notes)</span>
<span id="cb233-48"><a href="#cb233-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-49"><a href="#cb233-49" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Cleaned sales data:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Cleaned sales data:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>clean_sales</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 Ã— 7
   id          country date       customer_name tier     sales notes            
   &lt;chr&gt;       &lt;chr&gt;   &lt;date&gt;     &lt;chr&gt;         &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;            
 1 US-2023-001 US      2023-01-01 John Doe      Premium    100 Q1: Good performâ€¦
 2 US-2023-001 US      2023-02-01 John Doe      Premium    120 Q1: Good performâ€¦
 3 US-2023-001 US      2023-03-01 John Doe      Premium    115 Q1: Good performâ€¦
 4 US-2023-001 US      2023-04-01 John Doe      Premium    125 Q1: Good performâ€¦
 5 US-2023-001 US      2023-05-01 John Doe      Premium    130 Q1: Good performâ€¦
 6 US-2023-001 US      2023-06-01 John Doe      Premium    135 Q1: Good performâ€¦
 7 UK-2023-002 UK      2023-01-01 Jane Smith    Standard   200 Q1: Steady growth
 8 UK-2023-002 UK      2023-02-01 Jane Smith    Standard   210 Q1: Steady growth
 9 UK-2023-002 UK      2023-03-01 Jane Smith    Standard   205 Q1: Steady growth
10 UK-2023-002 UK      2023-04-01 Jane Smith    Standard   215 Q1: Steady growth
11 UK-2023-002 UK      2023-05-01 Jane Smith    Standard   220 Q1: Steady growth
12 UK-2023-002 UK      2023-06-01 Jane Smith    Standard   225 Q1: Steady growth
13 CA-2023-003 CA      2023-01-01 Bob Johnson   Premium    150 Q1: Meeting targâ€¦
14 CA-2023-003 CA      2023-02-01 Bob Johnson   Premium    145 Q1: Meeting targâ€¦
15 CA-2023-003 CA      2023-03-01 Bob Johnson   Premium    160 Q1: Meeting targâ€¦
16 CA-2023-003 CA      2023-04-01 Bob Johnson   Premium    165 Q1: Meeting targâ€¦
17 CA-2023-003 CA      2023-05-01 Bob Johnson   Premium    170 Q1: Meeting targâ€¦
18 CA-2023-003 CA      2023-06-01 Bob Johnson   Premium    175 Q1: Meeting targâ€¦</code></pre>
</div>
</div>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>Youâ€™ve mastered tidyr essentials:</p>
<p>âœ… Understanding tidy data principles<br>
âœ… Pivoting between wide and long formats<br>
âœ… Separating and uniting columns<br>
âœ… Handling missing values systematically<br>
âœ… Working with nested data and list columns<br>
âœ… Expanding and completing datasets<br>
âœ… Real-world data tidying techniques</p>
</section>
<section id="whats-next" class="level2">
<h2 class="anchored" data-anchor-id="whats-next">Whatâ€™s Next?</h2>
<p>In <a href="./05-visualization.html">Chapter 5</a>, weâ€™ll explore data visualization with ggplot2, creating beautiful and informative graphics.</p>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<ul>
<li><a href="https://tidyr.tidyverse.org/">tidyr Documentation</a></li>
<li><a href="https://www.jstatsoft.org/article/view/v059i10">Tidy Data Paper</a></li>
<li><a href="https://github.com/rstudio/cheatsheets/blob/main/tidyr.pdf">tidyr Cheat Sheet</a></li>
<li><a href="https://r4ds.had.co.nz/tidy-data.html">R for Data Science - Tidy Data</a></li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Find all elements with class 'quarto-title-meta-heading' that contain "Author"
    const authorHeadings = document.querySelectorAll('.quarto-title-meta-heading');
    
    authorHeadings.forEach(function(heading) {
        if (heading.textContent.trim() === 'Author') {
            heading.textContent = 'Authors';
        }
    });
});
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb237" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Chapter 4: Data Tidying with tidyr"</span></span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "David Sarrat GonzÃ¡lez, Juan R GonzÃ¡lez"</span></span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb237-8"><a href="#cb237-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb237-9"><a href="#cb237-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb237-10"><a href="#cb237-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-11"><a href="#cb237-11" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb237-12"><a href="#cb237-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-13"><a href="#cb237-13" aria-hidden="true" tabindex="-1"></a>By the end of this chapter, you will master:</span>
<span id="cb237-14"><a href="#cb237-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-15"><a href="#cb237-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Understanding tidy data principles</span>
<span id="cb237-16"><a href="#cb237-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Pivoting data between wide and long formats</span>
<span id="cb237-17"><a href="#cb237-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Separating and uniting columns</span>
<span id="cb237-18"><a href="#cb237-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Handling missing values systematically</span>
<span id="cb237-19"><a href="#cb237-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Nesting and unnesting data</span>
<span id="cb237-20"><a href="#cb237-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Working with list-columns</span>
<span id="cb237-21"><a href="#cb237-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Expanding and completing data</span>
<span id="cb237-22"><a href="#cb237-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Advanced tidying techniques</span>
<span id="cb237-23"><a href="#cb237-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-24"><a href="#cb237-24" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb237-25"><a href="#cb237-25" aria-hidden="true" tabindex="-1"></a><span class="fu">## Download R Script</span></span>
<span id="cb237-26"><a href="#cb237-26" aria-hidden="true" tabindex="-1"></a>You can download the complete R code for this chapter:</span>
<span id="cb237-27"><a href="#cb237-27" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">ðŸ“¥ Download 04-data-tidying.R</span><span class="co">](R_scripts/04-data-tidying.R)</span>{.btn .btn-primary download="04-data-tidying.R"}</span>
<span id="cb237-28"><a href="#cb237-28" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb237-29"><a href="#cb237-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-30"><a href="#cb237-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setup</span></span>
<span id="cb237-31"><a href="#cb237-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-34"><a href="#cb237-34" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-35"><a href="#cb237-35" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb237-36"><a href="#cb237-36" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb237-37"><a href="#cb237-37" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb237-38"><a href="#cb237-38" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span>
<span id="cb237-39"><a href="#cb237-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-40"><a href="#cb237-40" aria-hidden="true" tabindex="-1"></a><span class="co"># We'll create various messy datasets to practice tidying</span></span>
<span id="cb237-41"><a href="#cb237-41" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># For reproducibility</span></span>
<span id="cb237-42"><a href="#cb237-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-43"><a href="#cb237-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-44"><a href="#cb237-44" aria-hidden="true" tabindex="-1"></a><span class="fu">## Tidy Data Principles</span></span>
<span id="cb237-45"><a href="#cb237-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-46"><a href="#cb237-46" aria-hidden="true" tabindex="-1"></a><span class="fu">### What Makes Data Tidy?</span></span>
<span id="cb237-47"><a href="#cb237-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-48"><a href="#cb237-48" aria-hidden="true" tabindex="-1"></a>Tidy data follows three interrelated rules:</span>
<span id="cb237-49"><a href="#cb237-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-50"><a href="#cb237-50" aria-hidden="true" tabindex="-1"></a><span class="ss">1. </span>**Each variable forms a column**</span>
<span id="cb237-51"><a href="#cb237-51" aria-hidden="true" tabindex="-1"></a><span class="ss">2. </span>**Each observation forms a row**</span>
<span id="cb237-52"><a href="#cb237-52" aria-hidden="true" tabindex="-1"></a><span class="ss">3. </span>**Each type of observational unit forms a table**</span>
<span id="cb237-53"><a href="#cb237-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-54"><a href="#cb237-54" aria-hidden="true" tabindex="-1"></a><span class="fu">### Why Tidy Data?</span></span>
<span id="cb237-55"><a href="#cb237-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-56"><a href="#cb237-56" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Consistent structure makes tools easier to learn</span>
<span id="cb237-57"><a href="#cb237-57" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>R's vectorized operations work naturally with tidy data</span>
<span id="cb237-58"><a href="#cb237-58" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Supports the grammar of data manipulation</span>
<span id="cb237-59"><a href="#cb237-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-60"><a href="#cb237-60" aria-hidden="true" tabindex="-1"></a><span class="fu">### Common Problems with Messy Data</span></span>
<span id="cb237-61"><a href="#cb237-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-64"><a href="#cb237-64" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-65"><a href="#cb237-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem 1: Column headers are values, not variable names</span></span>
<span id="cb237-66"><a href="#cb237-66" aria-hidden="true" tabindex="-1"></a>messy1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-67"><a href="#cb237-67" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> <span class="fu">c</span>(<span class="st">"Afghanistan"</span>, <span class="st">"Brazil"</span>, <span class="st">"China"</span>),</span>
<span id="cb237-68"><a href="#cb237-68" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">1999</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">745</span>, <span class="dv">37737</span>, <span class="dv">212258</span>),</span>
<span id="cb237-69"><a href="#cb237-69" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">2000</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2666</span>, <span class="dv">80488</span>, <span class="dv">213766</span>)</span>
<span id="cb237-70"><a href="#cb237-70" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-71"><a href="#cb237-71" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Messy data - years as columns:"</span>)</span>
<span id="cb237-72"><a href="#cb237-72" aria-hidden="true" tabindex="-1"></a>messy1</span>
<span id="cb237-73"><a href="#cb237-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-74"><a href="#cb237-74" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy version</span></span>
<span id="cb237-75"><a href="#cb237-75" aria-hidden="true" tabindex="-1"></a>tidy1 <span class="ot">&lt;-</span> messy1 <span class="sc">%&gt;%</span></span>
<span id="cb237-76"><a href="#cb237-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb237-77"><a href="#cb237-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="st">`</span><span class="at">1999</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">2000</span><span class="st">`</span>,</span>
<span id="cb237-78"><a href="#cb237-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"year"</span>,</span>
<span id="cb237-79"><a href="#cb237-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"cases"</span></span>
<span id="cb237-80"><a href="#cb237-80" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb237-81"><a href="#cb237-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.integer</span>(year))</span>
<span id="cb237-82"><a href="#cb237-82" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Tidy version:"</span>)</span>
<span id="cb237-83"><a href="#cb237-83" aria-hidden="true" tabindex="-1"></a>tidy1</span>
<span id="cb237-84"><a href="#cb237-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-85"><a href="#cb237-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem 2: Multiple variables in one column</span></span>
<span id="cb237-86"><a href="#cb237-86" aria-hidden="true" tabindex="-1"></a>messy2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-87"><a href="#cb237-87" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> <span class="fu">c</span>(<span class="st">"Afghanistan"</span>, <span class="st">"Brazil"</span>, <span class="st">"China"</span>),</span>
<span id="cb237-88"><a href="#cb237-88" aria-hidden="true" tabindex="-1"></a>  <span class="at">rate =</span> <span class="fu">c</span>(<span class="st">"745/19987071"</span>, <span class="st">"37737/172006362"</span>, <span class="st">"212258/1272915272"</span>)</span>
<span id="cb237-89"><a href="#cb237-89" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-90"><a href="#cb237-90" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Messy data - multiple values in one column:"</span>)</span>
<span id="cb237-91"><a href="#cb237-91" aria-hidden="true" tabindex="-1"></a>messy2</span>
<span id="cb237-92"><a href="#cb237-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-93"><a href="#cb237-93" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy version</span></span>
<span id="cb237-94"><a href="#cb237-94" aria-hidden="true" tabindex="-1"></a>tidy2 <span class="ot">&lt;-</span> messy2 <span class="sc">%&gt;%</span></span>
<span id="cb237-95"><a href="#cb237-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(rate, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"cases"</span>, <span class="st">"population"</span>), <span class="at">sep =</span> <span class="st">"/"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-96"><a href="#cb237-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rate_per_10k =</span> cases <span class="sc">/</span> population <span class="sc">*</span> <span class="dv">10000</span>)</span>
<span id="cb237-97"><a href="#cb237-97" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Tidy version:"</span>)</span>
<span id="cb237-98"><a href="#cb237-98" aria-hidden="true" tabindex="-1"></a>tidy2</span>
<span id="cb237-99"><a href="#cb237-99" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-100"><a href="#cb237-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-101"><a href="#cb237-101" aria-hidden="true" tabindex="-1"></a><span class="fu">## Pivoting Data</span></span>
<span id="cb237-102"><a href="#cb237-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-103"><a href="#cb237-103" aria-hidden="true" tabindex="-1"></a><span class="fu">### pivot_longer(): Wide to Long</span></span>
<span id="cb237-104"><a href="#cb237-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-107"><a href="#cb237-107" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-108"><a href="#cb237-108" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Wide format data</span></span>
<span id="cb237-109"><a href="#cb237-109" aria-hidden="true" tabindex="-1"></a>wide_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-110"><a href="#cb237-110" aria-hidden="true" tabindex="-1"></a>  <span class="at">student =</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>),</span>
<span id="cb237-111"><a href="#cb237-111" aria-hidden="true" tabindex="-1"></a>  <span class="at">math_score =</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">92</span>, <span class="dv">78</span>),</span>
<span id="cb237-112"><a href="#cb237-112" aria-hidden="true" tabindex="-1"></a>  <span class="at">science_score =</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">88</span>, <span class="dv">85</span>),</span>
<span id="cb237-113"><a href="#cb237-113" aria-hidden="true" tabindex="-1"></a>  <span class="at">english_score =</span> <span class="fu">c</span>(<span class="dv">88</span>, <span class="dv">85</span>, <span class="dv">90</span>),</span>
<span id="cb237-114"><a href="#cb237-114" aria-hidden="true" tabindex="-1"></a>  <span class="at">history_score =</span> <span class="fu">c</span>(<span class="dv">92</span>, <span class="dv">90</span>, <span class="dv">88</span>)</span>
<span id="cb237-115"><a href="#cb237-115" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-116"><a href="#cb237-116" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Wide format:"</span>)</span>
<span id="cb237-117"><a href="#cb237-117" aria-hidden="true" tabindex="-1"></a>wide_data</span>
<span id="cb237-118"><a href="#cb237-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-119"><a href="#cb237-119" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic pivot_longer</span></span>
<span id="cb237-120"><a href="#cb237-120" aria-hidden="true" tabindex="-1"></a>long_data <span class="ot">&lt;-</span> wide_data <span class="sc">%&gt;%</span></span>
<span id="cb237-121"><a href="#cb237-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb237-122"><a href="#cb237-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">"_score"</span>),</span>
<span id="cb237-123"><a href="#cb237-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"subject"</span>,</span>
<span id="cb237-124"><a href="#cb237-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"score"</span></span>
<span id="cb237-125"><a href="#cb237-125" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-126"><a href="#cb237-126" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Long format:"</span>)</span>
<span id="cb237-127"><a href="#cb237-127" aria-hidden="true" tabindex="-1"></a>long_data</span>
<span id="cb237-128"><a href="#cb237-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-129"><a href="#cb237-129" aria-hidden="true" tabindex="-1"></a><span class="co"># Advanced: Extract parts of column names</span></span>
<span id="cb237-130"><a href="#cb237-130" aria-hidden="true" tabindex="-1"></a>long_data_clean <span class="ot">&lt;-</span> wide_data <span class="sc">%&gt;%</span></span>
<span id="cb237-131"><a href="#cb237-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb237-132"><a href="#cb237-132" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">ends_with</span>(<span class="st">"_score"</span>),</span>
<span id="cb237-133"><a href="#cb237-133" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"subject"</span>,</span>
<span id="cb237-134"><a href="#cb237-134" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">"(.*)_score"</span>,  <span class="co"># Extract subject name without "_score"</span></span>
<span id="cb237-135"><a href="#cb237-135" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"score"</span></span>
<span id="cb237-136"><a href="#cb237-136" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-137"><a href="#cb237-137" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Long format with cleaned names:"</span>)</span>
<span id="cb237-138"><a href="#cb237-138" aria-hidden="true" tabindex="-1"></a>long_data_clean</span>
<span id="cb237-139"><a href="#cb237-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-140"><a href="#cb237-140" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple value columns</span></span>
<span id="cb237-141"><a href="#cb237-141" aria-hidden="true" tabindex="-1"></a>quarterly_sales <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-142"><a href="#cb237-142" aria-hidden="true" tabindex="-1"></a>  <span class="at">company =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>),</span>
<span id="cb237-143"><a href="#cb237-143" aria-hidden="true" tabindex="-1"></a>  <span class="at">revenue_q1 =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">200</span>, <span class="dv">150</span>),</span>
<span id="cb237-144"><a href="#cb237-144" aria-hidden="true" tabindex="-1"></a>  <span class="at">revenue_q2 =</span> <span class="fu">c</span>(<span class="dv">110</span>, <span class="dv">210</span>, <span class="dv">160</span>),</span>
<span id="cb237-145"><a href="#cb237-145" aria-hidden="true" tabindex="-1"></a>  <span class="at">costs_q1 =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">150</span>, <span class="dv">120</span>),</span>
<span id="cb237-146"><a href="#cb237-146" aria-hidden="true" tabindex="-1"></a>  <span class="at">costs_q2 =</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">155</span>, <span class="dv">125</span>)</span>
<span id="cb237-147"><a href="#cb237-147" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-148"><a href="#cb237-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-149"><a href="#cb237-149" aria-hidden="true" tabindex="-1"></a>quarterly_long <span class="ot">&lt;-</span> quarterly_sales <span class="sc">%&gt;%</span></span>
<span id="cb237-150"><a href="#cb237-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb237-151"><a href="#cb237-151" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>company,</span>
<span id="cb237-152"><a href="#cb237-152" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">".value"</span>, <span class="st">"quarter"</span>),</span>
<span id="cb237-153"><a href="#cb237-153" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">"_"</span></span>
<span id="cb237-154"><a href="#cb237-154" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-155"><a href="#cb237-155" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Multiple value columns:"</span>)</span>
<span id="cb237-156"><a href="#cb237-156" aria-hidden="true" tabindex="-1"></a>quarterly_long</span>
<span id="cb237-157"><a href="#cb237-157" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-158"><a href="#cb237-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-159"><a href="#cb237-159" aria-hidden="true" tabindex="-1"></a><span class="fu">### pivot_wider(): Long to Wide</span></span>
<span id="cb237-160"><a href="#cb237-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-163"><a href="#cb237-163" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-164"><a href="#cb237-164" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic pivot_wider</span></span>
<span id="cb237-165"><a href="#cb237-165" aria-hidden="true" tabindex="-1"></a>wide_again <span class="ot">&lt;-</span> long_data_clean <span class="sc">%&gt;%</span></span>
<span id="cb237-166"><a href="#cb237-166" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb237-167"><a href="#cb237-167" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> subject,</span>
<span id="cb237-168"><a href="#cb237-168" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> score</span>
<span id="cb237-169"><a href="#cb237-169" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-170"><a href="#cb237-170" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Back to wide format:"</span>)</span>
<span id="cb237-171"><a href="#cb237-171" aria-hidden="true" tabindex="-1"></a>wide_again</span>
<span id="cb237-172"><a href="#cb237-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-173"><a href="#cb237-173" aria-hidden="true" tabindex="-1"></a><span class="co"># With custom column names</span></span>
<span id="cb237-174"><a href="#cb237-174" aria-hidden="true" tabindex="-1"></a>wide_custom <span class="ot">&lt;-</span> long_data_clean <span class="sc">%&gt;%</span></span>
<span id="cb237-175"><a href="#cb237-175" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb237-176"><a href="#cb237-176" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> subject,</span>
<span id="cb237-177"><a href="#cb237-177" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> score,</span>
<span id="cb237-178"><a href="#cb237-178" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"score_"</span></span>
<span id="cb237-179"><a href="#cb237-179" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-180"><a href="#cb237-180" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Wide with custom names:"</span>)</span>
<span id="cb237-181"><a href="#cb237-181" aria-hidden="true" tabindex="-1"></a>wide_custom</span>
<span id="cb237-182"><a href="#cb237-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-183"><a href="#cb237-183" aria-hidden="true" tabindex="-1"></a><span class="co"># Handling multiple values</span></span>
<span id="cb237-184"><a href="#cb237-184" aria-hidden="true" tabindex="-1"></a>multi_observations <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-185"><a href="#cb237-185" aria-hidden="true" tabindex="-1"></a>  <span class="at">day =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>),</span>
<span id="cb237-186"><a href="#cb237-186" aria-hidden="true" tabindex="-1"></a>  <span class="at">measurement =</span> <span class="fu">c</span>(<span class="st">"temp"</span>, <span class="st">"humidity"</span>, <span class="st">"temp"</span>, <span class="st">"humidity"</span>, <span class="st">"temp"</span>, <span class="st">"humidity"</span>),</span>
<span id="cb237-187"><a href="#cb237-187" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">60</span>, <span class="dv">22</span>, <span class="dv">55</span>, <span class="dv">21</span>, <span class="dv">58</span>)</span>
<span id="cb237-188"><a href="#cb237-188" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-189"><a href="#cb237-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-190"><a href="#cb237-190" aria-hidden="true" tabindex="-1"></a>wide_multi <span class="ot">&lt;-</span> multi_observations <span class="sc">%&gt;%</span></span>
<span id="cb237-191"><a href="#cb237-191" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb237-192"><a href="#cb237-192" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> measurement,</span>
<span id="cb237-193"><a href="#cb237-193" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> value</span>
<span id="cb237-194"><a href="#cb237-194" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-195"><a href="#cb237-195" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Multiple measurements to wide:"</span>)</span>
<span id="cb237-196"><a href="#cb237-196" aria-hidden="true" tabindex="-1"></a>wide_multi</span>
<span id="cb237-197"><a href="#cb237-197" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-198"><a href="#cb237-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-199"><a href="#cb237-199" aria-hidden="true" tabindex="-1"></a><span class="fu">### Complex Pivoting Examples</span></span>
<span id="cb237-200"><a href="#cb237-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-203"><a href="#cb237-203" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-204"><a href="#cb237-204" aria-hidden="true" tabindex="-1"></a><span class="co"># Real-world example with gapminder</span></span>
<span id="cb237-205"><a href="#cb237-205" aria-hidden="true" tabindex="-1"></a>gapminder_wide <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb237-206"><a href="#cb237-206" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, continent, year, lifeExp) <span class="sc">%&gt;%</span></span>
<span id="cb237-207"><a href="#cb237-207" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb237-208"><a href="#cb237-208" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> year,</span>
<span id="cb237-209"><a href="#cb237-209" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"year_"</span>,</span>
<span id="cb237-210"><a href="#cb237-210" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> lifeExp</span>
<span id="cb237-211"><a href="#cb237-211" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb237-212"><a href="#cb237-212" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb237-213"><a href="#cb237-213" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Gapminder in wide format:"</span>)</span>
<span id="cb237-214"><a href="#cb237-214" aria-hidden="true" tabindex="-1"></a>gapminder_wide</span>
<span id="cb237-215"><a href="#cb237-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-216"><a href="#cb237-216" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating a correlation matrix format</span></span>
<span id="cb237-217"><a href="#cb237-217" aria-hidden="true" tabindex="-1"></a>penguins_corr <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span></span>
<span id="cb237-218"><a href="#cb237-218" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb237-219"><a href="#cb237-219" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb237-220"><a href="#cb237-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>() <span class="sc">%&gt;%</span></span>
<span id="cb237-221"><a href="#cb237-221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span></span>
<span id="cb237-222"><a href="#cb237-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="st">"var1"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-223"><a href="#cb237-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb237-224"><a href="#cb237-224" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="sc">-</span>var1,</span>
<span id="cb237-225"><a href="#cb237-225" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"var2"</span>,</span>
<span id="cb237-226"><a href="#cb237-226" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"correlation"</span></span>
<span id="cb237-227"><a href="#cb237-227" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb237-228"><a href="#cb237-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(var1 <span class="sc">&lt;</span> var2)  <span class="co"># Keep only upper triangle</span></span>
<span id="cb237-229"><a href="#cb237-229" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Correlation matrix in long format:"</span>)</span>
<span id="cb237-230"><a href="#cb237-230" aria-hidden="true" tabindex="-1"></a>penguins_corr</span>
<span id="cb237-231"><a href="#cb237-231" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-232"><a href="#cb237-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-233"><a href="#cb237-233" aria-hidden="true" tabindex="-1"></a><span class="fu">## Separating and Uniting Columns</span></span>
<span id="cb237-234"><a href="#cb237-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-235"><a href="#cb237-235" aria-hidden="true" tabindex="-1"></a><span class="fu">### separate(): Split One Column into Multiple</span></span>
<span id="cb237-236"><a href="#cb237-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-239"><a href="#cb237-239" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-240"><a href="#cb237-240" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic separation</span></span>
<span id="cb237-241"><a href="#cb237-241" aria-hidden="true" tabindex="-1"></a>dates_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-242"><a href="#cb237-242" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">c</span>(<span class="st">"2023-01-15"</span>, <span class="st">"2023-02-20"</span>, <span class="st">"2023-03-25"</span>),</span>
<span id="cb237-243"><a href="#cb237-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">115</span>)</span>
<span id="cb237-244"><a href="#cb237-244" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-245"><a href="#cb237-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-246"><a href="#cb237-246" aria-hidden="true" tabindex="-1"></a>separated_dates <span class="ot">&lt;-</span> dates_data <span class="sc">%&gt;%</span></span>
<span id="cb237-247"><a href="#cb237-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(date, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"year"</span>, <span class="st">"month"</span>, <span class="st">"day"</span>), <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>)</span>
<span id="cb237-248"><a href="#cb237-248" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Separated date components:"</span>)</span>
<span id="cb237-249"><a href="#cb237-249" aria-hidden="true" tabindex="-1"></a>separated_dates</span>
<span id="cb237-250"><a href="#cb237-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-251"><a href="#cb237-251" aria-hidden="true" tabindex="-1"></a><span class="co"># Separation with regular expressions</span></span>
<span id="cb237-252"><a href="#cb237-252" aria-hidden="true" tabindex="-1"></a>complex_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-253"><a href="#cb237-253" aria-hidden="true" tabindex="-1"></a>  <span class="at">code =</span> <span class="fu">c</span>(<span class="st">"USA-NY-001"</span>, <span class="st">"CAN-ON-002"</span>, <span class="st">"MEX-DF-003"</span>),</span>
<span id="cb237-254"><a href="#cb237-254" aria-hidden="true" tabindex="-1"></a>  <span class="at">sales =</span> <span class="fu">c</span>(<span class="dv">1000</span>, <span class="dv">1500</span>, <span class="dv">800</span>)</span>
<span id="cb237-255"><a href="#cb237-255" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-256"><a href="#cb237-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-257"><a href="#cb237-257" aria-hidden="true" tabindex="-1"></a>separated_complex <span class="ot">&lt;-</span> complex_data <span class="sc">%&gt;%</span></span>
<span id="cb237-258"><a href="#cb237-258" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb237-259"><a href="#cb237-259" aria-hidden="true" tabindex="-1"></a>    code, </span>
<span id="cb237-260"><a href="#cb237-260" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"state"</span>, <span class="st">"id"</span>),</span>
<span id="cb237-261"><a href="#cb237-261" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"-"</span></span>
<span id="cb237-262"><a href="#cb237-262" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-263"><a href="#cb237-263" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Complex separation:"</span>)</span>
<span id="cb237-264"><a href="#cb237-264" aria-hidden="true" tabindex="-1"></a>separated_complex</span>
<span id="cb237-265"><a href="#cb237-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-266"><a href="#cb237-266" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep original column</span></span>
<span id="cb237-267"><a href="#cb237-267" aria-hidden="true" tabindex="-1"></a>with_original <span class="ot">&lt;-</span> complex_data <span class="sc">%&gt;%</span></span>
<span id="cb237-268"><a href="#cb237-268" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(</span>
<span id="cb237-269"><a href="#cb237-269" aria-hidden="true" tabindex="-1"></a>    code,</span>
<span id="cb237-270"><a href="#cb237-270" aria-hidden="true" tabindex="-1"></a>    <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"state"</span>, <span class="st">"id"</span>),</span>
<span id="cb237-271"><a href="#cb237-271" aria-hidden="true" tabindex="-1"></a>    <span class="at">sep =</span> <span class="st">"-"</span>,</span>
<span id="cb237-272"><a href="#cb237-272" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove =</span> <span class="cn">FALSE</span>  <span class="co"># Keep original column</span></span>
<span id="cb237-273"><a href="#cb237-273" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-274"><a href="#cb237-274" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"With original column:"</span>)</span>
<span id="cb237-275"><a href="#cb237-275" aria-hidden="true" tabindex="-1"></a>with_original</span>
<span id="cb237-276"><a href="#cb237-276" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-277"><a href="#cb237-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-278"><a href="#cb237-278" aria-hidden="true" tabindex="-1"></a><span class="fu">### separate_rows(): Create Multiple Rows</span></span>
<span id="cb237-279"><a href="#cb237-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-282"><a href="#cb237-282" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-283"><a href="#cb237-283" aria-hidden="true" tabindex="-1"></a><span class="co"># Data with multiple values in cells</span></span>
<span id="cb237-284"><a href="#cb237-284" aria-hidden="true" tabindex="-1"></a>multi_value_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-285"><a href="#cb237-285" aria-hidden="true" tabindex="-1"></a>  <span class="at">person =</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>),</span>
<span id="cb237-286"><a href="#cb237-286" aria-hidden="true" tabindex="-1"></a>  <span class="at">languages =</span> <span class="fu">c</span>(<span class="st">"R,Python,SQL"</span>, <span class="st">"R,JavaScript"</span>, <span class="st">"Python,SQL,Julia"</span>),</span>
<span id="cb237-287"><a href="#cb237-287" aria-hidden="true" tabindex="-1"></a>  <span class="at">years_exp =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">7</span>)</span>
<span id="cb237-288"><a href="#cb237-288" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-289"><a href="#cb237-289" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-290"><a href="#cb237-290" aria-hidden="true" tabindex="-1"></a>separated_rows <span class="ot">&lt;-</span> multi_value_data <span class="sc">%&gt;%</span></span>
<span id="cb237-291"><a href="#cb237-291" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(languages, <span class="at">sep =</span> <span class="st">","</span>)</span>
<span id="cb237-292"><a href="#cb237-292" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Multiple values to rows:"</span>)</span>
<span id="cb237-293"><a href="#cb237-293" aria-hidden="true" tabindex="-1"></a>separated_rows</span>
<span id="cb237-294"><a href="#cb237-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-295"><a href="#cb237-295" aria-hidden="true" tabindex="-1"></a><span class="co"># Count languages per person</span></span>
<span id="cb237-296"><a href="#cb237-296" aria-hidden="true" tabindex="-1"></a>language_counts <span class="ot">&lt;-</span> separated_rows <span class="sc">%&gt;%</span></span>
<span id="cb237-297"><a href="#cb237-297" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(person) <span class="sc">%&gt;%</span></span>
<span id="cb237-298"><a href="#cb237-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb237-299"><a href="#cb237-299" aria-hidden="true" tabindex="-1"></a>    <span class="at">num_languages =</span> <span class="fu">n</span>(),</span>
<span id="cb237-300"><a href="#cb237-300" aria-hidden="true" tabindex="-1"></a>    <span class="at">languages_list =</span> <span class="fu">paste</span>(languages, <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb237-301"><a href="#cb237-301" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-302"><a href="#cb237-302" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Language summary:"</span>)</span>
<span id="cb237-303"><a href="#cb237-303" aria-hidden="true" tabindex="-1"></a>language_counts</span>
<span id="cb237-304"><a href="#cb237-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-305"><a href="#cb237-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-306"><a href="#cb237-306" aria-hidden="true" tabindex="-1"></a><span class="fu">### unite(): Combine Multiple Columns</span></span>
<span id="cb237-307"><a href="#cb237-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-310"><a href="#cb237-310" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-311"><a href="#cb237-311" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic unite</span></span>
<span id="cb237-312"><a href="#cb237-312" aria-hidden="true" tabindex="-1"></a>address_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-313"><a href="#cb237-313" aria-hidden="true" tabindex="-1"></a>  <span class="at">street_num =</span> <span class="fu">c</span>(<span class="st">"123"</span>, <span class="st">"456"</span>, <span class="st">"789"</span>),</span>
<span id="cb237-314"><a href="#cb237-314" aria-hidden="true" tabindex="-1"></a>  <span class="at">street_name =</span> <span class="fu">c</span>(<span class="st">"Main St"</span>, <span class="st">"Oak Ave"</span>, <span class="st">"Park Rd"</span>),</span>
<span id="cb237-315"><a href="#cb237-315" aria-hidden="true" tabindex="-1"></a>  <span class="at">city =</span> <span class="fu">c</span>(<span class="st">"Boston"</span>, <span class="st">"New York"</span>, <span class="st">"Chicago"</span>),</span>
<span id="cb237-316"><a href="#cb237-316" aria-hidden="true" tabindex="-1"></a>  <span class="at">state =</span> <span class="fu">c</span>(<span class="st">"MA"</span>, <span class="st">"NY"</span>, <span class="st">"IL"</span>)</span>
<span id="cb237-317"><a href="#cb237-317" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-318"><a href="#cb237-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-319"><a href="#cb237-319" aria-hidden="true" tabindex="-1"></a>united_address <span class="ot">&lt;-</span> address_data <span class="sc">%&gt;%</span></span>
<span id="cb237-320"><a href="#cb237-320" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(full_address, street_num, street_name, city, state, <span class="at">sep =</span> <span class="st">", "</span>)</span>
<span id="cb237-321"><a href="#cb237-321" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"United address:"</span>)</span>
<span id="cb237-322"><a href="#cb237-322" aria-hidden="true" tabindex="-1"></a>united_address</span>
<span id="cb237-323"><a href="#cb237-323" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-324"><a href="#cb237-324" aria-hidden="true" tabindex="-1"></a><span class="co"># Unite with custom separator</span></span>
<span id="cb237-325"><a href="#cb237-325" aria-hidden="true" tabindex="-1"></a>date_parts <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-326"><a href="#cb237-326" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2023</span>, <span class="dv">2023</span>, <span class="dv">2023</span>),</span>
<span id="cb237-327"><a href="#cb237-327" aria-hidden="true" tabindex="-1"></a>  <span class="at">month =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb237-328"><a href="#cb237-328" aria-hidden="true" tabindex="-1"></a>  <span class="at">day =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">20</span>, <span class="dv">25</span>)</span>
<span id="cb237-329"><a href="#cb237-329" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-330"><a href="#cb237-330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-331"><a href="#cb237-331" aria-hidden="true" tabindex="-1"></a>united_dates <span class="ot">&lt;-</span> date_parts <span class="sc">%&gt;%</span></span>
<span id="cb237-332"><a href="#cb237-332" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(date, year, month, day, <span class="at">sep =</span> <span class="st">"-"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-333"><a href="#cb237-333" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb237-334"><a href="#cb237-334" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"United dates:"</span>)</span>
<span id="cb237-335"><a href="#cb237-335" aria-hidden="true" tabindex="-1"></a>united_dates</span>
<span id="cb237-336"><a href="#cb237-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-337"><a href="#cb237-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-338"><a href="#cb237-338" aria-hidden="true" tabindex="-1"></a><span class="fu">## Handling Missing Values</span></span>
<span id="cb237-339"><a href="#cb237-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-340"><a href="#cb237-340" aria-hidden="true" tabindex="-1"></a><span class="fu">### Explicit vs Implicit Missing Values</span></span>
<span id="cb237-341"><a href="#cb237-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-344"><a href="#cb237-344" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-345"><a href="#cb237-345" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset with implicit missing values</span></span>
<span id="cb237-346"><a href="#cb237-346" aria-hidden="true" tabindex="-1"></a>stocks <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-347"><a href="#cb237-347" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2022</span>),</span>
<span id="cb237-348"><a href="#cb237-348" aria-hidden="true" tabindex="-1"></a>  <span class="at">quarter =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>),</span>
<span id="cb237-349"><a href="#cb237-349" aria-hidden="true" tabindex="-1"></a>  <span class="at">revenue =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">120</span>, <span class="dv">110</span>, <span class="dv">130</span>, <span class="dv">125</span>)</span>
<span id="cb237-350"><a href="#cb237-350" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-351"><a href="#cb237-351" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Data with implicit missing values:"</span>)</span>
<span id="cb237-352"><a href="#cb237-352" aria-hidden="true" tabindex="-1"></a>stocks</span>
<span id="cb237-353"><a href="#cb237-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-354"><a href="#cb237-354" aria-hidden="true" tabindex="-1"></a><span class="co"># Make implicit missing values explicit</span></span>
<span id="cb237-355"><a href="#cb237-355" aria-hidden="true" tabindex="-1"></a>complete_stocks <span class="ot">&lt;-</span> stocks <span class="sc">%&gt;%</span></span>
<span id="cb237-356"><a href="#cb237-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(year, quarter)</span>
<span id="cb237-357"><a href="#cb237-357" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"After complete():"</span>)</span>
<span id="cb237-358"><a href="#cb237-358" aria-hidden="true" tabindex="-1"></a>complete_stocks</span>
<span id="cb237-359"><a href="#cb237-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-360"><a href="#cb237-360" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill missing values</span></span>
<span id="cb237-361"><a href="#cb237-361" aria-hidden="true" tabindex="-1"></a>filled_stocks <span class="ot">&lt;-</span> complete_stocks <span class="sc">%&gt;%</span></span>
<span id="cb237-362"><a href="#cb237-362" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(year, quarter) <span class="sc">%&gt;%</span></span>
<span id="cb237-363"><a href="#cb237-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(revenue, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb237-364"><a href="#cb237-364" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"After filling:"</span>)</span>
<span id="cb237-365"><a href="#cb237-365" aria-hidden="true" tabindex="-1"></a>filled_stocks</span>
<span id="cb237-366"><a href="#cb237-366" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-367"><a href="#cb237-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-368"><a href="#cb237-368" aria-hidden="true" tabindex="-1"></a><span class="fu">### drop_na() and replace_na()</span></span>
<span id="cb237-369"><a href="#cb237-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-372"><a href="#cb237-372" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-373"><a href="#cb237-373" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample data with NAs</span></span>
<span id="cb237-374"><a href="#cb237-374" aria-hidden="true" tabindex="-1"></a>messy_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-375"><a href="#cb237-375" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="cn">NA</span>, <span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb237-376"><a href="#cb237-376" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="cn">NA</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="cn">NA</span>),</span>
<span id="cb237-377"><a href="#cb237-377" aria-hidden="true" tabindex="-1"></a>  <span class="at">z =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="cn">NA</span>, <span class="dv">50</span>)</span>
<span id="cb237-378"><a href="#cb237-378" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-379"><a href="#cb237-379" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Data with NAs:"</span>)</span>
<span id="cb237-380"><a href="#cb237-380" aria-hidden="true" tabindex="-1"></a>messy_data</span>
<span id="cb237-381"><a href="#cb237-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-382"><a href="#cb237-382" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop rows with any NA</span></span>
<span id="cb237-383"><a href="#cb237-383" aria-hidden="true" tabindex="-1"></a>clean_all <span class="ot">&lt;-</span> messy_data <span class="sc">%&gt;%</span></span>
<span id="cb237-384"><a href="#cb237-384" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb237-385"><a href="#cb237-385" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Drop all NAs:"</span>)</span>
<span id="cb237-386"><a href="#cb237-386" aria-hidden="true" tabindex="-1"></a>clean_all</span>
<span id="cb237-387"><a href="#cb237-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-388"><a href="#cb237-388" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop NAs from specific columns</span></span>
<span id="cb237-389"><a href="#cb237-389" aria-hidden="true" tabindex="-1"></a>clean_x <span class="ot">&lt;-</span> messy_data <span class="sc">%&gt;%</span></span>
<span id="cb237-390"><a href="#cb237-390" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>(x)</span>
<span id="cb237-391"><a href="#cb237-391" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Drop NAs from x only:"</span>)</span>
<span id="cb237-392"><a href="#cb237-392" aria-hidden="true" tabindex="-1"></a>clean_x</span>
<span id="cb237-393"><a href="#cb237-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-394"><a href="#cb237-394" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace NAs with specific values</span></span>
<span id="cb237-395"><a href="#cb237-395" aria-hidden="true" tabindex="-1"></a>replaced_data <span class="ot">&lt;-</span> messy_data <span class="sc">%&gt;%</span></span>
<span id="cb237-396"><a href="#cb237-396" aria-hidden="true" tabindex="-1"></a>  <span class="fu">replace_na</span>(<span class="fu">list</span>(</span>
<span id="cb237-397"><a href="#cb237-397" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">0</span>,</span>
<span id="cb237-398"><a href="#cb237-398" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"missing"</span>,</span>
<span id="cb237-399"><a href="#cb237-399" aria-hidden="true" tabindex="-1"></a>    <span class="at">z =</span> <span class="fu">mean</span>(messy_data<span class="sc">$</span>z, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb237-400"><a href="#cb237-400" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb237-401"><a href="#cb237-401" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Replaced NAs:"</span>)</span>
<span id="cb237-402"><a href="#cb237-402" aria-hidden="true" tabindex="-1"></a>replaced_data</span>
<span id="cb237-403"><a href="#cb237-403" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-404"><a href="#cb237-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-405"><a href="#cb237-405" aria-hidden="true" tabindex="-1"></a><span class="fu">### Advanced Missing Value Patterns</span></span>
<span id="cb237-406"><a href="#cb237-406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-409"><a href="#cb237-409" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-410"><a href="#cb237-410" aria-hidden="true" tabindex="-1"></a><span class="co"># Create time series with gaps</span></span>
<span id="cb237-411"><a href="#cb237-411" aria-hidden="true" tabindex="-1"></a>time_series <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-412"><a href="#cb237-412" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2023-01-01"</span>, <span class="st">"2023-01-03"</span>, <span class="st">"2023-01-07"</span>, <span class="st">"2023-01-08"</span>)),</span>
<span id="cb237-413"><a href="#cb237-413" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">105</span>, <span class="dv">115</span>, <span class="dv">118</span>)</span>
<span id="cb237-414"><a href="#cb237-414" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-415"><a href="#cb237-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-416"><a href="#cb237-416" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the time series</span></span>
<span id="cb237-417"><a href="#cb237-417" aria-hidden="true" tabindex="-1"></a>complete_series <span class="ot">&lt;-</span> time_series <span class="sc">%&gt;%</span></span>
<span id="cb237-418"><a href="#cb237-418" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">date =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(date), <span class="fu">max</span>(date), <span class="at">by =</span> <span class="st">"day"</span>))</span>
<span id="cb237-419"><a href="#cb237-419" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Complete time series:"</span>)</span>
<span id="cb237-420"><a href="#cb237-420" aria-hidden="true" tabindex="-1"></a>complete_series</span>
<span id="cb237-421"><a href="#cb237-421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-422"><a href="#cb237-422" aria-hidden="true" tabindex="-1"></a><span class="co"># Forward fill (last observation carried forward)</span></span>
<span id="cb237-423"><a href="#cb237-423" aria-hidden="true" tabindex="-1"></a>filled_series <span class="ot">&lt;-</span> complete_series <span class="sc">%&gt;%</span></span>
<span id="cb237-424"><a href="#cb237-424" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(value, <span class="at">.direction =</span> <span class="st">"down"</span>)</span>
<span id="cb237-425"><a href="#cb237-425" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Forward filled:"</span>)</span>
<span id="cb237-426"><a href="#cb237-426" aria-hidden="true" tabindex="-1"></a>filled_series</span>
<span id="cb237-427"><a href="#cb237-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-428"><a href="#cb237-428" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpolation (requires zoo package)</span></span>
<span id="cb237-429"><a href="#cb237-429" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">require</span>(zoo, <span class="at">quietly =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb237-430"><a href="#cb237-430" aria-hidden="true" tabindex="-1"></a>  interpolated <span class="ot">&lt;-</span> complete_series <span class="sc">%&gt;%</span></span>
<span id="cb237-431"><a href="#cb237-431" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">value_interpolated =</span> zoo<span class="sc">::</span><span class="fu">na.approx</span>(value, <span class="at">na.rm =</span> <span class="cn">FALSE</span>))</span>
<span id="cb237-432"><a href="#cb237-432" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Linear interpolation:"</span>)</span>
<span id="cb237-433"><a href="#cb237-433" aria-hidden="true" tabindex="-1"></a>  interpolated</span>
<span id="cb237-434"><a href="#cb237-434" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb237-435"><a href="#cb237-435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-436"><a href="#cb237-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-437"><a href="#cb237-437" aria-hidden="true" tabindex="-1"></a><span class="fu">## Nesting and Unnesting</span></span>
<span id="cb237-438"><a href="#cb237-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-439"><a href="#cb237-439" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating Nested Data</span></span>
<span id="cb237-440"><a href="#cb237-440" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-443"><a href="#cb237-443" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-444"><a href="#cb237-444" aria-hidden="true" tabindex="-1"></a><span class="co"># Group and nest</span></span>
<span id="cb237-445"><a href="#cb237-445" aria-hidden="true" tabindex="-1"></a>nested_penguins <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span></span>
<span id="cb237-446"><a href="#cb237-446" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species, island) <span class="sc">%&gt;%</span></span>
<span id="cb237-447"><a href="#cb237-447" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb237-448"><a href="#cb237-448" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Nested penguins data:"</span>)</span>
<span id="cb237-449"><a href="#cb237-449" aria-hidden="true" tabindex="-1"></a>nested_penguins</span>
<span id="cb237-450"><a href="#cb237-450" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-451"><a href="#cb237-451" aria-hidden="true" tabindex="-1"></a><span class="co"># Access nested data</span></span>
<span id="cb237-452"><a href="#cb237-452" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"First nested tibble:"</span>)</span>
<span id="cb237-453"><a href="#cb237-453" aria-hidden="true" tabindex="-1"></a>nested_penguins<span class="sc">$</span>data[[<span class="dv">1</span>]]</span>
<span id="cb237-454"><a href="#cb237-454" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-455"><a href="#cb237-455" aria-hidden="true" tabindex="-1"></a><span class="co"># Nested with custom columns</span></span>
<span id="cb237-456"><a href="#cb237-456" aria-hidden="true" tabindex="-1"></a>custom_nest <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span></span>
<span id="cb237-457"><a href="#cb237-457" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb237-458"><a href="#cb237-458" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(</span>
<span id="cb237-459"><a href="#cb237-459" aria-hidden="true" tabindex="-1"></a>    <span class="at">bill_data =</span> <span class="fu">c</span>(bill_length_mm, bill_depth_mm),</span>
<span id="cb237-460"><a href="#cb237-460" aria-hidden="true" tabindex="-1"></a>    <span class="at">body_data =</span> <span class="fu">c</span>(flipper_length_mm, body_mass_g)</span>
<span id="cb237-461"><a href="#cb237-461" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-462"><a href="#cb237-462" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Custom nested columns:"</span>)</span>
<span id="cb237-463"><a href="#cb237-463" aria-hidden="true" tabindex="-1"></a>custom_nest</span>
<span id="cb237-464"><a href="#cb237-464" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-465"><a href="#cb237-465" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-466"><a href="#cb237-466" aria-hidden="true" tabindex="-1"></a><span class="fu">### Working with Nested Data</span></span>
<span id="cb237-467"><a href="#cb237-467" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-470"><a href="#cb237-470" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-471"><a href="#cb237-471" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply functions to nested data</span></span>
<span id="cb237-472"><a href="#cb237-472" aria-hidden="true" tabindex="-1"></a>nested_summary <span class="ot">&lt;-</span> nested_penguins <span class="sc">%&gt;%</span></span>
<span id="cb237-473"><a href="#cb237-473" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-474"><a href="#cb237-474" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_obs =</span> <span class="fu">map_int</span>(data, nrow),</span>
<span id="cb237-475"><a href="#cb237-475" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_mass =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span> <span class="fu">mean</span>(.<span class="sc">$</span>body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)),</span>
<span id="cb237-476"><a href="#cb237-476" aria-hidden="true" tabindex="-1"></a>    <span class="at">mass_range =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span> <span class="fu">diff</span>(<span class="fu">range</span>(.<span class="sc">$</span>body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb237-477"><a href="#cb237-477" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-478"><a href="#cb237-478" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Summary of nested data:"</span>)</span>
<span id="cb237-479"><a href="#cb237-479" aria-hidden="true" tabindex="-1"></a>nested_summary <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>data)</span>
<span id="cb237-480"><a href="#cb237-480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-481"><a href="#cb237-481" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models to nested data</span></span>
<span id="cb237-482"><a href="#cb237-482" aria-hidden="true" tabindex="-1"></a>nested_models <span class="ot">&lt;-</span> nested_penguins <span class="sc">%&gt;%</span></span>
<span id="cb237-483"><a href="#cb237-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-484"><a href="#cb237-484" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> flipper_length_mm, <span class="at">data =</span> .)),</span>
<span id="cb237-485"><a href="#cb237-485" aria-hidden="true" tabindex="-1"></a>    <span class="at">r_squared =</span> <span class="fu">map_dbl</span>(model, <span class="sc">~</span> <span class="fu">summary</span>(.)<span class="sc">$</span>r.squared)</span>
<span id="cb237-486"><a href="#cb237-486" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-487"><a href="#cb237-487" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Models fitted to nested data:"</span>)</span>
<span id="cb237-488"><a href="#cb237-488" aria-hidden="true" tabindex="-1"></a>nested_models <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>data, <span class="sc">-</span>model)</span>
<span id="cb237-489"><a href="#cb237-489" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-490"><a href="#cb237-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-491"><a href="#cb237-491" aria-hidden="true" tabindex="-1"></a><span class="fu">### Unnesting</span></span>
<span id="cb237-492"><a href="#cb237-492" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-495"><a href="#cb237-495" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-496"><a href="#cb237-496" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic unnest</span></span>
<span id="cb237-497"><a href="#cb237-497" aria-hidden="true" tabindex="-1"></a>unnested <span class="ot">&lt;-</span> nested_penguins <span class="sc">%&gt;%</span></span>
<span id="cb237-498"><a href="#cb237-498" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(data)</span>
<span id="cb237-499"><a href="#cb237-499" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unnested data (first 10 rows):"</span>)</span>
<span id="cb237-500"><a href="#cb237-500" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(unnested, <span class="dv">10</span>)</span>
<span id="cb237-501"><a href="#cb237-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-502"><a href="#cb237-502" aria-hidden="true" tabindex="-1"></a><span class="co"># Unnest with selection</span></span>
<span id="cb237-503"><a href="#cb237-503" aria-hidden="true" tabindex="-1"></a>partial_unnest <span class="ot">&lt;-</span> custom_nest <span class="sc">%&gt;%</span></span>
<span id="cb237-504"><a href="#cb237-504" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(bill_data) <span class="sc">%&gt;%</span></span>
<span id="cb237-505"><a href="#cb237-505" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span>
<span id="cb237-506"><a href="#cb237-506" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Partial unnest:"</span>)</span>
<span id="cb237-507"><a href="#cb237-507" aria-hidden="true" tabindex="-1"></a>partial_unnest</span>
<span id="cb237-508"><a href="#cb237-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-509"><a href="#cb237-509" aria-hidden="true" tabindex="-1"></a><span class="co"># Unnest wider (for list columns with consistent structure)</span></span>
<span id="cb237-510"><a href="#cb237-510" aria-hidden="true" tabindex="-1"></a>summary_data <span class="ot">&lt;-</span> nested_penguins <span class="sc">%&gt;%</span></span>
<span id="cb237-511"><a href="#cb237-511" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-512"><a href="#cb237-512" aria-hidden="true" tabindex="-1"></a>    <span class="at">summary =</span> <span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">tibble</span>(</span>
<span id="cb237-513"><a href="#cb237-513" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_mass =</span> <span class="fu">mean</span>(.<span class="sc">$</span>body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb237-514"><a href="#cb237-514" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd_mass =</span> <span class="fu">sd</span>(.<span class="sc">$</span>body_mass_g, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb237-515"><a href="#cb237-515" aria-hidden="true" tabindex="-1"></a>      <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb237-516"><a href="#cb237-516" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb237-517"><a href="#cb237-517" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb237-518"><a href="#cb237-518" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">%&gt;%</span></span>
<span id="cb237-519"><a href="#cb237-519" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest_wider</span>(summary)</span>
<span id="cb237-520"><a href="#cb237-520" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unnest wider:"</span>)</span>
<span id="cb237-521"><a href="#cb237-521" aria-hidden="true" tabindex="-1"></a>summary_data</span>
<span id="cb237-522"><a href="#cb237-522" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-523"><a href="#cb237-523" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-524"><a href="#cb237-524" aria-hidden="true" tabindex="-1"></a><span class="fu">## List Columns</span></span>
<span id="cb237-525"><a href="#cb237-525" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-526"><a href="#cb237-526" aria-hidden="true" tabindex="-1"></a><span class="fu">### Creating and Working with List Columns</span></span>
<span id="cb237-527"><a href="#cb237-527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-530"><a href="#cb237-530" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-531"><a href="#cb237-531" aria-hidden="true" tabindex="-1"></a><span class="co"># Create list columns</span></span>
<span id="cb237-532"><a href="#cb237-532" aria-hidden="true" tabindex="-1"></a>list_col_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-533"><a href="#cb237-533" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb237-534"><a href="#cb237-534" aria-hidden="true" tabindex="-1"></a>  <span class="at">values =</span> <span class="fu">list</span>(</span>
<span id="cb237-535"><a href="#cb237-535" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb237-536"><a href="#cb237-536" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>),</span>
<span id="cb237-537"><a href="#cb237-537" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>)</span>
<span id="cb237-538"><a href="#cb237-538" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb237-539"><a href="#cb237-539" aria-hidden="true" tabindex="-1"></a>  <span class="at">metadata =</span> <span class="fu">list</span>(</span>
<span id="cb237-540"><a href="#cb237-540" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"A"</span>, <span class="at">quality =</span> <span class="st">"high"</span>),</span>
<span id="cb237-541"><a href="#cb237-541" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"B"</span>, <span class="at">quality =</span> <span class="st">"medium"</span>),</span>
<span id="cb237-542"><a href="#cb237-542" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"A"</span>, <span class="at">quality =</span> <span class="st">"low"</span>)</span>
<span id="cb237-543"><a href="#cb237-543" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-544"><a href="#cb237-544" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-545"><a href="#cb237-545" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Data with list columns:"</span>)</span>
<span id="cb237-546"><a href="#cb237-546" aria-hidden="true" tabindex="-1"></a>list_col_data</span>
<span id="cb237-547"><a href="#cb237-547" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-548"><a href="#cb237-548" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract from list columns</span></span>
<span id="cb237-549"><a href="#cb237-549" aria-hidden="true" tabindex="-1"></a>extracted <span class="ot">&lt;-</span> list_col_data <span class="sc">%&gt;%</span></span>
<span id="cb237-550"><a href="#cb237-550" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-551"><a href="#cb237-551" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_values =</span> <span class="fu">map_int</span>(values, length),</span>
<span id="cb237-552"><a href="#cb237-552" aria-hidden="true" tabindex="-1"></a>    <span class="at">sum_values =</span> <span class="fu">map_dbl</span>(values, sum),</span>
<span id="cb237-553"><a href="#cb237-553" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">map_chr</span>(metadata, <span class="st">"type"</span>),</span>
<span id="cb237-554"><a href="#cb237-554" aria-hidden="true" tabindex="-1"></a>    <span class="at">quality =</span> <span class="fu">map_chr</span>(metadata, <span class="st">"quality"</span>)</span>
<span id="cb237-555"><a href="#cb237-555" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-556"><a href="#cb237-556" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Extracted values:"</span>)</span>
<span id="cb237-557"><a href="#cb237-557" aria-hidden="true" tabindex="-1"></a>extracted <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>values, <span class="sc">-</span>metadata)</span>
<span id="cb237-558"><a href="#cb237-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-559"><a href="#cb237-559" aria-hidden="true" tabindex="-1"></a><span class="co"># Unnest list columns</span></span>
<span id="cb237-560"><a href="#cb237-560" aria-hidden="true" tabindex="-1"></a>unnested_values <span class="ot">&lt;-</span> list_col_data <span class="sc">%&gt;%</span></span>
<span id="cb237-561"><a href="#cb237-561" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(values) <span class="sc">%&gt;%</span></span>
<span id="cb237-562"><a href="#cb237-562" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(id) <span class="sc">%&gt;%</span></span>
<span id="cb237-563"><a href="#cb237-563" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">value_index =</span> <span class="fu">row_number</span>())</span>
<span id="cb237-564"><a href="#cb237-564" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Unnested values:"</span>)</span>
<span id="cb237-565"><a href="#cb237-565" aria-hidden="true" tabindex="-1"></a>unnested_values</span>
<span id="cb237-566"><a href="#cb237-566" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-567"><a href="#cb237-567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-568"><a href="#cb237-568" aria-hidden="true" tabindex="-1"></a><span class="fu">### Advanced List Column Operations</span></span>
<span id="cb237-569"><a href="#cb237-569" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-572"><a href="#cb237-572" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-573"><a href="#cb237-573" aria-hidden="true" tabindex="-1"></a><span class="co"># Store complex objects</span></span>
<span id="cb237-574"><a href="#cb237-574" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">&lt;-</span> penguins <span class="sc">%&gt;%</span></span>
<span id="cb237-575"><a href="#cb237-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb237-576"><a href="#cb237-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(species) <span class="sc">%&gt;%</span></span>
<span id="cb237-577"><a href="#cb237-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb237-578"><a href="#cb237-578" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-579"><a href="#cb237-579" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fit different models</span></span>
<span id="cb237-580"><a href="#cb237-580" aria-hidden="true" tabindex="-1"></a>    <span class="at">lm_model =</span> <span class="fu">map</span>(data, <span class="sc">~</span> <span class="fu">lm</span>(body_mass_g <span class="sc">~</span> flipper_length_mm <span class="sc">+</span> bill_length_mm, <span class="at">data =</span> .)),</span>
<span id="cb237-581"><a href="#cb237-581" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coefficients</span></span>
<span id="cb237-582"><a href="#cb237-582" aria-hidden="true" tabindex="-1"></a>    <span class="at">coefficients =</span> <span class="fu">map</span>(lm_model, broom<span class="sc">::</span>tidy),</span>
<span id="cb237-583"><a href="#cb237-583" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get predictions</span></span>
<span id="cb237-584"><a href="#cb237-584" aria-hidden="true" tabindex="-1"></a>    <span class="at">predictions =</span> <span class="fu">map2</span>(lm_model, data, <span class="sc">~</span> broom<span class="sc">::</span><span class="fu">augment</span>(.x, <span class="at">newdata =</span> .y))</span>
<span id="cb237-585"><a href="#cb237-585" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-586"><a href="#cb237-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-587"><a href="#cb237-587" aria-hidden="true" tabindex="-1"></a><span class="co"># View coefficients</span></span>
<span id="cb237-588"><a href="#cb237-588" aria-hidden="true" tabindex="-1"></a>coefficients_df <span class="ot">&lt;-</span> model_data <span class="sc">%&gt;%</span></span>
<span id="cb237-589"><a href="#cb237-589" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species, coefficients) <span class="sc">%&gt;%</span></span>
<span id="cb237-590"><a href="#cb237-590" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(coefficients)</span>
<span id="cb237-591"><a href="#cb237-591" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Model coefficients:"</span>)</span>
<span id="cb237-592"><a href="#cb237-592" aria-hidden="true" tabindex="-1"></a>coefficients_df</span>
<span id="cb237-593"><a href="#cb237-593" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-594"><a href="#cb237-594" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract R-squared values</span></span>
<span id="cb237-595"><a href="#cb237-595" aria-hidden="true" tabindex="-1"></a>r_squared <span class="ot">&lt;-</span> model_data <span class="sc">%&gt;%</span></span>
<span id="cb237-596"><a href="#cb237-596" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r_squared =</span> <span class="fu">map_dbl</span>(lm_model, <span class="sc">~</span> <span class="fu">summary</span>(.)<span class="sc">$</span>r.squared)) <span class="sc">%&gt;%</span></span>
<span id="cb237-597"><a href="#cb237-597" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species, r_squared)</span>
<span id="cb237-598"><a href="#cb237-598" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"R-squared values:"</span>)</span>
<span id="cb237-599"><a href="#cb237-599" aria-hidden="true" tabindex="-1"></a>r_squared</span>
<span id="cb237-600"><a href="#cb237-600" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-601"><a href="#cb237-601" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-602"><a href="#cb237-602" aria-hidden="true" tabindex="-1"></a><span class="fu">## Expanding and Completing Data</span></span>
<span id="cb237-603"><a href="#cb237-603" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-604"><a href="#cb237-604" aria-hidden="true" tabindex="-1"></a><span class="fu">### expand(): All Combinations</span></span>
<span id="cb237-605"><a href="#cb237-605" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-608"><a href="#cb237-608" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-609"><a href="#cb237-609" aria-hidden="true" tabindex="-1"></a><span class="co"># Create all combinations</span></span>
<span id="cb237-610"><a href="#cb237-610" aria-hidden="true" tabindex="-1"></a>experiment_design <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb237-611"><a href="#cb237-611" aria-hidden="true" tabindex="-1"></a>  <span class="at">treatment =</span> <span class="fu">c</span>(<span class="st">"Control"</span>, <span class="st">"Drug A"</span>, <span class="st">"Drug B"</span>),</span>
<span id="cb237-612"><a href="#cb237-612" aria-hidden="true" tabindex="-1"></a>  <span class="at">dose =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">50</span>),</span>
<span id="cb237-613"><a href="#cb237-613" aria-hidden="true" tabindex="-1"></a>  <span class="at">replicate =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb237-614"><a href="#cb237-614" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-615"><a href="#cb237-615" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Experimental design:"</span>)</span>
<span id="cb237-616"><a href="#cb237-616" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(experiment_design, <span class="dv">12</span>)</span>
<span id="cb237-617"><a href="#cb237-617" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-618"><a href="#cb237-618" aria-hidden="true" tabindex="-1"></a><span class="co"># Expand existing data</span></span>
<span id="cb237-619"><a href="#cb237-619" aria-hidden="true" tabindex="-1"></a>sales_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-620"><a href="#cb237-620" aria-hidden="true" tabindex="-1"></a>  <span class="at">store =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>),</span>
<span id="cb237-621"><a href="#cb237-621" aria-hidden="true" tabindex="-1"></a>  <span class="at">product =</span> <span class="fu">c</span>(<span class="st">"X"</span>, <span class="st">"Y"</span>, <span class="st">"X"</span>),</span>
<span id="cb237-622"><a href="#cb237-622" aria-hidden="true" tabindex="-1"></a>  <span class="at">sales =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">120</span>)</span>
<span id="cb237-623"><a href="#cb237-623" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-624"><a href="#cb237-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-625"><a href="#cb237-625" aria-hidden="true" tabindex="-1"></a>all_combinations <span class="ot">&lt;-</span> sales_data <span class="sc">%&gt;%</span></span>
<span id="cb237-626"><a href="#cb237-626" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(store, product)</span>
<span id="cb237-627"><a href="#cb237-627" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"All store-product combinations:"</span>)</span>
<span id="cb237-628"><a href="#cb237-628" aria-hidden="true" tabindex="-1"></a>all_combinations</span>
<span id="cb237-629"><a href="#cb237-629" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-630"><a href="#cb237-630" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete with defaults</span></span>
<span id="cb237-631"><a href="#cb237-631" aria-hidden="true" tabindex="-1"></a>complete_sales <span class="ot">&lt;-</span> sales_data <span class="sc">%&gt;%</span></span>
<span id="cb237-632"><a href="#cb237-632" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(store, product, <span class="at">fill =</span> <span class="fu">list</span>(<span class="at">sales =</span> <span class="dv">0</span>))</span>
<span id="cb237-633"><a href="#cb237-633" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Complete sales data:"</span>)</span>
<span id="cb237-634"><a href="#cb237-634" aria-hidden="true" tabindex="-1"></a>complete_sales</span>
<span id="cb237-635"><a href="#cb237-635" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-636"><a href="#cb237-636" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-637"><a href="#cb237-637" aria-hidden="true" tabindex="-1"></a><span class="fu">### crossing() and nesting()</span></span>
<span id="cb237-638"><a href="#cb237-638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-641"><a href="#cb237-641" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-642"><a href="#cb237-642" aria-hidden="true" tabindex="-1"></a><span class="co"># Crossing - all combinations</span></span>
<span id="cb237-643"><a href="#cb237-643" aria-hidden="true" tabindex="-1"></a>colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>)</span>
<span id="cb237-644"><a href="#cb237-644" aria-hidden="true" tabindex="-1"></a>sizes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"S"</span>, <span class="st">"M"</span>, <span class="st">"L"</span>)</span>
<span id="cb237-645"><a href="#cb237-645" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-646"><a href="#cb237-646" aria-hidden="true" tabindex="-1"></a>inventory <span class="ot">&lt;-</span> <span class="fu">crossing</span>(</span>
<span id="cb237-647"><a href="#cb237-647" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> colors,</span>
<span id="cb237-648"><a href="#cb237-648" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> sizes</span>
<span id="cb237-649"><a href="#cb237-649" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb237-650"><a href="#cb237-650" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stock =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">50</span>, <span class="fu">n</span>(), <span class="at">replace =</span> <span class="cn">TRUE</span>))</span>
<span id="cb237-651"><a href="#cb237-651" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Inventory matrix:"</span>)</span>
<span id="cb237-652"><a href="#cb237-652" aria-hidden="true" tabindex="-1"></a>inventory</span>
<span id="cb237-653"><a href="#cb237-653" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-654"><a href="#cb237-654" aria-hidden="true" tabindex="-1"></a><span class="co"># Nesting - only observed combinations</span></span>
<span id="cb237-655"><a href="#cb237-655" aria-hidden="true" tabindex="-1"></a>observed_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-656"><a href="#cb237-656" aria-hidden="true" tabindex="-1"></a>  <span class="at">city =</span> <span class="fu">c</span>(<span class="st">"NYC"</span>, <span class="st">"NYC"</span>, <span class="st">"LA"</span>, <span class="st">"LA"</span>, <span class="st">"Chicago"</span>),</span>
<span id="cb237-657"><a href="#cb237-657" aria-hidden="true" tabindex="-1"></a>  <span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2021</span>),</span>
<span id="cb237-658"><a href="#cb237-658" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">110</span>, <span class="dv">95</span>, <span class="dv">105</span>, <span class="dv">115</span>)</span>
<span id="cb237-659"><a href="#cb237-659" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-660"><a href="#cb237-660" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-661"><a href="#cb237-661" aria-hidden="true" tabindex="-1"></a>nested_combos <span class="ot">&lt;-</span> observed_data <span class="sc">%&gt;%</span></span>
<span id="cb237-662"><a href="#cb237-662" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand</span>(<span class="fu">nesting</span>(city, year))</span>
<span id="cb237-663"><a href="#cb237-663" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Nested combinations (only observed):"</span>)</span>
<span id="cb237-664"><a href="#cb237-664" aria-hidden="true" tabindex="-1"></a>nested_combos</span>
<span id="cb237-665"><a href="#cb237-665" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-666"><a href="#cb237-666" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-667"><a href="#cb237-667" aria-hidden="true" tabindex="-1"></a><span class="fu">## Real-World Tidying Examples</span></span>
<span id="cb237-668"><a href="#cb237-668" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-669"><a href="#cb237-669" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example 1: Survey Data</span></span>
<span id="cb237-670"><a href="#cb237-670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-673"><a href="#cb237-673" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-674"><a href="#cb237-674" aria-hidden="true" tabindex="-1"></a><span class="co"># Messy survey data</span></span>
<span id="cb237-675"><a href="#cb237-675" aria-hidden="true" tabindex="-1"></a>survey_messy <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-676"><a href="#cb237-676" aria-hidden="true" tabindex="-1"></a>  <span class="at">respondent =</span> <span class="fu">c</span>(<span class="st">"R001"</span>, <span class="st">"R002"</span>, <span class="st">"R003"</span>),</span>
<span id="cb237-677"><a href="#cb237-677" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Q1_satisfied</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">3</span>),</span>
<span id="cb237-678"><a href="#cb237-678" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Q2_satisfied</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>),</span>
<span id="cb237-679"><a href="#cb237-679" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Q1_importance</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">4</span>),</span>
<span id="cb237-680"><a href="#cb237-680" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Q2_importance</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">5</span>),</span>
<span id="cb237-681"><a href="#cb237-681" aria-hidden="true" tabindex="-1"></a>  <span class="at">age_gender =</span> <span class="fu">c</span>(<span class="st">"25_M"</span>, <span class="st">"30_F"</span>, <span class="st">"28_M"</span>)</span>
<span id="cb237-682"><a href="#cb237-682" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-683"><a href="#cb237-683" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-684"><a href="#cb237-684" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy the survey data</span></span>
<span id="cb237-685"><a href="#cb237-685" aria-hidden="true" tabindex="-1"></a>survey_tidy <span class="ot">&lt;-</span> survey_messy <span class="sc">%&gt;%</span></span>
<span id="cb237-686"><a href="#cb237-686" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate age and gender</span></span>
<span id="cb237-687"><a href="#cb237-687" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(age_gender, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"gender"</span>), <span class="at">sep =</span> <span class="st">"_"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-688"><a href="#cb237-688" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot questions</span></span>
<span id="cb237-689"><a href="#cb237-689" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb237-690"><a href="#cb237-690" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"Q"</span>),</span>
<span id="cb237-691"><a href="#cb237-691" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"question"</span>, <span class="st">"measure"</span>),</span>
<span id="cb237-692"><a href="#cb237-692" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_pattern =</span> <span class="st">"(.*)_(.*)"</span>,</span>
<span id="cb237-693"><a href="#cb237-693" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"value"</span></span>
<span id="cb237-694"><a href="#cb237-694" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb237-695"><a href="#cb237-695" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reshape to have satisfaction and importance as columns</span></span>
<span id="cb237-696"><a href="#cb237-696" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb237-697"><a href="#cb237-697" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> measure,</span>
<span id="cb237-698"><a href="#cb237-698" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> value</span>
<span id="cb237-699"><a href="#cb237-699" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-700"><a href="#cb237-700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-701"><a href="#cb237-701" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Tidied survey data:"</span>)</span>
<span id="cb237-702"><a href="#cb237-702" aria-hidden="true" tabindex="-1"></a>survey_tidy</span>
<span id="cb237-703"><a href="#cb237-703" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-704"><a href="#cb237-704" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-705"><a href="#cb237-705" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example 2: Time Series Data</span></span>
<span id="cb237-706"><a href="#cb237-706" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-709"><a href="#cb237-709" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-710"><a href="#cb237-710" aria-hidden="true" tabindex="-1"></a><span class="co"># Messy time series</span></span>
<span id="cb237-711"><a href="#cb237-711" aria-hidden="true" tabindex="-1"></a>ts_messy <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-712"><a href="#cb237-712" aria-hidden="true" tabindex="-1"></a>  <span class="at">date_time =</span> <span class="fu">c</span>(<span class="st">"2023-01-15 10:30"</span>, <span class="st">"2023-01-15 14:45"</span>, <span class="st">"2023-01-16 09:15"</span>),</span>
<span id="cb237-713"><a href="#cb237-713" aria-hidden="true" tabindex="-1"></a>  <span class="at">sensor_readings =</span> <span class="fu">c</span>(<span class="st">"temp:22.5;humidity:60"</span>, <span class="st">"temp:23.1;humidity:58"</span>, <span class="st">"temp:21.8;humidity:62"</span>)</span>
<span id="cb237-714"><a href="#cb237-714" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-715"><a href="#cb237-715" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-716"><a href="#cb237-716" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy the time series</span></span>
<span id="cb237-717"><a href="#cb237-717" aria-hidden="true" tabindex="-1"></a>ts_tidy <span class="ot">&lt;-</span> ts_messy <span class="sc">%&gt;%</span></span>
<span id="cb237-718"><a href="#cb237-718" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate date and time</span></span>
<span id="cb237-719"><a href="#cb237-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(date_time, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"date"</span>, <span class="st">"time"</span>), <span class="at">sep =</span> <span class="st">" "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-720"><a href="#cb237-720" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate sensor readings</span></span>
<span id="cb237-721"><a href="#cb237-721" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(sensor_readings, <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-722"><a href="#cb237-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(sensor_readings, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"sensor"</span>, <span class="st">"value"</span>), <span class="at">sep =</span> <span class="st">":"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-723"><a href="#cb237-723" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert date</span></span>
<span id="cb237-724"><a href="#cb237-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(date))</span>
<span id="cb237-725"><a href="#cb237-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-726"><a href="#cb237-726" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Tidied time series:"</span>)</span>
<span id="cb237-727"><a href="#cb237-727" aria-hidden="true" tabindex="-1"></a>ts_tidy</span>
<span id="cb237-728"><a href="#cb237-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-729"><a href="#cb237-729" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape for analysis</span></span>
<span id="cb237-730"><a href="#cb237-730" aria-hidden="true" tabindex="-1"></a>ts_wide <span class="ot">&lt;-</span> ts_tidy <span class="sc">%&gt;%</span></span>
<span id="cb237-731"><a href="#cb237-731" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb237-732"><a href="#cb237-732" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> sensor,</span>
<span id="cb237-733"><a href="#cb237-733" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> value</span>
<span id="cb237-734"><a href="#cb237-734" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-735"><a href="#cb237-735" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Wide format for analysis:"</span>)</span>
<span id="cb237-736"><a href="#cb237-736" aria-hidden="true" tabindex="-1"></a>ts_wide</span>
<span id="cb237-737"><a href="#cb237-737" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-738"><a href="#cb237-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-739"><a href="#cb237-739" aria-hidden="true" tabindex="-1"></a><span class="fu">### Example 3: Hierarchical Data</span></span>
<span id="cb237-740"><a href="#cb237-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-743"><a href="#cb237-743" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-744"><a href="#cb237-744" aria-hidden="true" tabindex="-1"></a><span class="co"># Hierarchical organization data</span></span>
<span id="cb237-745"><a href="#cb237-745" aria-hidden="true" tabindex="-1"></a>org_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-746"><a href="#cb237-746" aria-hidden="true" tabindex="-1"></a>  <span class="at">employee =</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>, <span class="st">"Diana"</span>),</span>
<span id="cb237-747"><a href="#cb237-747" aria-hidden="true" tabindex="-1"></a>  <span class="at">department_division =</span> <span class="fu">c</span>(<span class="st">"Sales/North"</span>, <span class="st">"Sales/South"</span>, <span class="st">"IT/Infrastructure"</span>, <span class="st">"IT/Development"</span>),</span>
<span id="cb237-748"><a href="#cb237-748" aria-hidden="true" tabindex="-1"></a>  <span class="at">metrics =</span> <span class="fu">c</span>(<span class="st">"revenue:1000000;satisfaction:4.5"</span>, </span>
<span id="cb237-749"><a href="#cb237-749" aria-hidden="true" tabindex="-1"></a>              <span class="st">"revenue:800000;satisfaction:4.2"</span>,</span>
<span id="cb237-750"><a href="#cb237-750" aria-hidden="true" tabindex="-1"></a>              <span class="st">"tickets:450;uptime:99.9"</span>,</span>
<span id="cb237-751"><a href="#cb237-751" aria-hidden="true" tabindex="-1"></a>              <span class="st">"features:12;bugs:3"</span>)</span>
<span id="cb237-752"><a href="#cb237-752" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-753"><a href="#cb237-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-754"><a href="#cb237-754" aria-hidden="true" tabindex="-1"></a><span class="co"># Tidy hierarchical data</span></span>
<span id="cb237-755"><a href="#cb237-755" aria-hidden="true" tabindex="-1"></a>org_tidy <span class="ot">&lt;-</span> org_data <span class="sc">%&gt;%</span></span>
<span id="cb237-756"><a href="#cb237-756" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate hierarchy</span></span>
<span id="cb237-757"><a href="#cb237-757" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(department_division, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"department"</span>, <span class="st">"division"</span>), <span class="at">sep =</span> <span class="st">"/"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-758"><a href="#cb237-758" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate metrics</span></span>
<span id="cb237-759"><a href="#cb237-759" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate_rows</span>(metrics, <span class="at">sep =</span> <span class="st">";"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-760"><a href="#cb237-760" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(metrics, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"metric"</span>, <span class="st">"value"</span>), <span class="at">sep =</span> <span class="st">":"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>)</span>
<span id="cb237-761"><a href="#cb237-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-762"><a href="#cb237-762" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Tidied organizational data:"</span>)</span>
<span id="cb237-763"><a href="#cb237-763" aria-hidden="true" tabindex="-1"></a>org_tidy</span>
<span id="cb237-764"><a href="#cb237-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-765"><a href="#cb237-765" aria-hidden="true" tabindex="-1"></a><span class="co"># Summarize by department</span></span>
<span id="cb237-766"><a href="#cb237-766" aria-hidden="true" tabindex="-1"></a>dept_summary <span class="ot">&lt;-</span> org_tidy <span class="sc">%&gt;%</span></span>
<span id="cb237-767"><a href="#cb237-767" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(department, metric) <span class="sc">%&gt;%</span></span>
<span id="cb237-768"><a href="#cb237-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb237-769"><a href="#cb237-769" aria-hidden="true" tabindex="-1"></a>    <span class="at">total =</span> <span class="fu">sum</span>(value),</span>
<span id="cb237-770"><a href="#cb237-770" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg =</span> <span class="fu">mean</span>(value),</span>
<span id="cb237-771"><a href="#cb237-771" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb237-772"><a href="#cb237-772" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb237-773"><a href="#cb237-773" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb237-774"><a href="#cb237-774" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> metric,</span>
<span id="cb237-775"><a href="#cb237-775" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> <span class="fu">c</span>(total, avg),</span>
<span id="cb237-776"><a href="#cb237-776" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_glue =</span> <span class="st">"{metric}_{.value}"</span></span>
<span id="cb237-777"><a href="#cb237-777" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-778"><a href="#cb237-778" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-779"><a href="#cb237-779" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Department summary:"</span>)</span>
<span id="cb237-780"><a href="#cb237-780" aria-hidden="true" tabindex="-1"></a>dept_summary</span>
<span id="cb237-781"><a href="#cb237-781" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-782"><a href="#cb237-782" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-783"><a href="#cb237-783" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb237-784"><a href="#cb237-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-785"><a href="#cb237-785" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 1: Complex Pivoting</span></span>
<span id="cb237-786"><a href="#cb237-786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-787"><a href="#cb237-787" aria-hidden="true" tabindex="-1"></a>Transform this gradebook data into a tidy format suitable for analysis:</span>
<span id="cb237-788"><a href="#cb237-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-791"><a href="#cb237-791" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-792"><a href="#cb237-792" aria-hidden="true" tabindex="-1"></a><span class="co"># Given messy gradebook</span></span>
<span id="cb237-793"><a href="#cb237-793" aria-hidden="true" tabindex="-1"></a>gradebook <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-794"><a href="#cb237-794" aria-hidden="true" tabindex="-1"></a>  <span class="at">student =</span> <span class="fu">c</span>(<span class="st">"Alice"</span>, <span class="st">"Bob"</span>, <span class="st">"Charlie"</span>),</span>
<span id="cb237-795"><a href="#cb237-795" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Math_Midterm</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">90</span>, <span class="dv">78</span>),</span>
<span id="cb237-796"><a href="#cb237-796" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Math_Final</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">88</span>, <span class="dv">85</span>, <span class="dv">82</span>),</span>
<span id="cb237-797"><a href="#cb237-797" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Science_Midterm</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">92</span>, <span class="dv">88</span>, <span class="dv">90</span>),</span>
<span id="cb237-798"><a href="#cb237-798" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Science_Final</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">90</span>, <span class="dv">92</span>, <span class="dv">88</span>),</span>
<span id="cb237-799"><a href="#cb237-799" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">attendance_days</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"45/50"</span>, <span class="st">"48/50"</span>, <span class="st">"42/50"</span>)</span>
<span id="cb237-800"><a href="#cb237-800" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-801"><a href="#cb237-801" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-802"><a href="#cb237-802" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb237-803"><a href="#cb237-803" aria-hidden="true" tabindex="-1"></a>tidy_gradebook <span class="ot">&lt;-</span> gradebook <span class="sc">%&gt;%</span></span>
<span id="cb237-804"><a href="#cb237-804" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate attendance</span></span>
<span id="cb237-805"><a href="#cb237-805" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(attendance_days, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"days_present"</span>, <span class="st">"total_days"</span>), </span>
<span id="cb237-806"><a href="#cb237-806" aria-hidden="true" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">"/"</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-807"><a href="#cb237-807" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate attendance rate</span></span>
<span id="cb237-808"><a href="#cb237-808" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">attendance_rate =</span> days_present <span class="sc">/</span> total_days) <span class="sc">%&gt;%</span></span>
<span id="cb237-809"><a href="#cb237-809" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot grades</span></span>
<span id="cb237-810"><a href="#cb237-810" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb237-811"><a href="#cb237-811" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">matches</span>(<span class="st">"_Midterm|_Final"</span>),</span>
<span id="cb237-812"><a href="#cb237-812" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"subject"</span>, <span class="st">"exam"</span>),</span>
<span id="cb237-813"><a href="#cb237-813" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_sep =</span> <span class="st">"_"</span>,</span>
<span id="cb237-814"><a href="#cb237-814" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"score"</span></span>
<span id="cb237-815"><a href="#cb237-815" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb237-816"><a href="#cb237-816" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate average by subject</span></span>
<span id="cb237-817"><a href="#cb237-817" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(student, subject) <span class="sc">%&gt;%</span></span>
<span id="cb237-818"><a href="#cb237-818" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">subject_avg =</span> <span class="fu">mean</span>(score)) <span class="sc">%&gt;%</span></span>
<span id="cb237-819"><a href="#cb237-819" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb237-820"><a href="#cb237-820" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-821"><a href="#cb237-821" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Tidied gradebook:"</span>)</span>
<span id="cb237-822"><a href="#cb237-822" aria-hidden="true" tabindex="-1"></a>tidy_gradebook</span>
<span id="cb237-823"><a href="#cb237-823" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-824"><a href="#cb237-824" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-825"><a href="#cb237-825" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 2: Nested Data Analysis</span></span>
<span id="cb237-826"><a href="#cb237-826" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-827"><a href="#cb237-827" aria-hidden="true" tabindex="-1"></a>Work with nested gapminder data to calculate decade-wise trends:</span>
<span id="cb237-828"><a href="#cb237-828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-831"><a href="#cb237-831" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-832"><a href="#cb237-832" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb237-833"><a href="#cb237-833" aria-hidden="true" tabindex="-1"></a>gapminder_nested <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span></span>
<span id="cb237-834"><a href="#cb237-834" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">decade =</span> <span class="fu">floor</span>(year <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">*</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-835"><a href="#cb237-835" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(continent, decade) <span class="sc">%&gt;%</span></span>
<span id="cb237-836"><a href="#cb237-836" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span></span>
<span id="cb237-837"><a href="#cb237-837" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-838"><a href="#cb237-838" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate trends within each group</span></span>
<span id="cb237-839"><a href="#cb237-839" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_lifeExp =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span> <span class="fu">mean</span>(.<span class="sc">$</span>lifeExp)),</span>
<span id="cb237-840"><a href="#cb237-840" aria-hidden="true" tabindex="-1"></a>    <span class="at">gdp_growth =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span> {</span>
<span id="cb237-841"><a href="#cb237-841" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">nrow</span>(.) <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb237-842"><a href="#cb237-842" aria-hidden="true" tabindex="-1"></a>        model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(gdpPercap) <span class="sc">~</span> <span class="fu">I</span>(year <span class="sc">-</span> <span class="fu">min</span>(year)), <span class="at">data =</span> .)</span>
<span id="cb237-843"><a href="#cb237-843" aria-hidden="true" tabindex="-1"></a>        <span class="fu">coef</span>(model)[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">100</span>  <span class="co"># Percent growth per year</span></span>
<span id="cb237-844"><a href="#cb237-844" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb237-845"><a href="#cb237-845" aria-hidden="true" tabindex="-1"></a>        <span class="cn">NA_real_</span></span>
<span id="cb237-846"><a href="#cb237-846" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb237-847"><a href="#cb237-847" aria-hidden="true" tabindex="-1"></a>    }),</span>
<span id="cb237-848"><a href="#cb237-848" aria-hidden="true" tabindex="-1"></a>    <span class="at">pop_total =</span> <span class="fu">map_dbl</span>(data, <span class="sc">~</span> <span class="fu">sum</span>(.<span class="sc">$</span>pop) <span class="sc">/</span> <span class="fl">1e9</span>),  <span class="co"># In billions</span></span>
<span id="cb237-849"><a href="#cb237-849" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_countries =</span> <span class="fu">map_int</span>(data, <span class="sc">~</span> <span class="fu">n_distinct</span>(.<span class="sc">$</span>country))</span>
<span id="cb237-850"><a href="#cb237-850" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-851"><a href="#cb237-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-852"><a href="#cb237-852" aria-hidden="true" tabindex="-1"></a>gapminder_summary <span class="ot">&lt;-</span> gapminder_nested <span class="sc">%&gt;%</span></span>
<span id="cb237-853"><a href="#cb237-853" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">%&gt;%</span></span>
<span id="cb237-854"><a href="#cb237-854" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(continent, decade)</span>
<span id="cb237-855"><a href="#cb237-855" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-856"><a href="#cb237-856" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Decade-wise trends by continent:"</span>)</span>
<span id="cb237-857"><a href="#cb237-857" aria-hidden="true" tabindex="-1"></a>gapminder_summary</span>
<span id="cb237-858"><a href="#cb237-858" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-859"><a href="#cb237-859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-860"><a href="#cb237-860" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 3: Complex Missing Data</span></span>
<span id="cb237-861"><a href="#cb237-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-862"><a href="#cb237-862" aria-hidden="true" tabindex="-1"></a>Handle this dataset with various types of missing data:</span>
<span id="cb237-863"><a href="#cb237-863" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-866"><a href="#cb237-866" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-867"><a href="#cb237-867" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataset with complex missing patterns</span></span>
<span id="cb237-868"><a href="#cb237-868" aria-hidden="true" tabindex="-1"></a>complex_missing <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-869"><a href="#cb237-869" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">c</span>(<span class="st">"2023-01-01"</span>, <span class="st">"2023-01-02"</span>, <span class="st">"2023-01-04"</span>, <span class="st">"2023-01-07"</span>)),</span>
<span id="cb237-870"><a href="#cb237-870" aria-hidden="true" tabindex="-1"></a>  <span class="at">store_a =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="cn">NA</span>, <span class="dv">120</span>, <span class="dv">130</span>),</span>
<span id="cb237-871"><a href="#cb237-871" aria-hidden="true" tabindex="-1"></a>  <span class="at">store_b =</span> <span class="fu">c</span>(<span class="dv">200</span>, <span class="dv">210</span>, <span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb237-872"><a href="#cb237-872" aria-hidden="true" tabindex="-1"></a>  <span class="at">store_c =</span> <span class="fu">c</span>(<span class="dv">150</span>, <span class="dv">160</span>, <span class="dv">170</span>, <span class="dv">180</span>)</span>
<span id="cb237-873"><a href="#cb237-873" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-874"><a href="#cb237-874" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-875"><a href="#cb237-875" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb237-876"><a href="#cb237-876" aria-hidden="true" tabindex="-1"></a><span class="co"># Complete the date sequence</span></span>
<span id="cb237-877"><a href="#cb237-877" aria-hidden="true" tabindex="-1"></a>complete_data <span class="ot">&lt;-</span> complex_missing <span class="sc">%&gt;%</span></span>
<span id="cb237-878"><a href="#cb237-878" aria-hidden="true" tabindex="-1"></a>  <span class="fu">complete</span>(<span class="at">date =</span> <span class="fu">seq.Date</span>(<span class="fu">min</span>(date), <span class="fu">max</span>(date), <span class="at">by =</span> <span class="st">"day"</span>))</span>
<span id="cb237-879"><a href="#cb237-879" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-880"><a href="#cb237-880" aria-hidden="true" tabindex="-1"></a><span class="co"># Different filling strategies</span></span>
<span id="cb237-881"><a href="#cb237-881" aria-hidden="true" tabindex="-1"></a>filled_data <span class="ot">&lt;-</span> complete_data <span class="sc">%&gt;%</span></span>
<span id="cb237-882"><a href="#cb237-882" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Forward fill for store_a</span></span>
<span id="cb237-883"><a href="#cb237-883" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fill</span>(store_a, <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-884"><a href="#cb237-884" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Interpolate store_b</span></span>
<span id="cb237-885"><a href="#cb237-885" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-886"><a href="#cb237-886" aria-hidden="true" tabindex="-1"></a>    <span class="at">store_b =</span> zoo<span class="sc">::</span><span class="fu">na.approx</span>(store_b, <span class="at">na.rm =</span> <span class="cn">FALSE</span>)</span>
<span id="cb237-887"><a href="#cb237-887" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb237-888"><a href="#cb237-888" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average fill for store_c</span></span>
<span id="cb237-889"><a href="#cb237-889" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-890"><a href="#cb237-890" aria-hidden="true" tabindex="-1"></a>    <span class="at">store_c =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(store_c), </span>
<span id="cb237-891"><a href="#cb237-891" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">mean</span>(store_c, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), </span>
<span id="cb237-892"><a href="#cb237-892" aria-hidden="true" tabindex="-1"></a>                      store_c)</span>
<span id="cb237-893"><a href="#cb237-893" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-894"><a href="#cb237-894" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-895"><a href="#cb237-895" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Original data:"</span>)</span>
<span id="cb237-896"><a href="#cb237-896" aria-hidden="true" tabindex="-1"></a>complex_missing</span>
<span id="cb237-897"><a href="#cb237-897" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"After handling missing values:"</span>)</span>
<span id="cb237-898"><a href="#cb237-898" aria-hidden="true" tabindex="-1"></a>filled_data</span>
<span id="cb237-899"><a href="#cb237-899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-900"><a href="#cb237-900" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to long format for analysis</span></span>
<span id="cb237-901"><a href="#cb237-901" aria-hidden="true" tabindex="-1"></a>long_filled <span class="ot">&lt;-</span> filled_data <span class="sc">%&gt;%</span></span>
<span id="cb237-902"><a href="#cb237-902" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb237-903"><a href="#cb237-903" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"store"</span>),</span>
<span id="cb237-904"><a href="#cb237-904" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"store"</span>,</span>
<span id="cb237-905"><a href="#cb237-905" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"store_"</span>,</span>
<span id="cb237-906"><a href="#cb237-906" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"sales"</span></span>
<span id="cb237-907"><a href="#cb237-907" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb237-908"><a href="#cb237-908" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-909"><a href="#cb237-909" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Long format for analysis:"</span>)</span>
<span id="cb237-910"><a href="#cb237-910" aria-hidden="true" tabindex="-1"></a>long_filled</span>
<span id="cb237-911"><a href="#cb237-911" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-912"><a href="#cb237-912" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-913"><a href="#cb237-913" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 4: Real-World Data Cleaning</span></span>
<span id="cb237-914"><a href="#cb237-914" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-915"><a href="#cb237-915" aria-hidden="true" tabindex="-1"></a>Clean and reshape this messy real-world dataset:</span>
<span id="cb237-916"><a href="#cb237-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-919"><a href="#cb237-919" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb237-920"><a href="#cb237-920" aria-hidden="true" tabindex="-1"></a><span class="co"># Messy real-world data</span></span>
<span id="cb237-921"><a href="#cb237-921" aria-hidden="true" tabindex="-1"></a>messy_sales <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb237-922"><a href="#cb237-922" aria-hidden="true" tabindex="-1"></a>  <span class="at">id =</span> <span class="fu">c</span>(<span class="st">"US-2023-001"</span>, <span class="st">"UK-2023-002"</span>, <span class="st">"CA-2023-003"</span>),</span>
<span id="cb237-923"><a href="#cb237-923" aria-hidden="true" tabindex="-1"></a>  <span class="at">jan_feb_mar =</span> <span class="fu">c</span>(<span class="st">"100,120,115"</span>, <span class="st">"200,210,205"</span>, <span class="st">"150,145,160"</span>),</span>
<span id="cb237-924"><a href="#cb237-924" aria-hidden="true" tabindex="-1"></a>  <span class="at">apr_may_jun =</span> <span class="fu">c</span>(<span class="st">"125,130,135"</span>, <span class="st">"215,220,225"</span>, <span class="st">"165,170,175"</span>),</span>
<span id="cb237-925"><a href="#cb237-925" aria-hidden="true" tabindex="-1"></a>  <span class="at">customer_info =</span> <span class="fu">c</span>(<span class="st">"John Doe|Premium"</span>, <span class="st">"Jane Smith|Standard"</span>, <span class="st">"Bob Johnson|Premium"</span>),</span>
<span id="cb237-926"><a href="#cb237-926" aria-hidden="true" tabindex="-1"></a>  <span class="at">notes =</span> <span class="fu">c</span>(<span class="st">"Q1: Good performance"</span>, <span class="st">"Q1: Steady growth"</span>, <span class="st">"Q1: Meeting targets"</span>)</span>
<span id="cb237-927"><a href="#cb237-927" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb237-928"><a href="#cb237-928" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-929"><a href="#cb237-929" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb237-930"><a href="#cb237-930" aria-hidden="true" tabindex="-1"></a>clean_sales <span class="ot">&lt;-</span> messy_sales <span class="sc">%&gt;%</span></span>
<span id="cb237-931"><a href="#cb237-931" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate ID components</span></span>
<span id="cb237-932"><a href="#cb237-932" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(id, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"country"</span>, <span class="st">"year"</span>, <span class="st">"customer_id"</span>), <span class="at">sep =</span> <span class="st">"-"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-933"><a href="#cb237-933" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate customer info</span></span>
<span id="cb237-934"><a href="#cb237-934" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(customer_info, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"customer_name"</span>, <span class="st">"tier"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">|"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-935"><a href="#cb237-935" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot quarters</span></span>
<span id="cb237-936"><a href="#cb237-936" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb237-937"><a href="#cb237-937" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">c</span>(jan_feb_mar, apr_may_jun),</span>
<span id="cb237-938"><a href="#cb237-938" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"quarter"</span>,</span>
<span id="cb237-939"><a href="#cb237-939" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"monthly_sales"</span></span>
<span id="cb237-940"><a href="#cb237-940" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb237-941"><a href="#cb237-941" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate monthly sales</span></span>
<span id="cb237-942"><a href="#cb237-942" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(monthly_sales, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"month1"</span>, <span class="st">"month2"</span>, <span class="st">"month3"</span>), <span class="at">sep =</span> <span class="st">","</span>, <span class="at">convert =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb237-943"><a href="#cb237-943" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create proper quarter labels</span></span>
<span id="cb237-944"><a href="#cb237-944" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-945"><a href="#cb237-945" aria-hidden="true" tabindex="-1"></a>    <span class="at">quarter =</span> <span class="fu">case_when</span>(</span>
<span id="cb237-946"><a href="#cb237-946" aria-hidden="true" tabindex="-1"></a>      quarter <span class="sc">==</span> <span class="st">"jan_feb_mar"</span> <span class="sc">~</span> <span class="st">"Q1"</span>,</span>
<span id="cb237-947"><a href="#cb237-947" aria-hidden="true" tabindex="-1"></a>      quarter <span class="sc">==</span> <span class="st">"apr_may_jun"</span> <span class="sc">~</span> <span class="st">"Q2"</span></span>
<span id="cb237-948"><a href="#cb237-948" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb237-949"><a href="#cb237-949" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb237-950"><a href="#cb237-950" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Pivot months to long format</span></span>
<span id="cb237-951"><a href="#cb237-951" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb237-952"><a href="#cb237-952" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">starts_with</span>(<span class="st">"month"</span>),</span>
<span id="cb237-953"><a href="#cb237-953" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"month_num"</span>,</span>
<span id="cb237-954"><a href="#cb237-954" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"month"</span>,</span>
<span id="cb237-955"><a href="#cb237-955" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"sales"</span></span>
<span id="cb237-956"><a href="#cb237-956" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb237-957"><a href="#cb237-957" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate month</span></span>
<span id="cb237-958"><a href="#cb237-958" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb237-959"><a href="#cb237-959" aria-hidden="true" tabindex="-1"></a>    <span class="at">month_num =</span> <span class="fu">as.integer</span>(month_num),</span>
<span id="cb237-960"><a href="#cb237-960" aria-hidden="true" tabindex="-1"></a>    <span class="at">month =</span> <span class="fu">case_when</span>(</span>
<span id="cb237-961"><a href="#cb237-961" aria-hidden="true" tabindex="-1"></a>      quarter <span class="sc">==</span> <span class="st">"Q1"</span> <span class="sc">~</span> month_num,</span>
<span id="cb237-962"><a href="#cb237-962" aria-hidden="true" tabindex="-1"></a>      quarter <span class="sc">==</span> <span class="st">"Q2"</span> <span class="sc">~</span> month_num <span class="sc">+</span> <span class="dv">3</span></span>
<span id="cb237-963"><a href="#cb237-963" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb237-964"><a href="#cb237-964" aria-hidden="true" tabindex="-1"></a>    <span class="at">date =</span> <span class="fu">as.Date</span>(<span class="fu">paste</span>(year, month, <span class="st">"01"</span>, <span class="at">sep =</span> <span class="st">"-"</span>))</span>
<span id="cb237-965"><a href="#cb237-965" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb237-966"><a href="#cb237-966" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id, country, date, customer_name, tier, sales, notes)</span>
<span id="cb237-967"><a href="#cb237-967" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-968"><a href="#cb237-968" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Cleaned sales data:"</span>)</span>
<span id="cb237-969"><a href="#cb237-969" aria-hidden="true" tabindex="-1"></a>clean_sales</span>
<span id="cb237-970"><a href="#cb237-970" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb237-971"><a href="#cb237-971" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-972"><a href="#cb237-972" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb237-973"><a href="#cb237-973" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-974"><a href="#cb237-974" aria-hidden="true" tabindex="-1"></a>You've mastered tidyr essentials:</span>
<span id="cb237-975"><a href="#cb237-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-976"><a href="#cb237-976" aria-hidden="true" tabindex="-1"></a>âœ… Understanding tidy data principles  </span>
<span id="cb237-977"><a href="#cb237-977" aria-hidden="true" tabindex="-1"></a>âœ… Pivoting between wide and long formats  </span>
<span id="cb237-978"><a href="#cb237-978" aria-hidden="true" tabindex="-1"></a>âœ… Separating and uniting columns  </span>
<span id="cb237-979"><a href="#cb237-979" aria-hidden="true" tabindex="-1"></a>âœ… Handling missing values systematically  </span>
<span id="cb237-980"><a href="#cb237-980" aria-hidden="true" tabindex="-1"></a>âœ… Working with nested data and list columns  </span>
<span id="cb237-981"><a href="#cb237-981" aria-hidden="true" tabindex="-1"></a>âœ… Expanding and completing datasets  </span>
<span id="cb237-982"><a href="#cb237-982" aria-hidden="true" tabindex="-1"></a>âœ… Real-world data tidying techniques  </span>
<span id="cb237-983"><a href="#cb237-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-984"><a href="#cb237-984" aria-hidden="true" tabindex="-1"></a><span class="fu">## What's Next?</span></span>
<span id="cb237-985"><a href="#cb237-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-986"><a href="#cb237-986" aria-hidden="true" tabindex="-1"></a>In <span class="co">[</span><span class="ot">Chapter 5</span><span class="co">](05-visualization.Rmd)</span>, we'll explore data visualization with ggplot2, creating beautiful and informative graphics.</span>
<span id="cb237-987"><a href="#cb237-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-988"><a href="#cb237-988" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional Resources</span></span>
<span id="cb237-989"><a href="#cb237-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-990"><a href="#cb237-990" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">tidyr Documentation</span><span class="co">](https://tidyr.tidyverse.org/)</span></span>
<span id="cb237-991"><a href="#cb237-991" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Tidy Data Paper</span><span class="co">](https://www.jstatsoft.org/article/view/v059i10)</span></span>
<span id="cb237-992"><a href="#cb237-992" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">tidyr Cheat Sheet</span><span class="co">](https://github.com/rstudio/cheatsheets/blob/main/tidyr.pdf)</span></span>
<span id="cb237-993"><a href="#cb237-993" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">R for Data Science - Tidy Data</span><span class="co">](https://r4ds.had.co.nz/tidy-data.html)</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>