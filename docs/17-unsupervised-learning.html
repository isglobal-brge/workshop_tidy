<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="David Sarrat GonzÃ¡lez, Juan R GonzÃ¡lez">
<meta name="dcterms.date" content="2025-10-06">

<title>Chapter 17: Unsupervised Learning - Discovering Hidden Patterns â€“ Tidyverse &amp; Machine Learning Workshop</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-4a990d8dcb58f517c7c86712b8f2ac7c.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-90ee96a17764a76d4fcf3f331faa145e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<script src="site_libs/plotly-binding-4.10.4/plotly.js"></script>
<script src="site_libs/typedarray-0.1/typedarray.min.js"></script>
<script src="site_libs/jquery-3.5.1/jquery.min.js"></script>
<link href="site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<link href="site_libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">
<script src="site_libs/plotly-main-2.11.1/plotly-latest.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Tidyverse &amp; Machine Learning Workshop</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-1-tidyverse" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part 1: Tidyverse</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-1-tidyverse">    
        <li>
    <a class="dropdown-item" href="./01-introduction.html">
 <span class="dropdown-text">Ch 1: Introduction to Tidyverse</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./02-data-import.html">
 <span class="dropdown-text">Ch 2: Data Import with readr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./03-data-wrangling.html">
 <span class="dropdown-text">Ch 3: Data Wrangling with dplyr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./04-data-tidying.html">
 <span class="dropdown-text">Ch 4: Data Tidying with tidyr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./05-visualization.html">
 <span class="dropdown-text">Ch 5: Visualization with ggplot2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./06-functional-programming.html">
 <span class="dropdown-text">Ch 6: Functional Programming with purrr</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./07-strings-dates.html">
 <span class="dropdown-text">Ch 7: Strings and Dates</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="./quiz-block-1.html">
 <span class="dropdown-text">Block 1 Assessment</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-2-tidymodels" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part 2: Tidymodels</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-2-tidymodels">    
        <li>
    <a class="dropdown-item" href="./08-tidymodels-intro.html">
 <span class="dropdown-text">Ch 8: Introduction to Tidymodels</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./09-data-splitting.html">
 <span class="dropdown-text">Ch 9: Data Splitting &amp; Resampling</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./10-feature-engineering.html">
 <span class="dropdown-text">Ch 10: Feature Engineering</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./11-model-specification.html">
 <span class="dropdown-text">Ch 11: Model Specification</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./12-workflows-evaluation.html">
 <span class="dropdown-text">Ch 12: Workflows &amp; Evaluation</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./13-hyperparameter-tuning.html">
 <span class="dropdown-text">Ch 13: Hyperparameter Tuning</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="./quiz-block-2.html">
 <span class="dropdown-text">Block 2 Assessment</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-3-machine-learning" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part 3: Machine Learning</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-3-machine-learning">    
        <li>
    <a class="dropdown-item" href="./14-classification.html">
 <span class="dropdown-text">Ch 14: Classification Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./15-regression.html">
 <span class="dropdown-text">Ch 15: Regression Models</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./16-ensemble-methods.html">
 <span class="dropdown-text">Ch 16: Ensemble Methods</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./17-unsupervised-learning.html">
 <span class="dropdown-text">Ch 17: Unsupervised Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./18-model-deployment.html">
 <span class="dropdown-text">Ch 18: Model Deployment</span></a>
  </li>  
        <li><hr class="dropdown-divider"></li>
        <li>
    <a class="dropdown-item" href="./quiz-block-3.html">
 <span class="dropdown-text">Block 3 Assessment</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link active" data-scroll-target="#learning-objectives">Learning Objectives</a></li>
  <li><a href="#the-art-of-finding-structure-without-labels" id="toc-the-art-of-finding-structure-without-labels" class="nav-link" data-scroll-target="#the-art-of-finding-structure-without-labels">The Art of Finding Structure Without Labels</a></li>
  <li><a href="#clustering-finding-natural-groups" id="toc-clustering-finding-natural-groups" class="nav-link" data-scroll-target="#clustering-finding-natural-groups">Clustering: Finding Natural Groups</a>
  <ul class="collapse">
  <li><a href="#k-means-clustering" id="toc-k-means-clustering" class="nav-link" data-scroll-target="#k-means-clustering">K-Means Clustering</a></li>
  <li><a href="#hierarchical-clustering" id="toc-hierarchical-clustering" class="nav-link" data-scroll-target="#hierarchical-clustering">Hierarchical Clustering</a></li>
  <li><a href="#dbscan-density-based-clustering" id="toc-dbscan-density-based-clustering" class="nav-link" data-scroll-target="#dbscan-density-based-clustering">DBSCAN: Density-Based Clustering</a></li>
  </ul></li>
  <li><a href="#dimensionality-reduction" id="toc-dimensionality-reduction" class="nav-link" data-scroll-target="#dimensionality-reduction">Dimensionality Reduction</a>
  <ul class="collapse">
  <li><a href="#principal-component-analysis-pca" id="toc-principal-component-analysis-pca" class="nav-link" data-scroll-target="#principal-component-analysis-pca">Principal Component Analysis (PCA)</a></li>
  <li><a href="#t-sne-and-umap-non-linear-dimensionality-reduction" id="toc-t-sne-and-umap-non-linear-dimensionality-reduction" class="nav-link" data-scroll-target="#t-sne-and-umap-non-linear-dimensionality-reduction">t-SNE and UMAP: Non-linear Dimensionality Reduction</a></li>
  </ul></li>
  <li><a href="#anomaly-detection" id="toc-anomaly-detection" class="nav-link" data-scroll-target="#anomaly-detection">Anomaly Detection</a></li>
  <li><a href="#market-basket-analysis" id="toc-market-basket-analysis" class="nav-link" data-scroll-target="#market-basket-analysis">Market Basket Analysis</a></li>
  <li><a href="#evaluating-unsupervised-models" id="toc-evaluating-unsupervised-models" class="nav-link" data-scroll-target="#evaluating-unsupervised-models">Evaluating Unsupervised Models</a></li>
  <li><a href="#real-world-applications" id="toc-real-world-applications" class="nav-link" data-scroll-target="#real-world-applications">Real-World Applications</a>
  <ul class="collapse">
  <li><a href="#customer-segmentation" id="toc-customer-segmentation" class="nav-link" data-scroll-target="#customer-segmentation">Customer Segmentation</a></li>
  </ul></li>
  <li><a href="#best-practices" id="toc-best-practices" class="nav-link" data-scroll-target="#best-practices">Best Practices</a>
  <ul class="collapse">
  <li><a href="#data-preprocessing-is-critical" id="toc-data-preprocessing-is-critical" class="nav-link" data-scroll-target="#data-preprocessing-is-critical">1. Data Preprocessing is Critical</a></li>
  <li><a href="#choose-the-right-algorithm" id="toc-choose-the-right-algorithm" class="nav-link" data-scroll-target="#choose-the-right-algorithm">2. Choose the Right Algorithm</a></li>
  </ul></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
  <li><a href="#exercise-1-implement-custom-distance-metric" id="toc-exercise-1-implement-custom-distance-metric" class="nav-link" data-scroll-target="#exercise-1-implement-custom-distance-metric">Exercise 1: Implement Custom Distance Metric</a></li>
  <li><a href="#exercise-2-ensemble-clustering" id="toc-exercise-2-ensemble-clustering" class="nav-link" data-scroll-target="#exercise-2-ensemble-clustering">Exercise 2: Ensemble Clustering</a></li>
  <li><a href="#exercise-3-clustering-interpretation" id="toc-exercise-3-clustering-interpretation" class="nav-link" data-scroll-target="#exercise-3-clustering-interpretation">Exercise 3: Clustering Interpretation</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#whats-next" id="toc-whats-next" class="nav-link" data-scroll-target="#whats-next">Whatâ€™s Next?</a></li>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Chapter 17: Unsupervised Learning - Discovering Hidden Patterns</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>David Sarrat GonzÃ¡lez, Juan R GonzÃ¡lez </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 6, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="learning-objectives" class="level2">
<h2 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h2>
<p>By the end of this chapter, you will master:</p>
<ul>
<li>The fundamentals of unsupervised learning</li>
<li>Clustering algorithms (K-means, hierarchical, DBSCAN)</li>
<li>Dimensionality reduction (PCA, t-SNE, UMAP)</li>
<li>Anomaly detection techniques</li>
<li>Market basket analysis and association rules</li>
<li>Practical implementation with tidymodels</li>
<li>Evaluating unsupervised models</li>
<li>Real-world applications</li>
</ul>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Download R Script
</div>
</div>
<div class="callout-body-container callout-body">
<p>You can download the complete R code for this chapter: <a href="R_scripts/17-unsupervised-learning.R" class="btn btn-primary" download="17-unsupervised-learning.R">ðŸ“¥ Download 17-unsupervised-learning.R</a></p>
</div>
</div>
</section>
<section id="the-art-of-finding-structure-without-labels" class="level2">
<h2 class="anchored" data-anchor-id="the-art-of-finding-structure-without-labels">The Art of Finding Structure Without Labels</h2>
<p>Imagine youâ€™re an explorer discovering a new continent. You have no map, no guide, just raw observations. Your task is to identify natural groupings - mountain ranges, river systems, ecosystems. This is the essence of unsupervised learning: finding structure in data without predefined categories.</p>
<p>Unlike supervised learning where we have labels to guide us, unsupervised learning must discover patterns purely from the data itself. This makes it both challenging and powerful - we can uncover insights we didnâ€™t even know to look for.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyclust)  <span class="co"># For clustering with tidymodels</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)    <span class="co"># For clustering algorithms</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra) <span class="co"># For visualization</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dendextend) <span class="co"># For dendrograms</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbscan)     <span class="co"># For DBSCAN</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)  <span class="co"># For PCA plots</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)     <span class="co"># For 3D visualizations</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)   <span class="co"># For correlation plots</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Set theme and seed</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(ames)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for unsupervised learning</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>ames_numeric <span class="ot">&lt;-</span> ames <span class="sc">%&gt;%</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Sale_Price) <span class="sc">%&gt;%</span>  <span class="co"># Remove target for unsupervised learning</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">500</span>)  <span class="co"># Sample for computational efficiency</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="clustering-finding-natural-groups" class="level2">
<h2 class="anchored" data-anchor-id="clustering-finding-natural-groups">Clustering: Finding Natural Groups</h2>
<section id="k-means-clustering" class="level3">
<h3 class="anchored" data-anchor-id="k-means-clustering">K-Means Clustering</h3>
<p>K-means is the workhorse of clustering algorithms. It partitions data into K clusters by minimizing within-cluster variance:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for clustering</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>clustering_data <span class="ot">&lt;-</span> ames_numeric <span class="sc">%&gt;%</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Gr_Liv_Area, Lot_Area, Year_Built, Total_Bsmt_SF, Garage_Area)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the data (crucial for distance-based methods!)</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="ot">&lt;-</span> <span class="fu">scale</span>(clustering_data)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine optimal number of clusters using elbow method</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(k) {</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kmeans</span>(scaled_data, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>tot.withinss</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>elbow_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">wss =</span> wss)</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(elbow_data, <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> wss)) <span class="sc">+</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">4</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Elbow Method for Optimal K"</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Look for the 'elbow' where WSS decrease slows"</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of Clusters (k)"</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Total Within-Cluster Sum of Squares"</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Silhouette analysis for cluster validation</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>silhouette_scores <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(k) {</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(scaled_data, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  ss <span class="ot">&lt;-</span> <span class="fu">silhouette</span>(km<span class="sc">$</span>cluster, <span class="fu">dist</span>(scaled_data))</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(ss[, <span class="dv">3</span>])</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>silhouette_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">k =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">silhouette =</span> silhouette_scores)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(silhouette_data, <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> silhouette)) <span class="sc">+</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">which.max</span>(silhouette_scores) <span class="sc">+</span> <span class="dv">1</span>, </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Silhouette Analysis"</span>,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Higher values indicate better-defined clusters"</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of Clusters (k)"</span>,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Silhouette Score"</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform K-means with optimal k=4</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>km_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(scaled_data, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cluster assignments back to data</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>clustered_data <span class="ot">&lt;-</span> clustering_data <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">factor</span>(km_result<span class="sc">$</span>cluster))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize clusters</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(clustered_data, <span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Lot_Area, </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Clusters: Living Area vs Quality"</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(clustered_data, <span class="fu">aes</span>(<span class="at">x =</span> Year_Built, <span class="at">y =</span> Total_Bsmt_SF, </span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Clusters: Year vs Basement"</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-2-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster characteristics</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>cluster_profiles <span class="ot">&lt;-</span> clustered_data <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="fu">list</span>(<span class="at">mean =</span> mean, <span class="at">sd =</span> sd)), </span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(cluster, count),</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"variable"</span>, <span class="st">"stat"</span>),</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_(?=mean|sd)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> stat, <span class="at">values_from =</span> value)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(cluster_profiles, <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">cluster</th>
<th style="text-align: right;">count</th>
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">Gr_Liv_Area</td>
<td style="text-align: right;">2513.38</td>
<td style="text-align: right;">925.13</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">Lot_Area</td>
<td style="text-align: right;">56046.50</td>
<td style="text-align: right;">24669.55</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">Year_Built</td>
<td style="text-align: right;">1984.50</td>
<td style="text-align: right;">17.14</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">Total_Bsmt_SF</td>
<td style="text-align: right;">1550.62</td>
<td style="text-align: right;">764.04</td>
</tr>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">8</td>
<td style="text-align: left;">Garage_Area</td>
<td style="text-align: right;">793.00</td>
<td style="text-align: right;">181.72</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">175</td>
<td style="text-align: left;">Gr_Liv_Area</td>
<td style="text-align: right;">1296.11</td>
<td style="text-align: right;">409.47</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: right;">175</td>
<td style="text-align: left;">Lot_Area</td>
<td style="text-align: right;">8466.14</td>
<td style="text-align: right;">3142.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">175</td>
<td style="text-align: left;">Year_Built</td>
<td style="text-align: right;">1937.54</td>
<td style="text-align: right;">20.35</td>
</tr>
<tr class="odd">
<td style="text-align: left;">2</td>
<td style="text-align: right;">175</td>
<td style="text-align: left;">Total_Bsmt_SF</td>
<td style="text-align: right;">784.01</td>
<td style="text-align: right;">293.47</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">175</td>
<td style="text-align: left;">Garage_Area</td>
<td style="text-align: right;">294.43</td>
<td style="text-align: right;">166.78</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">236</td>
<td style="text-align: left;">Gr_Liv_Area</td>
<td style="text-align: right;">1397.47</td>
<td style="text-align: right;">306.68</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: right;">236</td>
<td style="text-align: left;">Lot_Area</td>
<td style="text-align: right;">9413.75</td>
<td style="text-align: right;">4132.14</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">236</td>
<td style="text-align: left;">Year_Built</td>
<td style="text-align: right;">1986.24</td>
<td style="text-align: right;">17.40</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: right;">236</td>
<td style="text-align: left;">Total_Bsmt_SF</td>
<td style="text-align: right;">1065.54</td>
<td style="text-align: right;">295.28</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">236</td>
<td style="text-align: left;">Garage_Area</td>
<td style="text-align: right;">487.47</td>
<td style="text-align: right;">131.59</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: right;">81</td>
<td style="text-align: left;">Gr_Liv_Area</td>
<td style="text-align: right;">2146.53</td>
<td style="text-align: right;">465.84</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: right;">81</td>
<td style="text-align: left;">Lot_Area</td>
<td style="text-align: right;">13104.25</td>
<td style="text-align: right;">4393.41</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: right;">81</td>
<td style="text-align: left;">Year_Built</td>
<td style="text-align: right;">1991.11</td>
<td style="text-align: right;">21.57</td>
</tr>
<tr class="odd">
<td style="text-align: left;">4</td>
<td style="text-align: right;">81</td>
<td style="text-align: left;">Total_Bsmt_SF</td>
<td style="text-align: right;">1577.49</td>
<td style="text-align: right;">436.29</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: right;">81</td>
<td style="text-align: left;">Garage_Area</td>
<td style="text-align: right;">752.70</td>
<td style="text-align: right;">171.67</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>The mathematics of K-means: - <strong>Objective</strong>: Minimize <span class="math inline">\(\sum_{i=1}^{k} \sum_{x \in C_i} ||x - \mu_i||^2\)</span> - <strong>Algorithm</strong>: Iteratively assign points and update centroids - <strong>Assumptions</strong>: Spherical clusters, similar sizes, similar densities</p>
</section>
<section id="hierarchical-clustering" class="level3">
<h3 class="anchored" data-anchor-id="hierarchical-clustering">Hierarchical Clustering</h3>
<p>Hierarchical clustering builds a tree of clusters, allowing exploration at different granularities:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distance matrix</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>dist_matrix <span class="ot">&lt;-</span> <span class="fu">dist</span>(scaled_data, <span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform hierarchical clustering with different linkage methods</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>hc_complete <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_matrix, <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>hc_average <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_matrix, <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>hc_ward <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_matrix, <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare dendrograms</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_complete, <span class="at">main =</span> <span class="st">"Complete Linkage"</span>, <span class="at">labels =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_average, <span class="at">main =</span> <span class="st">"Average Linkage"</span>, <span class="at">labels =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_ward, <span class="at">main =</span> <span class="st">"Ward's Method"</span>, <span class="at">labels =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use Ward's method (often gives best results)</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>hc_clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc_ward, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a prettier dendrogram</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>dend <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(hc_ward)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>dend <span class="ot">&lt;-</span> <span class="fu">color_branches</span>(dend, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dend, <span class="at">main =</span> <span class="st">"Hierarchical Clustering Dendrogram"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">leaflab =</span> <span class="st">"none"</span>, <span class="at">ylab =</span> <span class="st">"Height"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare with K-means</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>clustering_comparison <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">kmeans =</span> km_result<span class="sc">$</span>cluster,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">hierarchical =</span> hc_clusters</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix between methods</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(clustering_comparison<span class="sc">$</span>kmeans, clustering_comparison<span class="sc">$</span>hierarchical)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   
      1   2   3   4
  1   0   0   0   8
  2   0  63 110   2
  3   3 229   1   3
  4  66  12   1   2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize both clustering results</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>comparison_data <span class="ot">&lt;-</span> clustering_data <span class="sc">%&gt;%</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">kmeans =</span> <span class="fu">factor</span>(km_result<span class="sc">$</span>cluster),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">hierarchical =</span> <span class="fu">factor</span>(hc_clusters)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparison_data, <span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Lot_Area, </span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">color =</span> kmeans)) <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"K-Means Clustering"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparison_data, <span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Lot_Area, </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">color =</span> hierarchical)) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hierarchical Clustering"</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="dbscan-density-based-clustering" class="level3">
<h3 class="anchored" data-anchor-id="dbscan-density-based-clustering">DBSCAN: Density-Based Clustering</h3>
<p>DBSCAN finds clusters of arbitrary shape and identifies outliers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data with non-spherical clusters</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>moon_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First crescent</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">cos</span>(<span class="fu">seq</span>(<span class="dv">0</span>, pi, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">sin</span>(<span class="fu">seq</span>(<span class="dv">0</span>, pi, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_cluster =</span> <span class="dv">1</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Second crescent (shifted and flipped)</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">cos</span>(<span class="fu">seq</span>(<span class="dv">0</span>, pi, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">-</span> <span class="fu">sin</span>(<span class="fu">seq</span>(<span class="dv">0</span>, pi, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_cluster =</span> <span class="dv">2</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Noise points</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">20</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">runif</span>(<span class="dv">20</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_cluster =</span> <span class="dv">0</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Try K-means (will fail on non-spherical clusters)</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>km_moon <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(moon_data[, <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)], <span class="at">centers =</span> <span class="dv">2</span>)</span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="co"># DBSCAN</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>db_result <span class="ot">&lt;-</span> <span class="fu">dbscan</span>(moon_data[, <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)], <span class="at">eps =</span> <span class="fl">0.3</span>, <span class="at">minPts =</span> <span class="dv">5</span>)</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare results</span></span>
<span id="cb11-31"><a href="#cb11-31" aria-hidden="true" tabindex="-1"></a>moon_results <span class="ot">&lt;-</span> moon_data <span class="sc">%&gt;%</span></span>
<span id="cb11-32"><a href="#cb11-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-33"><a href="#cb11-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">kmeans =</span> <span class="fu">factor</span>(km_moon<span class="sc">$</span>cluster),</span>
<span id="cb11-34"><a href="#cb11-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">dbscan =</span> <span class="fu">factor</span>(db_result<span class="sc">$</span>cluster)</span>
<span id="cb11-35"><a href="#cb11-35" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-36"><a href="#cb11-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-37"><a href="#cb11-37" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(moon_results, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> <span class="fu">factor</span>(true_cluster))) <span class="sc">+</span></span>
<span id="cb11-38"><a href="#cb11-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-39"><a href="#cb11-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"True Clusters"</span>, <span class="at">color =</span> <span class="st">"Cluster"</span>) <span class="sc">+</span></span>
<span id="cb11-40"><a href="#cb11-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"gray"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"red"</span>))</span>
<span id="cb11-41"><a href="#cb11-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-42"><a href="#cb11-42" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(moon_results, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> kmeans)) <span class="sc">+</span></span>
<span id="cb11-43"><a href="#cb11-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-44"><a href="#cb11-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"K-Means Result"</span>, <span class="at">color =</span> <span class="st">"Cluster"</span>)</span>
<span id="cb11-45"><a href="#cb11-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-46"><a href="#cb11-46" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(moon_results, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> dbscan)) <span class="sc">+</span></span>
<span id="cb11-47"><a href="#cb11-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb11-48"><a href="#cb11-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"DBSCAN Result"</span>, <span class="at">color =</span> <span class="st">"Cluster"</span>) <span class="sc">+</span></span>
<span id="cb11-49"><a href="#cb11-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"gray"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"red"</span>))</span>
<span id="cb11-50"><a href="#cb11-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-51"><a href="#cb11-51" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply DBSCAN to housing data</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Find optimal eps using k-nearest neighbor distance</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>knn_dist <span class="ot">&lt;-</span> <span class="fu">kNNdist</span>(scaled_data, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>knn_dist_sorted <span class="ot">&lt;-</span> <span class="fu">sort</span>(knn_dist)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(knn_dist_sorted, <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"K-NN Distance Plot for eps Selection"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Points sorted by distance"</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"5-NN Distance"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">1.5</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply DBSCAN</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>db_housing <span class="ot">&lt;-</span> <span class="fu">dbscan</span>(scaled_data, <span class="at">eps =</span> <span class="fl">1.5</span>, <span class="at">minPts =</span> <span class="dv">5</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze results</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>dbscan_summary <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster =</span> db_housing<span class="sc">$</span>cluster</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">if_else</span>(cluster <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Noise"</span>, <span class="fu">paste</span>(<span class="st">"Cluster"</span>, cluster))</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(dbscan_summary)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: right;">cluster</th>
<th style="text-align: right;">n</th>
<th style="text-align: left;">type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">18</td>
<td style="text-align: left;">Noise</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">482</td>
<td style="text-align: left;">Cluster 1</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="dimensionality-reduction" class="level2">
<h2 class="anchored" data-anchor-id="dimensionality-reduction">Dimensionality Reduction</h2>
<section id="principal-component-analysis-pca" class="level3">
<h3 class="anchored" data-anchor-id="principal-component-analysis-pca">Principal Component Analysis (PCA)</h3>
<p>PCA finds the directions of maximum variance in high-dimensional data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform PCA</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(scaled_data, <span class="at">center =</span> <span class="cn">FALSE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance explained</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>variance_explained <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC =</span> <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pca_result<span class="sc">$</span>sdev)),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_explained =</span> pca_result<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sum</span>(pca_result<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cumulative_var =</span> <span class="fu">cumsum</span>(var_explained)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(variance_explained[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ], <span class="fu">aes</span>(<span class="at">x =</span> PC, <span class="at">y =</span> var_explained)) <span class="sc">+</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> cumulative_var, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> cumulative_var), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"PCA: Variance Explained"</span>,</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Red line shows cumulative variance"</span>,</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Principal Component"</span>,</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion of Variance"</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>., <span class="at">name =</span> <span class="st">"Cumulative Variance"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Biplot: variables and observations</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca_result, <span class="at">data =</span> clustered_data, <span class="at">colour =</span> <span class="st">'cluster'</span>,</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">loadings =</span> <span class="cn">TRUE</span>, <span class="at">loadings.label =</span> <span class="cn">TRUE</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">loadings.label.size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"PCA Biplot with Clusters"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpret principal components</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>loadings <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pca_result<span class="sc">$</span>rotation[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>loadings<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">rownames</span>(loadings)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>loadings_long <span class="ot">&lt;-</span> loadings <span class="sc">%&gt;%</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> PC1<span class="sc">:</span>PC3, <span class="at">names_to =</span> <span class="st">"PC"</span>, <span class="at">values_to =</span> <span class="st">"loading"</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(loadings_long, <span class="fu">aes</span>(<span class="at">x =</span> variable, <span class="at">y =</span> loading, <span class="at">fill =</span> variable)) <span class="sc">+</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>PC) <span class="sc">+</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"PCA Loadings"</span>,</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Variable contributions to each principal component"</span>,</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Variable"</span>,</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Loading"</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use PCA for visualization</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>pca_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pca_result<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> clustered_data<span class="sc">$</span>cluster)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2D visualization</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pca_data, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.95</span>) <span class="sc">+</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Clusters in PCA Space"</span>,</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"First two principal components"</span>,</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">paste0</span>(<span class="st">"PC1 ("</span>, <span class="fu">round</span>(variance_explained<span class="sc">$</span>var_explained[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%)"</span>),</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">paste0</span>(<span class="st">"PC2 ("</span>, <span class="fu">round</span>(variance_explained<span class="sc">$</span>var_explained[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%)"</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-5-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3D visualization with plotly</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(pca_data, <span class="at">x =</span> <span class="sc">~</span>PC1, <span class="at">y =</span> <span class="sc">~</span>PC2, <span class="at">z =</span> <span class="sc">~</span>PC3, <span class="at">color =</span> <span class="sc">~</span>cluster,</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"scatter3d"</span>, <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>        <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"3D PCA Visualization"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="plotly html-widget html-fill-item" id="htmlwidget-17463b260dfe37c51cd3" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-17463b260dfe37c51cd3">{"x":{"visdat":{"8ee25ddc06cb":["function () ","plotlyVisDat"]},"cur_data":"8ee25ddc06cb","attrs":{"8ee25ddc06cb":{"x":{},"y":{},"z":{},"mode":"markers","marker":{"size":5},"color":{},"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter3d"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"title":"3D PCA Visualization","scene":{"xaxis":{"title":"PC1"},"yaxis":{"title":"PC2"},"zaxis":{"title":"PC3"}},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[3.2423336615018519,6.415277088915655,5.177956224419952,6.2116319660893922,4.1142552629900111,5.5041288847430865,2.1936833858777423,2.7395648992156163],"y":[3.3324866670525499,2.5513634895235735,2.6105973365069408,8.9646159559978482,2.9948282322342958,3.8519223533789693,2.5268847816178339,5.2744566903978303],"z":[-3.2302620979715004,-2.6713980846347125,0.55084998422040465,-8.1426633662423633,-2.8590223634330343,-1.3406843732308107,-2.4141257113054357,0.73095633924709047],"mode":"markers","marker":{"color":"rgba(102,194,165,1)","size":5,"line":{"color":"rgba(102,194,165,1)"}},"type":"scatter3d","name":"1","textfont":{"color":"rgba(102,194,165,1)"},"error_y":{"color":"rgba(102,194,165,1)"},"error_x":{"color":"rgba(102,194,165,1)"},"line":{"color":"rgba(102,194,165,1)"},"frame":null},{"x":[-1.9902090154192975,-1.2158679789716731,-0.90471641261270619,-1.3546100706619828,-1.7950439376979066,-1.8960036944116421,-2.040362499305544,-0.68100230254909411,-0.85841612247333909,-0.98616181235047962,-0.86552462804098107,-0.75630760047790835,-0.86717639416617565,-0.85777775188576111,-1.5375846416466217,-1.2661405251765867,0.36410683769201435,-1.2195188413216287,-1.6202966798050731,-1.3746365194042147,-2.2048051540736888,-0.95261686707424476,-1.0710996997473887,-2.8701186518755821,-1.0855100044244381,-3.0602617701747681,-1.187580400281488,-3.0308153235641977,-1.3316450898176346,-0.85548599869098452,-1.1977447266875314,-0.75022409902796849,-1.4399346698278062,-0.78309796292859835,-1.687017843111942,-1.0521988639387703,0.069677992254304363,-1.1430280800058319,-1.4794339705341755,-1.9704028468210883,-1.2587802998783126,-0.72467949604809156,-2.8761414527020746,-0.40748818693360167,-1.3934990777124541,-1.8303683524117567,-2.9806996674851263,-1.2590228563743298,-2.2343218755469882,-0.49303085453716722,-1.323614083938033,-2.2663117991085908,-0.85638484040838725,-0.62464418679201605,-0.75865239511201343,-1.4724355785590342,-1.534137920239508,-1.1835039653155053,0.11575056484118544,-1.8925488736809266,-0.21769234124503764,-0.18717844258868144,-1.1074346580685492,-1.8640227436872352,-1.601468447443761,-1.1942649818247846,-2.1211772602179781,-1.9222787074539387,-2.5762751683295719,-1.5844770870332627,-1.6838584159777819,-1.3496077541095688,0.19924793359486079,-1.8348665281002943,-2.1430838792093376,-1.3091536942648041,-1.9014290591852478,-0.053429810285664826,-1.8525847012116228,-0.77572150568763887,-1.01461349446231,-2.6344112214679662,-1.8869573686859615,-0.95353113659589472,-1.5288255676578455,-1.7478316056220708,-0.92491682415340903,-3.103093543552669,-2.1865843333636779,-3.2081218904370887,-2.1383248415740637,-1.8619495751985264,-0.89416147019136083,-0.1255572408196142,-1.8944607338600883,-1.9549655439782552,-0.94615708527665199,-1.6780603618085408,-1.4862049496793874,-1.6881222818776869,-1.0775746726425357,-0.99467278636954015,-1.4897769974788637,-2.0038103129367926,-1.0269294655682435,-0.87727688022406802,-1.0717874875152815,-1.1827280632631942,-1.1261739648210907,-0.062058952280570692,-1.3479708897980218,-3.2687339351727212,-1.7036363125764937,-2.087783693145933,-2.0297822866261748,-1.0272899489176002,-1.9188962141880046,-1.2889610530302293,-2.0271934505539195,-1.2013822064996655,-1.1861744848345734,-0.15001897364685121,-1.7853141910086276,-0.58730677984564739,-0.76333627590410047,-1.4555344750684962,-2.2813845635956604,-1.0590923484686912,-1.5031073564793187,-2.4477856888480627,-0.73926622154362187,-2.1782454095645463,-1.9030864678739694,-0.9007664812851226,-1.3059935336608823,-1.2083978467354948,-0.11515607996090517,-1.0497780036694502,-2.1391860113954291,-1.7184581912731576,-0.62405612693191881,-1.6852045534960463,-2.8745886966560703,-3.3786847695388293,-1.6495486470284728,-1.597529820219399,-0.83047819348038476,-0.9247154374229275,-0.53000064835301519,-2.6508186543071126,-2.6986173842204755,-0.63541553549605112,-1.3714940482579729,-0.77140564490818997,-2.4251819826447347,-0.9113494168613977,-2.5867788822336295,-0.37704902222556785,-1.9150973739563362,-1.1117480646145639,-0.070730128849168572,-0.36329449862663948,-1.1146616476415403,-1.1274035405491463,-2.6802147513213472,-2.8075492473643284,-0.94774482723445164,-1.573424750841468,-1.9682934774474812,-0.95035378572394125,-0.54857804589845904,-1.4829926916184855,-1.5501287695062009,-1.8078609121925289,-1.7765674000601914],"y":[0.27765680389625141,0.25928668845580677,-0.2654742451054613,0.73483502871627804,0.43567471962752718,0.019774170126119657,1.1914624700224421,1.0555362281024911,-0.17905620862691038,-0.19132008026904587,0.25048881385476512,1.5496910646699815,-0.18934686125761718,-0.18513733815425845,1.1169202304851626,-0.071089716655193605,0.89953069129810925,1.8694492385925421,0.49917650090559229,1.6370387287354848,0.44360801892893237,-0.29458257816367922,1.0560475974007753,0.39687030821433567,0.34566881576821129,0.61517858171549078,-0.091656237348860373,0.28327222958989767,-0.032294387342526321,-0.25893408789477612,0.15553173198148654,0.56171100496052273,1.2264080142980549,0.54833754099208665,-0.87194614542327586,0.042569329490076212,1.4151938584088104,0.10016808202551862,0.76754723198532737,0.92873240038440541,1.1052947633403396,0.51272783594509752,-0.19290383426793029,0.42849915501101954,-0.26782414321980474,0.42739876593723886,0.22516321811285828,0.65868535096228953,0.54853952140572049,1.527893570050376,0.089583042367907498,0.58408085515804142,0.055193130006300661,0.20470817524942436,0.50151279676791083,0.81347730170573374,-0.058366834835109016,0.079569596644178911,2.4336763654808848,-0.15472306293317215,1.3263347432436807,1.5884293308371098,1.4408282949688851,0.17560485343467924,0.3409986430809881,-0.12739644513852713,1.0063609031444689,0.74181635910006227,1.4110724678224789,0.65524077858109875,-0.50539768674283803,-0.59307061473229283,1.8056889831730274,-0.80955359689963646,0.40235359068383786,0.15915568203031841,0.074777873952069362,2.1118493978759014,0.94829887653475808,-0.23205266779712719,0.11630048396747951,0.26621147516497023,0.7963852134836944,1.627692233980276,-0.47953489961605811,0.87916262470642725,0.24703514044638505,0.86252148249726346,-0.14701967750502848,0.58526545640231786,1.0050697256914354,0.4846864593193565,0.825811972252249,0.81219350711088489,0.44295876546622948,0.6610105063363183,3.96869891918583,0.28223219208497524,0.6639720109942121,1.1091073140228414,0.24380504828238639,0.188788115551276,0.77525275635510382,-0.86866400750698058,1.45316076216528,-0.029410927224997222,0.6417003187622583,0.34744622798750391,0.07966860276219713,0.60886784126450488,-0.36208115944189023,0.76455151793226916,-0.79052324501198701,0.82851476924832235,2.1648626749424813,0.35009465541414431,0.57351056654521815,1.0081735644273755,1.74607145584707,-0.11489704320015343,0.66919101084902977,0.72210634970402077,1.415869723622982,0.057984879993171055,1.477440060257214,1.297791943672238,-0.2994147920152947,-0.15757112665477457,0.43985095700973414,-0.63511732535410204,0.55925124474055976,0.20232930794241266,-0.36650161786956603,0.44286576362743219,0.2901201495986368,-0.051574116850545117,2.3770231639479609,0.22008246466797282,0.29569450082534665,1.328079267987273,0.16259726448097048,0.16873100418030654,0.86842107443451799,1.0888671535239898,0.36514585769856917,0.30325726997252783,-0.044323808104774022,-0.027633002480275917,1.1823663772268247,0.099056907400715627,0.19614190631991352,1.0563503274440713,0.9053474484890891,0.45195447056680249,0.77459897377182385,-0.30872552458926089,1.5699124391475705,0.40458559677840267,1.4497455444108853,-0.091883191091945357,0.53483984155621334,0.66734594445034989,0.9113584715648666,1.2496907606130636,0.71655395150045553,1.221859303048451,-0.024409485121040599,1.0659994580650789,-0.84309644887323654,0.67731041420454108,1.0353544939712889,0.71232959008193131,0.48803259863252951,0.64729715260353771,0.85404935788519976],"z":[0.13894841868534694,-0.031041908450256527,-0.2784855673344932,-0.26946034210038844,0.55625375697779023,-0.29906683738324674,0.027402815880512136,0.84616951579874666,-0.60410933668514422,-0.66218683481768126,-0.80847734292136864,1.387404733575039,-0.31868043142395341,-0.32909654715520376,0.59735289995543472,-0.39435402880776527,0.87936555307423714,1.3653006724184891,-0.1066631141941851,1.1198019966580266,-0.50949147672760409,0.41624917488573387,1.2898817232952313,-0.42734338811556422,-0.81028334486852616,-0.067883881674949548,-0.38142128962970767,0.041159818606374209,-0.75614445077336589,-0.25335256387261756,-0.49493006412649881,0.12842386922085483,0.52979958481855016,-0.70744814920931598,0.12061292604279027,-0.58730195493803572,1.8910826143630139,-0.70512447255274846,0.82618286093215942,0.66631655888147545,0.27704687995327609,-0.059109378099679713,-0.66750829193719508,0.79990727815844476,-0.52691284486978573,-0.45235590410983589,-0.19159483512886447,0.681696104375905,-0.67114987981074037,1.6130978834517431,0.29806223977652824,-0.3534226562362538,-0.54668600028990477,0.32174373429605313,0.81495259988315405,0.42472099770404015,-0.3223153669577119,-0.32847234609959636,2.4422977510601602,-0.20186985561522178,0.9716058237098999,1.6799721317171117,0.7819967356628057,0.28798841729336316,0.080139482355284217,-0.32675613375404311,0.29802986270271564,0.50239803091584123,0.16141776501303537,0.19484783193653207,-0.43504320678125952,-0.76719912588910388,2.2673255142921902,0.16750196205627871,0.015408664304139594,-0.14383807655734274,-0.64459349175549974,1.9530100632357223,0.92519078722336801,-0.21048270823305928,-1.0660152947378521,-0.013443749012754653,-0.99407823550015595,1.0434026062818977,-0.54297442625623438,-0.12264907123206011,0.56686052454999269,0.033514999352943241,-0.42479953024292638,-0.17205895228685156,0.25485953819853885,-0.65357091014692736,0.17694322155599987,1.408365548003051,0.22954267351953403,0.56684217132723203,0.6665555922189913,-0.81765455849538882,0.9476067543954978,0.37434654660536776,0.35853783258247707,-0.056045609335950701,-0.092501254211512465,-0.01617206873984818,0.68596318738307771,0.01580766220519773,0.45994483235052813,0.32972340046804155,0.079519662401519656,1.1190822427371725,-0.7461531027902345,-0.96065321909979684,0.21549865141864435,-0.39638851341555936,1.2910060718092471,0.59259057110742752,0.39337424379763358,-0.47637266890573282,0.19591263379384258,-0.069869366430475532,0.29417746845943304,0.3354067017161716,1.5499381959460812,-0.04758273965538614,0.95889711215173323,0.81110758661629345,-0.57729059434727326,-0.20523203087201305,0.072051005023302431,-0.023115645606930725,0.39905025991553933,-0.80782416440080429,-1.0919112457889368,-0.31560550838741774,0.030036614459630684,-0.33807811406017935,-0.69137878606042946,0.20615006654675758,-0.86459123185691711,0.74714698808219748,-0.18117596698847929,-0.47091676267213967,0.42059500400114935,-0.15628488495160406,0.3842633651860296,-0.15038197224278238,-0.17428765186439729,-0.83072429931258884,1.3257768189547008,-0.85308956033630134,-0.10471996501282636,0.61254700198988565,0.34210334046952934,0.50074057921462012,-0.30426892903217623,-0.26859211648680587,0.41786272663496421,0.38711622553137387,1.2068772841203528,-0.38035924011626199,1.1642808127029933,1.3073878334417901,0.81930715390578579,0.33681717228251318,0.065163364643858177,0.46500671147324518,-0.50420125320396336,0.4193334876582806,0.037208878115592744,-0.13066753553434804,0.82757271824259415,0.50165257409010533,0.14107234689071582,0.17404825142387151,1.0747662814043657],"mode":"markers","marker":{"color":"rgba(252,141,98,1)","size":5,"line":{"color":"rgba(252,141,98,1)"}},"type":"scatter3d","name":"2","textfont":{"color":"rgba(252,141,98,1)"},"error_y":{"color":"rgba(252,141,98,1)"},"error_x":{"color":"rgba(252,141,98,1)"},"line":{"color":"rgba(252,141,98,1)"},"frame":null},{"x":[-0.32526970644226061,-0.38071937283547519,1.0295408154063008,-0.41434949842365976,-0.026728185509149783,1.4800932987353683,-0.74554816343768637,1.0639383761279366,-0.16905807989817298,0.88369609215065026,0.95959238063826435,-0.059422715087854829,0.0007724880269754014,-1.2066476519006821,1.3506571397087381,-0.50408569628021216,0.63086307265003716,-0.36061683730420502,0.814867389017912,0.11918387817969099,-0.53606166945529388,-0.63535959653418284,1.0327209387493594,-0.47270148639748644,0.041042915728094362,0.66969664336805068,0.14563463780052163,-0.4469437714706791,-0.47786257041225272,1.273048023998735,-0.064084190559259152,0.25908549903263539,1.1945873642816789,-0.23531861879864832,-0.18173014596562678,0.64763833228422052,0.48658176505783246,0.6804154222371398,-0.24317277805518198,-0.062114945379052079,-0.051199605096592472,0.70918295551542354,-0.17957317507489559,-0.85444559354232097,-0.91881229050082081,0.44955748861616757,-0.27953405789645375,0.19084455822675517,0.72057969134541922,-0.12777756755121661,-0.36556913552711801,0.29040075353296108,-0.57373455229129922,1.0618949483195195,1.1854715342938016,0.29705482433088531,0.056396313026446626,0.16330515197927445,-0.64814411671844951,-0.60726590354224497,0.37657356459642333,0.31808448921352828,1.1464312288020655,0.63297734989861543,-0.84804186805266357,1.0058674439493438,-0.10827207722295296,0.064701862565792606,0.83220182104326257,-0.46958720118085157,-0.10570945263574935,-0.051960441349587598,-0.53602996665527425,-0.78198075904370623,-1.0094884922668734,-0.62960784098264344,-0.15490373081513265,0.50946019932476927,-0.35377338909087247,1.1436290016068349,0.59095479791981831,-1.1940994730572558,1.2043807516245224,-0.10291588467616698,-0.012248645807421299,0.22307954345425104,0.17140639730668153,0.75672648208217552,-0.12698740287568488,0.92974449472040532,-0.76396898092195054,0.22945484491466328,0.77375628044329836,-0.12506719625040902,1.0771599045927238,-0.098112548287337967,1.1340602133101085,0.203100511645882,0.45870929713934194,-0.25600535866371121,-0.81796751171560544,-0.76939670155930839,0.55244879324911178,-0.59002799402108663,0.48337758837482309,-0.26054222320828513,-0.67751467708736268,-1.0202641259825012,0.93226922866260808,-0.025332740962596478,-0.34664092919086598,-0.12698740287568488,0.34961742064602397,-0.67717907155990242,1.0843739890273569,0.71424890616081138,0.65998734638749357,-0.71347580840639013,0.69906909688885299,0.88954867602600862,-0.16502796517693855,0.44721896586636584,0.84302313790015326,1.1256847711656877,-0.78198075904370623,0.66217298567241245,0.73392658273096212,0.81394113402655488,0.29213308415308387,-0.43073451319636435,0.33382069349800331,-0.46926057366362833,-0.11002248180593036,1.2048144367752824,-0.53777478175568971,0.60309241516584411,-0.13380015577621776,1.2311488621756246,-0.34695830974469305,-1.1435486333131337,0.15429828388388783,1.0798049758645702,-0.84958050817770125,0.82622507799536726,0.46078568464910186,-0.28728737249207453,1.0374814938216961,0.077666349327601067,1.1085869333995311,0.26584385131066524,1.0638896097061801,0.27624250336590739,0.7672818326950438,0.81140349130284628,-0.13284401438846716,0.40937229628305066,-0.18172925124031405,0.25995195992118114,-0.66065940930608602,0.29812210522019883,-0.70755728903505144,-0.050619176062309514,1.0507016163659575,-1.164674861748672,0.39018422773563577,0.80792535778244956,1.1004954310509267,-0.20210068998932462,0.19232521745212086,0.94854560318980641,-0.81195092277799019,-0.66131612947146146,0.12307584404505628,-0.47105713216940959,0.32125820175319031,0.019829031400259864,0.15488525646303528,0.25496407313502567,0.41428881737348139,0.55153399993852892,-0.38111375296599087,-1.3907645486432771,-0.21663654527427195,-0.38807997824824481,-0.70173828502957847,-0.21868160672877818,0.19078605704182031,0.17203751214855501,0.40049113305863177,-0.44846820649883873,-1.0372073698094659,0.75265741776265993,0.91177219348635696,0.4542955844071242,0.43640441454041939,-0.28761695728630998,-0.060587493840187086,0.08311640518062556,0.87817820100235622,-0.48312165651881134,1.1855908633064822,-0.0061464211039206238,-0.3812078849445506,0.12150702620115325,0.96279170386128066,-0.78198075904370623,-0.093930001858909151,0.025825678660492676,-0.67717907155990242,-0.066690571683374847,0.5911276998642403,-0.88569982554290827,-0.2591890149626539,0.83125417241695199,0.30408111079460259,0.22423392277554038,0.55454477535443203,0.58108082688391138,-0.25720675737774901,-0.61334585781259976,0.34159501823640337,0.44159406377988786,-0.21888356083184096,1.5853380054027941,-0.0770409166032794,-1.4881883354234491,-0.27992488320207393,0.47552244441768809,0.55147981988353578,-0.38514236688824233,0.40712506944443949,-0.62960784098264344,1.0902165659353094,0.55033251307732278,1.2245078189323555,-0.58731799609423474],"y":[-1.1319744147023938,-1.3109110534230519,-0.76002338283341309,-0.22625537062674117,-0.76622394218229939,-0.64507905466793725,0.35774820729238177,1.0064882860213251,-0.19577992800507413,-0.94316132811878184,-0.10073147751462599,0.092620570958453038,0.35581877133164819,-1.4542730886715964,-1.1616121897207801,0.16470962667013225,-0.23256407590032785,-1.152503693728538,0.31970316642314928,0.67772304351278267,-0.37501520030606372,-0.97905017986634058,-1.4178440211555505,-0.13530897126709629,0.18801125333118496,-0.57811674080936259,-0.2612218513386112,0.53161728031556243,-0.19587562508460898,-0.76240595117486321,-0.57049088039116613,-0.67353498060200878,-0.94734454684803271,0.17391207197654424,0.29793499959349456,-0.50144770426159901,0.75380518560277299,-0.82749276969159524,-0.65422083348998261,-0.42019602628414016,-0.50814152313387673,2.0871054527105217,-0.42784830244357974,-0.2847243710704187,-0.28292513039063827,-0.298459572860166,-0.92173121295540827,-0.58245930002390645,-0.27472436870200928,0.047259519356280068,-0.986860956878722,0.48536189213493813,-0.79199320107538518,-0.93358010275678738,-1.0371908326617993,-0.61728153282932696,-0.60512429216008534,0.25736729147114518,-0.59697499865207204,-0.30052908657924443,-0.77601470367241987,-0.086349921306400013,-0.77537871613329057,0.4951106517606304,-0.18844800616178459,-1.0350051222225687,-1.103794035180973,-0.15623557388305617,-0.8058268324271195,-0.30203729178269184,-0.44641452849110258,-0.54198346696436661,0.11550132550943622,-1.5406324356581893,-1.098605169717862,-1.3882583846075074,-0.86045142189539092,-1.0517891751866382,-0.8555507019111831,0.80493454969958333,-0.52203499989875113,-0.62479104871836721,-1.5144396336173727,-1.5812695360178175,-0.15673682208327794,-0.97708544771128492,-0.061585210591009854,0.66357956774303517,-1.1913995290517085,-1.401676004411037,-0.81934488024916197,0.80126933959947011,-0.66413387366357091,0.3590529180067541,-1.4771655627473819,-0.006164701035667873,-1.1182513004637471,-1.6144262751566349,0.32191440699260426,-0.52836126387207016,-0.66654900022454533,-1.5622970943723737,0.00029120729177282479,-0.25496244821647862,-0.99543448543502611,0.55971659910693072,-1.3422226012887417,-0.47518007031939929,-1.4871403686323352,-1.1950067960210777,0.14202307182971402,-1.1913995290517085,0.41669805384128406,-1.4257714343827999,-0.26854263116389693,-0.91950017639003778,0.74823066843633323,-0.42203709415147828,-0.13361544660168947,-0.68260940137130066,-1.3239578563309613,-1.5143325094703806,-0.16889507220461417,0.49910197603003031,-1.5406324356581893,-1.2936284169706671,-0.60866248163677728,-0.46446468371908761,0.11376595531383139,-0.01162028675300235,-0.83385467203254571,-0.8635703367377392,-0.33099203282981593,-0.26883285228234344,-0.7081258398119743,-1.4670732254354881,0.27263080661846628,-0.39461097703301662,-0.56342806608751206,-0.67037987242252173,-1.4050021423266379,-1.1292816182514569,-0.32448766355665426,0.051479403431724517,-0.44284459834172429,-0.79598931967353792,-0.51170426292482996,-0.028867835353462403,0.22403508486207813,-0.15171141289004228,-0.76842771170638169,-1.1429646540106728,-1.3846846072208518,-0.12736197165894506,0.98792925411018973,-1.3849989885198168,-0.75362283771670213,-0.95474226909858029,-0.67983873303502906,-0.53634334769281411,-0.59744210327180136,-0.43788446387842206,-0.98083091432643321,-1.0740080630369819,-0.62820472462590315,-1.1371166465963849,-1.1552017791480096,-0.98785876633308944,-1.1760019273485063,0.2756458437055464,0.027195678713159484,-0.93728516050741184,-0.59172966220968926,-0.45541184271494295,-0.53280266204351923,-0.36117146119217053,0.20266772981800146,0.14642419458589062,0.04046641528640707,-1.2529135873539305,-0.59008766938948898,-0.89445569467453934,-0.068894756389590653,0.056830492208715673,-0.60328073121485126,0.23828115022901994,-0.30236373609914191,0.38731042436288843,-1.0616460168603923,-0.24008013658590616,-1.0826209301552967,-1.527459569361046,-0.073906763801477426,-0.94501775856926074,-0.20399746782456724,-1.0941605900895539,-0.21953228353004239,-0.43183607384454259,-0.28295511708122462,0.065239712953492915,-0.34339200571410866,-0.12692103325173765,-0.093679101650702271,-0.21426934630902145,-0.35042535393534874,-1.5406324356581893,-0.043246242926851121,0.58915253813120316,-1.4257714343827999,-0.69255962303452756,0.41027034183362288,-0.58248522996186192,-0.57317505051379081,-0.12939056446663552,-0.57117959089930148,-0.597574165040205,-0.67398993467854384,-1.3746162014940908,-0.20585720141380318,-1.0344518614460831,-1.1561301973344311,-0.011286888532857087,-0.91170192309190756,-0.40910912928700605,0.15012285166473788,-0.87018381648698517,-0.95563284012951422,-0.18004160787560017,-0.33099214581970809,-0.39725779038188563,-0.74458432253486451,-1.3882583846075074,-0.81463833851693734,-1.2419963400919922,-0.9018637514645923,-0.00058927025601868024],"z":[0.43164061930504172,-0.00026680415745709515,0.16444390166848183,-0.94377576966988441,-0.63671018641088706,-0.75165780996879528,0.66549619409053495,-0.033891515424326675,-0.81576448833545112,-0.3257744868099588,0.63253069341878465,-0.55782471161665503,-0.2466321101003727,-0.71193567086320197,-0.14805514415097673,-0.34418964978087735,-0.36412082311086547,0.53800171687192488,0.045648173157060698,0.52521162828085322,-0.38960124216757724,-0.15871962567731204,0.28315274060014567,-0.45460423278114931,-0.11867091433593313,-0.99096287067887079,-0.19986682664927416,-1.229694803726181,-0.50309054341341297,-0.5335038301859818,0.30435562198708094,-0.38127892970859073,-0.65143089317471381,-0.38891441325549703,-1.015488161986084,0.49467444018875739,-1.0474782582407385,0.11327654050459211,-0.11549063407565571,-0.21324605642436673,0.2414186677669618,-2.3779717851444864,-0.65901128334346526,-0.39891137591215675,-0.71487015880130489,-0.20616360702113823,-0.70500915881806037,-0.12709269957097272,0.60927464134217868,-0.61810249609811796,-0.076108064431155767,1.1974828087248774,0.61566949571789586,-0.24422718550760761,-0.14397541292343846,0.12513457433496103,-0.42360273291071032,0.27476653029321829,-0.24651675833706846,0.10130724798965295,-1.0583089556133378,-0.14059486932237114,-0.55157133480877363,0.7353729756143681,-0.60616146511495328,-0.29668513918293404,-0.59752555593934853,-0.61897283237656053,-0.58223265425236903,-0.40618336908598407,0.021955334626498364,0.198109971202545,0.17795007198433216,-0.68314059740449207,-0.94293306245347674,0.003455739409543683,-0.51121327889556956,-0.55946717804322454,-0.44416882634295368,-0.99284888564618201,0.34784066883419351,-0.64329891436815578,0.2505270489633693,-0.22585269670233463,-0.47305432134385322,-0.42776751780651179,-0.16155454152341497,-0.63382231141833301,0.60861063113209335,0.2535352602694031,0.42693111527508526,0.55654903482477214,-0.2920792289661483,-0.81987512242877225,0.2541134952362582,-0.067403020398827965,-0.035678065146617123,-0.20193842594572198,-0.093757273551929518,0.11120390518199523,-0.32893316417005591,-0.69190846188566602,-0.2461838066496706,-1.7415624720124478,-0.67619805350660744,-0.30863256772643893,-0.66405765962757146,-0.78999416972234693,0.16018616683951128,0.57567238688769695,0.34628855531748159,0.60861063113209335,-0.14616561791049418,-0.16423039858625299,0.67448301952709178,-0.32082214455396763,0.35001768877675477,0.049905835248725459,-0.17807949122857239,0.54697762618480783,0.22524414730033449,0.037769314096963949,-0.042969087595982149,-1.0035081623243689,-0.68314059740449207,-0.35636081449172541,0.29332258936093086,0.44601685857897561,0.12243441490835254,-0.27590200156975897,-0.28753506582626759,-0.26180587191974392,-0.029340005504249585,-0.85333807080395196,-0.4427028756630122,-0.050386853302517458,0.5456805187840591,0.059004929855064801,0.088183103501271939,-0.78627552696850411,0.10005870725778333,-0.28244275074668596,-0.70839972642111437,0.5699314157328651,-0.053356928330692069,-0.18952446545046026,-0.59663951680887573,-0.32174483698765194,0.18580493162943132,-0.081082526268982616,-0.31156564934707331,-0.74394409679056972,0.0040569045938281473,0.043268462072767001,-1.419427888131058,0.21960233574003379,-0.047066116561188164,-0.26704867666197241,-0.46745773976733296,0.23775542275106615,0.014382666364963182,-0.22349761027689752,-0.42044735961777491,-0.98989788724364758,0.38068680750400063,-0.20000094550441436,-0.016748655527737567,0.039837798185223865,-0.11362375056634756,-0.33282761146924561,-0.25290308789700972,-0.13971031638005926,0.15632911582449238,-1.0591464068975056,0.015198236046003469,-1.2705308592838624,-0.26119799561091867,-0.0039110447118060696,-0.27104691755876004,-0.3261178545514189,-0.54821694886972994,-0.80224139414160855,-0.38004481237444182,-0.42805620817034012,-0.38262459684129863,0.2269783361063416,-0.29874395939898668,0.79940959749253504,-0.82139895632001392,-0.72197285249948573,-0.36469609689087912,0.1138383583126478,-0.45566602653754024,-0.19301186632090661,0.59863677250622027,0.34861998757933299,-0.21637668392143861,-0.35285278993284813,0.035244519935377416,-0.39122134329232316,0.37614004043143218,0.087733495710782511,-0.087655488698840336,-0.24620339559243112,0.31202620236554957,-0.68314059740449207,-0.25169980099227879,-0.031821658690462287,-0.16423039858625299,-0.12590842365479787,0.6584895037709676,-0.67928866538503585,0.11721847876888977,0.3334323277880834,0.170653934249654,0.068695347357284942,0.34446127322696252,-0.37238742593993562,-1.4711576492252021,0.23950383636768846,0.63975168596091025,0.13232376024097034,-0.69130510850932847,-1.012662323824709,-0.19560623942036817,-0.93227303965991404,-0.026973903202521302,0.084299336697289576,0.59317010171661833,-0.3658303877597871,-0.47921909301108134,0.003455739409543683,-0.24947299367766218,-0.32670870018129683,-0.26886497855034525,-0.55522183282379378],"mode":"markers","marker":{"color":"rgba(141,160,203,1)","size":5,"line":{"color":"rgba(141,160,203,1)"}},"type":"scatter3d","name":"3","textfont":{"color":"rgba(141,160,203,1)"},"error_y":{"color":"rgba(141,160,203,1)"},"error_x":{"color":"rgba(141,160,203,1)"},"line":{"color":"rgba(141,160,203,1)"},"frame":null},{"x":[1.7213800791671123,1.9074762839450166,2.2780370017170957,2.1531052305756684,2.1421899893689758,2.3664618127116608,2.2827346093228589,2.4214566807365823,1.7690750074361994,1.8515929832185374,2.9012234616266914,1.2226453070591021,0.84757998310393601,4.2140931451874781,2.0431447839910217,1.1423529588032668,1.2302568982615141,2.6439268526163375,2.3318294525732695,1.4721738965743085,3.3020257134322404,1.6426223693402133,1.9106180665218806,2.4605403934296874,2.4031327042372439,1.8639915641721345,1.9898847569410725,1.7034839959371579,0.59594546437181994,3.1001882379303001,1.9085003157951437,3.3043650099097031,1.9519559976224423,2.8669553978166782,2.5775714673956793,1.0181701548976423,1.4590647680887252,3.516656019009317,3.5413278820382095,0.9030656115388016,3.0876737451894916,2.4549011638414817,1.2953415387846401,2.1216088411065885,3.6953440437145475,1.7333069870398532,1.7477079635172941,3.488627413619152,2.0914389417800847,2.0219602639149046,1.8543726880030178,4.3645510801994298,2.1905602767957477,1.757602904453095,1.7353662974405029,2.3629105314428602,2.7534023085492989,1.3005578007215377,2.1731269691559487,1.8588732271960751,3.99622719033355,2.48593916399374,2.3956916312258456,1.4009077717513672,2.4875473282150082,1.6948725103754045,2.1436483289878541,4.3449862863377344,1.6130809420347285,2.4212930847941623,1.8966097993061377,1.9885387728959016,1.7173573430357805,3.9928029717885205,4.0933564522102328,1.9047506276768666,1.590307107357156,1.241943409579483,3.3106305957102391,2.8393506237742727,2.0273224075763085],"y":[-0.97315355955280702,-0.057393385860076924,-0.64835780819937117,-0.87355573681710064,0.070681825954232225,-0.57688694112007644,0.22536393575811967,1.5198993128507297,-0.24990211635182286,-0.57043376855412176,1.9035475436251521,0.22704518188532674,0.95586120867703017,-0.072289029523703377,-0.90364158426456476,-0.17670027414299941,-0.13166947245298125,-1.2317804551980729,0.90376217084142529,0.25357278420528206,-0.17136877347270166,-0.92012230711543186,-0.92105039057238824,0.67528337712784003,3.938641191784447,-0.57857921907869747,0.92916897498082962,-1.0915994457529343,1.4578064826197139,-0.33091839388099931,-0.938104080077377,1.7740883912242142,-0.80460846252136431,0.067367896257086946,-0.36188028959175006,-0.12886705018677141,-0.057231271849447131,-0.88944321079771516,-0.60620419726154062,0.27484591619566262,-0.60986230479677328,-0.65083721934569339,-0.44440015504856939,-1.1553883719174785,0.055614155572556931,0.74556751923319786,0.16136255273963945,-0.44808003173944744,0.74690608267401237,-0.84463749546810496,-0.37563292750253674,0.97810190443309153,-0.31798167100956237,-0.52656590298772021,-0.62875513497591895,0.038966324532522377,0.39835118241087014,-0.38772131515613606,0.39992989204289386,-0.8715320048685401,-0.17519417028718182,-0.54108675113299132,-0.17117273452374066,-0.08184376656982803,0.60737347072659964,-0.18829498382270915,1.1560201004730062,-0.6257953314972563,-1.1146113342841084,-0.17528480287561735,-0.89785067489272308,-1.0702764552751933,0.39836298723880442,-1.5643174589962501,-0.54056599885876344,0.02634176546198206,-0.18257295804887574,0.38513453664154418,0.009680900399763933,0.064256256296860964,0.037740734728716814],"z":[-0.35031919961711283,-0.69250580993559441,0.66160767253587494,0.59303566370888539,0.8916385781548537,-0.3945224865189722,0.35356031403779403,-0.016039615839313282,1.2983541218163352,-0.20989963282599158,1.0432108409505492,-0.57010752046987845,1.157028512280909,-0.24355713027480527,-0.28890749608410382,-0.059229659863756008,0.57190617886903894,0.325859662432256,-0.021333538985585262,0.71015000291343877,1.1183912284422366,-0.0035411584664764113,0.43330560559474779,1.1066088504856204,2.8398732857551576,-0.34370873145797487,0.44919134556403745,0.068705661941314819,1.6080435505345818,0.028853025106645711,-0.31967305434620608,-1.0033051834015581,-0.19926711830884639,0.14207832910207041,0.80792239784877762,0.18750644460133833,1.4054159625099092,0.26934313881588517,0.16396772507249971,1.5208604455609156,0.0042972626541339523,0.59256249108027503,0.078659979582354794,-0.01409257894875862,1.5515942299497778,-0.12950132790173235,0.5241275573574945,0.38642783149627918,1.6785058137736455,0.36443343248932275,0.96349343654159592,2.0800522307258946,-0.58511288534075878,0.53367729180142875,0.45387365826858639,1.5574969806101129,1.0135902535573784,0.30482341969944859,1.7395780158551073,-0.27888927453018375,1.5470932176581873,-0.19701778902008232,0.59876520457146654,-0.070606591316219297,1.7433413993973914,0.97736944383951585,0.76505811204799279,-0.052424894302661659,0.088123275032226792,1.8851282180563544,-0.31106430610185759,-0.11334687015182464,0.72304354293988193,-0.56469520895905223,0.57138077784356756,0.93443276653721996,0.84243294376409306,-0.29193011648055156,1.0398858964571975,1.02844391888425,0.85680238832097411],"mode":"markers","marker":{"color":"rgba(231,138,195,1)","size":5,"line":{"color":"rgba(231,138,195,1)"}},"type":"scatter3d","name":"4","textfont":{"color":"rgba(231,138,195,1)"},"error_y":{"color":"rgba(231,138,195,1)"},"error_x":{"color":"rgba(231,138,195,1)"},"line":{"color":"rgba(231,138,195,1)"},"frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p>The mathematics of PCA: - <strong>Objective</strong>: Find orthogonal axes maximizing variance - <strong>Method</strong>: Eigendecomposition of covariance matrix - <strong>Result</strong>: Linear combinations of original variables - <strong>Key insight</strong>: Most variance often captured in few components</p>
</section>
<section id="t-sne-and-umap-non-linear-dimensionality-reduction" class="level3">
<h3 class="anchored" data-anchor-id="t-sne-and-umap-non-linear-dimensionality-reduction">t-SNE and UMAP: Non-linear Dimensionality Reduction</h3>
<p>For complex, non-linear structures:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># t-SNE (computationally intensive, using sample)</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rtsne)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>tsne_result <span class="ot">&lt;-</span> <span class="fu">Rtsne</span>(scaled_data[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>, ], <span class="at">dims =</span> <span class="dv">2</span>, <span class="at">perplexity =</span> <span class="dv">30</span>, </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">max_iter =</span> <span class="dv">500</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>tsne_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(tsne_result<span class="sc">$</span>Y) <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"tSNE1"</span>, <span class="st">"tSNE2"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> clustered_data<span class="sc">$</span>cluster[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>])</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tsne_data, <span class="fu">aes</span>(<span class="at">x =</span> tSNE1, <span class="at">y =</span> tSNE2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"t-SNE Visualization"</span>,</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Non-linear dimensionality reduction preserves local structure"</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare PCA vs t-SNE</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  pca_data[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>, <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"cluster"</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"PCA"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Dim1 =</span> PC1, <span class="at">Dim2 =</span> PC2),</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  tsne_data <span class="sc">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"t-SNE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Dim1 =</span> tSNE1, <span class="at">Dim2 =</span> tSNE2)</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison, <span class="fu">aes</span>(<span class="at">x =</span> Dim1, <span class="at">y =</span> Dim2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"PCA vs t-SNE"</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"t-SNE often reveals clearer cluster separation"</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="anomaly-detection" class="level2">
<h2 class="anchored" data-anchor-id="anomaly-detection">Anomaly Detection</h2>
<p>Identifying outliers and anomalies is crucial for many applications:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 1: Statistical approach (Z-score)</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>z_scores <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">scale</span>(scaled_data))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>outliers_zscore <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(z_scores <span class="sc">&gt;</span> threshold) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 2: Isolation Forest</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(isotree)</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>iso_forest <span class="ot">&lt;-</span> <span class="fu">isolation.forest</span>(scaled_data, <span class="at">ntrees =</span> <span class="dv">100</span>, <span class="at">sample_size =</span> <span class="dv">256</span>)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>outlier_scores <span class="ot">&lt;-</span> <span class="fu">predict</span>(iso_forest, scaled_data)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify outliers (top 5% highest scores)</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>outlier_threshold <span class="ot">&lt;-</span> <span class="fu">quantile</span>(outlier_scores, <span class="fl">0.95</span>)</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>outliers_iforest <span class="ot">&lt;-</span> <span class="fu">which</span>(outlier_scores <span class="sc">&gt;</span> outlier_threshold)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 3: Local Outlier Factor (LOF)</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbscan)</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>lof_scores <span class="ot">&lt;-</span> <span class="fu">lof</span>(scaled_data, <span class="at">minPts =</span> <span class="dv">10</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>outliers_lof <span class="ot">&lt;-</span> <span class="fu">which</span>(lof_scores <span class="sc">&gt;</span> <span class="fl">1.5</span>)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare methods</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>outlier_comparison <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(scaled_data),</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">z_score =</span> index <span class="sc">%in%</span> outliers_zscore,</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">isolation_forest =</span> index <span class="sc">%in%</span> outliers_iforest,</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">lof =</span> index <span class="sc">%in%</span> outliers_lof</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_methods =</span> z_score <span class="sc">+</span> isolation_forest <span class="sc">+</span> lof,</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">consensus_outlier =</span> n_methods <span class="sc">&gt;=</span> <span class="dv">2</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize outliers in PCA space</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>outlier_pca <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(pca_result<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]),</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>  outlier_comparison</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(outlier_pca, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> consensus_outlier), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"gray"</span>, <span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"red"</span>),</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Normal"</span>, <span class="st">"Outlier"</span>)) <span class="sc">+</span></span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Anomaly Detection Results"</span>,</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Points identified as outliers by at least 2 methods"</span>,</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Status"</span></span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine outlier characteristics</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>outlier_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(outlier_comparison<span class="sc">$</span>consensus_outlier)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>outlier_analysis <span class="ot">&lt;-</span> clustering_data[outlier_indices, ] <span class="sc">%&gt;%</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="fu">list</span>(<span class="at">mean =</span> mean, <span class="at">median =</span> median)))</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>normal_analysis <span class="ot">&lt;-</span> clustering_data[<span class="sc">-</span>outlier_indices, ] <span class="sc">%&gt;%</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="fu">list</span>(<span class="at">mean =</span> mean, <span class="at">median =</span> median)))</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Outlier characteristics vs normal points:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Outlier characteristics vs normal points:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(outlier_analysis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 10
  Gr_Liv_Area_mean Gr_Liv_Area_median Lot_Area_mean Lot_Area_median
             &lt;dbl&gt;              &lt;int&gt;         &lt;dbl&gt;           &lt;int&gt;
1            2403.               2338        33529.           26400
# â„¹ 6 more variables: Year_Built_mean &lt;dbl&gt;, Year_Built_median &lt;int&gt;,
#   Total_Bsmt_SF_mean &lt;dbl&gt;, Total_Bsmt_SF_median &lt;dbl&gt;,
#   Garage_Area_mean &lt;dbl&gt;, Garage_Area_median &lt;dbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(normal_analysis)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 Ã— 10
  Gr_Liv_Area_mean Gr_Liv_Area_median Lot_Area_mean Lot_Area_median
             &lt;dbl&gt;              &lt;int&gt;         &lt;dbl&gt;           &lt;int&gt;
1            1462.               1414         9413.            9260
# â„¹ 6 more variables: Year_Built_mean &lt;dbl&gt;, Year_Built_median &lt;int&gt;,
#   Total_Bsmt_SF_mean &lt;dbl&gt;, Total_Bsmt_SF_median &lt;dbl&gt;,
#   Garage_Area_mean &lt;dbl&gt;, Garage_Area_median &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
<section id="market-basket-analysis" class="level2">
<h2 class="anchored" data-anchor-id="market-basket-analysis">Market Basket Analysis</h2>
<p>Discover associations in transactional data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create synthetic transaction data</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>n_transactions <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Housing features that might be purchased together</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>features <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Granite_Counters"</span>, <span class="st">"Hardwood_Floors"</span>, <span class="st">"Central_AC"</span>, </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Updated_Kitchen"</span>, <span class="st">"Finished_Basement"</span>, <span class="st">"Deck"</span>, </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Pool"</span>, <span class="st">"Security_System"</span>, <span class="st">"Smart_Home"</span>, <span class="st">"Solar_Panels"</span>)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate transactions with realistic patterns</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>transactions <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>n_transactions, <span class="cf">function</span>(i) {</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Base probability for each item</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  probs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.35</span>, <span class="fl">0.25</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.15</span>, <span class="fl">0.05</span>)</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adjust probabilities based on correlations</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  selected <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(features)) {</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Increase probability if related items selected</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    adj_prob <span class="ot">&lt;-</span> probs[j]</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">"Granite_Counters"</span> <span class="sc">%in%</span> selected <span class="sc">&amp;&amp;</span> features[j] <span class="sc">==</span> <span class="st">"Updated_Kitchen"</span>) {</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>      adj_prob <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>, adj_prob <span class="sc">*</span> <span class="dv">3</span>)</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">"Smart_Home"</span> <span class="sc">%in%</span> selected <span class="sc">&amp;&amp;</span> features[j] <span class="sc">==</span> <span class="st">"Security_System"</span>) {</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>      adj_prob <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>, adj_prob <span class="sc">*</span> <span class="fl">2.5</span>)</span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">"Pool"</span> <span class="sc">%in%</span> selected <span class="sc">&amp;&amp;</span> features[j] <span class="sc">==</span> <span class="st">"Deck"</span>) {</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>      adj_prob <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>, adj_prob <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> adj_prob) {</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>      selected <span class="ot">&lt;-</span> <span class="fu">c</span>(selected, features[j])</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>  selected</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to transaction matrix</span></span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arules)</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>trans_matrix <span class="ot">&lt;-</span> <span class="fu">as</span>(transactions, <span class="st">"transactions"</span>)</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Find association rules</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(trans_matrix, </span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>                <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">supp =</span> <span class="fl">0.05</span>, <span class="at">conf =</span> <span class="fl">0.5</span>, <span class="at">target =</span> <span class="st">"rules"</span>))</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect top rules</span></span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>top_rules <span class="ot">&lt;-</span> <span class="fu">head</span>(<span class="fu">sort</span>(rules, <span class="at">by =</span> <span class="st">"lift"</span>), <span class="dv">10</span>)</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect</span>(top_rules)</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize rules</span></span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arulesViz)</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rules, <span class="at">method =</span> <span class="st">"graph"</span>, </span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>     <span class="at">control =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"items"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>),</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Association Rules Network"</span>)</span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a><span class="co"># Create rule quality metrics</span></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>rule_metrics <span class="ot">&lt;-</span> <span class="fu">as</span>(rules, <span class="st">"data.frame"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(rules, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"lhs"</span>, <span class="st">"rhs"</span>), <span class="at">sep =</span> <span class="st">" =&gt; "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(lift))</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rule_metrics <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">20</span>), </span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> support, <span class="at">y =</span> confidence, <span class="at">size =</span> lift, <span class="at">color =</span> lift)) <span class="sc">+</span></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Association Rules Quality"</span>,</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Size and color represent lift"</span>,</span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Support"</span>,</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Confidence"</span></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluating-unsupervised-models" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-unsupervised-models">Evaluating Unsupervised Models</h2>
<p>Without labels, evaluation is challenging but crucial:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Internal validation metrics for clustering</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>evaluate_clustering <span class="ot">&lt;-</span> <span class="cf">function</span>(data, clusters) {</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Silhouette coefficient</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  sil <span class="ot">&lt;-</span> <span class="fu">silhouette</span>(clusters, <span class="fu">dist</span>(data))</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  avg_silhouette <span class="ot">&lt;-</span> <span class="fu">mean</span>(sil[, <span class="dv">3</span>])</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calinski-Harabasz Index</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  ch_index <span class="ot">&lt;-</span> <span class="fu">cluster.stats</span>(<span class="fu">dist</span>(data), clusters)<span class="sc">$</span>ch</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Davies-Bouldin Index (lower is better)</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>  db_index <span class="ot">&lt;-</span> <span class="fu">cluster.stats</span>(<span class="fu">dist</span>(data), clusters)<span class="sc">$</span>dunn</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Within-cluster sum of squares</span></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>  wcss <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">cluster.stats</span>(<span class="fu">dist</span>(data), clusters)<span class="sc">$</span>within.cluster.ss)</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_silhouette =</span> avg_silhouette,</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">calinski_harabasz =</span> ch_index,</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">davies_bouldin =</span> db_index,</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">wcss =</span> wcss</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare different clustering solutions</span></span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a>clustering_methods <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">kmeans_3 =</span> <span class="fu">kmeans</span>(scaled_data, <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>cluster,</span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">kmeans_4 =</span> <span class="fu">kmeans</span>(scaled_data, <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>cluster,</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">kmeans_5 =</span> <span class="fu">kmeans</span>(scaled_data, <span class="dv">5</span>, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>cluster,</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">hierarchical =</span> <span class="fu">cutree</span>(hc_ward, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>evaluation_results <span class="ot">&lt;-</span> <span class="fu">map_df</span>(clustering_methods, </span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">~</span> <span class="fu">evaluate_clustering</span>(scaled_data, .),</span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a>                            <span class="at">.id =</span> <span class="st">"method"</span>)</span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(evaluation_results, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Stability analysis: How consistent are clusters?</span></span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a>stability_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(data, k, <span class="at">n_bootstrap =</span> <span class="dv">10</span>) {</span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a>  bootstrap_results <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>n_bootstrap, <span class="cf">function</span>(i) {</span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bootstrap sample</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>    sample_idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>    boot_data <span class="ot">&lt;-</span> data[sample_idx, ]</span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cluster</span></span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kmeans</span>(boot_data, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">10</span>)<span class="sc">$</span>cluster</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate pairwise agreement</span></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>  agreements <span class="ot">&lt;-</span> <span class="fu">combn</span>(n_bootstrap, <span class="dv">2</span>, <span class="cf">function</span>(pair) {</span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>    cl1 <span class="ot">&lt;-</span> bootstrap_results[[pair[<span class="dv">1</span>]]]</span>
<span id="cb29-52"><a href="#cb29-52" aria-hidden="true" tabindex="-1"></a>    cl2 <span class="ot">&lt;-</span> bootstrap_results[[pair[<span class="dv">2</span>]]]</span>
<span id="cb29-53"><a href="#cb29-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb29-54"><a href="#cb29-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjusted Rand Index</span></span>
<span id="cb29-55"><a href="#cb29-55" aria-hidden="true" tabindex="-1"></a>    mclust<span class="sc">::</span><span class="fu">adjustedRandIndex</span>(cl1, cl2)</span>
<span id="cb29-56"><a href="#cb29-56" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb29-57"><a href="#cb29-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-58"><a href="#cb29-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(agreements)</span>
<span id="cb29-59"><a href="#cb29-59" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-60"><a href="#cb29-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-61"><a href="#cb29-61" aria-hidden="true" tabindex="-1"></a>stability_scores <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb29-62"><a href="#cb29-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb29-63"><a href="#cb29-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">stability =</span> <span class="fu">map_dbl</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>, <span class="sc">~</span> <span class="fu">stability_analysis</span>(scaled_data, ., <span class="at">n_bootstrap =</span> <span class="dv">5</span>))</span>
<span id="cb29-64"><a href="#cb29-64" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-65"><a href="#cb29-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-66"><a href="#cb29-66" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stability_scores, <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> stability)) <span class="sc">+</span></span>
<span id="cb29-67"><a href="#cb29-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb29-68"><a href="#cb29-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb29-69"><a href="#cb29-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-70"><a href="#cb29-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Clustering Stability Analysis"</span>,</span>
<span id="cb29-71"><a href="#cb29-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Higher scores indicate more stable clusters"</span>,</span>
<span id="cb29-72"><a href="#cb29-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of Clusters"</span>,</span>
<span id="cb29-73"><a href="#cb29-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Adjusted Rand Index"</span></span>
<span id="cb29-74"><a href="#cb29-74" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="real-world-applications" class="level2">
<h2 class="anchored" data-anchor-id="real-world-applications">Real-World Applications</h2>
<section id="customer-segmentation" class="level3">
<h3 class="anchored" data-anchor-id="customer-segmentation">Customer Segmentation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate customer data</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>n_customers <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>customer_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">customer_id =</span> <span class="dv">1</span><span class="sc">:</span>n_customers,</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n_customers, <span class="dv">45</span>, <span class="dv">15</span>)),</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">income =</span> <span class="fu">round</span>(<span class="fu">rlnorm</span>(n_customers, <span class="dv">11</span>, <span class="fl">0.5</span>)),</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">spending_score =</span> <span class="fu">round</span>(<span class="fu">runif</span>(n_customers, <span class="dv">1</span>, <span class="dv">100</span>)),</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">purchase_frequency =</span> <span class="fu">rpois</span>(n_customers, <span class="at">lambda =</span> <span class="dv">5</span>),</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">avg_transaction =</span> <span class="fu">round</span>(<span class="fu">rlnorm</span>(n_customers, <span class="dv">4</span>, <span class="fl">0.5</span>)),</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">online_engagement =</span> <span class="fu">round</span>(<span class="fu">runif</span>(n_customers, <span class="dv">0</span>, <span class="dv">100</span>))</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">pmax</span>(<span class="dv">18</span>, <span class="fu">pmin</span>(<span class="dv">80</span>, age)),</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">income =</span> <span class="fu">pmax</span>(<span class="dv">20000</span>, <span class="fu">pmin</span>(<span class="dv">200000</span>, income))</span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocessing</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>customer_scaled <span class="ot">&lt;-</span> customer_data <span class="sc">%&gt;%</span></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>customer_id) <span class="sc">%&gt;%</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale</span>()</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Segment customers</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>customer_segments <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(customer_scaled, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Profile segments</span></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>customer_profiles <span class="ot">&lt;-</span> customer_data <span class="sc">%&gt;%</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">segment =</span> <span class="fu">factor</span>(customer_segments<span class="sc">$</span>cluster)) <span class="sc">%&gt;%</span></span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(segment) <span class="sc">%&gt;%</span></span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_age =</span> <span class="fu">mean</span>(age),</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_income =</span> <span class="fu">mean</span>(income),</span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_spending =</span> <span class="fu">mean</span>(spending_score),</span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_frequency =</span> <span class="fu">mean</span>(purchase_frequency),</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_transaction_value =</span> <span class="fu">mean</span>(avg_transaction),</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_engagement =</span> <span class="fu">mean</span>(online_engagement)</span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(customer_profiles, <span class="at">digits =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 13%">
<col style="width: 14%">
<col style="width: 22%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">segment</th>
<th style="text-align: right;">count</th>
<th style="text-align: right;">avg_age</th>
<th style="text-align: right;">avg_income</th>
<th style="text-align: right;">avg_spending</th>
<th style="text-align: right;">avg_frequency</th>
<th style="text-align: right;">avg_transaction_value</th>
<th style="text-align: right;">avg_engagement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">1</td>
<td style="text-align: right;">170</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">123792</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">42</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: right;">349</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">57856</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">51</td>
</tr>
<tr class="odd">
<td style="text-align: left;">3</td>
<td style="text-align: right;">131</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">63800</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">51</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: right;">350</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">55388</td>
<td style="text-align: right;">74</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">50</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize segments</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>customer_pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(customer_scaled)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>customer_viz <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(customer_pca<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">segment =</span> <span class="fu">factor</span>(customer_segments<span class="sc">$</span>cluster))</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(customer_viz, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> segment)) <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.95</span>) <span class="sc">+</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Customer Segments"</span>,</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Four distinct customer groups identified"</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Segment characteristics</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>segment_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"High-Value Engaged"</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Young Browsers"</span>,</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Loyal Regulars"</span>,</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Occasional Shoppers"</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>customer_profiles <span class="sc">%&gt;%</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">segment_name =</span> segment_names[<span class="fu">as.character</span>(segment)]) <span class="sc">%&gt;%</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(segment_name, <span class="fu">everything</span>(), <span class="sc">-</span>segment) <span class="sc">%&gt;%</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 18%">
<col style="width: 5%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 12%">
<col style="width: 20%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">segment_name</th>
<th style="text-align: right;">count</th>
<th style="text-align: right;">avg_age</th>
<th style="text-align: right;">avg_income</th>
<th style="text-align: right;">avg_spending</th>
<th style="text-align: right;">avg_frequency</th>
<th style="text-align: right;">avg_transaction_value</th>
<th style="text-align: right;">avg_engagement</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">High-Value Engaged</td>
<td style="text-align: right;">170</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">123792</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">55</td>
<td style="text-align: right;">42</td>
</tr>
<tr class="even">
<td style="text-align: left;">Young Browsers</td>
<td style="text-align: right;">349</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">57856</td>
<td style="text-align: right;">24</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">51</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Loyal Regulars</td>
<td style="text-align: right;">131</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">63800</td>
<td style="text-align: right;">50</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">122</td>
<td style="text-align: right;">51</td>
</tr>
<tr class="even">
<td style="text-align: left;">Occasional Shoppers</td>
<td style="text-align: right;">350</td>
<td style="text-align: right;">41</td>
<td style="text-align: right;">55388</td>
<td style="text-align: right;">74</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">50</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="best-practices" class="level2">
<h2 class="anchored" data-anchor-id="best-practices">Best Practices</h2>
<section id="data-preprocessing-is-critical" class="level3">
<h3 class="anchored" data-anchor-id="data-preprocessing-is-critical">1. Data Preprocessing is Critical</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate importance of scaling</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>unscaled_clusters <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(clustering_data, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>scaled_clusters <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(scaled_data, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare results</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>comparison_data <span class="ot">&lt;-</span> clustering_data <span class="sc">%&gt;%</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">unscaled =</span> <span class="fu">factor</span>(unscaled_clusters<span class="sc">$</span>cluster),</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">scaled =</span> <span class="fu">factor</span>(scaled_clusters<span class="sc">$</span>cluster)</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparison_data, <span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Year_Built, </span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">color =</span> unscaled)) <span class="sc">+</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Unscaled Data Clustering"</span>)</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparison_data, <span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Year_Built, </span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">color =</span> scaled)) <span class="sc">+</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Scaled Data Clustering"</span>)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="choose-the-right-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="choose-the-right-algorithm">2. Choose the Right Algorithm</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>algorithm_guide <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Scenario =</span> <span class="fu">c</span>(</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Spherical, similar-sized clusters"</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Unknown number of clusters"</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Non-spherical clusters"</span>,</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Outliers present"</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Hierarchical structure"</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Large datasets"</span>,</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mixed data types"</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Recommended Algorithm</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"K-means"</span>,</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Hierarchical or DBSCAN"</span>,</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DBSCAN or Spectral"</span>,</span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DBSCAN or Robust K-means"</span>,</span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Hierarchical clustering"</span>,</span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mini-batch K-means"</span>,</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"K-prototypes or Gower distance"</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(algorithm_guide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Scenario</th>
<th style="text-align: left;">Recommended Algorithm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Spherical, similar-sized clusters</td>
<td style="text-align: left;">K-means</td>
</tr>
<tr class="even">
<td style="text-align: left;">Unknown number of clusters</td>
<td style="text-align: left;">Hierarchical or DBSCAN</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Non-spherical clusters</td>
<td style="text-align: left;">DBSCAN or Spectral</td>
</tr>
<tr class="even">
<td style="text-align: left;">Outliers present</td>
<td style="text-align: left;">DBSCAN or Robust K-means</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hierarchical structure</td>
<td style="text-align: left;">Hierarchical clustering</td>
</tr>
<tr class="even">
<td style="text-align: left;">Large datasets</td>
<td style="text-align: left;">Mini-batch K-means</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Mixed data types</td>
<td style="text-align: left;">K-prototypes or Gower distance</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<section id="exercise-1-implement-custom-distance-metric" class="level3">
<h3 class="anchored" data-anchor-id="exercise-1-implement-custom-distance-metric">Exercise 1: Implement Custom Distance Metric</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom distance for mixed data types</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>gower_distance <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gower distance handles mixed types</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(cluster)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create mixed type data</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  mixed_data <span class="ot">&lt;-</span> ames <span class="sc">%&gt;%</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Gr_Liv_Area, Lot_Area, Neighborhood, Central_Air) <span class="sc">%&gt;%</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate Gower distance</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  gower_dist <span class="ot">&lt;-</span> <span class="fu">daisy</span>(mixed_data, <span class="at">metric =</span> <span class="st">"gower"</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform clustering</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>  gower_clusters <span class="ot">&lt;-</span> <span class="fu">hclust</span>(gower_dist, <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cut tree</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>  clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(gower_clusters, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Visualize</span></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>  mixed_data <span class="sc">%&gt;%</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">factor</span>(clusters)) <span class="sc">%&gt;%</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Lot_Area, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Neighborhood) <span class="sc">+</span></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Clustering with Gower Distance"</span>)</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a><span class="fu">gower_distance</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exercise-2-ensemble-clustering" class="level3">
<h3 class="anchored" data-anchor-id="exercise-2-ensemble-clustering">Exercise 2: Ensemble Clustering</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine multiple clustering results</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>ensemble_clustering <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">k =</span> <span class="dv">4</span>) {</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Multiple clustering algorithms</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>cluster</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>  hc <span class="ot">&lt;-</span> <span class="fu">cutree</span>(<span class="fu">hclust</span>(<span class="fu">dist</span>(data), <span class="at">method =</span> <span class="st">"ward.D2"</span>), <span class="at">k =</span> k)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create co-association matrix</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  co_assoc <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n, n)</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># K-means contribution</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (km[i] <span class="sc">==</span> km[j]) co_assoc[i, j] <span class="ot">&lt;-</span> co_assoc[i, j] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Hierarchical contribution</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (hc[i] <span class="sc">==</span> hc[j]) co_assoc[i, j] <span class="ot">&lt;-</span> co_assoc[i, j] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average co-association</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  co_assoc <span class="ot">&lt;-</span> co_assoc <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Final clustering on co-association matrix</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>  final_dist <span class="ot">&lt;-</span> <span class="fu">as.dist</span>(<span class="dv">1</span> <span class="sc">-</span> co_assoc)</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  final_clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(<span class="fu">hclust</span>(final_dist, <span class="at">method =</span> <span class="st">"average"</span>), <span class="at">k =</span> k)</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(final_clusters)</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply ensemble clustering</span></span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>ensemble_result <span class="ot">&lt;-</span> <span class="fu">ensemble_clustering</span>(scaled_data[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, ])</span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>pca_subset <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pca_result<span class="sc">$</span>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ensemble =</span> <span class="fu">factor</span>(ensemble_result))</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pca_subset, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> ensemble)) <span class="sc">+</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Ensemble Clustering Result"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="17-unsupervised-learning_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="exercise-3-clustering-interpretation" class="level3">
<h3 class="anchored" data-anchor-id="exercise-3-clustering-interpretation">Exercise 3: Clustering Interpretation</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Automated cluster interpretation</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>interpret_clusters <span class="ot">&lt;-</span> <span class="cf">function</span>(data, clusters) {</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  clustered <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">factor</span>(clusters))</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Statistical tests for each variable</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  interpretation <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="fu">names</span>(data), <span class="cf">function</span>(var) {</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ANOVA for continuous variables</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>    formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(var, <span class="st">"~ cluster"</span>))</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>    aov_result <span class="ot">&lt;-</span> <span class="fu">aov</span>(formula, <span class="at">data =</span> clustered)</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">variable =</span> var,</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">f_statistic =</span> <span class="fu">summary</span>(aov_result)[[<span class="dv">1</span>]][[<span class="st">"F value"</span>]][<span class="dv">1</span>],</span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value =</span> <span class="fu">summary</span>(aov_result)[[<span class="dv">1</span>]][[<span class="st">"Pr(&gt;F)"</span>]][<span class="dv">1</span>],</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">importance =</span> <span class="fu">if_else</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"High"</span>,</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">if_else</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"Medium"</span>, <span class="st">"Low"</span>))</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Characteristic values per cluster</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  characteristics <span class="ot">&lt;-</span> clustered <span class="sc">%&gt;%</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), </span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">list</span>(<span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sd =</span> <span class="sc">~</span><span class="fu">sd</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))))</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">importance =</span> interpretation <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(p_value),</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">characteristics =</span> characteristics</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-34"><a href="#cb37-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-35"><a href="#cb37-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to our clustering</span></span>
<span id="cb37-36"><a href="#cb37-36" aria-hidden="true" tabindex="-1"></a>interpretation <span class="ot">&lt;-</span> <span class="fu">interpret_clusters</span>(clustering_data, km_result<span class="sc">$</span>cluster)</span>
<span id="cb37-37"><a href="#cb37-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-38"><a href="#cb37-38" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variable Importance for Clustering:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variable Importance for Clustering:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(interpretation<span class="sc">$</span>importance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 Ã— 4
  variable      f_statistic   p_value importance
  &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;     
1 Lot_Area             260. 2.25e-101 High      
2 Year_Built           258. 8.56e-101 High      
3 Garage_Area          184. 4.44e- 80 High      
4 Gr_Liv_Area          115. 1.81e- 56 High      
5 Total_Bsmt_SF        112. 3.43e- 55 High      </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Cluster Characteristics:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Cluster Characteristics:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(interpretation<span class="sc">$</span>characteristics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 Ã— 11
  cluster Gr_Liv_Area_mean Gr_Liv_Area_sd Lot_Area_mean Lot_Area_sd
  &lt;fct&gt;              &lt;dbl&gt;          &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;
1 1                  2513.           925.        56046.      24670.
2 2                  1296.           409.         8466.       3142.
3 3                  1397.           307.         9414.       4132.
4 4                  2147.           466.        13104.       4393.
# â„¹ 6 more variables: Year_Built_mean &lt;dbl&gt;, Year_Built_sd &lt;dbl&gt;,
#   Total_Bsmt_SF_mean &lt;dbl&gt;, Total_Bsmt_SF_sd &lt;dbl&gt;, Garage_Area_mean &lt;dbl&gt;,
#   Garage_Area_sd &lt;dbl&gt;</code></pre>
</div>
</div>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>In this comprehensive chapter, youâ€™ve mastered:</p>
<p>âœ… <strong>Clustering algorithms</strong> - K-means for spherical clusters - Hierarchical for nested structure - DBSCAN for arbitrary shapes - Evaluation metrics</p>
<p>âœ… <strong>Dimensionality reduction</strong> - PCA for linear reduction - t-SNE/UMAP for non-linear - Interpretation of components - Visualization techniques</p>
<p>âœ… <strong>Anomaly detection</strong> - Statistical methods - Isolation forests - Local outlier factor - Ensemble approaches</p>
<p>âœ… <strong>Association analysis</strong> - Market basket analysis - Rule mining - Lift and confidence metrics</p>
<p>âœ… <strong>Practical applications</strong> - Customer segmentation - Data preprocessing importance - Algorithm selection - Evaluation strategies</p>
<p>Key takeaways: - Unsupervised learning finds structure without labels - Preprocessing (especially scaling) is crucial - No single best algorithm - depends on data structure - Validation is challenging but essential - Combine multiple methods for robustness - Visualization aids interpretation</p>
</section>
<section id="whats-next" class="level2">
<h2 class="anchored" data-anchor-id="whats-next">Whatâ€™s Next?</h2>
<p>In <a href="./18-model-deployment.html">Chapter 18</a>, weâ€™ll learn how to deploy models to production.</p>
</section>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<ul>
<li><a href="https://www.statlearning.com/">Introduction to Statistical Learning - Chapter 12</a></li>
<li><a href="https://hastie.su.domains/ElemStatLearn/">Elements of Statistical Learning - Chapter 14</a></li>
<li><a href="https://www.wiley.com/en-us/Cluster+Analysis%2C+5th+Edition-p-9780470749913">Cluster Analysis Book</a></li>
<li><a href="https://link.springer.com/article/10.1007/s40745-015-0040-1">Survey of Clustering Algorithms</a></li>
</ul>


<!-- -->

</section>

</main> <!-- /main -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Find all elements with class 'quarto-title-meta-heading' that contain "Author"
    const authorHeadings = document.querySelectorAll('.quarto-title-meta-heading');
    
    authorHeadings.forEach(function(heading) {
        if (heading.textContent.trim() === 'Author') {
            heading.textContent = 'Authors';
        }
    });
});
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "î§‹";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb45" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Chapter 17: Unsupervised Learning - Discovering Hidden Patterns"</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> "David Sarrat GonzÃ¡lez, Juan R GonzÃ¡lez"</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> today</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: false</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="fu">## Learning Objectives</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>By the end of this chapter, you will master:</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>The fundamentals of unsupervised learning</span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Clustering algorithms (K-means, hierarchical, DBSCAN)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Dimensionality reduction (PCA, t-SNE, UMAP)</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Anomaly detection techniques</span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Market basket analysis and association rules</span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Practical implementation with tidymodels</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Evaluating unsupervised models</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Real-world applications</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip}</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="fu">## Download R Script</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>You can download the complete R code for this chapter:</span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">ðŸ“¥ Download 17-unsupervised-learning.R</span><span class="co">](R_scripts/17-unsupervised-learning.R)</span>{.btn .btn-primary download="17-unsupervised-learning.R"}</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="fu">## The Art of Finding Structure Without Labels</span></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>Imagine you're an explorer discovering a new continent. You have no map, no guide, just raw observations. Your task is to identify natural groupings - mountain ranges, river systems, ecosystems. This is the essence of unsupervised learning: finding structure in data without predefined categories.</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a>Unlike supervised learning where we have labels to guide us, unsupervised learning must discover patterns purely from the data itself. This makes it both challenging and powerful - we can uncover insights we didn't even know to look for.</span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyclust)  <span class="co"># For clustering with tidymodels</span></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cluster)    <span class="co"># For clustering algorithms</span></span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(factoextra) <span class="co"># For visualization</span></span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dendextend) <span class="co"># For dendrograms</span></span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbscan)     <span class="co"># For DBSCAN</span></span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)  <span class="co"># For PCA plots</span></span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)     <span class="co"># For 3D visualizations</span></span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)   <span class="co"># For correlation plots</span></span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Set theme and seed</span></span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_minimal</span>())</span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(ames)</span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for unsupervised learning</span></span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a>ames_numeric <span class="ot">&lt;-</span> ames <span class="sc">%&gt;%</span></span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span></span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Sale_Price) <span class="sc">%&gt;%</span>  <span class="co"># Remove target for unsupervised learning</span></span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">500</span>)  <span class="co"># Sample for computational efficiency</span></span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a><span class="fu">## Clustering: Finding Natural Groups</span></span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a><span class="fu">### K-Means Clustering</span></span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a>K-means is the workhorse of clustering algorithms. It partitions data into K clusters by minimizing within-cluster variance:</span>
<span id="cb45-71"><a href="#cb45-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-74"><a href="#cb45-74" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-75"><a href="#cb45-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Prepare data for clustering</span></span>
<span id="cb45-76"><a href="#cb45-76" aria-hidden="true" tabindex="-1"></a>clustering_data <span class="ot">&lt;-</span> ames_numeric <span class="sc">%&gt;%</span></span>
<span id="cb45-77"><a href="#cb45-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Gr_Liv_Area, Lot_Area, Year_Built, Total_Bsmt_SF, Garage_Area)</span>
<span id="cb45-78"><a href="#cb45-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-79"><a href="#cb45-79" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale the data (crucial for distance-based methods!)</span></span>
<span id="cb45-80"><a href="#cb45-80" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="ot">&lt;-</span> <span class="fu">scale</span>(clustering_data)</span>
<span id="cb45-81"><a href="#cb45-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-82"><a href="#cb45-82" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine optimal number of clusters using elbow method</span></span>
<span id="cb45-83"><a href="#cb45-83" aria-hidden="true" tabindex="-1"></a>wss <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(k) {</span>
<span id="cb45-84"><a href="#cb45-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kmeans</span>(scaled_data, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>tot.withinss</span>
<span id="cb45-85"><a href="#cb45-85" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb45-86"><a href="#cb45-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-87"><a href="#cb45-87" aria-hidden="true" tabindex="-1"></a>elbow_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">wss =</span> wss)</span>
<span id="cb45-88"><a href="#cb45-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-89"><a href="#cb45-89" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(elbow_data, <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> wss)) <span class="sc">+</span></span>
<span id="cb45-90"><a href="#cb45-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb45-91"><a href="#cb45-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb45-92"><a href="#cb45-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="dv">4</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb45-93"><a href="#cb45-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-94"><a href="#cb45-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Elbow Method for Optimal K"</span>,</span>
<span id="cb45-95"><a href="#cb45-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Look for the 'elbow' where WSS decrease slows"</span>,</span>
<span id="cb45-96"><a href="#cb45-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of Clusters (k)"</span>,</span>
<span id="cb45-97"><a href="#cb45-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Total Within-Cluster Sum of Squares"</span></span>
<span id="cb45-98"><a href="#cb45-98" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-99"><a href="#cb45-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-100"><a href="#cb45-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Silhouette analysis for cluster validation</span></span>
<span id="cb45-101"><a href="#cb45-101" aria-hidden="true" tabindex="-1"></a>silhouette_scores <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>, <span class="cf">function</span>(k) {</span>
<span id="cb45-102"><a href="#cb45-102" aria-hidden="true" tabindex="-1"></a>  km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(scaled_data, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb45-103"><a href="#cb45-103" aria-hidden="true" tabindex="-1"></a>  ss <span class="ot">&lt;-</span> <span class="fu">silhouette</span>(km<span class="sc">$</span>cluster, <span class="fu">dist</span>(scaled_data))</span>
<span id="cb45-104"><a href="#cb45-104" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(ss[, <span class="dv">3</span>])</span>
<span id="cb45-105"><a href="#cb45-105" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb45-106"><a href="#cb45-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-107"><a href="#cb45-107" aria-hidden="true" tabindex="-1"></a>silhouette_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">k =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">silhouette =</span> silhouette_scores)</span>
<span id="cb45-108"><a href="#cb45-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-109"><a href="#cb45-109" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(silhouette_data, <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> silhouette)) <span class="sc">+</span></span>
<span id="cb45-110"><a href="#cb45-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb45-111"><a href="#cb45-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb45-112"><a href="#cb45-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">which.max</span>(silhouette_scores) <span class="sc">+</span> <span class="dv">1</span>, </span>
<span id="cb45-113"><a href="#cb45-113" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb45-114"><a href="#cb45-114" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-115"><a href="#cb45-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Silhouette Analysis"</span>,</span>
<span id="cb45-116"><a href="#cb45-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Higher values indicate better-defined clusters"</span>,</span>
<span id="cb45-117"><a href="#cb45-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of Clusters (k)"</span>,</span>
<span id="cb45-118"><a href="#cb45-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Silhouette Score"</span></span>
<span id="cb45-119"><a href="#cb45-119" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-120"><a href="#cb45-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-121"><a href="#cb45-121" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform K-means with optimal k=4</span></span>
<span id="cb45-122"><a href="#cb45-122" aria-hidden="true" tabindex="-1"></a>km_result <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(scaled_data, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb45-123"><a href="#cb45-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-124"><a href="#cb45-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Add cluster assignments back to data</span></span>
<span id="cb45-125"><a href="#cb45-125" aria-hidden="true" tabindex="-1"></a>clustered_data <span class="ot">&lt;-</span> clustering_data <span class="sc">%&gt;%</span></span>
<span id="cb45-126"><a href="#cb45-126" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">factor</span>(km_result<span class="sc">$</span>cluster))</span>
<span id="cb45-127"><a href="#cb45-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-128"><a href="#cb45-128" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize clusters</span></span>
<span id="cb45-129"><a href="#cb45-129" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(clustered_data, <span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Lot_Area, </span>
<span id="cb45-130"><a href="#cb45-130" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb45-131"><a href="#cb45-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb45-132"><a href="#cb45-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Clusters: Living Area vs Quality"</span>)</span>
<span id="cb45-133"><a href="#cb45-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-134"><a href="#cb45-134" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(clustered_data, <span class="fu">aes</span>(<span class="at">x =</span> Year_Built, <span class="at">y =</span> Total_Bsmt_SF, </span>
<span id="cb45-135"><a href="#cb45-135" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb45-136"><a href="#cb45-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb45-137"><a href="#cb45-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Clusters: Year vs Basement"</span>)</span>
<span id="cb45-138"><a href="#cb45-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-139"><a href="#cb45-139" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb45-140"><a href="#cb45-140" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span>
<span id="cb45-141"><a href="#cb45-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-142"><a href="#cb45-142" aria-hidden="true" tabindex="-1"></a><span class="co"># Cluster characteristics</span></span>
<span id="cb45-143"><a href="#cb45-143" aria-hidden="true" tabindex="-1"></a>cluster_profiles <span class="ot">&lt;-</span> clustered_data <span class="sc">%&gt;%</span></span>
<span id="cb45-144"><a href="#cb45-144" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb45-145"><a href="#cb45-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="fu">list</span>(<span class="at">mean =</span> mean, <span class="at">sd =</span> sd)), </span>
<span id="cb45-146"><a href="#cb45-146" aria-hidden="true" tabindex="-1"></a>            <span class="at">count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb45-147"><a href="#cb45-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(cluster, count),</span>
<span id="cb45-148"><a href="#cb45-148" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to =</span> <span class="fu">c</span>(<span class="st">"variable"</span>, <span class="st">"stat"</span>),</span>
<span id="cb45-149"><a href="#cb45-149" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_sep =</span> <span class="st">"_(?=mean|sd)"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-150"><a href="#cb45-150" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> stat, <span class="at">values_from =</span> value)</span>
<span id="cb45-151"><a href="#cb45-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-152"><a href="#cb45-152" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(cluster_profiles, <span class="at">digits =</span> <span class="dv">2</span>)</span>
<span id="cb45-153"><a href="#cb45-153" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-154"><a href="#cb45-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-155"><a href="#cb45-155" aria-hidden="true" tabindex="-1"></a>The mathematics of K-means:</span>
<span id="cb45-156"><a href="#cb45-156" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Objective**: Minimize $\sum_{i=1}^{k} \sum_{x \in C_i} ||x - \mu_i||^2$</span>
<span id="cb45-157"><a href="#cb45-157" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Algorithm**: Iteratively assign points and update centroids</span>
<span id="cb45-158"><a href="#cb45-158" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Assumptions**: Spherical clusters, similar sizes, similar densities</span>
<span id="cb45-159"><a href="#cb45-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-160"><a href="#cb45-160" aria-hidden="true" tabindex="-1"></a><span class="fu">### Hierarchical Clustering</span></span>
<span id="cb45-161"><a href="#cb45-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-162"><a href="#cb45-162" aria-hidden="true" tabindex="-1"></a>Hierarchical clustering builds a tree of clusters, allowing exploration at different granularities:</span>
<span id="cb45-163"><a href="#cb45-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-166"><a href="#cb45-166" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-167"><a href="#cb45-167" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate distance matrix</span></span>
<span id="cb45-168"><a href="#cb45-168" aria-hidden="true" tabindex="-1"></a>dist_matrix <span class="ot">&lt;-</span> <span class="fu">dist</span>(scaled_data, <span class="at">method =</span> <span class="st">"euclidean"</span>)</span>
<span id="cb45-169"><a href="#cb45-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-170"><a href="#cb45-170" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform hierarchical clustering with different linkage methods</span></span>
<span id="cb45-171"><a href="#cb45-171" aria-hidden="true" tabindex="-1"></a>hc_complete <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_matrix, <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb45-172"><a href="#cb45-172" aria-hidden="true" tabindex="-1"></a>hc_average <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_matrix, <span class="at">method =</span> <span class="st">"average"</span>)</span>
<span id="cb45-173"><a href="#cb45-173" aria-hidden="true" tabindex="-1"></a>hc_ward <span class="ot">&lt;-</span> <span class="fu">hclust</span>(dist_matrix, <span class="at">method =</span> <span class="st">"ward.D2"</span>)</span>
<span id="cb45-174"><a href="#cb45-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-175"><a href="#cb45-175" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare dendrograms</span></span>
<span id="cb45-176"><a href="#cb45-176" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb45-177"><a href="#cb45-177" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_complete, <span class="at">main =</span> <span class="st">"Complete Linkage"</span>, <span class="at">labels =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb45-178"><a href="#cb45-178" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_average, <span class="at">main =</span> <span class="st">"Average Linkage"</span>, <span class="at">labels =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb45-179"><a href="#cb45-179" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hc_ward, <span class="at">main =</span> <span class="st">"Ward's Method"</span>, <span class="at">labels =</span> <span class="cn">FALSE</span>, <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb45-180"><a href="#cb45-180" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb45-181"><a href="#cb45-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-182"><a href="#cb45-182" aria-hidden="true" tabindex="-1"></a><span class="co"># Use Ward's method (often gives best results)</span></span>
<span id="cb45-183"><a href="#cb45-183" aria-hidden="true" tabindex="-1"></a>hc_clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(hc_ward, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb45-184"><a href="#cb45-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-185"><a href="#cb45-185" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a prettier dendrogram</span></span>
<span id="cb45-186"><a href="#cb45-186" aria-hidden="true" tabindex="-1"></a>dend <span class="ot">&lt;-</span> <span class="fu">as.dendrogram</span>(hc_ward)</span>
<span id="cb45-187"><a href="#cb45-187" aria-hidden="true" tabindex="-1"></a>dend <span class="ot">&lt;-</span> <span class="fu">color_branches</span>(dend, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb45-188"><a href="#cb45-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-189"><a href="#cb45-189" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dend, <span class="at">main =</span> <span class="st">"Hierarchical Clustering Dendrogram"</span>,</span>
<span id="cb45-190"><a href="#cb45-190" aria-hidden="true" tabindex="-1"></a>     <span class="at">leaflab =</span> <span class="st">"none"</span>, <span class="at">ylab =</span> <span class="st">"Height"</span>)</span>
<span id="cb45-191"><a href="#cb45-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-192"><a href="#cb45-192" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare with K-means</span></span>
<span id="cb45-193"><a href="#cb45-193" aria-hidden="true" tabindex="-1"></a>clustering_comparison <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb45-194"><a href="#cb45-194" aria-hidden="true" tabindex="-1"></a>  <span class="at">kmeans =</span> km_result<span class="sc">$</span>cluster,</span>
<span id="cb45-195"><a href="#cb45-195" aria-hidden="true" tabindex="-1"></a>  <span class="at">hierarchical =</span> hc_clusters</span>
<span id="cb45-196"><a href="#cb45-196" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-197"><a href="#cb45-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-198"><a href="#cb45-198" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrix between methods</span></span>
<span id="cb45-199"><a href="#cb45-199" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(clustering_comparison<span class="sc">$</span>kmeans, clustering_comparison<span class="sc">$</span>hierarchical)</span>
<span id="cb45-200"><a href="#cb45-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-201"><a href="#cb45-201" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize both clustering results</span></span>
<span id="cb45-202"><a href="#cb45-202" aria-hidden="true" tabindex="-1"></a>comparison_data <span class="ot">&lt;-</span> clustering_data <span class="sc">%&gt;%</span></span>
<span id="cb45-203"><a href="#cb45-203" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-204"><a href="#cb45-204" aria-hidden="true" tabindex="-1"></a>    <span class="at">kmeans =</span> <span class="fu">factor</span>(km_result<span class="sc">$</span>cluster),</span>
<span id="cb45-205"><a href="#cb45-205" aria-hidden="true" tabindex="-1"></a>    <span class="at">hierarchical =</span> <span class="fu">factor</span>(hc_clusters)</span>
<span id="cb45-206"><a href="#cb45-206" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-207"><a href="#cb45-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-208"><a href="#cb45-208" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparison_data, <span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Lot_Area, </span>
<span id="cb45-209"><a href="#cb45-209" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">color =</span> kmeans)) <span class="sc">+</span></span>
<span id="cb45-210"><a href="#cb45-210" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-211"><a href="#cb45-211" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"K-Means Clustering"</span>)</span>
<span id="cb45-212"><a href="#cb45-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-213"><a href="#cb45-213" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparison_data, <span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Lot_Area, </span>
<span id="cb45-214"><a href="#cb45-214" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">color =</span> hierarchical)) <span class="sc">+</span></span>
<span id="cb45-215"><a href="#cb45-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-216"><a href="#cb45-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Hierarchical Clustering"</span>)</span>
<span id="cb45-217"><a href="#cb45-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-218"><a href="#cb45-218" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span>
<span id="cb45-219"><a href="#cb45-219" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-220"><a href="#cb45-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-221"><a href="#cb45-221" aria-hidden="true" tabindex="-1"></a><span class="fu">### DBSCAN: Density-Based Clustering</span></span>
<span id="cb45-222"><a href="#cb45-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-223"><a href="#cb45-223" aria-hidden="true" tabindex="-1"></a>DBSCAN finds clusters of arbitrary shape and identifies outliers:</span>
<span id="cb45-224"><a href="#cb45-224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-227"><a href="#cb45-227" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-228"><a href="#cb45-228" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data with non-spherical clusters</span></span>
<span id="cb45-229"><a href="#cb45-229" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb45-230"><a href="#cb45-230" aria-hidden="true" tabindex="-1"></a>moon_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb45-231"><a href="#cb45-231" aria-hidden="true" tabindex="-1"></a>  <span class="co"># First crescent</span></span>
<span id="cb45-232"><a href="#cb45-232" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb45-233"><a href="#cb45-233" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">cos</span>(<span class="fu">seq</span>(<span class="dv">0</span>, pi, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb45-234"><a href="#cb45-234" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">sin</span>(<span class="fu">seq</span>(<span class="dv">0</span>, pi, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb45-235"><a href="#cb45-235" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_cluster =</span> <span class="dv">1</span></span>
<span id="cb45-236"><a href="#cb45-236" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb45-237"><a href="#cb45-237" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Second crescent (shifted and flipped)</span></span>
<span id="cb45-238"><a href="#cb45-238" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb45-239"><a href="#cb45-239" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">cos</span>(<span class="fu">seq</span>(<span class="dv">0</span>, pi, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb45-240"><a href="#cb45-240" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="sc">-</span><span class="fl">0.5</span> <span class="sc">-</span> <span class="fu">sin</span>(<span class="fu">seq</span>(<span class="dv">0</span>, pi, <span class="at">length.out =</span> <span class="dv">100</span>)) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="at">sd =</span> <span class="fl">0.1</span>),</span>
<span id="cb45-241"><a href="#cb45-241" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_cluster =</span> <span class="dv">2</span></span>
<span id="cb45-242"><a href="#cb45-242" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb45-243"><a href="#cb45-243" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Noise points</span></span>
<span id="cb45-244"><a href="#cb45-244" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb45-245"><a href="#cb45-245" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">runif</span>(<span class="dv">20</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb45-246"><a href="#cb45-246" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">runif</span>(<span class="dv">20</span>, <span class="sc">-</span><span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb45-247"><a href="#cb45-247" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_cluster =</span> <span class="dv">0</span></span>
<span id="cb45-248"><a href="#cb45-248" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-249"><a href="#cb45-249" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-250"><a href="#cb45-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-251"><a href="#cb45-251" aria-hidden="true" tabindex="-1"></a><span class="co"># Try K-means (will fail on non-spherical clusters)</span></span>
<span id="cb45-252"><a href="#cb45-252" aria-hidden="true" tabindex="-1"></a>km_moon <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(moon_data[, <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)], <span class="at">centers =</span> <span class="dv">2</span>)</span>
<span id="cb45-253"><a href="#cb45-253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-254"><a href="#cb45-254" aria-hidden="true" tabindex="-1"></a><span class="co"># DBSCAN</span></span>
<span id="cb45-255"><a href="#cb45-255" aria-hidden="true" tabindex="-1"></a>db_result <span class="ot">&lt;-</span> <span class="fu">dbscan</span>(moon_data[, <span class="fu">c</span>(<span class="st">"x"</span>, <span class="st">"y"</span>)], <span class="at">eps =</span> <span class="fl">0.3</span>, <span class="at">minPts =</span> <span class="dv">5</span>)</span>
<span id="cb45-256"><a href="#cb45-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-257"><a href="#cb45-257" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare results</span></span>
<span id="cb45-258"><a href="#cb45-258" aria-hidden="true" tabindex="-1"></a>moon_results <span class="ot">&lt;-</span> moon_data <span class="sc">%&gt;%</span></span>
<span id="cb45-259"><a href="#cb45-259" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-260"><a href="#cb45-260" aria-hidden="true" tabindex="-1"></a>    <span class="at">kmeans =</span> <span class="fu">factor</span>(km_moon<span class="sc">$</span>cluster),</span>
<span id="cb45-261"><a href="#cb45-261" aria-hidden="true" tabindex="-1"></a>    <span class="at">dbscan =</span> <span class="fu">factor</span>(db_result<span class="sc">$</span>cluster)</span>
<span id="cb45-262"><a href="#cb45-262" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-263"><a href="#cb45-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-264"><a href="#cb45-264" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(moon_results, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> <span class="fu">factor</span>(true_cluster))) <span class="sc">+</span></span>
<span id="cb45-265"><a href="#cb45-265" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-266"><a href="#cb45-266" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"True Clusters"</span>, <span class="at">color =</span> <span class="st">"Cluster"</span>) <span class="sc">+</span></span>
<span id="cb45-267"><a href="#cb45-267" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"gray"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"red"</span>))</span>
<span id="cb45-268"><a href="#cb45-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-269"><a href="#cb45-269" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(moon_results, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> kmeans)) <span class="sc">+</span></span>
<span id="cb45-270"><a href="#cb45-270" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-271"><a href="#cb45-271" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"K-Means Result"</span>, <span class="at">color =</span> <span class="st">"Cluster"</span>)</span>
<span id="cb45-272"><a href="#cb45-272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-273"><a href="#cb45-273" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(moon_results, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> dbscan)) <span class="sc">+</span></span>
<span id="cb45-274"><a href="#cb45-274" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-275"><a href="#cb45-275" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"DBSCAN Result"</span>, <span class="at">color =</span> <span class="st">"Cluster"</span>) <span class="sc">+</span></span>
<span id="cb45-276"><a href="#cb45-276" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"0"</span> <span class="ot">=</span> <span class="st">"gray"</span>, <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"blue"</span>, <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"red"</span>))</span>
<span id="cb45-277"><a href="#cb45-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-278"><a href="#cb45-278" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2 <span class="sc">+</span> p3</span>
<span id="cb45-279"><a href="#cb45-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-280"><a href="#cb45-280" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply DBSCAN to housing data</span></span>
<span id="cb45-281"><a href="#cb45-281" aria-hidden="true" tabindex="-1"></a><span class="co"># Find optimal eps using k-nearest neighbor distance</span></span>
<span id="cb45-282"><a href="#cb45-282" aria-hidden="true" tabindex="-1"></a>knn_dist <span class="ot">&lt;-</span> <span class="fu">kNNdist</span>(scaled_data, <span class="at">k =</span> <span class="dv">5</span>)</span>
<span id="cb45-283"><a href="#cb45-283" aria-hidden="true" tabindex="-1"></a>knn_dist_sorted <span class="ot">&lt;-</span> <span class="fu">sort</span>(knn_dist)</span>
<span id="cb45-284"><a href="#cb45-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-285"><a href="#cb45-285" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(knn_dist_sorted, <span class="at">type =</span> <span class="st">"l"</span>,</span>
<span id="cb45-286"><a href="#cb45-286" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"K-NN Distance Plot for eps Selection"</span>,</span>
<span id="cb45-287"><a href="#cb45-287" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"Points sorted by distance"</span>,</span>
<span id="cb45-288"><a href="#cb45-288" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab =</span> <span class="st">"5-NN Distance"</span>)</span>
<span id="cb45-289"><a href="#cb45-289" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="fl">1.5</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb45-290"><a href="#cb45-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-291"><a href="#cb45-291" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply DBSCAN</span></span>
<span id="cb45-292"><a href="#cb45-292" aria-hidden="true" tabindex="-1"></a>db_housing <span class="ot">&lt;-</span> <span class="fu">dbscan</span>(scaled_data, <span class="at">eps =</span> <span class="fl">1.5</span>, <span class="at">minPts =</span> <span class="dv">5</span>)</span>
<span id="cb45-293"><a href="#cb45-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-294"><a href="#cb45-294" aria-hidden="true" tabindex="-1"></a><span class="co"># Analyze results</span></span>
<span id="cb45-295"><a href="#cb45-295" aria-hidden="true" tabindex="-1"></a>dbscan_summary <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb45-296"><a href="#cb45-296" aria-hidden="true" tabindex="-1"></a>  <span class="at">cluster =</span> db_housing<span class="sc">$</span>cluster</span>
<span id="cb45-297"><a href="#cb45-297" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb45-298"><a href="#cb45-298" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb45-299"><a href="#cb45-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-300"><a href="#cb45-300" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="fu">if_else</span>(cluster <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"Noise"</span>, <span class="fu">paste</span>(<span class="st">"Cluster"</span>, cluster))</span>
<span id="cb45-301"><a href="#cb45-301" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-302"><a href="#cb45-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-303"><a href="#cb45-303" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(dbscan_summary)</span>
<span id="cb45-304"><a href="#cb45-304" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-305"><a href="#cb45-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-306"><a href="#cb45-306" aria-hidden="true" tabindex="-1"></a><span class="fu">## Dimensionality Reduction</span></span>
<span id="cb45-307"><a href="#cb45-307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-308"><a href="#cb45-308" aria-hidden="true" tabindex="-1"></a><span class="fu">### Principal Component Analysis (PCA)</span></span>
<span id="cb45-309"><a href="#cb45-309" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-310"><a href="#cb45-310" aria-hidden="true" tabindex="-1"></a>PCA finds the directions of maximum variance in high-dimensional data:</span>
<span id="cb45-311"><a href="#cb45-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-314"><a href="#cb45-314" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-315"><a href="#cb45-315" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform PCA</span></span>
<span id="cb45-316"><a href="#cb45-316" aria-hidden="true" tabindex="-1"></a>pca_result <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(scaled_data, <span class="at">center =</span> <span class="cn">FALSE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb45-317"><a href="#cb45-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-318"><a href="#cb45-318" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance explained</span></span>
<span id="cb45-319"><a href="#cb45-319" aria-hidden="true" tabindex="-1"></a>variance_explained <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb45-320"><a href="#cb45-320" aria-hidden="true" tabindex="-1"></a>  <span class="at">PC =</span> <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(pca_result<span class="sc">$</span>sdev)),</span>
<span id="cb45-321"><a href="#cb45-321" aria-hidden="true" tabindex="-1"></a>  <span class="at">var_explained =</span> pca_result<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="fu">sum</span>(pca_result<span class="sc">$</span>sdev<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb45-322"><a href="#cb45-322" aria-hidden="true" tabindex="-1"></a>  <span class="at">cumulative_var =</span> <span class="fu">cumsum</span>(var_explained)</span>
<span id="cb45-323"><a href="#cb45-323" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-324"><a href="#cb45-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-325"><a href="#cb45-325" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(variance_explained[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, ], <span class="fu">aes</span>(<span class="at">x =</span> PC, <span class="at">y =</span> var_explained)) <span class="sc">+</span></span>
<span id="cb45-326"><a href="#cb45-326" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill =</span> <span class="st">"steelblue"</span>) <span class="sc">+</span></span>
<span id="cb45-327"><a href="#cb45-327" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> cumulative_var, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb45-328"><a href="#cb45-328" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y =</span> cumulative_var), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb45-329"><a href="#cb45-329" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-330"><a href="#cb45-330" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"PCA: Variance Explained"</span>,</span>
<span id="cb45-331"><a href="#cb45-331" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Red line shows cumulative variance"</span>,</span>
<span id="cb45-332"><a href="#cb45-332" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Principal Component"</span>,</span>
<span id="cb45-333"><a href="#cb45-333" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion of Variance"</span></span>
<span id="cb45-334"><a href="#cb45-334" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb45-335"><a href="#cb45-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="sc">~</span>., <span class="at">name =</span> <span class="st">"Cumulative Variance"</span>))</span>
<span id="cb45-336"><a href="#cb45-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-337"><a href="#cb45-337" aria-hidden="true" tabindex="-1"></a><span class="co"># Biplot: variables and observations</span></span>
<span id="cb45-338"><a href="#cb45-338" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(pca_result, <span class="at">data =</span> clustered_data, <span class="at">colour =</span> <span class="st">'cluster'</span>,</span>
<span id="cb45-339"><a href="#cb45-339" aria-hidden="true" tabindex="-1"></a>         <span class="at">loadings =</span> <span class="cn">TRUE</span>, <span class="at">loadings.label =</span> <span class="cn">TRUE</span>,</span>
<span id="cb45-340"><a href="#cb45-340" aria-hidden="true" tabindex="-1"></a>         <span class="at">loadings.label.size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb45-341"><a href="#cb45-341" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"PCA Biplot with Clusters"</span>)</span>
<span id="cb45-342"><a href="#cb45-342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-343"><a href="#cb45-343" aria-hidden="true" tabindex="-1"></a><span class="co"># Interpret principal components</span></span>
<span id="cb45-344"><a href="#cb45-344" aria-hidden="true" tabindex="-1"></a>loadings <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pca_result<span class="sc">$</span>rotation[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>])</span>
<span id="cb45-345"><a href="#cb45-345" aria-hidden="true" tabindex="-1"></a>loadings<span class="sc">$</span>variable <span class="ot">&lt;-</span> <span class="fu">rownames</span>(loadings)</span>
<span id="cb45-346"><a href="#cb45-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-347"><a href="#cb45-347" aria-hidden="true" tabindex="-1"></a>loadings_long <span class="ot">&lt;-</span> loadings <span class="sc">%&gt;%</span></span>
<span id="cb45-348"><a href="#cb45-348" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> PC1<span class="sc">:</span>PC3, <span class="at">names_to =</span> <span class="st">"PC"</span>, <span class="at">values_to =</span> <span class="st">"loading"</span>)</span>
<span id="cb45-349"><a href="#cb45-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-350"><a href="#cb45-350" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(loadings_long, <span class="fu">aes</span>(<span class="at">x =</span> variable, <span class="at">y =</span> loading, <span class="at">fill =</span> variable)) <span class="sc">+</span></span>
<span id="cb45-351"><a href="#cb45-351" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb45-352"><a href="#cb45-352" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>PC) <span class="sc">+</span></span>
<span id="cb45-353"><a href="#cb45-353" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb45-354"><a href="#cb45-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-355"><a href="#cb45-355" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"PCA Loadings"</span>,</span>
<span id="cb45-356"><a href="#cb45-356" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Variable contributions to each principal component"</span>,</span>
<span id="cb45-357"><a href="#cb45-357" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Variable"</span>,</span>
<span id="cb45-358"><a href="#cb45-358" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Loading"</span></span>
<span id="cb45-359"><a href="#cb45-359" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb45-360"><a href="#cb45-360" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb45-361"><a href="#cb45-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-362"><a href="#cb45-362" aria-hidden="true" tabindex="-1"></a><span class="co"># Use PCA for visualization</span></span>
<span id="cb45-363"><a href="#cb45-363" aria-hidden="true" tabindex="-1"></a>pca_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pca_result<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb45-364"><a href="#cb45-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> clustered_data<span class="sc">$</span>cluster)</span>
<span id="cb45-365"><a href="#cb45-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-366"><a href="#cb45-366" aria-hidden="true" tabindex="-1"></a><span class="co"># 2D visualization</span></span>
<span id="cb45-367"><a href="#cb45-367" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pca_data, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb45-368"><a href="#cb45-368" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb45-369"><a href="#cb45-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.95</span>) <span class="sc">+</span></span>
<span id="cb45-370"><a href="#cb45-370" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-371"><a href="#cb45-371" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Clusters in PCA Space"</span>,</span>
<span id="cb45-372"><a href="#cb45-372" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"First two principal components"</span>,</span>
<span id="cb45-373"><a href="#cb45-373" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="fu">paste0</span>(<span class="st">"PC1 ("</span>, <span class="fu">round</span>(variance_explained<span class="sc">$</span>var_explained[<span class="dv">1</span>] <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%)"</span>),</span>
<span id="cb45-374"><a href="#cb45-374" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="fu">paste0</span>(<span class="st">"PC2 ("</span>, <span class="fu">round</span>(variance_explained<span class="sc">$</span>var_explained[<span class="dv">2</span>] <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>), <span class="st">"%)"</span>)</span>
<span id="cb45-375"><a href="#cb45-375" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-376"><a href="#cb45-376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-377"><a href="#cb45-377" aria-hidden="true" tabindex="-1"></a><span class="co"># 3D visualization with plotly</span></span>
<span id="cb45-378"><a href="#cb45-378" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(pca_data, <span class="at">x =</span> <span class="sc">~</span>PC1, <span class="at">y =</span> <span class="sc">~</span>PC2, <span class="at">z =</span> <span class="sc">~</span>PC3, <span class="at">color =</span> <span class="sc">~</span>cluster,</span>
<span id="cb45-379"><a href="#cb45-379" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"scatter3d"</span>, <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb45-380"><a href="#cb45-380" aria-hidden="true" tabindex="-1"></a>        <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-381"><a href="#cb45-381" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">title =</span> <span class="st">"3D PCA Visualization"</span>)</span>
<span id="cb45-382"><a href="#cb45-382" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-383"><a href="#cb45-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-384"><a href="#cb45-384" aria-hidden="true" tabindex="-1"></a>The mathematics of PCA:</span>
<span id="cb45-385"><a href="#cb45-385" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Objective**: Find orthogonal axes maximizing variance</span>
<span id="cb45-386"><a href="#cb45-386" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Method**: Eigendecomposition of covariance matrix</span>
<span id="cb45-387"><a href="#cb45-387" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Result**: Linear combinations of original variables</span>
<span id="cb45-388"><a href="#cb45-388" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>**Key insight**: Most variance often captured in few components</span>
<span id="cb45-389"><a href="#cb45-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-390"><a href="#cb45-390" aria-hidden="true" tabindex="-1"></a><span class="fu">### t-SNE and UMAP: Non-linear Dimensionality Reduction</span></span>
<span id="cb45-391"><a href="#cb45-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-392"><a href="#cb45-392" aria-hidden="true" tabindex="-1"></a>For complex, non-linear structures:</span>
<span id="cb45-393"><a href="#cb45-393" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-396"><a href="#cb45-396" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-397"><a href="#cb45-397" aria-hidden="true" tabindex="-1"></a><span class="co"># t-SNE (computationally intensive, using sample)</span></span>
<span id="cb45-398"><a href="#cb45-398" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rtsne)</span>
<span id="cb45-399"><a href="#cb45-399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-400"><a href="#cb45-400" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb45-401"><a href="#cb45-401" aria-hidden="true" tabindex="-1"></a>tsne_result <span class="ot">&lt;-</span> <span class="fu">Rtsne</span>(scaled_data[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>, ], <span class="at">dims =</span> <span class="dv">2</span>, <span class="at">perplexity =</span> <span class="dv">30</span>, </span>
<span id="cb45-402"><a href="#cb45-402" aria-hidden="true" tabindex="-1"></a>                     <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">max_iter =</span> <span class="dv">500</span>)</span>
<span id="cb45-403"><a href="#cb45-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-404"><a href="#cb45-404" aria-hidden="true" tabindex="-1"></a>tsne_data <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(tsne_result<span class="sc">$</span>Y) <span class="sc">%&gt;%</span></span>
<span id="cb45-405"><a href="#cb45-405" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"tSNE1"</span>, <span class="st">"tSNE2"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb45-406"><a href="#cb45-406" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> clustered_data<span class="sc">$</span>cluster[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>])</span>
<span id="cb45-407"><a href="#cb45-407" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-408"><a href="#cb45-408" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tsne_data, <span class="fu">aes</span>(<span class="at">x =</span> tSNE1, <span class="at">y =</span> tSNE2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb45-409"><a href="#cb45-409" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb45-410"><a href="#cb45-410" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-411"><a href="#cb45-411" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"t-SNE Visualization"</span>,</span>
<span id="cb45-412"><a href="#cb45-412" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Non-linear dimensionality reduction preserves local structure"</span></span>
<span id="cb45-413"><a href="#cb45-413" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-414"><a href="#cb45-414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-415"><a href="#cb45-415" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare PCA vs t-SNE</span></span>
<span id="cb45-416"><a href="#cb45-416" aria-hidden="true" tabindex="-1"></a>comparison <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb45-417"><a href="#cb45-417" aria-hidden="true" tabindex="-1"></a>  pca_data[<span class="dv">1</span><span class="sc">:</span><span class="dv">200</span>, <span class="fu">c</span>(<span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"cluster"</span>)] <span class="sc">%&gt;%</span></span>
<span id="cb45-418"><a href="#cb45-418" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"PCA"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-419"><a href="#cb45-419" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Dim1 =</span> PC1, <span class="at">Dim2 =</span> PC2),</span>
<span id="cb45-420"><a href="#cb45-420" aria-hidden="true" tabindex="-1"></a>  tsne_data <span class="sc">%&gt;%</span></span>
<span id="cb45-421"><a href="#cb45-421" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">method =</span> <span class="st">"t-SNE"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-422"><a href="#cb45-422" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Dim1 =</span> tSNE1, <span class="at">Dim2 =</span> tSNE2)</span>
<span id="cb45-423"><a href="#cb45-423" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-424"><a href="#cb45-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-425"><a href="#cb45-425" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(comparison, <span class="fu">aes</span>(<span class="at">x =</span> Dim1, <span class="at">y =</span> Dim2, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb45-426"><a href="#cb45-426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb45-427"><a href="#cb45-427" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>method, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb45-428"><a href="#cb45-428" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-429"><a href="#cb45-429" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"PCA vs t-SNE"</span>,</span>
<span id="cb45-430"><a href="#cb45-430" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"t-SNE often reveals clearer cluster separation"</span></span>
<span id="cb45-431"><a href="#cb45-431" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-432"><a href="#cb45-432" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-433"><a href="#cb45-433" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-434"><a href="#cb45-434" aria-hidden="true" tabindex="-1"></a><span class="fu">## Anomaly Detection</span></span>
<span id="cb45-435"><a href="#cb45-435" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-436"><a href="#cb45-436" aria-hidden="true" tabindex="-1"></a>Identifying outliers and anomalies is crucial for many applications:</span>
<span id="cb45-437"><a href="#cb45-437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-440"><a href="#cb45-440" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-441"><a href="#cb45-441" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 1: Statistical approach (Z-score)</span></span>
<span id="cb45-442"><a href="#cb45-442" aria-hidden="true" tabindex="-1"></a>z_scores <span class="ot">&lt;-</span> <span class="fu">abs</span>(<span class="fu">scale</span>(scaled_data))</span>
<span id="cb45-443"><a href="#cb45-443" aria-hidden="true" tabindex="-1"></a>threshold <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb45-444"><a href="#cb45-444" aria-hidden="true" tabindex="-1"></a>outliers_zscore <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">rowSums</span>(z_scores <span class="sc">&gt;</span> threshold) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb45-445"><a href="#cb45-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-446"><a href="#cb45-446" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 2: Isolation Forest</span></span>
<span id="cb45-447"><a href="#cb45-447" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(isotree)</span>
<span id="cb45-448"><a href="#cb45-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-449"><a href="#cb45-449" aria-hidden="true" tabindex="-1"></a>iso_forest <span class="ot">&lt;-</span> <span class="fu">isolation.forest</span>(scaled_data, <span class="at">ntrees =</span> <span class="dv">100</span>, <span class="at">sample_size =</span> <span class="dv">256</span>)</span>
<span id="cb45-450"><a href="#cb45-450" aria-hidden="true" tabindex="-1"></a>outlier_scores <span class="ot">&lt;-</span> <span class="fu">predict</span>(iso_forest, scaled_data)</span>
<span id="cb45-451"><a href="#cb45-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-452"><a href="#cb45-452" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify outliers (top 5% highest scores)</span></span>
<span id="cb45-453"><a href="#cb45-453" aria-hidden="true" tabindex="-1"></a>outlier_threshold <span class="ot">&lt;-</span> <span class="fu">quantile</span>(outlier_scores, <span class="fl">0.95</span>)</span>
<span id="cb45-454"><a href="#cb45-454" aria-hidden="true" tabindex="-1"></a>outliers_iforest <span class="ot">&lt;-</span> <span class="fu">which</span>(outlier_scores <span class="sc">&gt;</span> outlier_threshold)</span>
<span id="cb45-455"><a href="#cb45-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-456"><a href="#cb45-456" aria-hidden="true" tabindex="-1"></a><span class="co"># Method 3: Local Outlier Factor (LOF)</span></span>
<span id="cb45-457"><a href="#cb45-457" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dbscan)</span>
<span id="cb45-458"><a href="#cb45-458" aria-hidden="true" tabindex="-1"></a>lof_scores <span class="ot">&lt;-</span> <span class="fu">lof</span>(scaled_data, <span class="at">minPts =</span> <span class="dv">10</span>)</span>
<span id="cb45-459"><a href="#cb45-459" aria-hidden="true" tabindex="-1"></a>outliers_lof <span class="ot">&lt;-</span> <span class="fu">which</span>(lof_scores <span class="sc">&gt;</span> <span class="fl">1.5</span>)</span>
<span id="cb45-460"><a href="#cb45-460" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-461"><a href="#cb45-461" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare methods</span></span>
<span id="cb45-462"><a href="#cb45-462" aria-hidden="true" tabindex="-1"></a>outlier_comparison <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb45-463"><a href="#cb45-463" aria-hidden="true" tabindex="-1"></a>  <span class="at">index =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(scaled_data),</span>
<span id="cb45-464"><a href="#cb45-464" aria-hidden="true" tabindex="-1"></a>  <span class="at">z_score =</span> index <span class="sc">%in%</span> outliers_zscore,</span>
<span id="cb45-465"><a href="#cb45-465" aria-hidden="true" tabindex="-1"></a>  <span class="at">isolation_forest =</span> index <span class="sc">%in%</span> outliers_iforest,</span>
<span id="cb45-466"><a href="#cb45-466" aria-hidden="true" tabindex="-1"></a>  <span class="at">lof =</span> index <span class="sc">%in%</span> outliers_lof</span>
<span id="cb45-467"><a href="#cb45-467" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb45-468"><a href="#cb45-468" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-469"><a href="#cb45-469" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_methods =</span> z_score <span class="sc">+</span> isolation_forest <span class="sc">+</span> lof,</span>
<span id="cb45-470"><a href="#cb45-470" aria-hidden="true" tabindex="-1"></a>    <span class="at">consensus_outlier =</span> n_methods <span class="sc">&gt;=</span> <span class="dv">2</span></span>
<span id="cb45-471"><a href="#cb45-471" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-472"><a href="#cb45-472" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-473"><a href="#cb45-473" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize outliers in PCA space</span></span>
<span id="cb45-474"><a href="#cb45-474" aria-hidden="true" tabindex="-1"></a>outlier_pca <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(</span>
<span id="cb45-475"><a href="#cb45-475" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>(pca_result<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]),</span>
<span id="cb45-476"><a href="#cb45-476" aria-hidden="true" tabindex="-1"></a>  outlier_comparison</span>
<span id="cb45-477"><a href="#cb45-477" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-478"><a href="#cb45-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-479"><a href="#cb45-479" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(outlier_pca, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2)) <span class="sc">+</span></span>
<span id="cb45-480"><a href="#cb45-480" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color =</span> consensus_outlier), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb45-481"><a href="#cb45-481" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"gray"</span>, <span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"red"</span>),</span>
<span id="cb45-482"><a href="#cb45-482" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Normal"</span>, <span class="st">"Outlier"</span>)) <span class="sc">+</span></span>
<span id="cb45-483"><a href="#cb45-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-484"><a href="#cb45-484" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Anomaly Detection Results"</span>,</span>
<span id="cb45-485"><a href="#cb45-485" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Points identified as outliers by at least 2 methods"</span>,</span>
<span id="cb45-486"><a href="#cb45-486" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Status"</span></span>
<span id="cb45-487"><a href="#cb45-487" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-488"><a href="#cb45-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-489"><a href="#cb45-489" aria-hidden="true" tabindex="-1"></a><span class="co"># Examine outlier characteristics</span></span>
<span id="cb45-490"><a href="#cb45-490" aria-hidden="true" tabindex="-1"></a>outlier_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(outlier_comparison<span class="sc">$</span>consensus_outlier)</span>
<span id="cb45-491"><a href="#cb45-491" aria-hidden="true" tabindex="-1"></a>outlier_analysis <span class="ot">&lt;-</span> clustering_data[outlier_indices, ] <span class="sc">%&gt;%</span></span>
<span id="cb45-492"><a href="#cb45-492" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="fu">list</span>(<span class="at">mean =</span> mean, <span class="at">median =</span> median)))</span>
<span id="cb45-493"><a href="#cb45-493" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-494"><a href="#cb45-494" aria-hidden="true" tabindex="-1"></a>normal_analysis <span class="ot">&lt;-</span> clustering_data[<span class="sc">-</span>outlier_indices, ] <span class="sc">%&gt;%</span></span>
<span id="cb45-495"><a href="#cb45-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="fu">list</span>(<span class="at">mean =</span> mean, <span class="at">median =</span> median)))</span>
<span id="cb45-496"><a href="#cb45-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-497"><a href="#cb45-497" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Outlier characteristics vs normal points:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-498"><a href="#cb45-498" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(outlier_analysis)</span>
<span id="cb45-499"><a href="#cb45-499" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(normal_analysis)</span>
<span id="cb45-500"><a href="#cb45-500" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-501"><a href="#cb45-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-502"><a href="#cb45-502" aria-hidden="true" tabindex="-1"></a><span class="fu">## Market Basket Analysis</span></span>
<span id="cb45-503"><a href="#cb45-503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-504"><a href="#cb45-504" aria-hidden="true" tabindex="-1"></a>Discover associations in transactional data:</span>
<span id="cb45-505"><a href="#cb45-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-506"><a href="#cb45-506" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb45-507"><a href="#cb45-507" aria-hidden="true" tabindex="-1"></a><span class="co"># Create synthetic transaction data</span></span>
<span id="cb45-508"><a href="#cb45-508" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb45-509"><a href="#cb45-509" aria-hidden="true" tabindex="-1"></a>n_transactions <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb45-510"><a href="#cb45-510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-511"><a href="#cb45-511" aria-hidden="true" tabindex="-1"></a><span class="co"># Housing features that might be purchased together</span></span>
<span id="cb45-512"><a href="#cb45-512" aria-hidden="true" tabindex="-1"></a>features <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Granite_Counters"</span>, <span class="st">"Hardwood_Floors"</span>, <span class="st">"Central_AC"</span>, </span>
<span id="cb45-513"><a href="#cb45-513" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Updated_Kitchen"</span>, <span class="st">"Finished_Basement"</span>, <span class="st">"Deck"</span>, </span>
<span id="cb45-514"><a href="#cb45-514" aria-hidden="true" tabindex="-1"></a>             <span class="st">"Pool"</span>, <span class="st">"Security_System"</span>, <span class="st">"Smart_Home"</span>, <span class="st">"Solar_Panels"</span>)</span>
<span id="cb45-515"><a href="#cb45-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-516"><a href="#cb45-516" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate transactions with realistic patterns</span></span>
<span id="cb45-517"><a href="#cb45-517" aria-hidden="true" tabindex="-1"></a>transactions <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>n_transactions, <span class="cf">function</span>(i) {</span>
<span id="cb45-518"><a href="#cb45-518" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Base probability for each item</span></span>
<span id="cb45-519"><a href="#cb45-519" aria-hidden="true" tabindex="-1"></a>  probs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.3</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.35</span>, <span class="fl">0.25</span>, <span class="fl">0.3</span>, <span class="fl">0.1</span>, <span class="fl">0.2</span>, <span class="fl">0.15</span>, <span class="fl">0.05</span>)</span>
<span id="cb45-520"><a href="#cb45-520" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-521"><a href="#cb45-521" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Adjust probabilities based on correlations</span></span>
<span id="cb45-522"><a href="#cb45-522" aria-hidden="true" tabindex="-1"></a>  selected <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb45-523"><a href="#cb45-523" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-524"><a href="#cb45-524" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(features)) {</span>
<span id="cb45-525"><a href="#cb45-525" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Increase probability if related items selected</span></span>
<span id="cb45-526"><a href="#cb45-526" aria-hidden="true" tabindex="-1"></a>    adj_prob <span class="ot">&lt;-</span> probs[j]</span>
<span id="cb45-527"><a href="#cb45-527" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-528"><a href="#cb45-528" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">"Granite_Counters"</span> <span class="sc">%in%</span> selected <span class="sc">&amp;&amp;</span> features[j] <span class="sc">==</span> <span class="st">"Updated_Kitchen"</span>) {</span>
<span id="cb45-529"><a href="#cb45-529" aria-hidden="true" tabindex="-1"></a>      adj_prob <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>, adj_prob <span class="sc">*</span> <span class="dv">3</span>)</span>
<span id="cb45-530"><a href="#cb45-530" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-531"><a href="#cb45-531" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">"Smart_Home"</span> <span class="sc">%in%</span> selected <span class="sc">&amp;&amp;</span> features[j] <span class="sc">==</span> <span class="st">"Security_System"</span>) {</span>
<span id="cb45-532"><a href="#cb45-532" aria-hidden="true" tabindex="-1"></a>      adj_prob <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>, adj_prob <span class="sc">*</span> <span class="fl">2.5</span>)</span>
<span id="cb45-533"><a href="#cb45-533" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-534"><a href="#cb45-534" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="st">"Pool"</span> <span class="sc">%in%</span> selected <span class="sc">&amp;&amp;</span> features[j] <span class="sc">==</span> <span class="st">"Deck"</span>) {</span>
<span id="cb45-535"><a href="#cb45-535" aria-hidden="true" tabindex="-1"></a>      adj_prob <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="dv">1</span>, adj_prob <span class="sc">*</span> <span class="dv">2</span>)</span>
<span id="cb45-536"><a href="#cb45-536" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-537"><a href="#cb45-537" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-538"><a href="#cb45-538" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">runif</span>(<span class="dv">1</span>) <span class="sc">&lt;</span> adj_prob) {</span>
<span id="cb45-539"><a href="#cb45-539" aria-hidden="true" tabindex="-1"></a>      selected <span class="ot">&lt;-</span> <span class="fu">c</span>(selected, features[j])</span>
<span id="cb45-540"><a href="#cb45-540" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-541"><a href="#cb45-541" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-542"><a href="#cb45-542" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-543"><a href="#cb45-543" aria-hidden="true" tabindex="-1"></a>  selected</span>
<span id="cb45-544"><a href="#cb45-544" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb45-545"><a href="#cb45-545" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-546"><a href="#cb45-546" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to transaction matrix</span></span>
<span id="cb45-547"><a href="#cb45-547" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arules)</span>
<span id="cb45-548"><a href="#cb45-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-549"><a href="#cb45-549" aria-hidden="true" tabindex="-1"></a>trans_matrix <span class="ot">&lt;-</span> <span class="fu">as</span>(transactions, <span class="st">"transactions"</span>)</span>
<span id="cb45-550"><a href="#cb45-550" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-551"><a href="#cb45-551" aria-hidden="true" tabindex="-1"></a><span class="co"># Find association rules</span></span>
<span id="cb45-552"><a href="#cb45-552" aria-hidden="true" tabindex="-1"></a>rules <span class="ot">&lt;-</span> <span class="fu">apriori</span>(trans_matrix, </span>
<span id="cb45-553"><a href="#cb45-553" aria-hidden="true" tabindex="-1"></a>                <span class="at">parameter =</span> <span class="fu">list</span>(<span class="at">supp =</span> <span class="fl">0.05</span>, <span class="at">conf =</span> <span class="fl">0.5</span>, <span class="at">target =</span> <span class="st">"rules"</span>))</span>
<span id="cb45-554"><a href="#cb45-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-555"><a href="#cb45-555" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect top rules</span></span>
<span id="cb45-556"><a href="#cb45-556" aria-hidden="true" tabindex="-1"></a>top_rules <span class="ot">&lt;-</span> <span class="fu">head</span>(<span class="fu">sort</span>(rules, <span class="at">by =</span> <span class="st">"lift"</span>), <span class="dv">10</span>)</span>
<span id="cb45-557"><a href="#cb45-557" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect</span>(top_rules)</span>
<span id="cb45-558"><a href="#cb45-558" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-559"><a href="#cb45-559" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize rules</span></span>
<span id="cb45-560"><a href="#cb45-560" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(arulesViz)</span>
<span id="cb45-561"><a href="#cb45-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-562"><a href="#cb45-562" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rules, <span class="at">method =</span> <span class="st">"graph"</span>, </span>
<span id="cb45-563"><a href="#cb45-563" aria-hidden="true" tabindex="-1"></a>     <span class="at">control =</span> <span class="fu">list</span>(<span class="at">type =</span> <span class="st">"items"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>),</span>
<span id="cb45-564"><a href="#cb45-564" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Association Rules Network"</span>)</span>
<span id="cb45-565"><a href="#cb45-565" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-566"><a href="#cb45-566" aria-hidden="true" tabindex="-1"></a><span class="co"># Create rule quality metrics</span></span>
<span id="cb45-567"><a href="#cb45-567" aria-hidden="true" tabindex="-1"></a>rule_metrics <span class="ot">&lt;-</span> <span class="fu">as</span>(rules, <span class="st">"data.frame"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-568"><a href="#cb45-568" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-569"><a href="#cb45-569" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(rules, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"lhs"</span>, <span class="st">"rhs"</span>), <span class="at">sep =</span> <span class="st">" =&gt; "</span>) <span class="sc">%&gt;%</span></span>
<span id="cb45-570"><a href="#cb45-570" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(lift))</span>
<span id="cb45-571"><a href="#cb45-571" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-572"><a href="#cb45-572" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(rule_metrics <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">20</span>), </span>
<span id="cb45-573"><a href="#cb45-573" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> support, <span class="at">y =</span> confidence, <span class="at">size =</span> lift, <span class="at">color =</span> lift)) <span class="sc">+</span></span>
<span id="cb45-574"><a href="#cb45-574" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb45-575"><a href="#cb45-575" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_size_continuous</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>)) <span class="sc">+</span></span>
<span id="cb45-576"><a href="#cb45-576" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>() <span class="sc">+</span></span>
<span id="cb45-577"><a href="#cb45-577" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-578"><a href="#cb45-578" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Association Rules Quality"</span>,</span>
<span id="cb45-579"><a href="#cb45-579" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Size and color represent lift"</span>,</span>
<span id="cb45-580"><a href="#cb45-580" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Support"</span>,</span>
<span id="cb45-581"><a href="#cb45-581" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Confidence"</span></span>
<span id="cb45-582"><a href="#cb45-582" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-583"><a href="#cb45-583" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-584"><a href="#cb45-584" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-585"><a href="#cb45-585" aria-hidden="true" tabindex="-1"></a><span class="fu">## Evaluating Unsupervised Models</span></span>
<span id="cb45-586"><a href="#cb45-586" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-587"><a href="#cb45-587" aria-hidden="true" tabindex="-1"></a>Without labels, evaluation is challenging but crucial:</span>
<span id="cb45-588"><a href="#cb45-588" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-589"><a href="#cb45-589" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval=FALSE}</span></span>
<span id="cb45-590"><a href="#cb45-590" aria-hidden="true" tabindex="-1"></a><span class="co"># Internal validation metrics for clustering</span></span>
<span id="cb45-591"><a href="#cb45-591" aria-hidden="true" tabindex="-1"></a>evaluate_clustering <span class="ot">&lt;-</span> <span class="cf">function</span>(data, clusters) {</span>
<span id="cb45-592"><a href="#cb45-592" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Silhouette coefficient</span></span>
<span id="cb45-593"><a href="#cb45-593" aria-hidden="true" tabindex="-1"></a>  sil <span class="ot">&lt;-</span> <span class="fu">silhouette</span>(clusters, <span class="fu">dist</span>(data))</span>
<span id="cb45-594"><a href="#cb45-594" aria-hidden="true" tabindex="-1"></a>  avg_silhouette <span class="ot">&lt;-</span> <span class="fu">mean</span>(sil[, <span class="dv">3</span>])</span>
<span id="cb45-595"><a href="#cb45-595" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-596"><a href="#cb45-596" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calinski-Harabasz Index</span></span>
<span id="cb45-597"><a href="#cb45-597" aria-hidden="true" tabindex="-1"></a>  ch_index <span class="ot">&lt;-</span> <span class="fu">cluster.stats</span>(<span class="fu">dist</span>(data), clusters)<span class="sc">$</span>ch</span>
<span id="cb45-598"><a href="#cb45-598" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-599"><a href="#cb45-599" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Davies-Bouldin Index (lower is better)</span></span>
<span id="cb45-600"><a href="#cb45-600" aria-hidden="true" tabindex="-1"></a>  db_index <span class="ot">&lt;-</span> <span class="fu">cluster.stats</span>(<span class="fu">dist</span>(data), clusters)<span class="sc">$</span>dunn</span>
<span id="cb45-601"><a href="#cb45-601" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-602"><a href="#cb45-602" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Within-cluster sum of squares</span></span>
<span id="cb45-603"><a href="#cb45-603" aria-hidden="true" tabindex="-1"></a>  wcss <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">cluster.stats</span>(<span class="fu">dist</span>(data), clusters)<span class="sc">$</span>within.cluster.ss)</span>
<span id="cb45-604"><a href="#cb45-604" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-605"><a href="#cb45-605" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(</span>
<span id="cb45-606"><a href="#cb45-606" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_silhouette =</span> avg_silhouette,</span>
<span id="cb45-607"><a href="#cb45-607" aria-hidden="true" tabindex="-1"></a>    <span class="at">calinski_harabasz =</span> ch_index,</span>
<span id="cb45-608"><a href="#cb45-608" aria-hidden="true" tabindex="-1"></a>    <span class="at">davies_bouldin =</span> db_index,</span>
<span id="cb45-609"><a href="#cb45-609" aria-hidden="true" tabindex="-1"></a>    <span class="at">wcss =</span> wcss</span>
<span id="cb45-610"><a href="#cb45-610" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-611"><a href="#cb45-611" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-612"><a href="#cb45-612" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-613"><a href="#cb45-613" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare different clustering solutions</span></span>
<span id="cb45-614"><a href="#cb45-614" aria-hidden="true" tabindex="-1"></a>clustering_methods <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb45-615"><a href="#cb45-615" aria-hidden="true" tabindex="-1"></a>  <span class="at">kmeans_3 =</span> <span class="fu">kmeans</span>(scaled_data, <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>cluster,</span>
<span id="cb45-616"><a href="#cb45-616" aria-hidden="true" tabindex="-1"></a>  <span class="at">kmeans_4 =</span> <span class="fu">kmeans</span>(scaled_data, <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>cluster,</span>
<span id="cb45-617"><a href="#cb45-617" aria-hidden="true" tabindex="-1"></a>  <span class="at">kmeans_5 =</span> <span class="fu">kmeans</span>(scaled_data, <span class="dv">5</span>, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>cluster,</span>
<span id="cb45-618"><a href="#cb45-618" aria-hidden="true" tabindex="-1"></a>  <span class="at">hierarchical =</span> <span class="fu">cutree</span>(hc_ward, <span class="at">k =</span> <span class="dv">4</span>)</span>
<span id="cb45-619"><a href="#cb45-619" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-620"><a href="#cb45-620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-621"><a href="#cb45-621" aria-hidden="true" tabindex="-1"></a>evaluation_results <span class="ot">&lt;-</span> <span class="fu">map_df</span>(clustering_methods, </span>
<span id="cb45-622"><a href="#cb45-622" aria-hidden="true" tabindex="-1"></a>                            <span class="sc">~</span> <span class="fu">evaluate_clustering</span>(scaled_data, .),</span>
<span id="cb45-623"><a href="#cb45-623" aria-hidden="true" tabindex="-1"></a>                            <span class="at">.id =</span> <span class="st">"method"</span>)</span>
<span id="cb45-624"><a href="#cb45-624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-625"><a href="#cb45-625" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(evaluation_results, <span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb45-626"><a href="#cb45-626" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-627"><a href="#cb45-627" aria-hidden="true" tabindex="-1"></a><span class="co"># Stability analysis: How consistent are clusters?</span></span>
<span id="cb45-628"><a href="#cb45-628" aria-hidden="true" tabindex="-1"></a>stability_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(data, k, <span class="at">n_bootstrap =</span> <span class="dv">10</span>) {</span>
<span id="cb45-629"><a href="#cb45-629" aria-hidden="true" tabindex="-1"></a>  bootstrap_results <span class="ot">&lt;-</span> <span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>n_bootstrap, <span class="cf">function</span>(i) {</span>
<span id="cb45-630"><a href="#cb45-630" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Bootstrap sample</span></span>
<span id="cb45-631"><a href="#cb45-631" aria-hidden="true" tabindex="-1"></a>    sample_idx <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data), <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-632"><a href="#cb45-632" aria-hidden="true" tabindex="-1"></a>    boot_data <span class="ot">&lt;-</span> data[sample_idx, ]</span>
<span id="cb45-633"><a href="#cb45-633" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-634"><a href="#cb45-634" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Cluster</span></span>
<span id="cb45-635"><a href="#cb45-635" aria-hidden="true" tabindex="-1"></a>    <span class="fu">kmeans</span>(boot_data, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">10</span>)<span class="sc">$</span>cluster</span>
<span id="cb45-636"><a href="#cb45-636" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb45-637"><a href="#cb45-637" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-638"><a href="#cb45-638" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate pairwise agreement</span></span>
<span id="cb45-639"><a href="#cb45-639" aria-hidden="true" tabindex="-1"></a>  agreements <span class="ot">&lt;-</span> <span class="fu">combn</span>(n_bootstrap, <span class="dv">2</span>, <span class="cf">function</span>(pair) {</span>
<span id="cb45-640"><a href="#cb45-640" aria-hidden="true" tabindex="-1"></a>    cl1 <span class="ot">&lt;-</span> bootstrap_results[[pair[<span class="dv">1</span>]]]</span>
<span id="cb45-641"><a href="#cb45-641" aria-hidden="true" tabindex="-1"></a>    cl2 <span class="ot">&lt;-</span> bootstrap_results[[pair[<span class="dv">2</span>]]]</span>
<span id="cb45-642"><a href="#cb45-642" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-643"><a href="#cb45-643" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Adjusted Rand Index</span></span>
<span id="cb45-644"><a href="#cb45-644" aria-hidden="true" tabindex="-1"></a>    mclust<span class="sc">::</span><span class="fu">adjustedRandIndex</span>(cl1, cl2)</span>
<span id="cb45-645"><a href="#cb45-645" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb45-646"><a href="#cb45-646" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-647"><a href="#cb45-647" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(agreements)</span>
<span id="cb45-648"><a href="#cb45-648" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-649"><a href="#cb45-649" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-650"><a href="#cb45-650" aria-hidden="true" tabindex="-1"></a>stability_scores <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb45-651"><a href="#cb45-651" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>,</span>
<span id="cb45-652"><a href="#cb45-652" aria-hidden="true" tabindex="-1"></a>  <span class="at">stability =</span> <span class="fu">map_dbl</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">6</span>, <span class="sc">~</span> <span class="fu">stability_analysis</span>(scaled_data, ., <span class="at">n_bootstrap =</span> <span class="dv">5</span>))</span>
<span id="cb45-653"><a href="#cb45-653" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-654"><a href="#cb45-654" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-655"><a href="#cb45-655" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(stability_scores, <span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> stability)) <span class="sc">+</span></span>
<span id="cb45-656"><a href="#cb45-656" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb45-657"><a href="#cb45-657" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb45-658"><a href="#cb45-658" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-659"><a href="#cb45-659" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Clustering Stability Analysis"</span>,</span>
<span id="cb45-660"><a href="#cb45-660" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Higher scores indicate more stable clusters"</span>,</span>
<span id="cb45-661"><a href="#cb45-661" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of Clusters"</span>,</span>
<span id="cb45-662"><a href="#cb45-662" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average Adjusted Rand Index"</span></span>
<span id="cb45-663"><a href="#cb45-663" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-664"><a href="#cb45-664" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-665"><a href="#cb45-665" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-666"><a href="#cb45-666" aria-hidden="true" tabindex="-1"></a><span class="fu">## Real-World Applications</span></span>
<span id="cb45-667"><a href="#cb45-667" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-668"><a href="#cb45-668" aria-hidden="true" tabindex="-1"></a><span class="fu">### Customer Segmentation</span></span>
<span id="cb45-669"><a href="#cb45-669" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-672"><a href="#cb45-672" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-673"><a href="#cb45-673" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate customer data</span></span>
<span id="cb45-674"><a href="#cb45-674" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb45-675"><a href="#cb45-675" aria-hidden="true" tabindex="-1"></a>n_customers <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb45-676"><a href="#cb45-676" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-677"><a href="#cb45-677" aria-hidden="true" tabindex="-1"></a>customer_data <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb45-678"><a href="#cb45-678" aria-hidden="true" tabindex="-1"></a>  <span class="at">customer_id =</span> <span class="dv">1</span><span class="sc">:</span>n_customers,</span>
<span id="cb45-679"><a href="#cb45-679" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">round</span>(<span class="fu">rnorm</span>(n_customers, <span class="dv">45</span>, <span class="dv">15</span>)),</span>
<span id="cb45-680"><a href="#cb45-680" aria-hidden="true" tabindex="-1"></a>  <span class="at">income =</span> <span class="fu">round</span>(<span class="fu">rlnorm</span>(n_customers, <span class="dv">11</span>, <span class="fl">0.5</span>)),</span>
<span id="cb45-681"><a href="#cb45-681" aria-hidden="true" tabindex="-1"></a>  <span class="at">spending_score =</span> <span class="fu">round</span>(<span class="fu">runif</span>(n_customers, <span class="dv">1</span>, <span class="dv">100</span>)),</span>
<span id="cb45-682"><a href="#cb45-682" aria-hidden="true" tabindex="-1"></a>  <span class="at">purchase_frequency =</span> <span class="fu">rpois</span>(n_customers, <span class="at">lambda =</span> <span class="dv">5</span>),</span>
<span id="cb45-683"><a href="#cb45-683" aria-hidden="true" tabindex="-1"></a>  <span class="at">avg_transaction =</span> <span class="fu">round</span>(<span class="fu">rlnorm</span>(n_customers, <span class="dv">4</span>, <span class="fl">0.5</span>)),</span>
<span id="cb45-684"><a href="#cb45-684" aria-hidden="true" tabindex="-1"></a>  <span class="at">online_engagement =</span> <span class="fu">round</span>(<span class="fu">runif</span>(n_customers, <span class="dv">0</span>, <span class="dv">100</span>))</span>
<span id="cb45-685"><a href="#cb45-685" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb45-686"><a href="#cb45-686" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-687"><a href="#cb45-687" aria-hidden="true" tabindex="-1"></a>    <span class="at">age =</span> <span class="fu">pmax</span>(<span class="dv">18</span>, <span class="fu">pmin</span>(<span class="dv">80</span>, age)),</span>
<span id="cb45-688"><a href="#cb45-688" aria-hidden="true" tabindex="-1"></a>    <span class="at">income =</span> <span class="fu">pmax</span>(<span class="dv">20000</span>, <span class="fu">pmin</span>(<span class="dv">200000</span>, income))</span>
<span id="cb45-689"><a href="#cb45-689" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-690"><a href="#cb45-690" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-691"><a href="#cb45-691" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocessing</span></span>
<span id="cb45-692"><a href="#cb45-692" aria-hidden="true" tabindex="-1"></a>customer_scaled <span class="ot">&lt;-</span> customer_data <span class="sc">%&gt;%</span></span>
<span id="cb45-693"><a href="#cb45-693" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>customer_id) <span class="sc">%&gt;%</span></span>
<span id="cb45-694"><a href="#cb45-694" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale</span>()</span>
<span id="cb45-695"><a href="#cb45-695" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-696"><a href="#cb45-696" aria-hidden="true" tabindex="-1"></a><span class="co"># Segment customers</span></span>
<span id="cb45-697"><a href="#cb45-697" aria-hidden="true" tabindex="-1"></a>customer_segments <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(customer_scaled, <span class="at">centers =</span> <span class="dv">4</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb45-698"><a href="#cb45-698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-699"><a href="#cb45-699" aria-hidden="true" tabindex="-1"></a><span class="co"># Profile segments</span></span>
<span id="cb45-700"><a href="#cb45-700" aria-hidden="true" tabindex="-1"></a>customer_profiles <span class="ot">&lt;-</span> customer_data <span class="sc">%&gt;%</span></span>
<span id="cb45-701"><a href="#cb45-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">segment =</span> <span class="fu">factor</span>(customer_segments<span class="sc">$</span>cluster)) <span class="sc">%&gt;%</span></span>
<span id="cb45-702"><a href="#cb45-702" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(segment) <span class="sc">%&gt;%</span></span>
<span id="cb45-703"><a href="#cb45-703" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb45-704"><a href="#cb45-704" aria-hidden="true" tabindex="-1"></a>    <span class="at">count =</span> <span class="fu">n</span>(),</span>
<span id="cb45-705"><a href="#cb45-705" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_age =</span> <span class="fu">mean</span>(age),</span>
<span id="cb45-706"><a href="#cb45-706" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_income =</span> <span class="fu">mean</span>(income),</span>
<span id="cb45-707"><a href="#cb45-707" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_spending =</span> <span class="fu">mean</span>(spending_score),</span>
<span id="cb45-708"><a href="#cb45-708" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_frequency =</span> <span class="fu">mean</span>(purchase_frequency),</span>
<span id="cb45-709"><a href="#cb45-709" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_transaction_value =</span> <span class="fu">mean</span>(avg_transaction),</span>
<span id="cb45-710"><a href="#cb45-710" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg_engagement =</span> <span class="fu">mean</span>(online_engagement)</span>
<span id="cb45-711"><a href="#cb45-711" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-712"><a href="#cb45-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-713"><a href="#cb45-713" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(customer_profiles, <span class="at">digits =</span> <span class="dv">0</span>)</span>
<span id="cb45-714"><a href="#cb45-714" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-715"><a href="#cb45-715" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize segments</span></span>
<span id="cb45-716"><a href="#cb45-716" aria-hidden="true" tabindex="-1"></a>customer_pca <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(customer_scaled)</span>
<span id="cb45-717"><a href="#cb45-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-718"><a href="#cb45-718" aria-hidden="true" tabindex="-1"></a>customer_viz <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(customer_pca<span class="sc">$</span>x[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb45-719"><a href="#cb45-719" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">segment =</span> <span class="fu">factor</span>(customer_segments<span class="sc">$</span>cluster))</span>
<span id="cb45-720"><a href="#cb45-720" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-721"><a href="#cb45-721" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(customer_viz, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> segment)) <span class="sc">+</span></span>
<span id="cb45-722"><a href="#cb45-722" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb45-723"><a href="#cb45-723" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ellipse</span>(<span class="at">level =</span> <span class="fl">0.95</span>) <span class="sc">+</span></span>
<span id="cb45-724"><a href="#cb45-724" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-725"><a href="#cb45-725" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Customer Segments"</span>,</span>
<span id="cb45-726"><a href="#cb45-726" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Four distinct customer groups identified"</span></span>
<span id="cb45-727"><a href="#cb45-727" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-728"><a href="#cb45-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-729"><a href="#cb45-729" aria-hidden="true" tabindex="-1"></a><span class="co"># Segment characteristics</span></span>
<span id="cb45-730"><a href="#cb45-730" aria-hidden="true" tabindex="-1"></a>segment_names <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb45-731"><a href="#cb45-731" aria-hidden="true" tabindex="-1"></a>  <span class="st">"1"</span> <span class="ot">=</span> <span class="st">"High-Value Engaged"</span>,</span>
<span id="cb45-732"><a href="#cb45-732" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2"</span> <span class="ot">=</span> <span class="st">"Young Browsers"</span>,</span>
<span id="cb45-733"><a href="#cb45-733" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3"</span> <span class="ot">=</span> <span class="st">"Loyal Regulars"</span>,</span>
<span id="cb45-734"><a href="#cb45-734" aria-hidden="true" tabindex="-1"></a>  <span class="st">"4"</span> <span class="ot">=</span> <span class="st">"Occasional Shoppers"</span></span>
<span id="cb45-735"><a href="#cb45-735" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-736"><a href="#cb45-736" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-737"><a href="#cb45-737" aria-hidden="true" tabindex="-1"></a>customer_profiles <span class="sc">%&gt;%</span></span>
<span id="cb45-738"><a href="#cb45-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">segment_name =</span> segment_names[<span class="fu">as.character</span>(segment)]) <span class="sc">%&gt;%</span></span>
<span id="cb45-739"><a href="#cb45-739" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(segment_name, <span class="fu">everything</span>(), <span class="sc">-</span>segment) <span class="sc">%&gt;%</span></span>
<span id="cb45-740"><a href="#cb45-740" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">0</span>)</span>
<span id="cb45-741"><a href="#cb45-741" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-742"><a href="#cb45-742" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-743"><a href="#cb45-743" aria-hidden="true" tabindex="-1"></a><span class="fu">## Best Practices</span></span>
<span id="cb45-744"><a href="#cb45-744" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-745"><a href="#cb45-745" aria-hidden="true" tabindex="-1"></a><span class="fu">### 1. Data Preprocessing is Critical</span></span>
<span id="cb45-746"><a href="#cb45-746" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-749"><a href="#cb45-749" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-750"><a href="#cb45-750" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate importance of scaling</span></span>
<span id="cb45-751"><a href="#cb45-751" aria-hidden="true" tabindex="-1"></a>unscaled_clusters <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(clustering_data, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb45-752"><a href="#cb45-752" aria-hidden="true" tabindex="-1"></a>scaled_clusters <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(scaled_data, <span class="at">centers =</span> <span class="dv">3</span>, <span class="at">nstart =</span> <span class="dv">25</span>)</span>
<span id="cb45-753"><a href="#cb45-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-754"><a href="#cb45-754" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare results</span></span>
<span id="cb45-755"><a href="#cb45-755" aria-hidden="true" tabindex="-1"></a>comparison_data <span class="ot">&lt;-</span> clustering_data <span class="sc">%&gt;%</span></span>
<span id="cb45-756"><a href="#cb45-756" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb45-757"><a href="#cb45-757" aria-hidden="true" tabindex="-1"></a>    <span class="at">unscaled =</span> <span class="fu">factor</span>(unscaled_clusters<span class="sc">$</span>cluster),</span>
<span id="cb45-758"><a href="#cb45-758" aria-hidden="true" tabindex="-1"></a>    <span class="at">scaled =</span> <span class="fu">factor</span>(scaled_clusters<span class="sc">$</span>cluster)</span>
<span id="cb45-759"><a href="#cb45-759" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-760"><a href="#cb45-760" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-761"><a href="#cb45-761" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparison_data, <span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Year_Built, </span>
<span id="cb45-762"><a href="#cb45-762" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">color =</span> unscaled)) <span class="sc">+</span></span>
<span id="cb45-763"><a href="#cb45-763" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb45-764"><a href="#cb45-764" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Unscaled Data Clustering"</span>)</span>
<span id="cb45-765"><a href="#cb45-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-766"><a href="#cb45-766" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(comparison_data, <span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Year_Built, </span>
<span id="cb45-767"><a href="#cb45-767" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">color =</span> scaled)) <span class="sc">+</span></span>
<span id="cb45-768"><a href="#cb45-768" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb45-769"><a href="#cb45-769" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Scaled Data Clustering"</span>)</span>
<span id="cb45-770"><a href="#cb45-770" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-771"><a href="#cb45-771" aria-hidden="true" tabindex="-1"></a>p1 <span class="sc">+</span> p2</span>
<span id="cb45-772"><a href="#cb45-772" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-773"><a href="#cb45-773" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-774"><a href="#cb45-774" aria-hidden="true" tabindex="-1"></a><span class="fu">### 2. Choose the Right Algorithm</span></span>
<span id="cb45-775"><a href="#cb45-775" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-778"><a href="#cb45-778" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-779"><a href="#cb45-779" aria-hidden="true" tabindex="-1"></a>algorithm_guide <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb45-780"><a href="#cb45-780" aria-hidden="true" tabindex="-1"></a>  <span class="at">Scenario =</span> <span class="fu">c</span>(</span>
<span id="cb45-781"><a href="#cb45-781" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Spherical, similar-sized clusters"</span>,</span>
<span id="cb45-782"><a href="#cb45-782" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Unknown number of clusters"</span>,</span>
<span id="cb45-783"><a href="#cb45-783" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Non-spherical clusters"</span>,</span>
<span id="cb45-784"><a href="#cb45-784" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Outliers present"</span>,</span>
<span id="cb45-785"><a href="#cb45-785" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Hierarchical structure"</span>,</span>
<span id="cb45-786"><a href="#cb45-786" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Large datasets"</span>,</span>
<span id="cb45-787"><a href="#cb45-787" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mixed data types"</span></span>
<span id="cb45-788"><a href="#cb45-788" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb45-789"><a href="#cb45-789" aria-hidden="true" tabindex="-1"></a>  <span class="st">`</span><span class="at">Recommended Algorithm</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">c</span>(</span>
<span id="cb45-790"><a href="#cb45-790" aria-hidden="true" tabindex="-1"></a>    <span class="st">"K-means"</span>,</span>
<span id="cb45-791"><a href="#cb45-791" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Hierarchical or DBSCAN"</span>,</span>
<span id="cb45-792"><a href="#cb45-792" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DBSCAN or Spectral"</span>,</span>
<span id="cb45-793"><a href="#cb45-793" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DBSCAN or Robust K-means"</span>,</span>
<span id="cb45-794"><a href="#cb45-794" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Hierarchical clustering"</span>,</span>
<span id="cb45-795"><a href="#cb45-795" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mini-batch K-means"</span>,</span>
<span id="cb45-796"><a href="#cb45-796" aria-hidden="true" tabindex="-1"></a>    <span class="st">"K-prototypes or Gower distance"</span></span>
<span id="cb45-797"><a href="#cb45-797" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-798"><a href="#cb45-798" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-799"><a href="#cb45-799" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-800"><a href="#cb45-800" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(algorithm_guide)</span>
<span id="cb45-801"><a href="#cb45-801" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-802"><a href="#cb45-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-803"><a href="#cb45-803" aria-hidden="true" tabindex="-1"></a><span class="fu">## Exercises</span></span>
<span id="cb45-804"><a href="#cb45-804" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-805"><a href="#cb45-805" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 1: Implement Custom Distance Metric</span></span>
<span id="cb45-806"><a href="#cb45-806" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-809"><a href="#cb45-809" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-810"><a href="#cb45-810" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb45-811"><a href="#cb45-811" aria-hidden="true" tabindex="-1"></a><span class="co"># Custom distance for mixed data types</span></span>
<span id="cb45-812"><a href="#cb45-812" aria-hidden="true" tabindex="-1"></a>gower_distance <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb45-813"><a href="#cb45-813" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Gower distance handles mixed types</span></span>
<span id="cb45-814"><a href="#cb45-814" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(cluster)</span>
<span id="cb45-815"><a href="#cb45-815" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-816"><a href="#cb45-816" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create mixed type data</span></span>
<span id="cb45-817"><a href="#cb45-817" aria-hidden="true" tabindex="-1"></a>  mixed_data <span class="ot">&lt;-</span> ames <span class="sc">%&gt;%</span></span>
<span id="cb45-818"><a href="#cb45-818" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(Gr_Liv_Area, Lot_Area, Neighborhood, Central_Air) <span class="sc">%&gt;%</span></span>
<span id="cb45-819"><a href="#cb45-819" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">100</span>)</span>
<span id="cb45-820"><a href="#cb45-820" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-821"><a href="#cb45-821" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate Gower distance</span></span>
<span id="cb45-822"><a href="#cb45-822" aria-hidden="true" tabindex="-1"></a>  gower_dist <span class="ot">&lt;-</span> <span class="fu">daisy</span>(mixed_data, <span class="at">metric =</span> <span class="st">"gower"</span>)</span>
<span id="cb45-823"><a href="#cb45-823" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-824"><a href="#cb45-824" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Perform clustering</span></span>
<span id="cb45-825"><a href="#cb45-825" aria-hidden="true" tabindex="-1"></a>  gower_clusters <span class="ot">&lt;-</span> <span class="fu">hclust</span>(gower_dist, <span class="at">method =</span> <span class="st">"complete"</span>)</span>
<span id="cb45-826"><a href="#cb45-826" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-827"><a href="#cb45-827" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cut tree</span></span>
<span id="cb45-828"><a href="#cb45-828" aria-hidden="true" tabindex="-1"></a>  clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(gower_clusters, <span class="at">k =</span> <span class="dv">3</span>)</span>
<span id="cb45-829"><a href="#cb45-829" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-830"><a href="#cb45-830" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Visualize</span></span>
<span id="cb45-831"><a href="#cb45-831" aria-hidden="true" tabindex="-1"></a>  mixed_data <span class="sc">%&gt;%</span></span>
<span id="cb45-832"><a href="#cb45-832" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">factor</span>(clusters)) <span class="sc">%&gt;%</span></span>
<span id="cb45-833"><a href="#cb45-833" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Gr_Liv_Area, <span class="at">y =</span> Lot_Area, <span class="at">color =</span> cluster)) <span class="sc">+</span></span>
<span id="cb45-834"><a href="#cb45-834" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb45-835"><a href="#cb45-835" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Neighborhood) <span class="sc">+</span></span>
<span id="cb45-836"><a href="#cb45-836" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Clustering with Gower Distance"</span>)</span>
<span id="cb45-837"><a href="#cb45-837" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-838"><a href="#cb45-838" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-839"><a href="#cb45-839" aria-hidden="true" tabindex="-1"></a><span class="fu">gower_distance</span>()</span>
<span id="cb45-840"><a href="#cb45-840" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-841"><a href="#cb45-841" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-842"><a href="#cb45-842" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 2: Ensemble Clustering</span></span>
<span id="cb45-843"><a href="#cb45-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-846"><a href="#cb45-846" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-847"><a href="#cb45-847" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb45-848"><a href="#cb45-848" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine multiple clustering results</span></span>
<span id="cb45-849"><a href="#cb45-849" aria-hidden="true" tabindex="-1"></a>ensemble_clustering <span class="ot">&lt;-</span> <span class="cf">function</span>(data, <span class="at">k =</span> <span class="dv">4</span>) {</span>
<span id="cb45-850"><a href="#cb45-850" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Multiple clustering algorithms</span></span>
<span id="cb45-851"><a href="#cb45-851" aria-hidden="true" tabindex="-1"></a>  km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data, <span class="at">centers =</span> k, <span class="at">nstart =</span> <span class="dv">25</span>)<span class="sc">$</span>cluster</span>
<span id="cb45-852"><a href="#cb45-852" aria-hidden="true" tabindex="-1"></a>  hc <span class="ot">&lt;-</span> <span class="fu">cutree</span>(<span class="fu">hclust</span>(<span class="fu">dist</span>(data), <span class="at">method =</span> <span class="st">"ward.D2"</span>), <span class="at">k =</span> k)</span>
<span id="cb45-853"><a href="#cb45-853" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-854"><a href="#cb45-854" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create co-association matrix</span></span>
<span id="cb45-855"><a href="#cb45-855" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(data)</span>
<span id="cb45-856"><a href="#cb45-856" aria-hidden="true" tabindex="-1"></a>  co_assoc <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, n, n)</span>
<span id="cb45-857"><a href="#cb45-857" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-858"><a href="#cb45-858" aria-hidden="true" tabindex="-1"></a>  <span class="co"># K-means contribution</span></span>
<span id="cb45-859"><a href="#cb45-859" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb45-860"><a href="#cb45-860" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb45-861"><a href="#cb45-861" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (km[i] <span class="sc">==</span> km[j]) co_assoc[i, j] <span class="ot">&lt;-</span> co_assoc[i, j] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb45-862"><a href="#cb45-862" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-863"><a href="#cb45-863" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-864"><a href="#cb45-864" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-865"><a href="#cb45-865" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Hierarchical contribution</span></span>
<span id="cb45-866"><a href="#cb45-866" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb45-867"><a href="#cb45-867" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n) {</span>
<span id="cb45-868"><a href="#cb45-868" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (hc[i] <span class="sc">==</span> hc[j]) co_assoc[i, j] <span class="ot">&lt;-</span> co_assoc[i, j] <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb45-869"><a href="#cb45-869" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-870"><a href="#cb45-870" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-871"><a href="#cb45-871" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-872"><a href="#cb45-872" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Average co-association</span></span>
<span id="cb45-873"><a href="#cb45-873" aria-hidden="true" tabindex="-1"></a>  co_assoc <span class="ot">&lt;-</span> co_assoc <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb45-874"><a href="#cb45-874" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-875"><a href="#cb45-875" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Final clustering on co-association matrix</span></span>
<span id="cb45-876"><a href="#cb45-876" aria-hidden="true" tabindex="-1"></a>  final_dist <span class="ot">&lt;-</span> <span class="fu">as.dist</span>(<span class="dv">1</span> <span class="sc">-</span> co_assoc)</span>
<span id="cb45-877"><a href="#cb45-877" aria-hidden="true" tabindex="-1"></a>  final_clusters <span class="ot">&lt;-</span> <span class="fu">cutree</span>(<span class="fu">hclust</span>(final_dist, <span class="at">method =</span> <span class="st">"average"</span>), <span class="at">k =</span> k)</span>
<span id="cb45-878"><a href="#cb45-878" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-879"><a href="#cb45-879" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(final_clusters)</span>
<span id="cb45-880"><a href="#cb45-880" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-881"><a href="#cb45-881" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-882"><a href="#cb45-882" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply ensemble clustering</span></span>
<span id="cb45-883"><a href="#cb45-883" aria-hidden="true" tabindex="-1"></a>ensemble_result <span class="ot">&lt;-</span> <span class="fu">ensemble_clustering</span>(scaled_data[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, ])</span>
<span id="cb45-884"><a href="#cb45-884" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-885"><a href="#cb45-885" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb45-886"><a href="#cb45-886" aria-hidden="true" tabindex="-1"></a>pca_subset <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pca_result<span class="sc">$</span>x[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb45-887"><a href="#cb45-887" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ensemble =</span> <span class="fu">factor</span>(ensemble_result))</span>
<span id="cb45-888"><a href="#cb45-888" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-889"><a href="#cb45-889" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pca_subset, <span class="fu">aes</span>(<span class="at">x =</span> PC1, <span class="at">y =</span> PC2, <span class="at">color =</span> ensemble)) <span class="sc">+</span></span>
<span id="cb45-890"><a href="#cb45-890" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb45-891"><a href="#cb45-891" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Ensemble Clustering Result"</span>)</span>
<span id="cb45-892"><a href="#cb45-892" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-893"><a href="#cb45-893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-894"><a href="#cb45-894" aria-hidden="true" tabindex="-1"></a><span class="fu">### Exercise 3: Clustering Interpretation</span></span>
<span id="cb45-895"><a href="#cb45-895" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-898"><a href="#cb45-898" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb45-899"><a href="#cb45-899" aria-hidden="true" tabindex="-1"></a><span class="co"># Your solution</span></span>
<span id="cb45-900"><a href="#cb45-900" aria-hidden="true" tabindex="-1"></a><span class="co"># Automated cluster interpretation</span></span>
<span id="cb45-901"><a href="#cb45-901" aria-hidden="true" tabindex="-1"></a>interpret_clusters <span class="ot">&lt;-</span> <span class="cf">function</span>(data, clusters) {</span>
<span id="cb45-902"><a href="#cb45-902" aria-hidden="true" tabindex="-1"></a>  clustered <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb45-903"><a href="#cb45-903" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cluster =</span> <span class="fu">factor</span>(clusters))</span>
<span id="cb45-904"><a href="#cb45-904" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-905"><a href="#cb45-905" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Statistical tests for each variable</span></span>
<span id="cb45-906"><a href="#cb45-906" aria-hidden="true" tabindex="-1"></a>  interpretation <span class="ot">&lt;-</span> <span class="fu">map_df</span>(<span class="fu">names</span>(data), <span class="cf">function</span>(var) {</span>
<span id="cb45-907"><a href="#cb45-907" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ANOVA for continuous variables</span></span>
<span id="cb45-908"><a href="#cb45-908" aria-hidden="true" tabindex="-1"></a>    formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(var, <span class="st">"~ cluster"</span>))</span>
<span id="cb45-909"><a href="#cb45-909" aria-hidden="true" tabindex="-1"></a>    aov_result <span class="ot">&lt;-</span> <span class="fu">aov</span>(formula, <span class="at">data =</span> clustered)</span>
<span id="cb45-910"><a href="#cb45-910" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-911"><a href="#cb45-911" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tibble</span>(</span>
<span id="cb45-912"><a href="#cb45-912" aria-hidden="true" tabindex="-1"></a>      <span class="at">variable =</span> var,</span>
<span id="cb45-913"><a href="#cb45-913" aria-hidden="true" tabindex="-1"></a>      <span class="at">f_statistic =</span> <span class="fu">summary</span>(aov_result)[[<span class="dv">1</span>]][[<span class="st">"F value"</span>]][<span class="dv">1</span>],</span>
<span id="cb45-914"><a href="#cb45-914" aria-hidden="true" tabindex="-1"></a>      <span class="at">p_value =</span> <span class="fu">summary</span>(aov_result)[[<span class="dv">1</span>]][[<span class="st">"Pr(&gt;F)"</span>]][<span class="dv">1</span>],</span>
<span id="cb45-915"><a href="#cb45-915" aria-hidden="true" tabindex="-1"></a>      <span class="at">importance =</span> <span class="fu">if_else</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"High"</span>,</span>
<span id="cb45-916"><a href="#cb45-916" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">if_else</span>(p_value <span class="sc">&lt;</span> <span class="fl">0.05</span>, <span class="st">"Medium"</span>, <span class="st">"Low"</span>))</span>
<span id="cb45-917"><a href="#cb45-917" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb45-918"><a href="#cb45-918" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb45-919"><a href="#cb45-919" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-920"><a href="#cb45-920" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Characteristic values per cluster</span></span>
<span id="cb45-921"><a href="#cb45-921" aria-hidden="true" tabindex="-1"></a>  characteristics <span class="ot">&lt;-</span> clustered <span class="sc">%&gt;%</span></span>
<span id="cb45-922"><a href="#cb45-922" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cluster) <span class="sc">%&gt;%</span></span>
<span id="cb45-923"><a href="#cb45-923" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), </span>
<span id="cb45-924"><a href="#cb45-924" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">list</span>(<span class="at">mean =</span> <span class="sc">~</span><span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb45-925"><a href="#cb45-925" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sd =</span> <span class="sc">~</span><span class="fu">sd</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))))</span>
<span id="cb45-926"><a href="#cb45-926" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-927"><a href="#cb45-927" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(</span>
<span id="cb45-928"><a href="#cb45-928" aria-hidden="true" tabindex="-1"></a>    <span class="at">importance =</span> interpretation <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(p_value),</span>
<span id="cb45-929"><a href="#cb45-929" aria-hidden="true" tabindex="-1"></a>    <span class="at">characteristics =</span> characteristics</span>
<span id="cb45-930"><a href="#cb45-930" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb45-931"><a href="#cb45-931" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-932"><a href="#cb45-932" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-933"><a href="#cb45-933" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply to our clustering</span></span>
<span id="cb45-934"><a href="#cb45-934" aria-hidden="true" tabindex="-1"></a>interpretation <span class="ot">&lt;-</span> <span class="fu">interpret_clusters</span>(clustering_data, km_result<span class="sc">$</span>cluster)</span>
<span id="cb45-935"><a href="#cb45-935" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-936"><a href="#cb45-936" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variable Importance for Clustering:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-937"><a href="#cb45-937" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(interpretation<span class="sc">$</span>importance)</span>
<span id="cb45-938"><a href="#cb45-938" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-939"><a href="#cb45-939" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Cluster Characteristics:</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-940"><a href="#cb45-940" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(interpretation<span class="sc">$</span>characteristics)</span>
<span id="cb45-941"><a href="#cb45-941" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb45-942"><a href="#cb45-942" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-943"><a href="#cb45-943" aria-hidden="true" tabindex="-1"></a><span class="fu">## Summary</span></span>
<span id="cb45-944"><a href="#cb45-944" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-945"><a href="#cb45-945" aria-hidden="true" tabindex="-1"></a>In this comprehensive chapter, you've mastered:</span>
<span id="cb45-946"><a href="#cb45-946" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-947"><a href="#cb45-947" aria-hidden="true" tabindex="-1"></a>âœ… **Clustering algorithms**</span>
<span id="cb45-948"><a href="#cb45-948" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>K-means for spherical clusters</span>
<span id="cb45-949"><a href="#cb45-949" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Hierarchical for nested structure</span>
<span id="cb45-950"><a href="#cb45-950" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>DBSCAN for arbitrary shapes</span>
<span id="cb45-951"><a href="#cb45-951" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Evaluation metrics</span>
<span id="cb45-952"><a href="#cb45-952" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-953"><a href="#cb45-953" aria-hidden="true" tabindex="-1"></a>âœ… **Dimensionality reduction**</span>
<span id="cb45-954"><a href="#cb45-954" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>PCA for linear reduction</span>
<span id="cb45-955"><a href="#cb45-955" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>t-SNE/UMAP for non-linear</span>
<span id="cb45-956"><a href="#cb45-956" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Interpretation of components</span>
<span id="cb45-957"><a href="#cb45-957" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Visualization techniques</span>
<span id="cb45-958"><a href="#cb45-958" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-959"><a href="#cb45-959" aria-hidden="true" tabindex="-1"></a>âœ… **Anomaly detection**</span>
<span id="cb45-960"><a href="#cb45-960" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Statistical methods</span>
<span id="cb45-961"><a href="#cb45-961" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Isolation forests</span>
<span id="cb45-962"><a href="#cb45-962" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Local outlier factor</span>
<span id="cb45-963"><a href="#cb45-963" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Ensemble approaches</span>
<span id="cb45-964"><a href="#cb45-964" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-965"><a href="#cb45-965" aria-hidden="true" tabindex="-1"></a>âœ… **Association analysis**</span>
<span id="cb45-966"><a href="#cb45-966" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Market basket analysis</span>
<span id="cb45-967"><a href="#cb45-967" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Rule mining</span>
<span id="cb45-968"><a href="#cb45-968" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Lift and confidence metrics</span>
<span id="cb45-969"><a href="#cb45-969" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-970"><a href="#cb45-970" aria-hidden="true" tabindex="-1"></a>âœ… **Practical applications**</span>
<span id="cb45-971"><a href="#cb45-971" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Customer segmentation</span>
<span id="cb45-972"><a href="#cb45-972" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Data preprocessing importance</span>
<span id="cb45-973"><a href="#cb45-973" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Algorithm selection</span>
<span id="cb45-974"><a href="#cb45-974" aria-hidden="true" tabindex="-1"></a><span class="ss">  - </span>Evaluation strategies</span>
<span id="cb45-975"><a href="#cb45-975" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-976"><a href="#cb45-976" aria-hidden="true" tabindex="-1"></a>Key takeaways:</span>
<span id="cb45-977"><a href="#cb45-977" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Unsupervised learning finds structure without labels</span>
<span id="cb45-978"><a href="#cb45-978" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Preprocessing (especially scaling) is crucial</span>
<span id="cb45-979"><a href="#cb45-979" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>No single best algorithm - depends on data structure</span>
<span id="cb45-980"><a href="#cb45-980" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Validation is challenging but essential</span>
<span id="cb45-981"><a href="#cb45-981" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Combine multiple methods for robustness</span>
<span id="cb45-982"><a href="#cb45-982" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>Visualization aids interpretation</span>
<span id="cb45-983"><a href="#cb45-983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-984"><a href="#cb45-984" aria-hidden="true" tabindex="-1"></a><span class="fu">## What's Next?</span></span>
<span id="cb45-985"><a href="#cb45-985" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-986"><a href="#cb45-986" aria-hidden="true" tabindex="-1"></a>In <span class="co">[</span><span class="ot">Chapter 18</span><span class="co">](18-model-deployment.Rmd)</span>, we'll learn how to deploy models to production.</span>
<span id="cb45-987"><a href="#cb45-987" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-988"><a href="#cb45-988" aria-hidden="true" tabindex="-1"></a><span class="fu">## Additional Resources</span></span>
<span id="cb45-989"><a href="#cb45-989" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-990"><a href="#cb45-990" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Introduction to Statistical Learning - Chapter 12</span><span class="co">](https://www.statlearning.com/)</span></span>
<span id="cb45-991"><a href="#cb45-991" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Elements of Statistical Learning - Chapter 14</span><span class="co">](https://hastie.su.domains/ElemStatLearn/)</span></span>
<span id="cb45-992"><a href="#cb45-992" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Cluster Analysis Book</span><span class="co">](https://www.wiley.com/en-us/Cluster+Analysis%2C+5th+Edition-p-9780470749913)</span></span>
<span id="cb45-993"><a href="#cb45-993" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span><span class="co">[</span><span class="ot">Survey of Clustering Algorithms</span><span class="co">](https://link.springer.com/article/10.1007/s40745-015-0040-1)</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>