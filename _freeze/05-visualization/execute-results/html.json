{
  "hash": "b432ae973bd37cab6e5bdf15e59ad807",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Chapter 5: Data Visualization with ggplot2\"\ndate: today\nformat:\n  html:\n    code-fold: false\n    code-tools: true\n---\n\n## Learning Objectives\n\nBy the end of this chapter, you will master:\n\n- The grammar of graphics philosophy\n- Creating basic plots: scatter, line, bar, histogram\n- Customizing aesthetics, scales, and themes\n- Creating complex multi-panel visualizations\n- Statistical layers and transformations\n- Interactive visualizations\n- Publication-ready graphics\n\n## Setup\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n-- Attaching core tidyverse packages ------------------------ tidyverse 2.0.0 --\nv dplyr     1.1.4     v readr     2.1.5\nv forcats   1.0.0     v stringr   1.5.2\nv ggplot2   4.0.0     v tibble    3.3.0\nv lubridate 1.9.4     v tidyr     1.3.1\nv purrr     1.1.0     \n-- Conflicts ------------------------------------------ tidyverse_conflicts() --\nx dplyr::filter() masks stats::filter()\nx dplyr::lag()    masks stats::lag()\ni Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(palmerpenguins)\nlibrary(gapminder)\nlibrary(patchwork)  # For combining plots\nlibrary(scales)     # For scale formatting\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAdjuntando el paquete: 'scales'\n\nThe following object is masked from 'package:purrr':\n\n    discard\n\nThe following object is masked from 'package:readr':\n\n    col_factor\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(viridis)   # For color palettes\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nCargando paquete requerido: viridisLite\n\nAdjuntando el paquete: 'viridis'\n\nThe following object is masked from 'package:scales':\n\n    viridis_pal\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(ggrepel)   # For better text labels\nlibrary(GGally)    # For pair plots\n\n# Set a default theme\ntheme_set(theme_minimal())\n```\n:::\n\n\n## The Grammar of Graphics\n\nggplot2 builds plots layer by layer:\n\n1. **Data**: The dataset\n2. **Aesthetics (aes)**: How variables map to visual properties\n3. **Geometries (geom)**: The type of plot\n4. **Facets**: Subplots\n5. **Statistics**: Statistical transformations\n6. **Coordinates**: Coordinate systems\n7. **Themes**: Overall visual appearance\n\n## Basic Plots\n\n### Scatter Plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Basic scatter plot\nggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +\n  geom_point()\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-2-1.png){width=768}\n:::\n\n```{.r .cell-code}\n# Enhanced scatter plot\nggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g)) +\n  geom_point(aes(color = species, shape = species), size = 3, alpha = 0.7) +\n  scale_color_brewer(palette = \"Set2\") +\n  labs(\n    title = \"Penguin Body Mass vs Flipper Length\",\n    subtitle = \"Data from Palmer Station, Antarctica\",\n    x = \"Flipper Length (mm)\",\n    y = \"Body Mass (g)\",\n    color = \"Species\",\n    shape = \"Species\",\n    caption = \"Source: palmerpenguins package\"\n  ) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-2-2.png){width=768}\n:::\n\n```{.r .cell-code}\n# Adding trend lines\nggplot(penguins, aes(x = flipper_length_mm, y = body_mass_g, color = species)) +\n  geom_point(size = 2, alpha = 0.6) +\n  geom_smooth(method = \"lm\", se = TRUE) +  # Linear regression with confidence interval\n  scale_color_viridis_d() +\n  facet_wrap(~island) +  # Separate panels by island\n  labs(\n    title = \"Penguin Morphology by Island\",\n    x = \"Flipper Length (mm)\",\n    y = \"Body Mass (g)\"\n  )\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-2-3.png){width=768}\n:::\n:::\n\n\n### Bar Plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Count bar plot\nggplot(penguins, aes(x = species)) +\n  geom_bar(fill = \"steelblue\") +\n  labs(title = \"Penguin Count by Species\")\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-3-1.png){width=960}\n:::\n\n```{.r .cell-code}\n# Grouped bar plot\npenguins %>%\n  count(species, island) %>%\n  ggplot(aes(x = species, y = n, fill = island)) +\n  geom_col(position = \"dodge\") +\n  scale_fill_brewer(palette = \"Set3\") +\n  labs(\n    title = \"Penguin Distribution Across Islands\",\n    x = \"Species\",\n    y = \"Count\",\n    fill = \"Island\"\n  ) +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-3-2.png){width=960}\n:::\n\n```{.r .cell-code}\n# Stacked percentage bar plot\npenguins %>%\n  count(species, sex) %>%\n  drop_na() %>%\n  group_by(species) %>%\n  mutate(percentage = n / sum(n) * 100) %>%\n  ggplot(aes(x = species, y = percentage, fill = sex)) +\n  geom_col() +\n  scale_fill_manual(values = c(\"female\" = \"#FF6B9D\", \"male\" = \"#4ECDC4\")) +\n  labs(\n    title = \"Sex Distribution by Species\",\n    x = \"Species\",\n    y = \"Percentage\",\n    fill = \"Sex\"\n  ) +\n  geom_text(aes(label = round(percentage, 1)), \n            position = position_stack(vjust = 0.5),\n            color = \"white\", fontface = \"bold\")\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-3-3.png){width=960}\n:::\n:::\n\n\n### Histograms and Density Plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Basic histogram\nggplot(penguins, aes(x = body_mass_g)) +\n  geom_histogram(bins = 30, fill = \"darkblue\", alpha = 0.7) +\n  labs(title = \"Distribution of Penguin Body Mass\")\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-4-1.png){width=960}\n:::\n\n```{.r .cell-code}\n# Density plot with fill\nggplot(penguins, aes(x = body_mass_g, fill = species)) +\n  geom_density(alpha = 0.5) +\n  scale_fill_viridis_d() +\n  labs(\n    title = \"Body Mass Distribution by Species\",\n    x = \"Body Mass (g)\",\n    y = \"Density\"\n  )\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-4-2.png){width=960}\n:::\n\n```{.r .cell-code}\n# Histogram with density overlay\nggplot(penguins, aes(x = flipper_length_mm)) +\n  geom_histogram(aes(y = after_stat(density)), \n                 bins = 30, fill = \"lightblue\", color = \"black\", alpha = 0.7) +\n  geom_density(color = \"red\", linewidth = 1.2) +\n  facet_wrap(~species, scales = \"free_y\") +\n  labs(\n    title = \"Flipper Length Distribution by Species\",\n    x = \"Flipper Length (mm)\",\n    y = \"Density\"\n  )\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-4-3.png){width=960}\n:::\n\n```{.r .cell-code}\n# Ridge plot (requires ggridges)\nif (require(ggridges, quietly = TRUE)) {\n  ggplot(penguins, aes(x = body_mass_g, y = species, fill = species)) +\n    geom_density_ridges(alpha = 0.7, scale = 1.5) +\n    scale_fill_viridis_d() +\n    labs(\n      title = \"Body Mass Distribution Ridge Plot\",\n      x = \"Body Mass (g)\",\n      y = \"Species\"\n    ) +\n    theme_minimal() +\n    theme(legend.position = \"none\")\n}\n```\n:::\n\n\n### Box Plots and Violin Plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Basic box plot\nggplot(penguins, aes(x = species, y = bill_length_mm)) +\n  geom_boxplot(fill = \"lightgreen\", alpha = 0.7) +\n  labs(title = \"Bill Length by Species\")\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-5-1.png){width=960}\n:::\n\n```{.r .cell-code}\n# Box plot with points\nggplot(penguins, aes(x = species, y = bill_length_mm, fill = species)) +\n  geom_boxplot(alpha = 0.5, outlier.shape = NA) +  # Hide outliers\n  geom_jitter(width = 0.2, alpha = 0.3) +  # Add jittered points\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(\n    title = \"Bill Length Distribution with Individual Points\",\n    x = \"Species\",\n    y = \"Bill Length (mm)\"\n  ) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-5-2.png){width=960}\n:::\n\n```{.r .cell-code}\n# Violin plot with box plot overlay\nggplot(penguins, aes(x = species, y = body_mass_g, fill = species)) +\n  geom_violin(alpha = 0.5) +\n  geom_boxplot(width = 0.2, alpha = 0.7) +\n  scale_fill_viridis_d() +\n  labs(\n    title = \"Body Mass Distribution: Violin + Box Plot\",\n    x = \"Species\",\n    y = \"Body Mass (g)\"\n  ) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-5-3.png){width=960}\n:::\n:::\n\n\n## Line Plots and Time Series\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Time series with gapminder\ngapminder %>%\n  filter(country %in% c(\"United States\", \"China\", \"India\", \"Brazil\", \"Germany\")) %>%\n  ggplot(aes(x = year, y = gdpPercap, color = country)) +\n  geom_line(linewidth = 1.2) +\n  geom_point(size = 2) +\n  scale_y_log10(labels = scales::dollar) +\n  scale_color_brewer(palette = \"Set1\") +\n  labs(\n    title = \"GDP per Capita Over Time\",\n    subtitle = \"Selected Countries (1952-2007)\",\n    x = \"Year\",\n    y = \"GDP per Capita (log scale)\",\n    color = \"Country\"\n  ) +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-6-1.png){width=1152}\n:::\n\n```{.r .cell-code}\n# Area plot\ngapminder %>%\n  filter(continent == \"Americas\") %>%\n  group_by(year) %>%\n  summarise(total_pop = sum(pop) / 1e9) %>%\n  ggplot(aes(x = year, y = total_pop)) +\n  geom_area(fill = \"steelblue\", alpha = 0.7) +\n  geom_line(color = \"darkblue\", linewidth = 1) +\n  labs(\n    title = \"Total Population of the Americas\",\n    x = \"Year\",\n    y = \"Population (billions)\"\n  )\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-6-2.png){width=1152}\n:::\n\n```{.r .cell-code}\n# Multiple lines with confidence intervals\npenguins %>%\n  drop_na() %>%\n  group_by(species, year) %>%\n  summarise(\n    mean_mass = mean(body_mass_g),\n    se_mass = sd(body_mass_g) / sqrt(n()),\n    .groups = \"drop\"\n  ) %>%\n  ggplot(aes(x = year, y = mean_mass, color = species)) +\n  geom_ribbon(aes(ymin = mean_mass - se_mass, \n                  ymax = mean_mass + se_mass, \n                  fill = species), alpha = 0.2) +\n  geom_line(linewidth = 1.2) +\n  geom_point(size = 3) +\n  scale_color_viridis_d() +\n  scale_fill_viridis_d() +\n  labs(\n    title = \"Average Penguin Body Mass by Year\",\n    subtitle = \"With standard error bands\",\n    x = \"Year\",\n    y = \"Mean Body Mass (g)\"\n  )\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-6-3.png){width=1152}\n:::\n:::\n\n\n## Advanced Aesthetics and Scales\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Custom color scales\np1 <- ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = body_mass_g)) +\n  geom_point(size = 3) +\n  scale_color_gradient(low = \"blue\", high = \"red\") +\n  labs(title = \"Gradient Color Scale\")\n\np2 <- ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = body_mass_g)) +\n  geom_point(size = 3) +\n  scale_color_viridis_c(option = \"plasma\") +\n  labs(title = \"Viridis Color Scale\")\n\np3 <- ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = species)) +\n  geom_point(size = 3) +\n  scale_color_manual(values = c(\"#E69F00\", \"#56B4E9\", \"#009E73\")) +\n  labs(title = \"Manual Color Scale\")\n\np4 <- ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, size = body_mass_g)) +\n  geom_point(alpha = 0.5, color = \"darkblue\") +\n  scale_size_continuous(range = c(1, 10)) +\n  labs(title = \"Size Scale\")\n\n# Combine plots with patchwork\n(p1 + p2) / (p3 + p4) +\n  plot_annotation(title = \"Different Scale Examples\")\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-7-1.png){width=1152}\n:::\n:::\n\n\n## Statistical Layers\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Smoothing methods\np1 <- ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"lm\", color = \"red\") +\n  labs(title = \"Linear Regression\")\n\np2 <- ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +\n  geom_point(alpha = 0.5) +\n  geom_smooth(method = \"loess\", color = \"blue\") +\n  labs(title = \"LOESS Smoothing\")\n\n# 2D density\np3 <- ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +\n  geom_density_2d_filled() +\n  geom_point(alpha = 0.3) +\n  labs(title = \"2D Density Contours\")\n\n# Hexbin plot\np4 <- ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +\n  geom_hex(bins = 20) +\n  scale_fill_viridis_c() +\n  labs(title = \"Hexagonal Binning\")\n\n(p1 + p2) / (p3 + p4)\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-8-1.png){width=1152}\n:::\n:::\n\n\n## Faceting\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Facet wrap\nggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = species)) +\n  geom_point() +\n  facet_wrap(~year, ncol = 2) +\n  scale_color_viridis_d() +\n  labs(title = \"Penguin Bills by Year\")\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-9-1.png){width=1152}\n:::\n\n```{.r .cell-code}\n# Facet grid\nggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +\n  geom_point(aes(color = sex)) +\n  geom_smooth(method = \"lm\", se = FALSE) +\n  facet_grid(species ~ island) +\n  labs(title = \"Penguin Bills: Species by Island Grid\") +\n  theme(strip.text = element_text(face = \"bold\"))\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-9-2.png){width=1152}\n:::\n\n```{.r .cell-code}\n# Free scales\npenguins %>%\n  pivot_longer(cols = contains(\"mm\"), names_to = \"measurement\", values_to = \"value\") %>%\n  ggplot(aes(x = value, fill = species)) +\n  geom_histogram(bins = 30, alpha = 0.7) +\n  facet_wrap(~measurement, scales = \"free\", ncol = 2) +\n  scale_fill_viridis_d() +\n  labs(\n    title = \"Distribution of Penguin Measurements\",\n    x = \"Value (mm)\",\n    y = \"Count\"\n  )\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-9-3.png){width=1152}\n:::\n:::\n\n\n## Annotations and Labels\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Text annotations\navg_by_species <- penguins %>%\n  group_by(species) %>%\n  summarise(\n    avg_bill_length = mean(bill_length_mm, na.rm = TRUE),\n    avg_bill_depth = mean(bill_depth_mm, na.rm = TRUE)\n  )\n\nggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = species)) +\n  geom_point(alpha = 0.5) +\n  geom_point(data = avg_by_species, \n             aes(x = avg_bill_length, y = avg_bill_depth),\n             size = 5, shape = 18) +\n  geom_text(data = avg_by_species,\n            aes(x = avg_bill_length, y = avg_bill_depth, label = species),\n            vjust = -1.5, fontface = \"bold\") +\n  annotate(\"text\", x = 55, y = 21, \n           label = \"Diamonds show\\nspecies averages\", \n           size = 4, fontface = \"italic\") +\n  annotate(\"segment\", x = 53, y = 20.5, xend = 51, yend = 19,\n           arrow = arrow(length = unit(0.3, \"cm\"))) +\n  scale_color_viridis_d() +\n  labs(\n    title = \"Penguin Bill Dimensions with Species Averages\",\n    x = \"Bill Length (mm)\",\n    y = \"Bill Depth (mm)\"\n  ) +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-10-1.png){width=960}\n:::\n\n```{.r .cell-code}\n# Using ggrepel for better label placement\nif (require(ggrepel, quietly = TRUE)) {\n  top_countries <- gapminder %>%\n    filter(year == 2007) %>%\n    arrange(desc(gdpPercap)) %>%\n    head(10)\n  \n  ggplot(top_countries, aes(x = gdpPercap, y = lifeExp)) +\n    geom_point(aes(size = pop), alpha = 0.7, color = \"steelblue\") +\n    geom_text_repel(aes(label = country), size = 3) +\n    scale_x_log10(labels = scales::dollar) +\n    scale_size_continuous(range = c(3, 15), labels = scales::comma) +\n    labs(\n      title = \"Top 10 Countries by GDP per Capita (2007)\",\n      x = \"GDP per Capita (log scale)\",\n      y = \"Life Expectancy\",\n      size = \"Population\"\n    )\n}\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-10-2.png){width=960}\n:::\n:::\n\n\n## Custom Themes\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a custom theme\ntheme_workshop <- function() {\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 16, face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(size = 12, hjust = 0.5, face = \"italic\"),\n    axis.title = element_text(size = 12, face = \"bold\"),\n    axis.text = element_text(size = 10),\n    legend.title = element_text(size = 11, face = \"bold\"),\n    legend.position = \"bottom\",\n    panel.grid.minor = element_blank(),\n    panel.border = element_rect(color = \"gray80\", fill = NA),\n    plot.background = element_rect(fill = \"gray98\"),\n    strip.background = element_rect(fill = \"gray90\"),\n    strip.text = element_text(face = \"bold\")\n  )\n}\n\n# Apply custom theme\np1 <- ggplot(penguins, aes(x = species, fill = species)) +\n  geom_bar() +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(title = \"theme_minimal()\") +\n  theme_minimal()\n\np2 <- ggplot(penguins, aes(x = species, fill = species)) +\n  geom_bar() +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(title = \"theme_classic()\") +\n  theme_classic()\n\np3 <- ggplot(penguins, aes(x = species, fill = species)) +\n  geom_bar() +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(title = \"theme_dark()\") +\n  theme_dark()\n\np4 <- ggplot(penguins, aes(x = species, fill = species)) +\n  geom_bar() +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(title = \"Custom Theme\") +\n  theme_workshop()\n\n(p1 + p2) / (p3 + p4)\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-11-1.png){width=1152}\n:::\n:::\n\n\n## Complex Visualizations\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Correlation heatmap\nif (require(corrplot, quietly = TRUE)) {\n  penguins %>%\n    select(where(is.numeric)) %>%\n    drop_na() %>%\n    cor() %>%\n    corrplot(method = \"color\", type = \"upper\", \n             order = \"hclust\", tl.cex = 0.8)\n}\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-12-1.png){width=1344}\n:::\n\n```{.r .cell-code}\n# Pair plot with GGally\nif (require(GGally, quietly = TRUE)) {\n  penguins %>%\n    select(species, bill_length_mm, bill_depth_mm, \n           flipper_length_mm, body_mass_g) %>%\n    drop_na() %>%\n    ggpairs(\n      aes(color = species),\n      upper = list(continuous = \"density\", combo = \"box_no_facet\"),\n      lower = list(continuous = \"points\", combo = \"dot_no_facet\"),\n      diag = list(continuous = \"densityDiag\"),\n      title = \"Penguin Measurements Pair Plot\"\n    ) +\n    scale_color_viridis_d() +\n    scale_fill_viridis_d()\n}\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-12-2.png){width=1344}\n:::\n\n```{.r .cell-code}\n# Complex composite visualization\nplot_data <- gapminder %>%\n  filter(year == 2007) %>%\n  mutate(pop_millions = pop / 1e6)\n\nmain_plot <- ggplot(plot_data, aes(x = gdpPercap, y = lifeExp)) +\n  geom_point(aes(size = pop_millions, color = continent), alpha = 0.6) +\n  scale_x_log10(labels = scales::dollar) +\n  scale_size_continuous(range = c(1, 15), \n                       labels = scales::comma,\n                       name = \"Population (millions)\") +\n  scale_color_brewer(palette = \"Set2\") +\n  geom_smooth(method = \"lm\", se = FALSE, color = \"gray30\", linetype = \"dashed\") +\n  labs(\n    title = \"Global Development in 2007\",\n    subtitle = \"Relationship between wealth, health, and population\",\n    x = \"GDP per Capita (log scale)\",\n    y = \"Life Expectancy (years)\",\n    caption = \"Source: Gapminder dataset\"\n  ) +\n  theme_minimal() +\n  theme(legend.position = \"right\")\n\n# Marginal distributions\nx_density <- ggplot(plot_data, aes(x = gdpPercap, fill = continent)) +\n  geom_density(alpha = 0.5) +\n  scale_x_log10() +\n  scale_fill_brewer(palette = \"Set2\") +\n  theme_void() +\n  theme(legend.position = \"none\")\n\ny_density <- ggplot(plot_data, aes(y = lifeExp, fill = continent)) +\n  geom_density(alpha = 0.5) +\n  scale_fill_brewer(palette = \"Set2\") +\n  coord_flip() +\n  theme_void() +\n  theme(legend.position = \"none\")\n\n# Combine with patchwork\nx_density / main_plot / plot_spacer() + \n  plot_layout(heights = c(1, 4, 0.1))\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-12-3.png){width=1344}\n:::\n:::\n\n\n## Interactive Visualizations\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Using plotly for interactivity\nif (require(plotly, quietly = TRUE)) {\n  # Create a simple interactive plot\n  # Note: plotly works better with simpler ggplot objects\n  penguins_clean <- penguins %>% \n    drop_na(bill_length_mm, bill_depth_mm, species)\n  \n  p <- ggplot(penguins_clean, aes(x = bill_length_mm, \n                            y = bill_depth_mm, \n                            color = species)) +\n    geom_point(size = 2) +\n    theme_minimal() +\n    labs(\n      title = \"Interactive Penguin Plot\",\n      x = \"Bill Length (mm)\",\n      y = \"Bill Depth (mm)\"\n    )\n  \n  # Try to create plotly plot, fallback to static if error\n  tryCatch({\n    ggplotly(p)\n  }, error = function(e) {\n    print(\"Note: Interactive plot failed, showing static version\")\n    print(p)\n  })\n}\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Note: Interactive plot failed, showing static version\"\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-13-1.png){width=960}\n:::\n:::\n\n\n## Saving Plots\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a publication-ready plot\nfinal_plot <- penguins %>%\n  drop_na() %>%\n  ggplot(aes(x = flipper_length_mm, y = body_mass_g)) +\n  geom_point(aes(color = species, shape = island), size = 2.5, alpha = 0.7) +\n  geom_smooth(aes(color = species), method = \"lm\", se = FALSE) +\n  scale_color_brewer(palette = \"Set1\") +\n  scale_shape_manual(values = c(16, 17, 15)) +\n  labs(\n    title = \"Palmer Penguins Morphology\",\n    subtitle = \"Relationship between flipper length and body mass\",\n    x = \"Flipper Length (mm)\",\n    y = \"Body Mass (g)\",\n    color = \"Species\",\n    shape = \"Island\",\n    caption = \"Data: Palmer Station, Antarctica\"\n  ) +\n  theme_minimal(base_size = 12) +\n  theme(\n    plot.title = element_text(face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(hjust = 0.5),\n    legend.position = \"bottom\",\n    legend.box = \"horizontal\"\n  )\n\n# Save in different formats\nggsave(\"penguin_plot.png\", final_plot, width = 10, height = 8, dpi = 300)\nggsave(\"penguin_plot.pdf\", final_plot, width = 10, height = 8)\nggsave(\"penguin_plot.svg\", final_plot, width = 10, height = 8)\n\nprint(final_plot)\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n## Exercises\n\n### Exercise 1: Create a Complex Bar Chart\n\nCreate a bar chart showing average life expectancy by continent over time using gapminder data:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your solution\ngapminder %>%\n  group_by(continent, year) %>%\n  summarise(avg_lifeExp = weighted.mean(lifeExp, pop), .groups = \"drop\") %>%\n  ggplot(aes(x = year, y = avg_lifeExp, fill = continent)) +\n  geom_col(position = \"dodge\") +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(\n    title = \"Average Life Expectancy by Continent Over Time\",\n    subtitle = \"Population-weighted averages\",\n    x = \"Year\",\n    y = \"Life Expectancy (years)\",\n    fill = \"Continent\"\n  ) +\n  theme_minimal() +\n  theme(legend.position = \"top\")\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n### Exercise 2: Multi-panel Visualization\n\nCreate a visualization showing the relationship between GDP and life expectancy for each continent, with trend lines:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your solution\ngapminder %>%\n  filter(year == 2007) %>%\n  ggplot(aes(x = gdpPercap, y = lifeExp)) +\n  geom_point(aes(size = pop, color = continent), alpha = 0.6) +\n  geom_smooth(method = \"lm\", se = FALSE, color = \"black\", linetype = \"dashed\") +\n  scale_x_log10(labels = scales::dollar) +\n  scale_size_continuous(range = c(1, 10), guide = \"none\") +\n  facet_wrap(~continent, scales = \"free\") +\n  scale_color_brewer(palette = \"Set2\") +\n  labs(\n    title = \"Wealth vs Health by Continent (2007)\",\n    x = \"GDP per Capita (log scale)\",\n    y = \"Life Expectancy\",\n    color = \"Continent\"\n  ) +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-16-1.png){width=672}\n:::\n:::\n\n\n### Exercise 3: Custom Theme\n\nCreate your own custom theme and apply it to a visualization:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your solution\ntheme_exercise <- function() {\n  theme_gray() +\n  theme(\n    plot.title = element_text(size = 18, face = \"bold\", color = \"navy\", hjust = 0.5),\n    plot.subtitle = element_text(size = 14, face = \"italic\", hjust = 0.5),\n    axis.title = element_text(size = 12, face = \"bold\", color = \"darkblue\"),\n    axis.text = element_text(size = 10),\n    panel.background = element_rect(fill = \"white\"),\n    panel.grid.major = element_line(color = \"gray90\"),\n    panel.grid.minor = element_blank(),\n    legend.background = element_rect(fill = \"gray95\"),\n    legend.key = element_rect(fill = \"white\"),\n    strip.background = element_rect(fill = \"navy\"),\n    strip.text = element_text(color = \"white\", face = \"bold\")\n  )\n}\n\npenguins %>%\n  drop_na() %>%\n  ggplot(aes(x = species, y = body_mass_g, fill = sex)) +\n  geom_violin(alpha = 0.7) +\n  geom_boxplot(width = 0.2, position = position_dodge(0.9)) +\n  scale_fill_manual(values = c(\"female\" = \"pink\", \"male\" = \"lightblue\")) +\n  labs(\n    title = \"Penguin Body Mass Distribution\",\n    subtitle = \"By species and sex\",\n    x = \"Species\",\n    y = \"Body Mass (g)\",\n    fill = \"Sex\"\n  ) +\n  theme_exercise()\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n### Exercise 4: Advanced Composite Plot\n\nCreate a dashboard-style visualization with multiple related plots:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Your solution\n# Main scatter plot\np_main <- penguins %>%\n  drop_na() %>%\n  ggplot(aes(x = flipper_length_mm, y = body_mass_g, color = species)) +\n  geom_point(size = 2, alpha = 0.6) +\n  scale_color_viridis_d() +\n  labs(\n    title = \"Penguin Morphology Dashboard\",\n    x = \"Flipper Length (mm)\",\n    y = \"Body Mass (g)\"\n  ) +\n  theme_minimal()\n\n# Species distribution\np_bar <- penguins %>%\n  count(species) %>%\n  ggplot(aes(x = species, y = n, fill = species)) +\n  geom_col() +\n  scale_fill_viridis_d() +\n  labs(title = \"Species Count\", x = \"\", y = \"Count\") +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\n# Bill measurements\np_bill <- penguins %>%\n  drop_na() %>%\n  ggplot(aes(x = bill_length_mm, y = bill_depth_mm, color = species)) +\n  geom_point(alpha = 0.6) +\n  scale_color_viridis_d() +\n  labs(\n    title = \"Bill Measurements\",\n    x = \"Length (mm)\",\n    y = \"Depth (mm)\"\n  ) +\n  theme_minimal() +\n  theme(legend.position = \"none\")\n\n# Island distribution\np_island <- penguins %>%\n  count(island, species) %>%\n  ggplot(aes(x = island, y = n, fill = species)) +\n  geom_col(position = \"fill\") +\n  scale_fill_viridis_d() +\n  labs(\n    title = \"Species by Island\",\n    x = \"Island\",\n    y = \"Proportion\"\n  ) +\n  theme_minimal()\n\n# Combine all plots\n(p_main | (p_bar / p_bill)) / p_island +\n  plot_layout(heights = c(2, 1))\n```\n\n::: {.cell-output-display}\n![](05-visualization_files/figure-html/unnamed-chunk-18-1.png){width=1344}\n:::\n:::\n\n\n## Summary\n\nYou've mastered ggplot2 essentials:\n\n✅ Grammar of graphics concepts  \n✅ Creating various plot types  \n✅ Customizing aesthetics and scales  \n✅ Using statistical layers  \n✅ Faceting for multi-panel plots  \n✅ Creating custom themes  \n✅ Building complex composite visualizations  \n\n## What's Next?\n\nIn [Chapter 6](06-functional-programming.Rmd), we'll explore functional programming with purrr, learning to apply functions efficiently across data structures.\n\n## Additional Resources\n\n- [ggplot2 Documentation](https://ggplot2.tidyverse.org/)\n- [R Graphics Cookbook](https://r-graphics.org/)\n- [ggplot2 Cheat Sheet](https://github.com/rstudio/cheatsheets/blob/main/data-visualization.pdf)\n- [Data Visualization: A Practical Introduction](https://socviz.co/)\n",
    "supporting": [
      "05-visualization_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}